from aiogram.types import Message

from src.domain.entities import User
from src.infrastructure.services import product_service
from src.infrastructure.services import logger
from src.presentation.bot.keyboard.main_menu import main_menu

async def command_start_handler(message: Message) -> None:
    user = User(
        id=str(message.from_user.id),
        username=message.from_user.username,
        chat_id=str(message.chat.id), 
    )
    try:
        product_service.create_user(user)
        logger.info(f'üë§ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user.id} —Å–æ–∑–¥–∞–Ω –∏–ª–∏ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç')

    except Exception as e:
        logger.warning(f'–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è {user.id}: {e}')

    keyboard = main_menu()
    await message.answer(
        f'''
üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {message.from_user.full_name}! –Ø ‚Äî Pricely, —Ç–≤–æ–π –ª–∏—á–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—é —Ü–µ–Ω –Ω–∞ Ozon üõí

üì¶ –ü—Ä–æ—Å—Ç–æ –ø—Ä–∏—à–ª–∏ –º–Ω–µ —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä, –∏ —è:
    ‚Ä¢ –î–æ–±–∞–≤–ª—é –µ–≥–æ –≤ —Å–ø–∏—Å–æ–∫ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è  
    ‚Ä¢ –ë—É–¥—É —Ä–µ–≥—É–ª—è—Ä–Ω–æ –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ü–µ–Ω—É  
    ‚Ä¢ –£–≤–µ–¥–æ–º–ª—é —Ç–µ–±—è, –∫–æ–≥–¥–∞ –æ–Ω–∞ —Å–Ω–∏–∑–∏—Ç—Å—è üí∏

‚ú® –ù–∞—á–Ω—ë–º? –û—Ç–ø—Ä–∞–≤—å —Å—Å—ã–ª–∫—É –Ω–∞ –ª—é–±–æ–π —Ç–æ–≤–∞—Ä —Å Ozon!
        ''',
        reply_markup=keyboard
    )

