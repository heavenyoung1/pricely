2025-09-30 14:03:52,213 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:03:52,476 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:03:52,697 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:04:01,296 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:04:01,642 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:04:02,446 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:04:02,446 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:04:02,447 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:04:02,453 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:04:02,454 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:04:02,455 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:04:02,456 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:04:02,482 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:04:02,502 - aiogram.event - INFO - Update id=557184935 is not handled. Duration 1207 ms by bot id=5702092394
2025-09-30 14:04:02,503 - aiogram.event - ERROR - Cause exception while process update id=557184935 by bot id=5702092394
UnboundLocalError: cannot access local variable 'keyboard' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 23, in command_start_handler
    reply_markup=keyboard
                 ^^^^^^^^
UnboundLocalError: cannot access local variable 'keyboard' where it is not associated with a value
2025-09-30 14:05:05,198 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:05:05,202 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:05:05,202 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:05:05,368 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:05:11,335 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:05:11,742 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:05:11,978 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:05:15,001 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:05:15,104 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:05:15,230 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:05:15,230 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:05:15,230 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:05:15,233 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:05:15,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:05:15,234 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:05:15,235 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:05:15,235 - aiogram.event - INFO - Update id=557184936 is not handled. Duration 234 ms by bot id=5702092394
2025-09-30 14:05:15,236 - aiogram.event - ERROR - Cause exception while process update id=557184936 by bot id=5702092394
ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 21, in command_start_handler
    keyboard = main_manu()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\keyboard\main_menu.py", line 8, in main_manu
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:06:12,561 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:06:12,563 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:06:12,563 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:06:12,736 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:06:17,719 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:06:18,068 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:06:18,248 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:06:20,512 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:06:20,598 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:06:20,788 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:06:20,789 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:06:20,789 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:06:20,791 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:06:20,793 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:06:20,794 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:06:20,794 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:06:20,795 - aiogram.event - INFO - Update id=557184937 is not handled. Duration 283 ms by bot id=5702092394
2025-09-30 14:06:20,796 - aiogram.event - ERROR - Cause exception while process update id=557184937 by bot id=5702092394
ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 21, in command_start_handler
    keyboard = main_menu()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\keyboard\main_menu.py", line 8, in main_menu
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:09:01,569 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:09:01,572 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:09:01,572 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:09:01,732 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:19:16,514 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:19:16,923 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:19:17,208 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:19:26,038 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:19:26,198 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:19:26,716 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:19:26,717 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:19:26,717 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:19:26,721 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:19:26,722 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:19:26,722 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:19:26,723 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:19:26,919 - aiogram.event - INFO - Update id=557184940 is handled. Duration 883 ms by bot id=5702092394
2025-09-30 14:19:29,054 - aiogram.event - INFO - Update id=557184941 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:19:31,198 - aiogram.event - INFO - Update id=557184942 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:19:33,288 - aiogram.event - INFO - Update id=557184943 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:20:03,611 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:20:03,613 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:20:03,614 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:20:03,774 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:20:09,056 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:20:09,433 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:20:09,614 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:20:13,957 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:20:14,106 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:20:14,312 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:20:14,312 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:20:14,313 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:20:14,316 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:20:14,317 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:20:14,318 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:20:14,320 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:20:14,557 - aiogram.event - INFO - Update id=557184944 is handled. Duration 600 ms by bot id=5702092394
2025-09-30 14:20:15,963 - aiogram.event - INFO - Update id=557184945 is handled. Duration 84 ms by bot id=5702092394
2025-09-30 14:20:18,480 - aiogram.event - INFO - Update id=557184946 is handled. Duration 82 ms by bot id=5702092394
2025-09-30 14:20:20,185 - aiogram.event - INFO - Update id=557184947 is handled. Duration 78 ms by bot id=5702092394
2025-09-30 15:49:34,089 - aiogram.event - INFO - Update id=557184948 is not handled. Duration 25 ms by bot id=5702092394
2025-09-30 15:49:37,721 - aiogram.event - INFO - Update id=557184949 is not handled. Duration 1 ms by bot id=5702092394
2025-09-30 16:19:41,348 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 16:19:41,388 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 16:19:41,390 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 16:19:41,492 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:49:32,994 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:49:33,703 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:49:33,964 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:49:56,048 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:49:56,282 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:49:56,791 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:49:56,792 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:49:56,792 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:49:56,799 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:49:56,800 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:49:56,801 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:49:56,802 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:49:57,040 - aiogram.event - INFO - Update id=557184950 is handled. Duration 992 ms by bot id=5702092394
2025-10-01 09:49:59,615 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:50:03,897 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:50:03,907 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:03,908 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:03,909 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:06,037 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:50:06,037 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:06,038 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:06,039 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:50:06,039 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:50:06,040 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:50:06,040 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:06,373 - aiogram.event - INFO - Update id=557184951 is handled. Duration 6759 ms by bot id=5702092394
2025-10-01 09:50:09,137 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:50:10,745 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:50:10,753 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы ➕ Добавить товар: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:10,755 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы ➕ Добавить товар: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:10,757 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:12,523 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:50:12,523 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL ➕ Добавить товар для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:12,524 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:12,525 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:50:12,525 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:50:12,526 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:50:12,526 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:12,717 - aiogram.event - INFO - Update id=557184952 is handled. Duration 3580 ms by bot id=5702092394
2025-10-01 09:51:32,221 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:51:32,224 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:51:32,225 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:51:32,384 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:51:49,927 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:51:50,553 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:51:50,815 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:53:52,318 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:53:52,320 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:53:52,320 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:53:52,493 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:54:01,419 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:54:01,854 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:54:02,050 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:54:04,608 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:54:04,745 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:54:05,594 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:54:05,594 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:54:05,595 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:54:05,602 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:54:05,603 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:54:05,603 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:54:05,604 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:54:05,822 - aiogram.event - INFO - Update id=557184953 is handled. Duration 1213 ms by bot id=5702092394
2025-10-01 09:54:09,284 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:54:10,958 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:54:10,966 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:10,967 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:10,968 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:12,879 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:54:12,880 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:12,882 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:54:12,883 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:54:12,883 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:54:12,884 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:54:12,884 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:54:12,989 - aiogram.event - INFO - Update id=557184954 is handled. Duration 3706 ms by bot id=5702092394
2025-10-01 09:56:02,082 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:56:02,087 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:56:02,089 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:56:02,244 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:56:11,020 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:56:11,402 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:56:11,626 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:56:14,929 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:56:15,026 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:56:15,306 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:56:15,307 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:56:15,307 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:56:15,310 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:56:15,311 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:56:15,311 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:56:15,312 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:56:15,557 - aiogram.event - INFO - Update id=557184955 is handled. Duration 627 ms by bot id=5702092394
2025-10-01 09:56:18,995 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:56:20,700 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:56:20,705 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:20,705 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:20,706 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:22,305 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:56:22,316 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:22,317 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:56:22,317 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:56:22,318 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:56:22,318 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:56:22,319 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:56:22,411 - aiogram.event - INFO - Update id=557184956 is handled. Duration 3415 ms by bot id=5702092394
2025-10-01 10:47:32,422 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 10:47:32,466 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 10:47:32,470 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 10:47:32,564 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 10:52:41,488 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 10:52:41,915 - aiogram.dispatcher - INFO - Start polling
2025-10-01 10:52:42,232 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 10:52:47,762 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 10:52:48,062 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 10:52:48,762 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 10:52:48,764 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 10:52:48,765 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 10:52:48,772 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 10:52:48,775 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 10:52:48,777 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 10:52:48,778 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 10:52:49,052 - aiogram.event - INFO - Update id=557184957 is handled. Duration 1291 ms by bot id=5702092394
2025-10-01 10:52:51,483 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 10:52:57,891 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 10:52:57,917 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:52:57,922 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:52:57,924 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:53:00,799 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 10:53:00,801 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:53:00,803 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 10:53:00,804 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 10:53:00,805 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 10:53:00,806 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 10:53:00,807 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = product_service.create_product(str(message.from_user.id), url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 10:53:01,347 - aiogram.event - INFO - Update id=557184958 is handled. Duration 9864 ms by bot id=5702092394
2025-10-01 13:45:06,169 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 13:45:06,197 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 13:45:06,198 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 13:45:06,305 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:56:20,420 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 13:56:20,421 - aiogram.dispatcher - INFO - Start polling
2025-10-01 13:56:20,694 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:56:30,349 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 13:56:30,526 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 13:56:30,929 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 13:56:30,930 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 13:56:30,930 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 13:56:30,933 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 13:56:30,934 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 13:56:30,935 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 13:56:30,935 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 13:56:31,138 - aiogram.event - INFO - Update id=557184959 is handled. Duration 789 ms by bot id=5702092394
2025-10-01 13:56:32,825 - aiogram.event - INFO - Update id=557184960 is handled. Duration 86 ms by bot id=5702092394
2025-10-01 13:56:38,169 - aiogram.event - INFO - Update id=557184961 is handled. Duration 88 ms by bot id=5702092394
2025-10-01 13:56:39,793 - aiogram.event - INFO - Update id=557184962 is handled. Duration 96 ms by bot id=5702092394
2025-10-01 13:59:51,434 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 13:59:51,436 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 13:59:51,436 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 13:59:51,603 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:59:57,202 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 13:59:57,204 - aiogram.dispatcher - INFO - Start polling
2025-10-01 13:59:57,515 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:00:01,254 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:00:01,389 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:00:01,649 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:00:01,651 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:00:01,651 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:00:01,654 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:01,655 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:01,656 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:00:01,657 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:00:02,053 - aiogram.event - INFO - Update id=557184963 is handled. Duration 799 ms by bot id=5702092394
2025-10-01 14:00:03,802 - aiogram.event - INFO - Update id=557184964 is handled. Duration 186 ms by bot id=5702092394
2025-10-01 14:00:05,703 - aiogram.event - INFO - Update id=557184965 is handled. Duration 208 ms by bot id=5702092394
2025-10-01 14:00:06,248 - aiogram.event - INFO - Update id=557184966 is handled. Duration 143 ms by bot id=5702092394
2025-10-01 14:00:11,309 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:00:11,324 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:00:11,326 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:00:11,326 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:00:11,333 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:11,333 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:11,334 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:00:11,335 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:00:11,511 - aiogram.event - INFO - Update id=557184967 is handled. Duration 202 ms by bot id=5702092394
2025-10-01 14:00:12,900 - aiogram.event - INFO - Update id=557184968 is handled. Duration 192 ms by bot id=5702092394
2025-10-01 14:06:41,635 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:06:41,637 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:06:41,637 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:06:41,804 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:06:46,823 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:06:46,825 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:06:47,042 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:06:57,346 - aiogram.event - INFO - Update id=557184969 is handled. Duration 633 ms by bot id=5702092394
2025-10-01 14:06:59,347 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:06:59,486 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:06:59,598 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:06:59,599 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:06:59,599 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:06:59,601 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:06:59,602 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:06:59,603 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:06:59,603 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:06:59,720 - aiogram.event - INFO - Update id=557184970 is handled. Duration 373 ms by bot id=5702092394
2025-10-01 14:07:01,064 - aiogram.event - INFO - Update id=557184971 is handled. Duration 219 ms by bot id=5702092394
2025-10-01 14:07:09,060 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:07:09,062 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:07:09,063 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:07:09,230 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:18,718 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:07:18,719 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:07:19,001 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:19,077 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:07:19,148 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:07:19,244 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:07:19,245 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:07:19,245 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:07:19,247 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:19,248 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:19,248 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:07:19,248 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:07:19,452 - aiogram.event - INFO - Update id=557184972 is handled. Duration 374 ms by bot id=5702092394
2025-10-01 14:07:21,991 - aiogram.event - INFO - Update id=557184973 is handled. Duration 100 ms by bot id=5702092394
2025-10-01 14:07:24,507 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:07:24,508 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:07:24,509 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:07:24,678 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:36,022 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:07:36,023 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:07:37,680 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:42,368 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:07:42,464 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:07:42,568 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:07:42,568 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:07:42,569 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:07:42,571 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:42,572 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:42,572 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:07:42,573 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:07:42,839 - aiogram.event - INFO - Update id=557184974 is handled. Duration 470 ms by bot id=5702092394
2025-10-01 14:07:44,646 - aiogram.event - INFO - Update id=557184975 is handled. Duration 114 ms by bot id=5702092394
2025-10-01 14:08:00,490 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:08:00,491 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:08:00,492 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:08:00,648 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:08:06,226 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:08:06,227 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:08:06,527 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:08:08,283 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:08:08,370 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:08:08,497 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:08:08,497 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:08:08,498 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:08:08,499 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:08:08,500 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:08:08,501 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:08:08,501 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:08:08,841 - aiogram.event - INFO - Update id=557184976 is handled. Duration 558 ms by bot id=5702092394
2025-10-01 14:08:10,487 - aiogram.event - INFO - Update id=557184977 is handled. Duration 115 ms by bot id=5702092394
2025-10-01 14:08:12,047 - aiogram.event - INFO - Update id=557184978 is handled. Duration 90 ms by bot id=5702092394
2025-10-01 14:08:37,875 - aiogram.event - INFO - Update id=557184979 is handled. Duration 484 ms by bot id=5702092394
2025-10-01 14:10:04,501 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:10:04,504 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:10:04,504 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:10:04,659 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:10:09,753 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:10:09,754 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:10:09,996 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:10:13,064 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:10:13,183 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:10:13,342 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:10:13,343 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:10:13,343 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:10:13,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:10:13,345 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:10:13,345 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:10:13,346 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:10:13,591 - aiogram.event - INFO - Update id=557184980 is handled. Duration 528 ms by bot id=5702092394
2025-10-01 14:10:15,448 - aiogram.event - INFO - Update id=557184981 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:23,196 - aiogram.event - INFO - Update id=557184982 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:24,174 - aiogram.event - INFO - Update id=557184983 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:24,643 - aiogram.event - INFO - Update id=557184984 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:26,039 - aiogram.event - INFO - Update id=557184985 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:26,569 - aiogram.event - INFO - Update id=557184986 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,021 - aiogram.event - INFO - Update id=557184987 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,173 - aiogram.event - INFO - Update id=557184988 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,326 - aiogram.event - INFO - Update id=557184989 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:27,475 - aiogram.event - INFO - Update id=557184990 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:27,621 - aiogram.event - INFO - Update id=557184991 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,754 - aiogram.event - INFO - Update id=557184992 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:04,449 - aiogram.event - INFO - Update id=557184993 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:06,166 - aiogram.event - INFO - Update id=557184994 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:07,247 - aiogram.event - INFO - Update id=557184995 is not handled. Duration 11 ms by bot id=5702092394
2025-10-01 14:11:08,460 - aiogram.event - INFO - Update id=557184996 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:11:09,588 - aiogram.event - INFO - Update id=557184997 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:59,623 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:11:59,624 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:11:59,624 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:11:59,799 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:12:04,722 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:12:04,724 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:12:04,724 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:12:05,028 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:12:12,782 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:12:12,873 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:12:12,979 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:12:12,979 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:12:12,979 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:12:12,981 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:12:12,982 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:12:12,983 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:12:12,984 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:12:13,921 - aiogram.event - INFO - Update id=557184998 is handled. Duration 1139 ms by bot id=5702092394
2025-10-01 14:12:17,531 - aiogram.event - INFO - Update id=557184999 is not handled. Duration 2 ms by bot id=5702092394
2025-10-01 14:15:51,305 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:15:51,308 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:15:51,308 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:15:51,452 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:15:56,526 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:15:56,528 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:15:56,529 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:15:56,745 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:00,019 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:16:00,127 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:16:00,244 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:16:00,245 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:16:00,245 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:16:00,247 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:00,248 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:00,248 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:16:00,249 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:16:01,845 - aiogram.event - INFO - Update id=557185001 is not handled. Duration 12 ms by bot id=5702092394
2025-10-01 14:16:01,895 - aiogram.event - INFO - Update id=557185000 is handled. Duration 1876 ms by bot id=5702092394
2025-10-01 14:16:04,336 - aiogram.event - INFO - Update id=557185002 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:16:05,382 - aiogram.event - INFO - Update id=557185003 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:16:07,990 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:16:07,992 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:16:07,993 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:16:08,150 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:16,420 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:16:16,422 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:16:16,423 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:16:16,605 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:23,009 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:16:23,092 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:16:23,193 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:16:23,194 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:16:23,194 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:16:23,196 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:23,197 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:23,198 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:16:23,198 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:16:23,466 - aiogram.event - INFO - Update id=557185004 is handled. Duration 456 ms by bot id=5702092394
2025-10-01 14:16:25,675 - aiogram.event - INFO - Update id=557185005 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:31:36,200 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:31:36,212 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:31:36,213 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:31:36,381 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:31:42,036 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:31:42,038 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:31:42,327 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:31:48,754 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:31:48,875 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:31:49,002 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:31:49,002 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:31:49,003 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:31:49,005 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:31:49,005 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:31:49,006 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:31:49,007 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:31:49,394 - aiogram.event - INFO - Update id=557185006 is handled. Duration 640 ms by bot id=5702092394
2025-10-01 14:31:51,107 - aiogram.event - INFO - Update id=557185007 is handled. Duration 113 ms by bot id=5702092394
2025-10-01 14:31:53,743 - aiogram.event - INFO - Update id=557185008 is handled. Duration 248 ms by bot id=5702092394
2025-10-01 14:31:54,371 - aiogram.event - INFO - Update id=557185009 is handled. Duration 257 ms by bot id=5702092394
2025-10-01 14:31:55,767 - aiogram.event - INFO - Update id=557185010 is handled. Duration 90 ms by bot id=5702092394
2025-10-01 14:31:56,518 - aiogram.event - INFO - Update id=557185011 is handled. Duration 121 ms by bot id=5702092394
2025-10-01 14:31:57,634 - aiogram.event - INFO - Update id=557185012 is handled. Duration 92 ms by bot id=5702092394
2025-10-01 14:31:58,465 - aiogram.event - INFO - Update id=557185013 is handled. Duration 162 ms by bot id=5702092394
2025-10-01 14:31:59,538 - aiogram.event - INFO - Update id=557185014 is handled. Duration 95 ms by bot id=5702092394
2025-10-01 14:40:41,605 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:40:41,607 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:40:41,608 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:40:41,751 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:40:47,477 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:40:47,479 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:40:47,709 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:40:55,327 - aiogram.event - INFO - Update id=557185015 is handled. Duration 268 ms by bot id=5702092394
2025-10-01 14:40:58,013 - aiogram.event - INFO - Update id=557185016 is handled. Duration 102 ms by bot id=5702092394
2025-10-01 14:40:58,357 - aiogram.event - INFO - Update id=557185017 is handled. Duration 85 ms by bot id=5702092394
2025-10-01 14:40:58,768 - aiogram.event - INFO - Update id=557185018 is handled. Duration 106 ms by bot id=5702092394
2025-10-01 14:40:59,700 - aiogram.event - INFO - Update id=557185019 is handled. Duration 111 ms by bot id=5702092394
2025-10-01 14:41:00,238 - aiogram.event - INFO - Update id=557185020 is handled. Duration 145 ms by bot id=5702092394
2025-10-01 14:41:00,565 - aiogram.event - INFO - Update id=557185021 is handled. Duration 169 ms by bot id=5702092394
2025-10-01 14:42:58,885 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:42:58,887 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:42:58,887 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:42:59,068 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:46:54,532 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:46:54,545 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:46:54,839 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:46:59,589 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:46:59,711 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:46:59,877 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:46:59,877 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:46:59,878 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:46:59,880 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:46:59,881 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:46:59,882 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:46:59,882 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:47:00,188 - aiogram.event - INFO - Update id=557185022 is handled. Duration 599 ms by bot id=5702092394
2025-10-01 14:47:01,810 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:47:01,810 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 14:47:01,862 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 14:47:01,895 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 14:47:01,923 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 14:47:01,928 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 14:47:01,931 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 14:47:01,932 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:47:01,932 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:47:01,933 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 55, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 14:47:02,138 - aiogram.event - INFO - Update id=557185023 is handled. Duration 329 ms by bot id=5702092394
2025-10-01 14:47:07,772 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:47:07,982 - aiogram.event - INFO - Update id=557185024 is handled. Duration 212 ms by bot id=5702092394
2025-10-01 14:48:31,440 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:31,442 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:48:41,627 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:48:56,941 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:56,942 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:57,902 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-01 14:48:58,004 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-01 14:48:58,066 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-01 14:48:58,134 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1568
2025-10-01 14:48:58,202 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1705
2025-10-01 14:48:58,243 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-01 14:48:58,435 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-01 14:49:00,996 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:49:00,997 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1568, 'price_without_card': 1705, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-01 14:49:01,004 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 1668950019 не найден
2025-10-01 14:49:01,011 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:49:01,014 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='1668950019', user_id='515084006', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories=['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX'], prices=[Price(id=None, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))])
2025-10-01 14:49:01,018 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))
2025-10-01 14:49:01,019 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 1668950019 пользователю ID 515084006
2025-10-01 14:49:01,021 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-01 14:49:01,133 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:49:01,134 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:49:01,134 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:49:01,135 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 35, in add_product_process
    reply_markup=build_product_actions_keyboard(result['id'], result['link'])
                                                ~~~~~~^^^^^^
KeyError: 'id'
2025-10-01 14:49:01,389 - aiogram.event - INFO - Update id=557185025 is handled. Duration 29954 ms by bot id=5702092394
2025-10-01 14:50:20,486 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:50:20,487 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:50:20,488 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:50:20,647 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:50:29,353 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:50:29,355 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:50:29,952 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:50:33,251 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:50:33,411 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:50:33,636 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:50:33,636 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:50:33,637 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:50:33,642 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:50:33,643 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:50:33,644 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:50:33,645 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:50:34,138 - aiogram.event - INFO - Update id=557185026 is handled. Duration 887 ms by bot id=5702092394
2025-10-01 14:50:35,301 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:50:35,469 - aiogram.event - INFO - Update id=557185027 is handled. Duration 169 ms by bot id=5702092394
2025-10-01 14:50:37,717 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:50:37,718 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:50:39,403 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:50:54,172 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:50:54,172 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:51:05,752 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-01 14:51:05,797 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-01 14:51:05,845 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-01 14:51:05,917 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1568
2025-10-01 14:51:05,973 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1705
2025-10-01 14:51:06,011 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-01 14:51:06,151 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-01 14:51:08,955 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:51:08,956 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1568, 'price_without_card': 1705, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-01 14:51:08,983 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 14:51:08,984 - src.application.use_cases.create_product - ERROR - Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,984 - src.core.uow - WARNING - Исключение в Unit of Work: ProductCreationError: Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,988 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 14:51:08,989 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:51:08,989 - src.core.decorators - ERROR - Ошибка в функции create_product: Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,990 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 29, in add_product_process
    result = product_service.create_product(str(message.from_user.id), url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 41, in execute
    raise ProductCreationError(f'Товар с ID {product_data['id']} уже существует')
src.domain.exceptions.ProductCreationError: Товар с ID 1668950019 уже существует
2025-10-01 14:51:09,364 - aiogram.event - INFO - Update id=557185028 is handled. Duration 31649 ms by bot id=5702092394
2025-10-01 14:51:26,939 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:51:26,975 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:51:26,976 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:51:26,977 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:51:26,984 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:51:26,985 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:51:26,986 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:51:26,987 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:51:27,084 - aiogram.event - INFO - Update id=557185029 is handled. Duration 145 ms by bot id=5702092394
2025-10-01 14:51:27,942 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:51:28,175 - aiogram.event - INFO - Update id=557185030 is handled. Duration 235 ms by bot id=5702092394
2025-10-01 14:51:30,687 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:51:30,687 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:51:32,224 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:51:47,650 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:51:47,650 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:52:22,082 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1565602444
2025-10-01 14:52:22,120 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Ray-Ban Очки солнцезащитные
2025-10-01 14:52:22,164 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.7
2025-10-01 14:52:22,210 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 737
2025-10-01 14:52:22,254 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 805
2025-10-01 14:52:22,289 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg
2025-10-01 14:52:22,440 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']
2025-10-01 14:52:24,109 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:52:24,110 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/: {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'rating': 4.7, 'price_with_card': 737, 'price_without_card': 805, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'categories': ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']}
2025-10-01 14:52:24,118 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 1565602444 не найден
2025-10-01 14:52:24,125 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:52:24,129 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='1565602444', user_id='515084006', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories=['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban'], prices=[Price(id=None, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))])
2025-10-01 14:52:24,135 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))
2025-10-01 14:52:24,136 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 1565602444 пользователю ID 515084006
2025-10-01 14:52:24,136 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-01 14:52:24,175 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:52:24,176 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:52:24,177 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:52:24,179 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 35, in add_product_process
    reply_markup=build_product_actions_keyboard(result['product_id'], result['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 14:52:24,694 - aiogram.event - INFO - Update id=557185031 is handled. Duration 54008 ms by bot id=5702092394
2025-10-01 16:10:20,384 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:10:20,411 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:10:20,414 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:10:20,522 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:10:29,073 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:10:29,075 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:10:29,331 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:10:34,883 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:10:35,032 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:10:35,341 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:10:35,342 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:10:35,342 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:10:35,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:35,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:35,345 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:10:35,345 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:10:36,785 - aiogram.event - INFO - Update id=557185032 is handled. Duration 1903 ms by bot id=5702092394
2025-10-01 16:10:37,915 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:10:37,916 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:10:37,957 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:10:37,978 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:10:37,996 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:10:38,007 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:10:38,021 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:10:38,026 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:10:38,029 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:10:38,030 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:38,031 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:10:38,032 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:10:38,158 - aiogram.event - INFO - Update id=557185033 is handled. Duration 244 ms by bot id=5702092394
2025-10-01 16:12:59,272 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:12:59,274 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:12:59,274 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:12:59,423 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:13:04,785 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:13:04,787 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:13:07,716 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:13:08,072 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:13:08,155 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:13:08,231 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:13:08,232 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:13:08,232 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:13:08,235 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:13:08,534 - aiogram.event - INFO - Update id=557185034 is handled. Duration 462 ms by bot id=5702092394
2025-10-01 16:13:11,686 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:13:11,687 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:13:11,729 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:13:11,756 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:13:11,782 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:13:11,802 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:13:11,824 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:13:11,829 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:13:11,839 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:13:11,840 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:11,841 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:13:11,842 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:13:12,296 - aiogram.event - INFO - Update id=557185035 is handled. Duration 612 ms by bot id=5702092394
2025-10-01 16:13:53,153 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:13:53,154 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:13:53,155 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:13:53,322 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:14:00,260 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:14:00,261 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:14:01,595 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:14:05,043 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:14:05,144 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:14:05,237 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:14:05,238 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:14:05,238 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:14:05,240 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:05,241 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:05,241 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:14:05,242 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:14:06,784 - aiogram.event - INFO - Update id=557185036 is handled. Duration 1741 ms by bot id=5702092394
2025-10-01 16:14:08,398 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:14:08,399 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:14:08,426 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:14:08,438 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:14:08,461 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:14:08,475 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:14:08,486 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:14:08,490 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:14:08,493 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:14:08,493 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:08,494 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:14:08,495 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:14:08,626 - aiogram.event - INFO - Update id=557185037 is handled. Duration 230 ms by bot id=5702092394
2025-10-01 16:17:10,998 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:17:11,001 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:17:11,001 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:17:11,157 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:16,053 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:17:16,055 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:17:16,344 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:19,789 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:17:19,892 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:19,970 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:17:19,971 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:17:19,971 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:17:19,973 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:19,973 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:19,974 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:19,974 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:17:20,226 - aiogram.event - INFO - Update id=557185038 is handled. Duration 436 ms by bot id=5702092394
2025-10-01 16:17:21,161 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:21,162 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:17:21,191 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:17:21,209 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:17:21,227 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:17:21,241 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:17:21,249 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:17:21,254 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:17:21,257 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:17:21,258 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:21,258 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:21,259 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:17:21,389 - aiogram.event - INFO - Update id=557185039 is handled. Duration 229 ms by bot id=5702092394
2025-10-01 16:17:29,244 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:17:29,246 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:17:29,246 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:17:29,409 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:35,297 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:17:35,299 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:17:36,886 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:40,537 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:17:40,605 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:40,691 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:17:40,691 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:17:40,692 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:17:40,693 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:40,694 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:40,694 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:40,694 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:17:40,959 - aiogram.event - INFO - Update id=557185040 is handled. Duration 422 ms by bot id=5702092394
2025-10-01 16:17:43,124 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:43,125 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:17:43,149 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:17:43,163 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:17:43,199 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:17:43,212 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:17:43,224 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:17:43,227 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:17:43,230 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:17:43,231 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:43,231 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:43,232 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:17:43,359 - aiogram.event - INFO - Update id=557185041 is handled. Duration 235 ms by bot id=5702092394
2025-10-01 16:19:18,115 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:19:18,118 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:19:18,119 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:19:18,271 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:24,675 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:19:24,678 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:19:24,919 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:27,896 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:19:27,984 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:19:28,038 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:19:28,039 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:19:28,039 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:19:28,040 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:28,041 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:28,041 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:19:28,041 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:19:28,250 - aiogram.event - INFO - Update id=557185042 is handled. Duration 353 ms by bot id=5702092394
2025-10-01 16:19:29,365 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:19:29,365 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:19:29,391 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:19:29,414 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:19:29,431 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:19:29,451 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:19:29,463 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:19:29,467 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:19:29,469 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:19:29,470 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:29,470 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:19:29,470 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 104, in get_my_product_list
    inline_buttons.add(InlineKeyboardButton(text=display, callback_data=f"product:{p['id']}"))
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'add'
2025-10-01 16:19:29,579 - aiogram.event - INFO - Update id=557185043 is handled. Duration 216 ms by bot id=5702092394
2025-10-01 16:19:49,729 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:19:49,732 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:19:49,732 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:19:49,860 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:54,479 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:19:54,481 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:19:54,724 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:20:00,600 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:20:00,719 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:20:00,719 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:20:00,796 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:20:00,806 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:20:00,817 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:20:00,828 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:20:00,839 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:20:00,843 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:20:00,846 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:20:00,846 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:20:00,847 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:20:01,049 - aiogram.event - INFO - Update id=557185044 is handled. Duration 451 ms by bot id=5702092394
2025-10-01 16:20:04,623 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:20:04,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:20:04,636 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:20:04,638 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:20:04,638 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:20:04,639 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:20:04,639 - src.infrastructure.services.logger - ERROR - Ошибка в handle_product_button
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:20:04,719 - aiogram.event - INFO - Update id=557185045 is not handled. Duration 170 ms by bot id=5702092394
2025-10-01 16:20:04,720 - aiogram.event - ERROR - Cause exception while process update id=557185045 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 159, in handle_product_button
    await call.answer(f'Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:21:57,755 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:21:57,757 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:21:57,757 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:21:57,921 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:03,557 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:22:03,560 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:22:04,436 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:07,117 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:22:07,198 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:07,276 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:22:07,277 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:22:07,277 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:22:07,279 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:07,280 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:07,281 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:07,281 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:22:07,542 - aiogram.event - INFO - Update id=557185046 is handled. Duration 424 ms by bot id=5702092394
2025-10-01 16:22:08,717 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:08,718 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:22:08,742 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:22:08,756 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:22:08,769 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:22:08,783 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:22:08,799 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:22:08,804 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:22:08,806 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:22:08,806 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:08,807 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:08,809 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:22:08,970 - aiogram.event - INFO - Update id=557185047 is not handled. Duration 254 ms by bot id=5702092394
2025-10-01 16:22:08,971 - aiogram.event - ERROR - Cause exception while process update id=557185047 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: message is too long
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 114, in get_my_product_list
    await message.answer(f'❌ Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is too long
2025-10-01 16:22:18,863 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:22:18,865 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:22:18,866 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:22:19,034 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:25,320 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:22:25,323 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:22:25,565 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:28,671 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:22:28,749 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:28,810 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:22:28,810 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:22:28,811 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:22:28,812 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:28,813 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:28,813 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:28,814 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:22:29,069 - aiogram.event - INFO - Update id=557185048 is handled. Duration 398 ms by bot id=5702092394
2025-10-01 16:22:30,420 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:30,421 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:22:30,453 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:22:30,474 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:22:30,490 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:22:30,506 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:22:30,521 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:22:30,525 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:22:30,528 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:22:30,529 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:30,530 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:30,531 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:22:30,660 - aiogram.event - INFO - Update id=557185049 is not handled. Duration 241 ms by bot id=5702092394
2025-10-01 16:22:30,660 - aiogram.event - ERROR - Cause exception while process update id=557185049 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: message is too long
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 114, in get_my_product_list
    await message.answer(f'❌ Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is too long
2025-10-01 16:22:54,971 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:22:54,972 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:22:54,972 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:22:55,147 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:23:01,808 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:23:01,810 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:23:02,033 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:23:04,798 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:23:04,934 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:23:04,935 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:23:05,025 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:23:05,038 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:23:05,051 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:23:05,068 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:23:05,083 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:23:05,089 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:23:05,091 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:23:05,092 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:23:05,092 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:23:05,618 - aiogram.event - INFO - Update id=557185050 is handled. Duration 826 ms by bot id=5702092394
2025-10-01 16:24:04,757 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:24:04,770 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:24:04,774 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:24:04,776 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:24:04,777 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:24:04,777 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:24:04,778 - src.infrastructure.services.logger - ERROR - Ошибка в handle_product_button
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:24:04,866 - aiogram.event - INFO - Update id=557185051 is not handled. Duration 193 ms by bot id=5702092394
2025-10-01 16:24:04,866 - aiogram.event - ERROR - Cause exception while process update id=557185051 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 159, in handle_product_button
    await call.answer(f'Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:25:51,011 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:25:51,015 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:25:51,015 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:25:51,276 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:25:57,951 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:25:57,953 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:26:00,461 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:26:02,250 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:26:02,336 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:26:02,394 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:26:02,394 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:26:02,394 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:26:02,396 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:02,396 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:02,397 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:26:02,397 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:26:02,648 - aiogram.event - INFO - Update id=557185052 is handled. Duration 398 ms by bot id=5702092394
2025-10-01 16:26:04,286 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:26:04,286 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:26:04,305 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:26:04,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:26:04,351 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:26:04,364 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:26:04,372 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:26:04,376 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:26:04,378 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:26:04,379 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:04,379 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:26:04,380 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 105, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=[[inline_buttons]])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:26:04,544 - aiogram.event - INFO - Update id=557185053 is handled. Duration 258 ms by bot id=5702092394
2025-10-01 16:27:47,151 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:27:47,153 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:27:47,154 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:27:47,322 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:53:41,975 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:53:41,978 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:53:42,246 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:53:46,455 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:53:46,640 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:46,944 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:53:46,945 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:53:46,946 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:53:46,947 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:46,948 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:46,949 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:46,949 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:53:47,752 - aiogram.event - INFO - Update id=557185060 is handled. Duration 1298 ms by bot id=5702092394
2025-10-01 16:53:48,172 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:48,174 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:53:48,206 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:48,226 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:53:48,249 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:53:48,270 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:53:48,284 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:53:48,288 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:53:48,290 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:48,291 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:48,291 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:48,388 - aiogram.event - INFO - Update id=557185061 is handled. Duration 216 ms by bot id=5702092394
2025-10-01 16:53:49,806 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:49,816 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:49,819 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:53:49,821 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:49,822 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:49,822 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:50,011 - aiogram.event - INFO - Update id=557185062 is handled. Duration 322 ms by bot id=5702092394
2025-10-01 16:53:57,128 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:57,129 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:53:57,156 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:57,173 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:53:57,188 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:53:57,205 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:53:57,223 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:53:57,234 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:53:57,237 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:57,238 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:57,239 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:57,239 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-01 16:53:57,388 - aiogram.event - INFO - Update id=557185063 is not handled. Duration 380 ms by bot id=5702092394
2025-10-01 16:53:57,389 - aiogram.event - ERROR - Cause exception while process update id=557185063 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:54:32,844 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:54:32,848 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:54:32,849 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:54:33,013 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:54:41,014 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:54:41,018 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:54:41,225 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:54:50,703 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:54:50,817 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:50,927 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:54:50,927 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:54:50,928 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:54:50,929 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:50,930 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:50,930 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:50,931 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:54:51,186 - aiogram.event - INFO - Update id=557185064 is handled. Duration 482 ms by bot id=5702092394
2025-10-01 16:54:52,946 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:52,946 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:54:52,970 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:54:52,995 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:54:53,012 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:54:53,029 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:54:53,047 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:54:53,053 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:54:53,055 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:54:53,056 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:53,056 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:53,155 - aiogram.event - INFO - Update id=557185065 is handled. Duration 210 ms by bot id=5702092394
2025-10-01 16:54:56,162 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:56,175 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:54:56,180 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:54:56,183 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:54:56,184 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:56,184 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:56,385 - aiogram.event - INFO - Update id=557185066 is handled. Duration 429 ms by bot id=5702092394
2025-10-01 16:55:58,004 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:55:58,008 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:55:58,008 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:55:58,141 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:36:19,468 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:36:19,482 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:36:20,280 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:36:20,442 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:36:20,537 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:20,726 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:36:20,726 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:36:20,727 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:36:20,730 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:20,730 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:20,731 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:20,732 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:36:21,010 - aiogram.event - INFO - Update id=557185070 is handled. Duration 569 ms by bot id=5702092394
2025-10-02 18:36:24,308 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:24,345 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:36:24,346 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:36:24,347 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:36:24,354 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:24,356 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:24,357 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:24,358 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:36:24,453 - aiogram.event - INFO - Update id=557185071 is handled. Duration 145 ms by bot id=5702092394
2025-10-02 18:36:25,817 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:25,818 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:36:25,892 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:36:25,942 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:36:25,987 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:36:26,016 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:36:26,045 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:36:26,056 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:36:26,065 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:36:26,067 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:26,068 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:26,177 - aiogram.event - INFO - Update id=557185072 is handled. Duration 362 ms by bot id=5702092394
2025-10-02 18:36:28,119 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:28,170 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:36:28,177 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:36:28,181 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:36:28,183 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:28,184 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:28,297 - aiogram.event - INFO - Update id=557185073 is handled. Duration 298 ms by bot id=5702092394
2025-10-02 18:36:32,524 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:32,525 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:36:32,593 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:36:32,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:36:32,676 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:36:32,712 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:36:32,744 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:36:32,763 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:36:32,767 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:36:32,769 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:32,770 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:32,771 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:36:32,992 - aiogram.event - INFO - Update id=557185074 is not handled. Duration 554 ms by bot id=5702092394
2025-10-02 18:36:32,993 - aiogram.event - ERROR - Cause exception while process update id=557185074 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:36:34,250 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:34,252 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:36:34,323 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:36:34,362 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:36:34,402 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:36:34,441 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:36:34,467 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:36:34,476 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:36:34,480 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:36:34,481 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:34,482 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:34,484 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:36:34,669 - aiogram.event - INFO - Update id=557185075 is not handled. Duration 606 ms by bot id=5702092394
2025-10-02 18:36:34,670 - aiogram.event - ERROR - Cause exception while process update id=557185075 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:36:47,227 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:36:47,239 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:36:47,240 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:36:47,405 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:36:54,572 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:36:54,575 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:36:54,836 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:39:20,874 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:39:20,877 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:39:20,877 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:39:21,068 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:39:28,889 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:39:28,893 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:39:29,136 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:39:33,950 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:39:34,143 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:39:34,677 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:39:34,678 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:39:34,678 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:39:34,688 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:34,689 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:34,690 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:39:34,691 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:39:35,001 - aiogram.event - INFO - Update id=557185076 is handled. Duration 1055 ms by bot id=5702092394
2025-10-02 18:39:36,141 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:39:36,142 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:39:36,238 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:39:36,291 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:39:36,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:39:36,373 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:39:36,409 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:39:36,428 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:39:36,436 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:39:36,437 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:36,438 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:39:36,592 - aiogram.event - INFO - Update id=557185077 is handled. Duration 453 ms by bot id=5702092394
2025-10-02 18:39:39,152 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:39:39,201 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:39:39,212 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:39:39,218 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:39:39,219 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:39,220 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:39:39,352 - aiogram.event - INFO - Update id=557185078 is handled. Duration 317 ms by bot id=5702092394
2025-10-02 18:39:41,122 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:39:41,123 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:39:41,334 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:39:41,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:39:41,911 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:39:42,144 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:39:42,180 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:39:42,195 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:39:42,201 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:39:42,202 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:42,202 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:39:42,203 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:39:42,347 - aiogram.event - INFO - Update id=557185079 is not handled. Duration 1356 ms by bot id=5702092394
2025-10-02 18:39:42,348 - aiogram.event - ERROR - Cause exception while process update id=557185079 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:26,574 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:44:26,578 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:44:26,579 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:44:26,687 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:44:33,164 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:44:33,167 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:44:33,399 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:44:40,385 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:44:40,597 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:40,876 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:44:40,877 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:44:40,877 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:44:40,882 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:40,883 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:40,885 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:40,886 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:44:41,236 - aiogram.event - INFO - Update id=557185080 is handled. Duration 852 ms by bot id=5702092394
2025-10-02 18:44:42,381 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:42,381 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:42,453 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:42,500 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:42,541 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:42,580 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:42,612 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:42,620 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:42,624 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:42,625 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:42,626 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:42,792 - aiogram.event - INFO - Update id=557185081 is handled. Duration 416 ms by bot id=5702092394
2025-10-02 18:44:44,805 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:44,876 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:44,888 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:44:44,897 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:44,898 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:44,899 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:45,109 - aiogram.event - INFO - Update id=557185082 is handled. Duration 517 ms by bot id=5702092394
2025-10-02 18:44:46,550 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:46,551 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:46,583 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:46,610 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:46,642 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:46,679 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:46,707 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:46,720 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:46,725 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:46,726 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:46,728 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:46,731 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:46,872 - aiogram.event - INFO - Update id=557185083 is not handled. Duration 434 ms by bot id=5702092394
2025-10-02 18:44:46,873 - aiogram.event - ERROR - Cause exception while process update id=557185083 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:47,935 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:47,937 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:47,968 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:48,018 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:48,063 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:48,091 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:48,118 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:48,126 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:48,133 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:48,135 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:48,135 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:48,136 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:48,245 - aiogram.event - INFO - Update id=557185084 is not handled. Duration 442 ms by bot id=5702092394
2025-10-02 18:44:48,247 - aiogram.event - ERROR - Cause exception while process update id=557185084 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:48,556 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:48,558 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:48,590 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:48,622 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:48,661 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:48,707 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:48,742 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:48,755 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:48,763 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:48,765 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:48,766 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:48,768 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:48,850 - aiogram.event - INFO - Update id=557185085 is not handled. Duration 377 ms by bot id=5702092394
2025-10-02 18:44:48,851 - aiogram.event - ERROR - Cause exception while process update id=557185085 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:50,739 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:50,740 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:50,772 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:50,802 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:50,834 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:50,886 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:50,912 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:50,921 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:50,935 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:50,936 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:50,937 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:50,938 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:51,079 - aiogram.event - INFO - Update id=557185086 is not handled. Duration 576 ms by bot id=5702092394
2025-10-02 18:44:51,080 - aiogram.event - ERROR - Cause exception while process update id=557185086 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:51,242 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:51,244 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:51,274 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:51,298 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:51,333 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:51,388 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:51,441 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:51,454 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:51,461 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:51,462 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:51,464 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:51,465 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:51,584 - aiogram.event - INFO - Update id=557185087 is not handled. Duration 630 ms by bot id=5702092394
2025-10-02 18:44:51,585 - aiogram.event - ERROR - Cause exception while process update id=557185087 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:45:56,311 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:45:56,313 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:45:56,313 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:45:56,465 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:46:03,626 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:46:03,629 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:46:03,878 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:46:11,589 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:46:11,701 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:11,932 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:46:11,933 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:46:11,934 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:46:11,938 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:11,939 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:11,941 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:11,942 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:46:12,225 - aiogram.event - INFO - Update id=557185088 is handled. Duration 636 ms by bot id=5702092394
2025-10-02 18:46:12,771 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:12,773 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:46:12,864 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:46:12,899 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:46:12,935 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:46:12,978 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:13,007 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:46:13,034 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:46:13,047 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:13,048 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:13,049 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:13,595 - aiogram.event - INFO - Update id=557185089 is handled. Duration 825 ms by bot id=5702092394
2025-10-02 18:46:15,660 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:15,678 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:15,683 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:46:15,687 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:15,689 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:15,690 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:15,797 - aiogram.event - INFO - Update id=557185090 is handled. Duration 246 ms by bot id=5702092394
2025-10-02 18:46:17,333 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:17,334 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:46:17,377 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:46:17,406 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:46:17,435 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:46:17,473 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:17,519 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:46:17,533 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:46:17,536 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:17,536 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:17,537 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:17,538 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:46:17,633 - aiogram.event - INFO - Update id=557185091 is not handled. Duration 383 ms by bot id=5702092394
2025-10-02 18:46:17,634 - aiogram.event - ERROR - Cause exception while process update id=557185091 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:46:18,879 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:18,880 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:46:18,914 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:46:18,934 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:46:18,981 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:46:19,011 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:19,045 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:46:19,054 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:46:19,060 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:19,061 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:19,062 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:19,063 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:46:19,197 - aiogram.event - INFO - Update id=557185092 is not handled. Duration 396 ms by bot id=5702092394
2025-10-02 18:46:19,198 - aiogram.event - ERROR - Cause exception while process update id=557185092 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:46:19,759 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:19,760 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:46:19,812 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:46:19,852 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:46:19,893 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:46:19,924 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:19,952 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:46:19,959 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:46:19,964 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:19,965 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:19,966 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:19,967 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:46:20,108 - aiogram.event - INFO - Update id=557185093 is not handled. Duration 529 ms by bot id=5702092394
2025-10-02 18:46:20,109 - aiogram.event - ERROR - Cause exception while process update id=557185093 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:50:27,386 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:50:27,399 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:50:27,469 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:50:27,528 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:50:27,625 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:50:27,675 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:50:27,735 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:50:27,758 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:50:27,769 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:50:27,770 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:50:27,771 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:50:27,772 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:50:27,874 - aiogram.event - INFO - Update id=557185094 is not handled. Duration 600 ms by bot id=5702092394
2025-10-02 18:50:27,875 - aiogram.event - ERROR - Cause exception while process update id=557185094 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:51:12,077 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:51:12,079 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:51:12,138 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:51:12,190 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:51:12,219 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:51:12,247 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:51:12,285 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:51:12,300 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:51:12,306 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:51:12,307 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:51:12,309 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:51:12,311 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:51:12,410 - aiogram.event - INFO - Update id=557185095 is not handled. Duration 422 ms by bot id=5702092394
2025-10-02 18:51:12,412 - aiogram.event - ERROR - Cause exception while process update id=557185095 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:55:00,485 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:55:00,490 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:55:00,491 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:55:00,657 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:55:08,162 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:55:08,165 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:55:08,407 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:55:15,178 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:55:15,384 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:15,385 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:55:15,614 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:55:15,644 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:55:15,690 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:55:15,725 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:55:15,767 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:55:15,777 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:55:15,785 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:55:15,787 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:15,789 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:16,059 - aiogram.event - INFO - Update id=557185096 is handled. Duration 882 ms by bot id=5702092394
2025-10-02 18:55:17,822 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:17,855 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:55:17,863 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:55:17,873 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:55:17,874 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:17,875 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:17,984 - aiogram.event - INFO - Update id=557185097 is handled. Duration 247 ms by bot id=5702092394
2025-10-02 18:55:19,324 - aiogram.event - INFO - Update id=557185098 is not handled. Duration 3 ms by bot id=5702092394
2025-10-02 18:55:33,377 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:55:33,380 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:55:33,381 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:55:33,536 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:55:40,549 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:55:40,552 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:55:40,827 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:55:43,536 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:55:43,623 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:43,786 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:55:43,786 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:55:43,787 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:55:43,790 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:43,791 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:43,791 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:43,792 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:55:44,105 - aiogram.event - INFO - Update id=557185099 is handled. Duration 569 ms by bot id=5702092394
2025-10-02 18:55:45,574 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:45,575 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:55:45,637 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:55:45,673 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:55:45,723 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:55:45,754 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:55:45,778 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:55:45,788 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:55:45,794 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:55:45,795 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:45,796 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:45,916 - aiogram.event - INFO - Update id=557185100 is handled. Duration 342 ms by bot id=5702092394
2025-10-02 18:55:46,968 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:46,998 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:55:47,006 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:55:47,014 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:55:47,016 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:47,027 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:47,633 - aiogram.event - INFO - Update id=557185101 is handled. Duration 755 ms by bot id=5702092394
2025-10-02 18:55:48,209 - aiogram.event - INFO - Update id=557185102 is not handled. Duration 2 ms by bot id=5702092394
2025-10-02 20:01:23,505 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-10-02 20:01:23,582 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 20:01:24,663 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-02 20:01:24,663 - aiogram.dispatcher - WARNING - Sleep for 1.247018 seconds and try again... (tryings = 1, bot id = 5702092394)
2025-10-02 20:01:25,930 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-02 20:01:25,931 - aiogram.dispatcher - WARNING - Sleep for 1.525038 seconds and try again... (tryings = 2, bot id = 5702092394)
2025-10-02 20:01:27,467 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-02 20:01:27,469 - aiogram.dispatcher - WARNING - Sleep for 2.064538 seconds and try again... (tryings = 3, bot id = 5702092394)
2025-10-02 20:07:59,276 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-02 20:07:59,316 - aiogram.dispatcher - WARNING - Sleep for 2.621835 seconds and try again... (tryings = 4, bot id = 5702092394)
2025-10-02 20:08:12,267 - aiogram.dispatcher - INFO - Connection established (tryings = 5, bot id = 5702092394)
2025-10-03 17:15:41,963 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:15:41,967 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:15:42,201 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:16:01,391 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:16:01,482 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:16:01,576 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:16:01,576 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:16:01,577 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:16:01,578 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:16:01,579 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:16:01,579 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:16:01,580 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:16:01,838 - aiogram.event - INFO - Update id=557185103 is handled. Duration 447 ms by bot id=5702092394
2025-10-03 17:16:03,294 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:16:03,295 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:16:03,337 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:16:03,356 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:16:03,369 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:16:03,384 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:16:03,398 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:16:03,403 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:16:03,406 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:16:03,408 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:16:03,409 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:16:03,516 - aiogram.event - INFO - Update id=557185104 is handled. Duration 223 ms by bot id=5702092394
2025-10-03 17:16:05,346 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:16:05,362 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:16:05,367 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:16:05,369 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:16:05,370 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:16:05,371 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:16:05,543 - aiogram.event - INFO - Update id=557185105 is handled. Duration 297 ms by bot id=5702092394
2025-10-03 17:16:06,945 - aiogram.event - INFO - Update id=557185106 is not handled. Duration 2 ms by bot id=5702092394
2025-10-03 17:20:14,382 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:20:14,393 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:20:14,394 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:20:14,549 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:20:20,792 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:20:20,795 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:20:21,004 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:20:24,828 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:20:24,927 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:20:25,034 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:20:25,035 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:20:25,035 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:20:25,038 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:20:25,039 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:20:25,039 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:20:25,040 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:20:25,324 - aiogram.event - INFO - Update id=557185107 is handled. Duration 496 ms by bot id=5702092394
2025-10-03 17:20:26,525 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:20:26,526 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:20:26,556 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:20:26,574 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:20:26,591 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:20:26,605 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:20:26,619 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:20:26,623 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:20:26,625 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:20:26,626 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:20:26,627 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:20:26,739 - aiogram.event - INFO - Update id=557185108 is handled. Duration 215 ms by bot id=5702092394
2025-10-03 17:20:28,564 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:20:28,577 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:20:28,581 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:20:28,585 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:20:28,586 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:20:28,586 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:20:28,725 - aiogram.event - INFO - Update id=557185109 is handled. Duration 265 ms by bot id=5702092394
2025-10-03 17:20:30,079 - aiogram.event - INFO - Update id=557185110 is not handled. Duration 3 ms by bot id=5702092394
2025-10-03 17:20:53,291 - aiogram.event - INFO - Update id=557185111 is not handled. Duration 3 ms by bot id=5702092394
2025-10-03 17:26:38,725 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:26:38,727 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:26:38,727 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:26:38,883 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:26:43,449 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:26:43,452 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:26:43,660 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:26:49,293 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:26:49,380 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:26:49,459 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:26:49,460 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:26:49,460 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:26:49,463 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:26:49,464 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:26:49,465 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:26:49,465 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:26:49,720 - aiogram.event - INFO - Update id=557185112 is handled. Duration 427 ms by bot id=5702092394
2025-10-03 17:26:50,676 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:26:50,676 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:26:50,704 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:26:50,721 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:26:50,735 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:26:50,747 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:26:50,758 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:26:50,761 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:26:50,764 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:26:50,765 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:26:50,766 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:26:50,883 - aiogram.event - INFO - Update id=557185113 is handled. Duration 208 ms by bot id=5702092394
2025-10-03 17:26:52,058 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:26:52,069 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:26:52,072 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:26:52,074 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:26:52,075 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:26:52,076 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:26:52,200 - aiogram.event - INFO - Update id=557185114 is handled. Duration 225 ms by bot id=5702092394
2025-10-03 17:26:52,982 - aiogram.event - INFO - Update id=557185115 is not handled. Duration 2 ms by bot id=5702092394
2025-10-03 17:27:14,090 - aiogram.event - INFO - Update id=557185116 is not handled. Duration 2 ms by bot id=5702092394
2025-10-03 17:27:33,302 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:27:33,304 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:27:33,304 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:27:33,494 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:27:38,125 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:27:38,126 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:27:38,330 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:27:41,391 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:27:41,454 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:41,540 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:27:41,541 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:27:41,542 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:27:41,545 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:41,545 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:41,546 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:41,547 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:27:41,798 - aiogram.event - INFO - Update id=557185117 is handled. Duration 407 ms by bot id=5702092394
2025-10-03 17:27:42,511 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:42,511 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:42,531 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:42,547 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:42,562 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:42,574 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:42,585 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:42,588 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:42,590 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:42,591 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:42,591 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:42,715 - aiogram.event - INFO - Update id=557185118 is handled. Duration 205 ms by bot id=5702092394
2025-10-03 17:27:44,377 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:44,384 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:44,388 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:27:44,390 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:44,391 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:44,392 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:44,673 - aiogram.event - INFO - Update id=557185119 is handled. Duration 535 ms by bot id=5702092394
2025-10-03 17:27:46,327 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:46,328 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:46,341 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:46,359 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:46,374 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:46,389 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:46,406 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:46,414 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:46,416 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:46,417 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:46,418 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:46,419 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:46,501 - aiogram.event - INFO - Update id=557185120 is not handled. Duration 248 ms by bot id=5702092394
2025-10-03 17:27:46,503 - aiogram.event - ERROR - Cause exception while process update id=557185120 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:47,893 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:47,894 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:47,911 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:47,932 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:47,950 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:47,970 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:47,991 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:47,997 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:48,000 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:48,002 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:48,003 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:48,004 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:48,085 - aiogram.event - INFO - Update id=557185121 is not handled. Duration 268 ms by bot id=5702092394
2025-10-03 17:27:48,086 - aiogram.event - ERROR - Cause exception while process update id=557185121 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:49,301 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:49,302 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:49,316 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:49,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:49,349 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:49,364 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:49,381 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:49,385 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:49,388 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:49,390 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:49,391 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:49,392 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:49,474 - aiogram.event - INFO - Update id=557185122 is not handled. Duration 245 ms by bot id=5702092394
2025-10-03 17:27:49,475 - aiogram.event - ERROR - Cause exception while process update id=557185122 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:50,019 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:50,019 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:50,039 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:50,055 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:50,072 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:50,089 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:50,104 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:50,110 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:50,114 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:50,115 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:50,116 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:50,116 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:50,199 - aiogram.event - INFO - Update id=557185123 is not handled. Duration 254 ms by bot id=5702092394
2025-10-03 17:27:50,200 - aiogram.event - ERROR - Cause exception while process update id=557185123 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:50,289 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:50,290 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:50,303 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:50,319 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:50,336 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:50,352 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:50,367 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:50,371 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:50,374 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:50,375 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:50,376 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:50,378 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:50,456 - aiogram.event - INFO - Update id=557185124 is not handled. Duration 241 ms by bot id=5702092394
2025-10-03 17:27:50,457 - aiogram.event - ERROR - Cause exception while process update id=557185124 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:51,729 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:51,729 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:51,748 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:51,766 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:51,782 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:51,807 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:51,821 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:51,832 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:51,835 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:51,835 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:51,836 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:51,838 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:51,921 - aiogram.event - INFO - Update id=557185125 is not handled. Duration 291 ms by bot id=5702092394
2025-10-03 17:27:51,923 - aiogram.event - ERROR - Cause exception while process update id=557185125 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:28:36,057 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:28:36,059 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:28:36,059 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:28:36,217 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:28:40,859 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:28:40,861 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:28:41,057 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:28:49,509 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:28:49,573 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:28:49,659 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:28:49,660 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:28:49,661 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:28:49,663 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:28:49,663 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:28:49,664 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:28:49,664 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:28:49,972 - aiogram.event - INFO - Update id=557185126 is handled. Duration 463 ms by bot id=5702092394
2025-10-03 17:28:50,537 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:28:50,537 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:28:50,564 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:28:50,578 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:28:50,591 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:28:50,602 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:28:50,614 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:28:50,618 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:28:50,620 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:28:50,621 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:28:50,621 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:28:50,732 - aiogram.event - INFO - Update id=557185127 is handled. Duration 196 ms by bot id=5702092394
2025-10-03 17:28:51,710 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:28:51,720 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:28:51,725 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:28:51,727 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:28:51,729 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:28:51,730 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:28:51,871 - aiogram.event - INFO - Update id=557185128 is handled. Duration 267 ms by bot id=5702092394
2025-10-03 17:28:53,052 - aiogram.event - INFO - Update id=557185129 is not handled. Duration 1 ms by bot id=5702092394
2025-10-03 17:35:01,861 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:35:01,862 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:35:01,863 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:35:02,041 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:35:07,210 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:35:07,211 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:35:07,468 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:35:13,943 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:35:14,049 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:35:14,171 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:35:14,172 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:35:14,173 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:35:14,177 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:14,178 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:14,179 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:35:14,179 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:35:14,592 - aiogram.event - INFO - Update id=557185130 is handled. Duration 649 ms by bot id=5702092394
2025-10-03 17:35:15,798 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:35:15,799 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:35:15,824 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:35:15,841 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:35:15,854 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:35:15,868 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:35:15,880 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:35:15,883 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:35:15,884 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:35:15,885 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:15,885 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:35:16,129 - aiogram.event - INFO - Update id=557185131 is handled. Duration 331 ms by bot id=5702092394
2025-10-03 17:35:17,791 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:35:17,808 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:35:17,814 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:35:17,818 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:35:17,819 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:17,821 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:35:17,944 - aiogram.event - INFO - Update id=557185132 is handled. Duration 246 ms by bot id=5702092394
2025-10-03 17:35:19,380 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:35:19,380 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:35:19,399 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:35:19,417 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:35:19,438 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:35:19,453 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:35:19,469 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:35:19,477 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:35:19,479 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:35:19,479 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:19,480 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:35:19,481 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:35:19,576 - aiogram.event - INFO - Update id=557185133 is not handled. Duration 285 ms by bot id=5702092394
2025-10-03 17:35:19,576 - aiogram.event - ERROR - Cause exception while process update id=557185133 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:40:19,657 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:40:19,669 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:40:19,669 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:40:19,812 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:42:06,455 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:42:06,457 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:42:06,726 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:42:11,154 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:42:11,260 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:42:11,323 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:42:11,324 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:42:11,324 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:42:11,326 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:11,327 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:11,328 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:42:11,328 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:42:11,604 - aiogram.event - INFO - Update id=557185134 is handled. Duration 449 ms by bot id=5702092394
2025-10-03 17:42:12,810 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:42:12,810 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:42:12,826 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:42:12,841 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:42:12,850 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:42:12,865 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:42:12,875 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:42:12,880 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:42:12,882 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:42:12,882 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:12,883 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:42:12,996 - aiogram.event - INFO - Update id=557185135 is handled. Duration 187 ms by bot id=5702092394
2025-10-03 17:42:13,957 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:42:13,967 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:42:13,972 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:42:13,975 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:42:13,976 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:13,977 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:42:14,119 - aiogram.event - INFO - Update id=557185136 is handled. Duration 259 ms by bot id=5702092394
2025-10-03 17:42:15,308 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:42:15,309 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:42:15,320 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:42:15,330 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:42:15,348 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:42:15,361 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:42:15,377 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:42:15,380 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:42:15,383 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:42:15,384 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:15,384 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:42:15,537 - aiogram.event - INFO - Update id=557185137 is handled. Duration 396 ms by bot id=5702092394
2025-10-03 18:05:56,276 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:05:56,284 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:05:56,286 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:05:56,289 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:05:56,290 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:05:56,291 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:05:56,407 - aiogram.event - INFO - Update id=557185138 is handled. Duration 239 ms by bot id=5702092394
2025-10-03 18:05:58,003 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:05:58,005 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:05:58,019 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:05:58,033 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:05:58,048 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:05:58,062 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:05:58,077 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:05:58,082 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:05:58,086 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:05:58,087 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:05:58,088 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:05:58,199 - aiogram.event - INFO - Update id=557185139 is handled. Duration 298 ms by bot id=5702092394
2025-10-03 18:05:59,560 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:05:59,568 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:05:59,572 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:05:59,575 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:05:59,575 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:05:59,576 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:05:59,722 - aiogram.event - INFO - Update id=557185140 is handled. Duration 262 ms by bot id=5702092394
2025-10-03 18:06:00,676 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 18:06:00,760 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 18:06:00,761 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:06:00,768 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:06:04,352 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 18:06:15,759 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 18:06:15,760 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 18:06:15,897 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 18:06:15,931 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 18:06:15,970 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 18:06:16,022 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 18:06:16,065 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 18:06:16,089 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 18:06:16,167 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 18:06:17,879 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 18:06:17,883 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:06:17,889 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id='b8690b1c-089b-4646-84e0-1fcc1c28dd6f', product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))
2025-10-03 18:06:17,890 - src.application.use_cases.upd_product - INFO - Цена для товара 1818184981 обновлена: Price(id='b8690b1c-089b-4646-84e0-1fcc1c28dd6f', product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))
2025-10-03 18:06:17,896 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:06:17,899 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 18:06:17,916 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:06:17,916 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:06:17,917 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:06:17,917 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-10-03 18:06:17,919 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 230, in handle_update_price
    reply_markup=InlineKeyboardMarkup().add(
                 ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-03 18:06:17,950 - aiogram.event - INFO - Update id=557185141 is handled. Duration 17276 ms by bot id=5702092394
2025-10-03 18:06:26,791 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:06:26,798 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:06:26,800 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:06:26,803 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:06:26,804 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:06:26,804 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:06:26,805 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:06:26,959 - aiogram.event - INFO - Update id=557185142 is handled. Duration 477 ms by bot id=5702092394
2025-10-03 18:09:05,579 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:09:05,581 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:09:05,582 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:09:05,736 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:09:11,544 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:09:11,547 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:09:11,547 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:09:11,773 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:09:17,320 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:09:17,426 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:09:17,492 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:09:17,493 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:09:17,493 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:09:17,496 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:17,498 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:17,498 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:09:17,499 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:09:17,757 - aiogram.event - INFO - Update id=557185143 is handled. Duration 438 ms by bot id=5702092394
2025-10-03 18:09:18,836 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:09:18,837 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:09:18,861 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:09:18,883 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:09:18,895 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:09:18,907 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:09:18,917 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:09:18,920 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:09:18,922 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:09:18,923 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:18,923 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:09:19,025 - aiogram.event - INFO - Update id=557185144 is handled. Duration 190 ms by bot id=5702092394
2025-10-03 18:09:20,355 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:09:20,365 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:09:20,368 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:09:20,370 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:09:20,371 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:20,371 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:09:20,506 - aiogram.event - INFO - Update id=557185145 is handled. Duration 283 ms by bot id=5702092394
2025-10-03 18:09:22,023 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:09:22,024 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:09:22,035 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:09:22,054 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:09:22,078 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:09:22,102 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:09:22,122 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:09:22,130 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:09:22,133 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:09:22,134 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:22,135 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:09:22,280 - aiogram.event - INFO - Update id=557185146 is handled. Duration 396 ms by bot id=5702092394
2025-10-03 18:10:01,298 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:10:01,299 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:10:01,312 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:10:01,318 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:10:01,324 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:10:01,334 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:10:01,340 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:10:01,343 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:10:01,347 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:10:01,348 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:10:01,348 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:10:01,436 - aiogram.event - INFO - Update id=557185147 is handled. Duration 139 ms by bot id=5702092394
2025-10-03 18:10:02,972 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:10:02,979 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:10:02,983 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:10:02,985 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:10:02,986 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:10:02,986 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:10:03,156 - aiogram.event - INFO - Update id=557185148 is handled. Duration 321 ms by bot id=5702092394
2025-10-03 18:10:04,906 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:10:04,915 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:10:04,917 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:10:04,919 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:10:04,920 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:10:04,920 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:10:04,920 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:10:05,006 - aiogram.event - INFO - Update id=557185149 is handled. Duration 192 ms by bot id=5702092394
2025-10-03 18:14:45,265 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:14:45,268 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:14:45,268 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:14:45,415 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:15:35,935 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:15:35,936 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:15:35,936 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:15:36,171 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:15:40,586 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:15:40,703 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:40,782 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:15:40,782 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:15:40,783 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:15:40,784 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:40,785 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:40,786 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:40,786 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:15:41,043 - aiogram.event - INFO - Update id=557185150 is handled. Duration 457 ms by bot id=5702092394
2025-10-03 18:15:43,304 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:43,305 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:15:43,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:15:43,342 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:15:43,355 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:15:43,367 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:15:43,385 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:15:43,388 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:15:43,389 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:15:43,390 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:43,391 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:43,645 - aiogram.event - INFO - Update id=557185151 is handled. Duration 342 ms by bot id=5702092394
2025-10-03 18:15:45,057 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:45,065 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:15:45,068 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:15:45,070 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:15:45,070 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:45,071 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:45,197 - aiogram.event - INFO - Update id=557185152 is handled. Duration 269 ms by bot id=5702092394
2025-10-03 18:15:46,370 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:46,382 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:15:46,385 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:15:46,387 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:15:46,388 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:46,389 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:46,390 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:15:46,489 - aiogram.event - INFO - Update id=557185153 is handled. Duration 203 ms by bot id=5702092394
2025-10-03 18:15:53,884 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:53,891 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:15:53,895 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:15:53,898 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:15:53,899 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:53,899 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:53,900 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:15:53,990 - aiogram.event - INFO - Update id=557185154 is handled. Duration 198 ms by bot id=5702092394
2025-10-03 18:24:34,156 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:24:34,159 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:24:34,160 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:24:34,326 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:24:41,784 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:24:41,788 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:24:41,788 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:24:42,017 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:24:46,496 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:24:46,579 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:46,625 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:24:46,626 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:24:46,626 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:24:46,627 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:46,627 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:46,627 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:46,628 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:24:46,863 - aiogram.event - INFO - Update id=557185155 is handled. Duration 367 ms by bot id=5702092394
2025-10-03 18:24:47,701 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:47,702 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:24:47,724 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:24:47,733 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:24:47,745 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:24:47,752 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:24:47,763 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:24:47,767 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:24:47,772 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:24:47,773 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:47,774 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:47,869 - aiogram.event - INFO - Update id=557185156 is handled. Duration 168 ms by bot id=5702092394
2025-10-03 18:24:49,201 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:49,209 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:24:49,213 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:24:49,214 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:24:49,215 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:49,216 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:49,322 - aiogram.event - INFO - Update id=557185157 is handled. Duration 216 ms by bot id=5702092394
2025-10-03 18:24:50,299 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:50,310 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:24:50,313 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:24:50,315 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:24:50,316 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:50,316 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:50,317 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:24:50,430 - aiogram.event - INFO - Update id=557185158 is handled. Duration 234 ms by bot id=5702092394
2025-10-03 18:24:53,350 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:53,363 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:24:53,367 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:24:53,372 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:24:53,373 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:53,374 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:53,374 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:24:53,511 - aiogram.event - INFO - Update id=557185159 is handled. Duration 297 ms by bot id=5702092394
2025-10-03 18:26:20,218 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:26:20,221 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:26:20,222 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:26:20,380 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:27:04,762 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:27:04,765 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:27:04,765 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:27:05,020 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:27:08,627 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:27:08,684 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:08,768 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:27:08,769 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:27:08,769 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:27:08,770 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:08,771 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:08,771 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:08,771 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:27:09,036 - aiogram.event - INFO - Update id=557185160 is handled. Duration 408 ms by bot id=5702092394
2025-10-03 18:27:09,665 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:09,666 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:27:09,689 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:27:09,702 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:27:09,720 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:27:09,739 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:27:09,753 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:27:09,759 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:27:09,762 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:27:09,763 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:09,764 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:09,878 - aiogram.event - INFO - Update id=557185161 is handled. Duration 214 ms by bot id=5702092394
2025-10-03 18:27:10,806 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:10,821 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:27:10,825 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:27:10,827 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:27:10,828 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:10,829 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:10,933 - aiogram.event - INFO - Update id=557185162 is handled. Duration 219 ms by bot id=5702092394
2025-10-03 18:27:11,739 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:11,752 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:27:11,755 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:27:11,757 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:27:11,758 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:11,758 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:11,872 - aiogram.event - INFO - Update id=557185163 is handled. Duration 210 ms by bot id=5702092394
2025-10-03 18:27:13,472 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:13,484 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:27:13,489 - src.infrastructure.database.repositories.price_repository - INFO - Найдено 1 цен для продукта 2000108942
2025-10-03 18:27:13,489 - src.infrastructure.database.repositories.price_repository - INFO - Попытка удаления цены с ID: 12
2025-10-03 18:27:13,495 - src.infrastructure.database.repositories.price_repository - INFO - Цена с ID 12 успешно удалена
2025-10-03 18:27:13,497 - src.infrastructure.database.repositories.product_repository - INFO - Попытка удаления товара с ID: 2000108942
2025-10-03 18:27:13,508 - src.infrastructure.database.repositories.product_repository - INFO - Товар с ID 2000108942 успешно удален
2025-10-03 18:27:13,511 - src.infrastructure.database.repositories.user_repository - WARNING - Пользователь с id  не найден
2025-10-03 18:27:13,512 - src.application.use_cases.delete_product - INFO - Операция удаления выполнена для ID 2000108942
2025-10-03 18:27:13,513 - src.core.decorators - INFO - Функция delete_product: выполняется commit транзакции
2025-10-03 18:27:13,539 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:13,540 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:13,541 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:13,542 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:13,543 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:27:13,558 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:27:13,571 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:27:13,584 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:27:13,598 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:27:13,601 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:27:13,603 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:27:13,604 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:13,604 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:13,715 - aiogram.event - INFO - Update id=557185164 is handled. Duration 389 ms by bot id=5702092394
2025-10-03 18:27:23,534 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:27:23,535 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:27:23,535 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:27:23,687 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:32:22,794 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:32:22,796 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:32:22,796 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:32:23,056 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:32:30,042 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:32:30,176 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:32:30,301 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:32:30,301 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:32:30,302 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:32:30,304 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:30,304 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:30,305 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:32:30,305 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:32:30,558 - aiogram.event - INFO - Update id=557185165 is handled. Duration 517 ms by bot id=5702092394
2025-10-03 18:32:31,583 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:32:31,583 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:32:31,625 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:31,657 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:32:31,676 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:32:31,690 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:32:31,695 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:32:31,700 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:32:31,700 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:31,701 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:32:31,825 - aiogram.event - INFO - Update id=557185166 is handled. Duration 243 ms by bot id=5702092394
2025-10-03 18:32:33,189 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:32:33,208 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:33,214 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:32:33,221 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:32:33,221 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:33,222 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:32:33,361 - aiogram.event - INFO - Update id=557185167 is handled. Duration 264 ms by bot id=5702092394
2025-10-03 18:32:34,590 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 18:32:34,670 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 18:32:34,671 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:32:34,697 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:36,581 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 18:32:48,105 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 18:32:48,105 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 18:32:48,193 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 18:32:48,271 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 18:32:48,343 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 18:32:48,396 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 18:32:48,457 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 18:32:48,496 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 18:32:48,652 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 18:32:50,649 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 18:32:50,656 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:50,660 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id='38fdfc6b-4984-4a7d-9f33-67d8146b0516', product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))
2025-10-03 18:32:50,661 - src.application.use_cases.upd_product - INFO - Цена для товара 1818184981 обновлена: Price(id='38fdfc6b-4984-4a7d-9f33-67d8146b0516', product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))
2025-10-03 18:32:50,671 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:50,676 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 18:32:50,689 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:50,690 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:50,691 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:32:50,691 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-10-03 18:32:50,693 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 230, in handle_update_price
    reply_markup=InlineKeyboardMarkup().add(
                 ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-03 18:32:50,700 - aiogram.event - INFO - Update id=557185168 is handled. Duration 16115 ms by bot id=5702092394
2025-10-03 19:18:29,538 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 19:18:29,543 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 19:18:29,544 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 19:18:29,710 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 19:21:00,596 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 19:21:00,598 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 19:21:00,599 - aiogram.dispatcher - INFO - Start polling
2025-10-03 19:21:00,869 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 19:21:15,442 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 19:21:15,606 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:15,723 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 19:21:15,723 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 19:21:15,724 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 19:21:15,728 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:15,729 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:15,730 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:15,730 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 19:21:16,004 - aiogram.event - INFO - Update id=557185169 is handled. Duration 562 ms by bot id=5702092394
2025-10-03 19:21:16,393 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:16,394 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 19:21:16,421 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:16,440 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 19:21:16,450 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 19:21:16,471 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 19:21:16,476 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 19:21:16,478 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:21:16,479 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:16,480 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:16,607 - aiogram.event - INFO - Update id=557185170 is handled. Duration 214 ms by bot id=5702092394
2025-10-03 19:21:17,771 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:17,785 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:17,790 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 19:21:17,793 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:21:17,794 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:17,794 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:17,960 - aiogram.event - INFO - Update id=557185171 is handled. Duration 268 ms by bot id=5702092394
2025-10-03 19:21:19,507 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:19,508 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 19:21:19,524 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:19,549 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 19:21:19,567 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 19:21:19,588 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 19:21:19,594 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 19:21:19,604 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:21:19,605 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:19,606 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:19,771 - aiogram.event - INFO - Update id=557185172 is handled. Duration 353 ms by bot id=5702092394
2025-10-03 19:21:21,034 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:21,050 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:21,056 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 19:21:21,058 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:21:21,060 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:21,065 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:21,167 - aiogram.event - INFO - Update id=557185173 is handled. Duration 220 ms by bot id=5702092394
2025-10-03 19:21:21,989 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 19:21:22,076 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 19:21:22,077 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:22,090 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:25,271 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 19:21:36,660 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 19:21:36,660 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 19:21:36,713 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 19:21:36,752 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 19:21:36,788 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 19:21:36,820 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 19:21:36,852 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 19:21:36,876 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 19:21:36,945 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 19:21:38,660 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 19:21:38,668 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:38,680 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))
2025-10-03 19:21:38,681 - src.application.use_cases.upd_product - INFO - Цена для товара 1818184981 обновлена: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))
2025-10-03 19:21:38,688 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:38,690 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 19:21:38,698 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:38,699 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:38,700 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:38,700 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-10-03 19:21:38,704 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 230, in handle_update_price
    reply_markup=InlineKeyboardMarkup().add(
                 ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-03 19:21:38,706 - aiogram.event - INFO - Update id=557185174 is handled. Duration 16720 ms by bot id=5702092394
2025-10-03 19:22:18,619 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 19:22:18,620 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 19:22:18,620 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 19:22:18,781 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 19:22:23,752 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 19:22:23,754 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 19:22:23,755 - aiogram.dispatcher - INFO - Start polling
2025-10-03 19:22:24,017 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 19:22:26,476 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 19:22:26,583 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:22:26,583 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 19:22:26,698 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:26,716 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 19:22:26,736 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 19:22:26,758 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 19:22:26,768 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 19:22:26,771 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:22:26,772 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:22:26,772 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:22:27,088 - aiogram.event - INFO - Update id=557185175 is handled. Duration 614 ms by bot id=5702092394
2025-10-03 19:22:29,282 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:22:29,292 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:29,304 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 19:22:29,307 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:22:29,308 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:22:29,308 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:22:29,552 - aiogram.event - INFO - Update id=557185176 is handled. Duration 455 ms by bot id=5702092394
2025-10-03 19:22:30,633 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 19:22:30,634 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 19:22:30,634 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:22:30,650 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:32,387 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 19:22:43,785 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 19:22:43,786 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 19:22:43,848 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 19:22:43,883 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 19:22:43,913 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 19:22:43,946 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 19:22:43,984 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 19:22:44,005 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 19:22:44,074 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 19:22:45,884 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 19:22:45,888 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:45,891 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))
2025-10-03 19:22:45,892 - src.application.use_cases.upd_product - INFO - Цена для товара 1818184981 обновлена: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))
2025-10-03 19:22:45,903 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:45,906 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 19:22:45,919 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:22:45,920 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:22:45,921 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:22:45,921 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-10-03 19:22:45,922 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 230, in handle_update_price
    reply_markup=InlineKeyboardMarkup().add(
                 ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-03 19:22:45,924 - aiogram.event - INFO - Update id=557185177 is handled. Duration 15297 ms by bot id=5702092394
2025-10-03 22:09:48,752 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:09:48,757 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:09:48,758 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:09:49,017 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:09:56,833 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 22:09:56,834 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 22:09:56,835 - aiogram.dispatcher - INFO - Start polling
2025-10-03 22:09:57,083 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:10:05,072 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 22:10:05,724 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:10:05,903 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 22:10:05,903 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 22:10:05,904 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 22:10:05,909 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:05,910 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:05,911 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:10:05,911 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 22:10:06,156 - aiogram.event - INFO - Update id=557185178 is handled. Duration 1084 ms by bot id=5702092394
2025-10-03 22:10:06,954 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:10:06,955 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 22:10:06,997 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:10:07,040 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 22:10:07,071 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:07,100 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 22:10:07,107 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 22:10:07,111 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:10:07,113 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:07,113 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:10:07,235 - aiogram.event - INFO - Update id=557185179 is handled. Duration 282 ms by bot id=5702092394
2025-10-03 22:10:08,463 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:10:08,499 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:08,505 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 22:10:08,508 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:10:08,509 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:08,510 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:10:08,607 - aiogram.event - INFO - Update id=557185180 is handled. Duration 230 ms by bot id=5702092394
2025-10-03 22:10:09,413 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1668950019
2025-10-03 22:10:09,414 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 22:10:09,414 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:10:09,443 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:13,235 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 22:10:24,601 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-03 22:10:24,602 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-03 22:10:25,116 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-03 22:10:25,232 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-03 22:10:25,296 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 22:10:25,350 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1575
2025-10-03 22:10:25,509 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1713
2025-10-03 22:10:25,566 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-03 22:10:25,771 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-03 22:10:27,656 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 22:10:27,662 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:27,666 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))
2025-10-03 22:10:27,667 - src.application.use_cases.upd_product - INFO - Цена для товара 1668950019 обновлена: Price(id=None, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))
2025-10-03 22:10:27,673 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:27,677 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 22:10:27,697 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:27,698 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:27,699 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:10:27,699 - src.infrastructure.services.logger - INFO - Получили обновленный товар: <class 'dict'> - {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'link': 'https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'rating': 4.9, 'categories': '{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', 'latest_price': {'with_card': 1568, 'without_card': 1705}}
2025-10-03 22:10:27,700 - src.infrastructure.services.logger - INFO - Формируем новое сообщение
2025-10-03 22:10:27,701 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Легинсы FITFOX Спорт Фитнес
💳 Цена с картой: 1568 ₽
💵 Цена без карты: 1705 ₽
🔗 <a href='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/'>Ссылка на товар</a>
2025-10-03 22:10:27,702 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-03 22:10:27,702 - src.infrastructure.services.logger - INFO - Обновляем сообщение с новыми данными
2025-10-03 22:10:27,982 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 213, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-03 22:10:28,053 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-03 22:10:28,056 - aiogram.event - INFO - Update id=557185181 is handled. Duration 18645 ms by bot id=5702092394
2025-10-03 22:43:21,646 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:43:21,648 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:43:21,649 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:43:21,903 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:43:27,093 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 22:43:27,094 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 22:43:27,095 - aiogram.dispatcher - INFO - Start polling
2025-10-03 22:43:27,349 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:43:38,183 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 22:43:38,334 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:43:38,476 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 22:43:38,477 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 22:43:38,478 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 22:43:38,480 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:43:38,481 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:43:38,482 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:43:38,483 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 22:43:38,837 - aiogram.event - INFO - Update id=557185182 is handled. Duration 654 ms by bot id=5702092394
2025-10-03 22:43:40,200 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:43:40,201 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 22:43:40,250 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:43:40,283 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 22:43:40,319 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-03 22:43:40,348 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 22:43:40,354 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 22:43:40,359 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:43:40,362 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:43:40,363 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:43:40,604 - aiogram.event - INFO - Update id=557185183 is handled. Duration 405 ms by bot id=5702092394
2025-10-03 22:43:42,121 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:43:42,144 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:43:42,152 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 22:43:42,156 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:43:42,157 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:43:42,158 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:43:42,268 - aiogram.event - INFO - Update id=557185184 is handled. Duration 255 ms by bot id=5702092394
2025-10-03 22:43:43,350 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 22:43:43,350 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 22:43:43,351 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:43:43,371 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:43:45,549 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 22:43:56,998 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 22:43:56,999 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 22:43:57,059 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 22:43:57,107 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 22:43:57,146 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 22:43:57,178 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 22:43:57,213 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 22:43:57,239 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 22:43:57,310 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 22:43:59,020 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 22:43:59,021 - src.core.uow - WARNING - Исключение в Unit of Work: TypeError: UpdateProductPriceUseCase.__init__() missing 1 required positional argument: 'parser'
2025-10-03 22:43:59,024 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:43:59,024 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:43:59,025 - src.core.decorators - ERROR - Ошибка в функции update_product_price: UpdateProductPriceUseCase.__init__() missing 1 required positional argument: 'parser'
2025-10-03 22:43:59,026 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 124, in update_product_price
    use_case = UpdateProductPriceUseCase(
        product_repo=self.uow.product_repository,
        price_repo=self.uow.price_repository,
    )
TypeError: UpdateProductPriceUseCase.__init__() missing 1 required positional argument: 'parser'
2025-10-03 22:43:59,040 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-03 22:43:59,042 - aiogram.event - INFO - Update id=557185185 is handled. Duration 15697 ms by bot id=5702092394
2025-10-03 22:45:43,149 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:45:43,150 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:45:43,151 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:45:43,365 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:45:48,093 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 22:45:48,094 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 22:45:48,095 - aiogram.dispatcher - INFO - Start polling
2025-10-03 22:45:48,330 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:45:52,472 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 22:45:52,609 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:45:52,752 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 22:45:52,753 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 22:45:52,754 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 22:45:52,756 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:45:52,757 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:45:52,758 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:45:52,758 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 22:45:53,029 - aiogram.event - INFO - Update id=557185186 is handled. Duration 557 ms by bot id=5702092394
2025-10-03 22:45:53,733 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:45:53,734 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 22:45:53,765 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:45:53,793 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 22:45:53,815 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-03 22:45:53,841 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 22:45:53,847 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 22:45:53,852 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:45:53,854 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:45:53,854 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:45:53,991 - aiogram.event - INFO - Update id=557185187 is handled. Duration 260 ms by bot id=5702092394
2025-10-03 22:45:55,339 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:45:55,353 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:45:55,358 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 22:45:55,361 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:45:55,362 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:45:55,363 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:45:55,486 - aiogram.event - INFO - Update id=557185188 is handled. Duration 232 ms by bot id=5702092394
2025-10-03 22:45:57,019 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 22:45:57,020 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 22:45:57,021 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:45:57,021 - src.core.uow - WARNING - Исключение в Unit of Work: TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:45:57,022 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:45:57,022 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:45:57,023 - src.core.decorators - ERROR - Ошибка в функции update_product_price: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:45:57,023 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:45:57,028 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-03 22:45:57,032 - aiogram.event - INFO - Update id=557185189 is handled. Duration 16 ms by bot id=5702092394
2025-10-03 22:50:13,812 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:50:13,813 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:50:13,814 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:50:14,074 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:50:20,114 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 22:50:20,116 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 22:50:20,117 - aiogram.dispatcher - INFO - Start polling
2025-10-03 22:50:20,340 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:50:26,766 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 22:50:26,923 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:50:27,082 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 22:50:27,083 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 22:50:27,084 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 22:50:27,088 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:50:27,089 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:50:27,091 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:50:27,093 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 22:50:27,385 - aiogram.event - INFO - Update id=557185190 is handled. Duration 620 ms by bot id=5702092394
2025-10-03 22:50:28,741 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:50:28,742 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 22:50:28,806 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:50:28,839 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 22:50:28,869 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-03 22:50:28,897 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 22:50:28,904 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 22:50:28,915 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:50:28,916 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:50:28,916 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:50:29,028 - aiogram.event - INFO - Update id=557185191 is handled. Duration 292 ms by bot id=5702092394
2025-10-03 22:50:30,078 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:50:30,102 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:50:30,117 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 22:50:30,121 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:50:30,124 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:50:30,128 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:50:30,255 - aiogram.event - INFO - Update id=557185192 is handled. Duration 284 ms by bot id=5702092394
2025-10-03 22:50:30,930 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 22:50:30,930 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 22:50:30,931 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:50:30,932 - src.core.uow - WARNING - Исключение в Unit of Work: TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:50:30,932 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:50:30,933 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:50:30,933 - src.core.decorators - ERROR - Ошибка в функции update_product_price: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:50:30,934 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:50:30,940 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-03 22:50:30,942 - aiogram.event - INFO - Update id=557185193 is handled. Duration 17 ms by bot id=5702092394
2025-10-03 22:52:43,376 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:52:43,377 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:52:43,378 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:52:43,507 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:05:53,717 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:05:53,720 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:05:53,720 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:05:53,965 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:06:04,381 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:06:04,879 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:06:05,003 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 09:06:05,003 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 09:06:05,004 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 09:06:05,006 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:06:05,007 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:06:05,008 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:06:05,008 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 09:06:05,274 - aiogram.event - INFO - Update id=557185194 is handled. Duration 895 ms by bot id=5702092394
2025-10-04 09:06:06,371 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:06:06,372 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:06:06,409 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:06:06,439 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:06:06,461 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:06:06,477 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:06:06,486 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:06:06,493 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:06:06,494 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:06:06,494 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:06:06,589 - aiogram.event - INFO - Update id=557185195 is handled. Duration 219 ms by bot id=5702092394
2025-10-04 09:06:07,823 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:06:07,838 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:06:07,845 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:06:07,848 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:06:07,851 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:06:07,853 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:06:07,975 - aiogram.event - INFO - Update id=557185196 is handled. Duration 252 ms by bot id=5702092394
2025-10-04 09:06:10,181 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:06:10,182 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:06:10,183 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:06:10,184 - src.core.uow - WARNING - Исключение в Unit of Work: TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-04 09:06:10,185 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:06:10,185 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:06:10,186 - src.core.decorators - ERROR - Ошибка в функции update_product_price: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-04 09:06:10,186 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-04 09:06:10,254 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-04 09:06:10,256 - aiogram.event - INFO - Update id=557185197 is handled. Duration 77 ms by bot id=5702092394
2025-10-04 09:07:43,549 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:07:43,550 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:07:43,551 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:07:43,689 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:07:48,164 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:07:48,165 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:07:48,166 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:07:48,406 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:07:52,534 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:07:52,632 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:07:52,633 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:07:52,719 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:07:52,731 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:07:52,741 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:07:52,756 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:07:52,760 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:07:52,765 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:07:52,766 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:07:52,767 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:07:53,014 - aiogram.event - INFO - Update id=557185198 is handled. Duration 481 ms by bot id=5702092394
2025-10-04 09:07:54,433 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:07:54,444 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:07:54,448 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:07:54,451 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:07:54,452 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:07:54,452 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:07:54,545 - aiogram.event - INFO - Update id=557185199 is handled. Duration 207 ms by bot id=5702092394
2025-10-04 09:07:55,725 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:07:55,726 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:07:55,727 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:07:55,739 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:07:58,662 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:08:10,015 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:08:10,016 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:08:10,161 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:08:10,182 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:08:10,207 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:08:10,236 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:08:10,257 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:08:10,274 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:08:10,328 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:08:12,121 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:08:12,126 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:08:13,352 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:08:24,699 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:08:24,699 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:08:24,746 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:08:24,780 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:08:24,808 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:08:24,837 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:08:24,864 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:08:24,882 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:08:24,936 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:08:26,572 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:08:26,573 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: 'with_card'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'
2025-10-04 09:08:26,587 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:08:26,589 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:08:26,590 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:08:26,591 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:08:26,591 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 80, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:08:26,595 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-04 09:08:26,597 - aiogram.event - INFO - Update id=557185200 is handled. Duration 30874 ms by bot id=5702092394
2025-10-04 09:12:16,940 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:12:16,942 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:12:16,943 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:12:17,105 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:12:21,198 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:12:21,201 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:12:21,201 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:12:21,445 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:12:28,201 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:12:28,273 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:12:28,273 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:12:28,351 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:12:28,359 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:12:28,370 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:12:28,379 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:12:28,381 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:12:28,385 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:12:28,386 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:12:28,386 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:12:28,660 - aiogram.event - INFO - Update id=557185201 is handled. Duration 459 ms by bot id=5702092394
2025-10-04 09:12:30,153 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:12:30,160 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:12:30,163 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:12:30,166 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:12:30,167 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:12:30,167 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:12:30,270 - aiogram.event - INFO - Update id=557185202 is handled. Duration 214 ms by bot id=5702092394
2025-10-04 09:12:31,263 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:12:31,264 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:12:31,265 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:12:31,273 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:12:32,635 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:12:44,410 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:12:44,410 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:12:44,481 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:12:44,526 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:12:44,558 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:12:44,588 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:12:44,624 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:12:44,656 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:12:44,749 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:12:46,547 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:12:46,552 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:12:47,856 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:12:59,211 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:12:59,212 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:12:59,282 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:12:59,336 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:12:59,375 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:12:59,410 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:12:59,443 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:12:59,472 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:12:59,537 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:13:01,189 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:13:01,189 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: 'with_card'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'
2025-10-04 09:13:01,192 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:13:01,193 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:13:01,193 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:13:01,193 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:13:01,193 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 80, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:13:01,427 - aiogram.event - INFO - Update id=557185203 is handled. Duration 30167 ms by bot id=5702092394
2025-10-04 09:15:12,043 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:15:12,044 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:15:12,045 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:15:12,210 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:33:15,680 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:33:15,681 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:33:15,682 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:33:16,001 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:33:23,597 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:33:23,712 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:33:44,766 - src.infrastructure.services.product_service - ERROR - Ошибка при создании пользователя 515084006: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:33:44,767 - src.core.uow - WARNING - Исключение в Unit of Work: UserCreationError: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:33:44,768 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:33:44,768 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:33:44,769 - src.core.decorators - ERROR - Ошибка в функции create_user: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:33:44,769 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:33:44,776 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:34:15,178 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:34:15,180 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:34:15,180 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:34:15,390 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:34:15,464 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:34:15,530 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:34:36,586 - src.infrastructure.services.product_service - ERROR - Ошибка при создании пользователя 515084006: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:34:36,587 - src.core.uow - WARNING - Исключение в Unit of Work: UserCreationError: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:34:36,588 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:34:36,588 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:34:36,589 - src.core.decorators - ERROR - Ошибка в функции create_user: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:34:36,589 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:34:36,665 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:31,839 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:51:31,842 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:51:31,842 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:51:32,113 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:51:40,691 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:51:40,789 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:40,919 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 09:51:40,920 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 09:51:40,920 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 09:51:40,922 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:51:40,923 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:51:40,923 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:51:40,924 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 09:51:41,233 - aiogram.event - INFO - Update id=557185209 is handled. Duration 542 ms by bot id=5702092394
2025-10-04 09:51:42,524 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:42,524 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:51:42,562 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:51:42,590 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:51:42,608 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:51:42,624 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:51:42,629 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:51:42,633 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:51:42,634 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:51:42,635 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:51:42,745 - aiogram.event - INFO - Update id=557185210 is handled. Duration 222 ms by bot id=5702092394
2025-10-04 09:51:43,663 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:43,679 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:51:43,685 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:51:43,689 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:51:43,690 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:51:43,691 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:51:43,795 - aiogram.event - INFO - Update id=557185211 is handled. Duration 235 ms by bot id=5702092394
2025-10-04 09:51:44,670 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:51:44,671 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:51:44,672 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:44,689 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:51:46,642 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:51:58,045 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:51:58,046 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:51:58,113 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:51:58,144 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:51:58,170 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:51:58,197 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:51:58,226 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:51:58,243 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:51:58,329 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:51:58,329 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:52:00,088 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:52:00,099 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:52:01,322 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:52:12,821 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:52:12,822 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:52:12,888 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:52:12,925 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:52:12,961 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:52:13,001 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:52:13,028 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:52:13,049 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:52:13,109 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:52:13,110 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:52:14,701 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:52:14,701 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: 'with_card'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'
2025-10-04 09:52:14,714 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:52:14,717 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:52:14,718 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:52:14,718 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:52:14,719 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 84, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:52:14,990 - aiogram.event - INFO - Update id=557185212 is handled. Duration 30322 ms by bot id=5702092394
2025-10-04 09:53:04,875 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:53:04,879 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:53:04,879 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:53:05,016 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:53:11,756 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:53:11,757 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:53:11,758 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:53:11,999 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:53:17,835 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:53:17,938 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:53:18,040 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 09:53:18,041 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 09:53:18,041 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 09:53:18,043 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:53:18,043 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:53:18,044 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:53:18,045 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 09:53:18,323 - aiogram.event - INFO - Update id=557185213 is handled. Duration 487 ms by bot id=5702092394
2025-10-04 09:53:18,859 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:53:18,860 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:53:18,884 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:53:18,903 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:53:18,917 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:53:18,930 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:53:18,935 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:53:18,938 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:53:18,939 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:53:18,939 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:53:19,063 - aiogram.event - INFO - Update id=557185214 is handled. Duration 204 ms by bot id=5702092394
2025-10-04 09:53:20,348 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:53:20,359 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:53:20,364 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:53:20,370 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:53:20,370 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:53:20,371 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:53:20,492 - aiogram.event - INFO - Update id=557185215 is handled. Duration 558 ms by bot id=5702092394
2025-10-04 09:53:21,563 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:53:21,563 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:53:21,564 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:53:21,581 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:53:23,276 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:53:34,671 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:53:34,672 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:53:34,774 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:53:34,833 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:53:34,908 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:53:34,987 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:53:35,049 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:53:35,098 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:53:35,278 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:53:35,279 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:53:37,129 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:53:37,138 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:53:38,358 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:53:49,722 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:53:49,723 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:53:49,782 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:53:49,857 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:53:49,922 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:53:49,975 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:53:50,034 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:53:50,067 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:53:50,189 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:53:50,190 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:53:51,915 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:53:51,916 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 09:53:51,918 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: cannot access local variable 'new_price' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 67, in execute
    logger.info(f"Цена для товара {product_id} успешно обновлена: {new_price}")
                                                                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value
2025-10-04 09:53:51,919 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:53:51,921 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:53:51,922 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:53:51,922 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:53:51,922 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 67, in execute
    logger.info(f"Цена для товара {product_id} успешно обновлена: {new_price}")
                                                                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 84, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:53:52,146 - aiogram.event - INFO - Update id=557185216 is handled. Duration 30587 ms by bot id=5702092394
2025-10-04 09:55:34,617 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:55:34,618 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:55:34,619 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:55:34,752 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:55:39,475 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:55:39,477 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:55:39,477 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:55:39,719 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:56:37,354 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:56:37,416 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:56:37,417 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:56:37,512 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:56:37,530 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:56:37,545 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:56:37,560 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:56:37,565 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:56:37,568 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:56:37,568 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:56:37,569 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:56:37,955 - aiogram.event - INFO - Update id=557185217 is handled. Duration 601 ms by bot id=5702092394
2025-10-04 09:56:39,661 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:56:39,718 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:56:39,724 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:56:39,730 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:56:39,731 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:56:39,731 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:56:39,864 - aiogram.event - INFO - Update id=557185218 is handled. Duration 305 ms by bot id=5702092394
2025-10-04 09:56:45,916 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:56:45,917 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:56:45,918 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:56:45,930 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:56:47,360 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:56:58,726 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:56:58,728 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:56:58,982 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:56:59,026 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:56:59,057 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:56:59,092 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:56:59,140 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:56:59,162 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:56:59,229 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:56:59,229 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:57:01,049 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:57:01,057 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:57:02,245 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:57:13,715 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:57:13,715 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:57:13,796 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:57:13,826 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:57:13,853 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:57:13,880 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:57:13,923 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:57:13,944 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:57:14,004 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:57:14,005 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:57:15,688 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:57:15,689 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 09:57:15,689 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: cannot access local variable 'new_price' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 67, in execute
    logger.info(f"Цена для товара {product_id} успешно обновлена: {new_price.with_card}")
                                                                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value
2025-10-04 09:57:15,690 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:57:15,692 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:57:15,692 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:57:15,692 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:57:15,692 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 67, in execute
    logger.info(f"Цена для товара {product_id} успешно обновлена: {new_price.with_card}")
                                                                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 84, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:57:16,000 - aiogram.event - INFO - Update id=557185219 is handled. Duration 30085 ms by bot id=5702092394
2025-10-04 09:58:39,660 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:58:39,662 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:58:39,663 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:58:39,800 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:59:01,930 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:59:01,932 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:59:01,932 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:59:02,231 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:59:09,300 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:59:09,389 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:59:09,474 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:59:09,479 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:59:09,482 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:59:09,483 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:59:09,483 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:59:09,636 - aiogram.event - INFO - Update id=557185220 is handled. Duration 611 ms by bot id=5702092394
2025-10-04 09:59:11,320 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:59:11,320 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:59:11,342 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:59:11,358 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:59:11,372 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:59:11,388 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:59:11,393 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:59:11,397 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:59:11,398 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:59:11,399 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:59:11,555 - aiogram.event - INFO - Update id=557185221 is handled. Duration 432 ms by bot id=5702092394
2025-10-04 09:59:15,759 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:59:15,773 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:59:15,779 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:59:15,782 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:59:15,783 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:59:15,783 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:59:15,882 - aiogram.event - INFO - Update id=557185222 is handled. Duration 197 ms by bot id=5702092394
2025-10-04 09:59:19,939 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1668950019
2025-10-04 09:59:19,940 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:59:19,941 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:59:19,954 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:59:21,393 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:59:34,745 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-04 09:59:34,747 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-04 09:59:34,995 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-04 09:59:35,359 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-04 09:59:35,474 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:59:35,590 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1575
2025-10-04 09:59:35,989 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1713
2025-10-04 09:59:36,857 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-04 09:59:37,183 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-04 09:59:37,184 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1575, 'price_without_card': 1713, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-04 09:59:39,024 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:59:39,036 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:59:40,352 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:59:52,358 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-04 09:59:52,359 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-04 10:00:02,047 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-04 10:00:02,075 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-04 10:00:02,131 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 10:00:02,158 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1575
2025-10-04 10:00:02,193 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1713
2025-10-04 10:00:02,215 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-04 10:00:02,300 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-04 10:00:02,301 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1575, 'price_without_card': 1713, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-04 10:00:04,015 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 10:00:04,016 - src.application.use_cases.upd_product - INFO - Цена товара 1668950019 не изменилась
2025-10-04 10:00:04,016 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: cannot access local variable 'new_price' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 75, in execute
    "with_card": new_price.with_card,
                 ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value
2025-10-04 10:00:04,019 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1668950019
2025-10-04 10:00:04,021 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 10:00:04,021 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 10:00:04,021 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1668950019
2025-10-04 10:00:04,022 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 75, in execute
    "with_card": new_price.with_card,
                 ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 85, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1668950019
2025-10-04 10:00:04,348 - aiogram.event - INFO - Update id=557185223 is handled. Duration 44411 ms by bot id=5702092394
2025-10-04 11:38:40,685 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:38:40,688 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:38:40,688 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:38:40,932 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:40:00,846 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:40:01,010 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:40:01,227 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:40:01,228 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:40:01,229 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:40:01,230 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:40:01,231 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:40:01,231 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:40:01,232 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:40:01,578 - aiogram.event - INFO - Update id=557185224 is handled. Duration 734 ms by bot id=5702092394
2025-10-04 11:40:02,280 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:40:02,281 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:40:02,362 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:40:02,385 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:40:02,403 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:40:02,419 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:40:02,426 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:40:02,428 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:40:02,429 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:40:02,429 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:40:02,674 - aiogram.event - INFO - Update id=557185225 is handled. Duration 395 ms by bot id=5702092394
2025-10-04 11:40:03,833 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:40:03,853 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:40:03,860 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:40:03,862 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:40:03,863 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:40:03,864 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:40:04,012 - aiogram.event - INFO - Update id=557185226 is handled. Duration 295 ms by bot id=5702092394
2025-10-04 11:40:05,285 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:40:05,285 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 11:40:05,286 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:40:05,312 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:40:08,384 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:40:19,742 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:40:19,743 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:40:19,806 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:40:19,850 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:40:19,893 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:40:19,938 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:40:19,981 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:40:20,012 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:40:20,107 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:40:20,108 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:40:21,968 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:40:21,977 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:40:23,194 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:40:34,533 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:40:34,534 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:40:34,598 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:40:34,647 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:40:34,693 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:40:34,733 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:40:34,772 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:40:34,802 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:40:34,875 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:40:34,876 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:40:36,570 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:40:36,570 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:40:36,571 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: 'NoneType' object has no attribute 'with_card'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 75, in execute
    "with_card": new_price.with_card,
                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'with_card'
2025-10-04 11:40:36,586 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 11:40:36,589 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:40:36,589 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:40:36,590 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 11:40:36,590 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 75, in execute
    "with_card": new_price.with_card,
                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'with_card'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 85, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 11:40:36,843 - aiogram.event - INFO - Update id=557185227 is handled. Duration 31560 ms by bot id=5702092394
2025-10-04 11:42:30,044 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:42:30,045 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:42:30,046 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:42:30,307 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:42:35,218 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:42:35,220 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:42:35,220 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:42:35,468 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:42:41,508 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:42:41,598 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:42:41,697 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:42:41,699 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:42:41,700 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:42:41,702 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:42:41,702 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:42:41,703 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:42:41,703 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:42:41,943 - aiogram.event - INFO - Update id=557185228 is handled. Duration 435 ms by bot id=5702092394
2025-10-04 11:42:42,567 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:42:42,567 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:42:42,593 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:42:42,610 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:42:42,625 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:42:42,637 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:42:42,641 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:42:42,643 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:42:42,644 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:42:42,645 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:42:42,755 - aiogram.event - INFO - Update id=557185229 is handled. Duration 190 ms by bot id=5702092394
2025-10-04 11:42:43,802 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:42:43,812 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:42:43,819 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:42:43,821 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:42:43,822 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:42:43,822 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:42:43,930 - aiogram.event - INFO - Update id=557185230 is handled. Duration 240 ms by bot id=5702092394
2025-10-04 11:42:44,920 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:42:44,921 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 11:42:44,921 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:42:44,935 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:42:46,327 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:42:57,639 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:42:57,640 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:42:57,693 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:42:57,722 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:42:57,756 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:42:57,807 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:42:57,848 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:42:57,875 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:42:57,972 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:42:57,973 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:42:59,701 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:42:59,709 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:43:00,909 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:43:12,289 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:43:12,290 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:43:12,356 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:43:12,402 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:43:12,459 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:43:12,501 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:43:12,534 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:43:12,555 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:43:12,625 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:43:12,625 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:43:14,262 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:43:14,263 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:43:14,269 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:43:14,271 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:43:14,273 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:43:14,273 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:43:14,273 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:43:14,274 - src.infrastructure.services.logger - INFO - Получили обновленный товар: <class 'dict'> - {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}}
2025-10-04 11:43:14,274 - src.infrastructure.services.logger - INFO - Формируем новое сообщение
2025-10-04 11:43:14,274 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:43:14,275 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-04 11:43:14,275 - src.infrastructure.services.logger - INFO - Обновляем сообщение с новыми данными
2025-10-04 11:43:14,504 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 213, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:43:14,619 - aiogram.event - INFO - Update id=557185231 is handled. Duration 29700 ms by bot id=5702092394
2025-10-04 11:46:23,666 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:46:23,668 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:46:23,668 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:46:23,805 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:46:29,221 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:46:29,223 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:46:29,224 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:46:29,439 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:46:36,233 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:46:36,329 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:46:36,428 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:46:36,429 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:46:36,429 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:46:36,431 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:46:36,432 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:46:36,432 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:46:36,432 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:46:36,662 - aiogram.event - INFO - Update id=557185232 is handled. Duration 429 ms by bot id=5702092394
2025-10-04 11:46:38,159 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:46:38,160 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:46:38,190 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:46:38,212 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:46:38,233 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:46:38,247 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:46:38,250 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:46:38,253 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:46:38,254 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:46:38,255 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:46:38,363 - aiogram.event - INFO - Update id=557185233 is handled. Duration 205 ms by bot id=5702092394
2025-10-04 11:46:39,618 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:46:39,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:46:39,641 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:46:39,644 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:46:39,645 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:46:39,645 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:46:39,744 - aiogram.event - INFO - Update id=557185234 is handled. Duration 219 ms by bot id=5702092394
2025-10-04 11:46:40,692 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:46:40,693 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:46:40,704 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:46:42,129 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:46:53,617 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:46:53,618 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:46:53,664 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:46:53,694 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:46:53,741 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:46:53,770 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:46:53,799 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:46:53,823 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:46:53,931 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:46:53,931 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:46:55,640 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:46:55,647 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:46:56,841 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:47:08,176 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:47:08,176 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:47:08,242 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:47:08,280 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:47:08,316 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:47:08,361 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:47:08,395 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:47:08,419 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:47:08,536 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:47:08,536 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:47:10,169 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:47:10,170 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:47:10,174 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:47:10,177 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:47:10,178 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:47:10,179 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:47:10,179 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:47:10,179 - src.infrastructure.services.logger - INFO - Получили обновленный товар: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}}
2025-10-04 11:47:10,179 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:47:10,180 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-04 11:47:10,180 - src.infrastructure.services.logger - INFO - Обновляем сообщение с новыми данными
2025-10-04 11:47:10,432 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 200, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:47:10,522 - aiogram.event - INFO - Update id=557185235 is handled. Duration 29832 ms by bot id=5702092394
2025-10-04 11:50:23,146 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:50:23,148 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:50:23,149 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:50:23,313 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:50:28,550 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:50:28,552 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:50:28,552 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:50:28,807 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:50:33,905 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:50:34,024 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:50:34,170 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:50:34,171 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:50:34,172 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:50:34,177 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:50:34,178 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:50:34,178 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:50:34,179 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:50:34,438 - aiogram.event - INFO - Update id=557185236 is handled. Duration 533 ms by bot id=5702092394
2025-10-04 11:50:36,418 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:50:36,419 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:50:36,452 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:50:36,473 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:50:36,488 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:50:36,503 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:50:36,506 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:50:36,510 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:50:36,511 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:50:36,512 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:50:36,616 - aiogram.event - INFO - Update id=557185237 is handled. Duration 198 ms by bot id=5702092394
2025-10-04 11:50:37,613 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:50:37,628 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:50:37,632 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:50:37,635 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:50:37,636 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:50:37,637 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:50:37,736 - aiogram.event - INFO - Update id=557185238 is handled. Duration 208 ms by bot id=5702092394
2025-10-04 11:50:38,890 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:50:38,973 - src.infrastructure.services.logger - INFO - Вызываем product_service.update_product_price
2025-10-04 11:50:38,974 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:50:38,987 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:50:40,446 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:50:51,885 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:50:51,885 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:50:51,950 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:50:52,020 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:50:52,063 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:50:52,103 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:50:52,139 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:50:52,168 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:50:52,250 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:50:52,250 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:50:53,975 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:50:53,984 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:50:55,231 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:51:06,629 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:51:06,630 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:51:06,671 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:51:06,700 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:51:06,733 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:51:06,766 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:51:06,802 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:51:06,837 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:51:06,914 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:51:06,914 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:51:08,546 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:51:08,547 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:51:08,556 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:51:08,560 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:51:08,562 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:08,562 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:08,563 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:51:08,563 - src.infrastructure.services.logger - INFO - Получили обновленный товар: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}}
2025-10-04 11:51:08,563 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:51:08,564 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-04 11:51:08,565 - src.infrastructure.services.logger - INFO - Цена изменилась, обновляем сообщение
2025-10-04 11:51:08,814 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 207, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:51:08,909 - aiogram.event - INFO - Update id=557185239 is handled. Duration 30021 ms by bot id=5702092394
2025-10-04 11:51:45,612 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:51:45,614 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:51:45,614 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:51:45,748 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:51:50,131 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:51:50,132 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:51:50,133 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:51:50,349 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:51:54,324 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:51:54,421 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:51:54,529 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:51:54,530 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:51:54,530 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:51:54,532 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:54,533 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:54,534 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:51:54,534 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:51:54,787 - aiogram.event - INFO - Update id=557185240 is handled. Duration 463 ms by bot id=5702092394
2025-10-04 11:51:56,016 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:51:56,017 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:51:56,046 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:51:56,066 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:51:56,081 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:51:56,093 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:51:56,098 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:51:56,101 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:51:56,101 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:56,103 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:51:56,203 - aiogram.event - INFO - Update id=557185241 is handled. Duration 187 ms by bot id=5702092394
2025-10-04 11:51:57,299 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:51:57,315 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:51:57,320 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:51:57,324 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:51:57,326 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:57,327 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:51:57,443 - aiogram.event - INFO - Update id=557185242 is handled. Duration 227 ms by bot id=5702092394
2025-10-04 11:51:58,279 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:51:58,355 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 11:51:58,356 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:51:58,372 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:51:59,713 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:52:11,080 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:52:11,081 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:52:11,147 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:52:11,193 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:52:11,243 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:52:11,293 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:52:11,343 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:52:11,373 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:52:11,450 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:52:11,451 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:52:13,113 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:52:13,119 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:52:14,347 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:52:25,703 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:52:25,704 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:52:25,750 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:52:25,780 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:52:25,811 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:52:25,839 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:52:25,868 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:52:25,890 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:52:25,951 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:52:25,952 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:52:27,560 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:52:27,561 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:52:27,568 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:52:27,573 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:52:27,576 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:52:27,576 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:52:27,577 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:52:27,577 - src.infrastructure.services.logger - INFO - Получили обновленный товар
2025-10-04 11:52:27,577 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:52:27,578 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-04 11:52:27,578 - src.infrastructure.services.logger - INFO - Цена изменилась, обновляем сообщение
2025-10-04 11:52:27,827 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 206, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:52:27,924 - aiogram.event - INFO - Update id=557185243 is handled. Duration 29647 ms by bot id=5702092394
2025-10-04 11:53:59,912 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:53:59,914 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:53:59,914 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:54:00,053 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:54:05,224 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:54:05,226 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:54:05,226 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:54:05,440 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:57:51,246 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:57:51,351 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:57:51,352 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:57:51,466 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:57:51,479 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:57:51,493 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:57:51,503 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:57:51,508 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:57:51,511 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:57:51,512 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:57:51,512 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:57:51,758 - aiogram.event - INFO - Update id=557185244 is handled. Duration 512 ms by bot id=5702092394
2025-10-04 11:57:53,031 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:57:53,045 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:57:53,051 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:57:53,054 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:57:53,056 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:57:53,057 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:57:53,153 - aiogram.event - INFO - Update id=557185245 is handled. Duration 197 ms by bot id=5702092394
2025-10-04 11:57:54,410 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:57:54,541 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:57:54,556 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:57:55,998 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:58:07,436 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:58:07,437 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:58:07,518 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:58:07,566 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:58:07,603 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:58:07,647 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:58:07,692 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:58:07,722 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:58:07,812 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:58:07,813 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:58:09,480 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:58:09,486 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:58:10,751 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:58:22,131 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:58:22,132 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:58:22,191 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:58:22,232 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:58:22,303 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:58:22,363 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:58:22,427 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:58:22,455 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:58:22,549 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:58:22,550 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:58:24,245 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:58:24,246 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:58:24,254 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:58:24,260 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:58:24,262 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:58:24,262 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:58:24,263 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:58:24,263 - src.infrastructure.services.logger - INFO - Получили обновленный товар
2025-10-04 11:58:24,268 - src.infrastructure.services.logger - INFO - Current text: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href="https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/">Ссылка на товар</a>
2025-10-04 11:58:24,269 - src.infrastructure.services.logger - INFO - New text: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:58:24,269 - src.infrastructure.services.logger - INFO - Текст изменился, обновляем сообщение
2025-10-04 11:58:24,509 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 209, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:58:24,605 - aiogram.event - INFO - Update id=557185246 is handled. Duration 30198 ms by bot id=5702092394
2025-10-04 11:58:33,496 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:58:33,497 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:58:33,513 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:58:33,527 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:58:33,536 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:58:33,550 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:58:33,555 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:58:33,559 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:58:33,560 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:58:33,561 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:58:33,651 - aiogram.event - INFO - Update id=557185247 is handled. Duration 155 ms by bot id=5702092394
2025-10-04 11:58:36,467 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:58:36,484 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:58:36,491 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:58:36,495 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:58:36,496 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:58:36,496 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:58:36,607 - aiogram.event - INFO - Update id=557185248 is handled. Duration 232 ms by bot id=5702092394
2025-10-04 11:58:38,110 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1728110604
2025-10-04 11:58:38,206 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:58:38,224 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:58:39,609 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:58:50,940 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/
2025-10-04 11:58:50,940 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/
2025-10-04 11:58:50,979 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1728110604
2025-10-04 11:58:51,005 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый
2025-10-04 11:58:51,034 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.8
2025-10-04 11:58:51,064 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 15830
2025-10-04 11:58:51,091 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 15990
2025-10-04 11:58:51,109 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg
2025-10-04 11:58:51,226 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Бытовая техника', 'Техника для дома', 'Пылесосы', 'Роботы-пылесосы', 'Xiaomi']
2025-10-04 11:58:51,227 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1728110604', 'name': 'Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', 'rating': 4.8, 'price_with_card': 15830, 'price_without_card': 15990, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', 'categories': ['Бытовая техника', 'Техника для дома', 'Пылесосы', 'Роботы-пылесосы', 'Xiaomi']}
2025-10-04 11:58:52,920 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:58:52,932 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:58:54,126 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:59:05,461 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/
2025-10-04 11:59:05,462 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/
2025-10-04 11:59:05,525 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1728110604
2025-10-04 11:59:05,591 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый
2025-10-04 11:59:05,635 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.8
2025-10-04 11:59:05,670 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 15830
2025-10-04 11:59:05,708 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 15990
2025-10-04 11:59:05,730 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg
2025-10-04 11:59:05,844 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Бытовая техника', 'Техника для дома', 'Пылесосы', 'Роботы-пылесосы', 'Xiaomi']
2025-10-04 11:59:05,844 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1728110604', 'name': 'Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', 'rating': 4.8, 'price_with_card': 15830, 'price_without_card': 15990, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', 'categories': ['Бытовая техника', 'Техника для дома', 'Пылесосы', 'Роботы-пылесосы', 'Xiaomi']}
2025-10-04 11:59:07,525 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:59:07,526 - src.application.use_cases.upd_product - INFO - Цена для товара ИЗМЕНИЛАСЬ и 1728110604 успешно обновлена: 15830
2025-10-04 11:59:07,527 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))
2025-10-04 11:59:07,535 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:59:07,540 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:59:07,597 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:59:07,597 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:59:07,598 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:59:07,599 - src.infrastructure.services.logger - INFO - Получили обновленный товар
2025-10-04 11:59:07,599 - src.infrastructure.services.logger - INFO - Current text: 📦 Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый
💳 Цена с картой: 14452 ₽
💵 Цена без карты: 14598 ₽
🔗 <a href="https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/">Ссылка на товар</a>
2025-10-04 11:59:07,600 - src.infrastructure.services.logger - INFO - New text: 📦 Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый
💳 Цена с картой: 14452 ₽
💵 Цена без карты: 14598 ₽
🔗 <a href='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/'>Ссылка на товар</a>
2025-10-04 11:59:07,600 - src.infrastructure.services.logger - INFO - Текст изменился, обновляем сообщение
2025-10-04 11:59:07,852 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 209, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:59:07,945 - aiogram.event - INFO - Update id=557185249 is handled. Duration 29837 ms by bot id=5702092394
2025-10-04 12:37:39,704 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 12:37:39,707 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 12:37:39,707 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 12:37:39,826 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 12:42:18,799 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 12:42:18,801 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 12:42:18,802 - aiogram.dispatcher - INFO - Start polling
2025-10-04 12:42:19,038 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 12:46:23,568 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 12:46:23,667 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 12:46:23,779 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 12:46:23,780 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 12:46:23,780 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 12:46:23,782 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:46:23,783 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:46:23,784 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 12:46:23,784 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 12:46:24,031 - aiogram.event - INFO - Update id=557185250 is handled. Duration 463 ms by bot id=5702092394
2025-10-04 12:46:25,634 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 12:46:25,635 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 12:46:25,665 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 12:46:25,688 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 12:46:25,704 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 12:46:25,717 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 12:46:25,721 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 12:46:25,724 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 12:46:25,724 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:46:25,725 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 12:46:25,846 - aiogram.event - INFO - Update id=557185251 is handled. Duration 213 ms by bot id=5702092394
2025-10-04 12:46:26,927 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 12:46:26,945 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 12:46:26,950 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 12:46:26,953 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 12:46:26,954 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:46:26,954 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 12:46:27,057 - aiogram.event - INFO - Update id=557185252 is handled. Duration 209 ms by bot id=5702092394
2025-10-04 12:46:27,996 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 12:46:28,081 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 12:46:28,098 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 12:46:30,407 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 12:46:41,764 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 12:46:41,765 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 12:46:41,819 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 12:46:41,851 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 12:46:41,881 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 12:46:41,910 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 12:46:41,950 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 12:46:41,972 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 12:46:42,049 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 12:46:42,050 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 12:46:43,793 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 12:46:43,799 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 12:46:44,973 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 12:46:56,271 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 12:46:56,271 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 12:46:56,307 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 12:46:56,333 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 12:46:56,376 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 12:46:56,420 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 12:46:56,456 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 12:46:56,483 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 12:46:56,560 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 12:46:56,560 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 12:46:58,213 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 12:46:58,214 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687))
2025-10-04 12:46:58,215 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-04 12:46:58,215 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687))
2025-10-04 12:46:58,223 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 12:46:58,226 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 12:46:58,253 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:46:58,253 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:46:58,253 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 12:46:58,254 - src.infrastructure.services.logger - INFO - Получили обновленный товар
2025-10-04 12:46:58,256 - src.infrastructure.services.logger - INFO - Current text: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href="https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/">Ссылка на товар</a>
2025-10-04 12:46:58,257 - src.infrastructure.services.logger - INFO - New text: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 12:46:58,257 - src.infrastructure.services.logger - INFO - Текст изменился, обновляем сообщение
2025-10-04 12:46:58,467 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 209, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 12:46:58,578 - aiogram.event - INFO - Update id=557185253 is handled. Duration 30584 ms by bot id=5702092394
2025-10-04 12:49:33,102 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 12:49:33,103 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 12:49:33,104 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 12:49:33,206 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 12:49:38,503 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 12:49:38,505 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 12:49:38,505 - aiogram.dispatcher - INFO - Start polling
2025-10-04 12:49:38,539 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 12:49:38,821 - asyncio - ERROR - Task exception was never retrieved
future: <Task finished name='Task-2' coro=<Dispatcher._polling() done, defined at C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py:339> exception=TelegramNetworkError('HTTP Client says - ClientConnectionError: Connector is closed.')>
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiohttp\client.py", line 1488, in __aenter__
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiohttp\client.py", line 770, in _request
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiohttp\client.py", line 725, in _connect_and_send_request
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiohttp\connector.py", line 652, in connect
aiohttp.client_exceptions.ClientConnectionError: Connector is closed.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 362, in _polling
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 354, in me
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 1780, in get_me
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 184, in make_request
aiogram.exceptions.TelegramNetworkError: HTTP Client says - ClientConnectionError: Connector is closed.
2025-10-04 12:49:47,562 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 12:49:47,564 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 12:49:47,565 - aiogram.dispatcher - INFO - Start polling
2025-10-04 12:49:47,792 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 12:49:57,498 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 12:49:57,560 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 12:49:57,633 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 12:49:57,634 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 12:49:57,634 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 12:49:57,636 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:49:57,636 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:49:57,637 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 12:49:57,637 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 12:49:57,999 - aiogram.event - INFO - Update id=557185254 is handled. Duration 501 ms by bot id=5702092394
2025-10-04 12:49:59,103 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 12:49:59,104 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 12:49:59,125 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687))]) (ID: 1818184981)
2025-10-04 12:49:59,143 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 12:49:59,160 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 12:49:59,176 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 12:49:59,181 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 12:49:59,184 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 12:49:59,185 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:49:59,186 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 12:49:59,366 - aiogram.event - INFO - Update id=557185255 is handled. Duration 263 ms by bot id=5702092394
2025-10-04 12:50:00,567 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 12:50:00,577 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687))]) (ID: 1818184981)
2025-10-04 12:50:00,583 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 12:50:00,587 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 12:50:00,588 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:50:00,588 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 12:50:00,700 - aiogram.event - INFO - Update id=557185256 is handled. Duration 214 ms by bot id=5702092394
2025-10-04 12:50:01,737 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 12:50:01,829 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 12:50:01,841 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687))]) (ID: 1818184981)
2025-10-04 12:50:03,162 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 12:50:14,521 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 12:50:14,523 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 12:50:15,884 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 12:50:15,966 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 12:50:16,080 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 12:50:16,172 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 12:50:16,266 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 12:50:16,332 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 12:50:16,529 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 12:50:16,531 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 12:50:18,553 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 12:50:18,566 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687))]) (ID: 1818184981)
2025-10-04 12:50:19,992 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 12:50:31,352 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 12:50:31,352 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 12:50:31,430 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 12:50:31,482 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 12:50:31,532 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 12:50:31,584 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 12:50:31,632 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 12:50:31,666 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 12:50:31,809 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 12:50:31,810 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 12:50:33,507 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 12:50:33,507 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891))
2025-10-04 12:50:33,508 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-04 12:50:33,509 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891))
2025-10-04 12:50:33,518 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687))]) (ID: 1818184981)
2025-10-04 12:50:33,521 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 12:50:33,533 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:50:33,533 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 12:50:33,533 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 12:50:33,534 - src.infrastructure.services.logger - INFO - Получили обновленный товар
2025-10-04 12:50:33,534 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 197, in handle_update_price
    if updated_product['is_changed']:
       ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
KeyError: 'is_changed'
2025-10-04 12:50:33,765 - aiogram.event - INFO - Update id=557185257 is handled. Duration 32030 ms by bot id=5702092394
2025-10-04 13:05:08,418 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 13:05:08,420 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 13:05:08,420 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 13:05:08,560 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 13:05:13,290 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 13:05:13,292 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 13:05:13,292 - aiogram.dispatcher - INFO - Start polling
2025-10-04 13:05:13,528 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 13:05:18,938 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 13:05:19,026 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:05:19,027 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 13:05:19,135 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891))]) (ID: 1818184981)
2025-10-04 13:05:19,151 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 13:05:19,164 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 13:05:19,178 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 13:05:19,181 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 13:05:19,184 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 13:05:19,184 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:05:19,185 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:05:19,448 - aiogram.event - INFO - Update id=557185258 is handled. Duration 510 ms by bot id=5702092394
2025-10-04 13:05:24,391 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:05:24,402 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891))]) (ID: 1818184981)
2025-10-04 13:05:24,407 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 13:05:24,410 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 13:05:24,411 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:05:24,411 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:05:24,505 - aiogram.event - INFO - Update id=557185259 is handled. Duration 199 ms by bot id=5702092394
2025-10-04 13:05:28,862 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 13:05:28,961 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:05:28,972 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891))]) (ID: 1818184981)
2025-10-04 13:05:30,237 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 13:05:41,657 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:05:41,658 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:05:41,723 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 13:05:41,769 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 13:05:41,832 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 13:05:41,879 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 13:05:41,928 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 13:05:41,959 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 13:05:42,084 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 13:05:42,084 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 13:05:43,987 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 13:05:43,994 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891))]) (ID: 1818184981)
2025-10-04 13:05:45,170 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 13:05:56,584 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:05:56,585 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:05:56,624 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 13:05:56,651 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 13:05:56,677 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 13:05:56,716 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 13:05:56,748 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 13:05:56,765 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 13:05:56,875 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 13:05:56,876 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 13:05:58,518 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 13:05:58,519 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276))
2025-10-04 13:05:58,519 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-04 13:05:58,520 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276))
2025-10-04 13:05:58,526 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891))]) (ID: 1818184981)
2025-10-04 13:05:58,529 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 13:05:58,545 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:05:58,545 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:05:58,545 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:05:58,546 - src.infrastructure.services.logger - INFO - Получили обновленный товар
2025-10-04 13:05:58,546 - src.infrastructure.services.logger - INFO - Цена не изменилась, уведомление не требуется
2025-10-04 13:05:58,751 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 209, in handle_update_price
    await call.answer('✅ Цена актуальна', show_alert=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-10-04 13:05:58,861 - aiogram.event - INFO - Update id=557185260 is handled. Duration 30000 ms by bot id=5702092394
2025-10-04 13:06:47,444 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 13:06:47,445 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 13:06:47,446 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 13:06:47,592 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 13:06:52,743 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 13:06:52,744 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 13:06:52,744 - aiogram.dispatcher - INFO - Start polling
2025-10-04 13:06:52,953 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 13:07:01,822 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 13:07:01,908 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:07:02,009 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 13:07:02,010 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 13:07:02,011 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 13:07:02,014 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:07:02,014 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:07:02,015 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:07:02,016 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 13:07:02,389 - aiogram.event - INFO - Update id=557185261 is handled. Duration 567 ms by bot id=5702092394
2025-10-04 13:07:02,891 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:07:02,892 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 13:07:02,923 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276))]) (ID: 1818184981)
2025-10-04 13:07:02,940 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 13:07:02,955 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 13:07:02,970 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 13:07:02,974 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 13:07:02,979 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 13:07:02,980 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:07:02,980 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:07:03,131 - aiogram.event - INFO - Update id=557185262 is handled. Duration 240 ms by bot id=5702092394
2025-10-04 13:07:04,203 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:07:04,212 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276))]) (ID: 1818184981)
2025-10-04 13:07:04,216 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 13:07:04,219 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 13:07:04,220 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:07:04,220 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:07:04,369 - aiogram.event - INFO - Update id=557185263 is handled. Duration 269 ms by bot id=5702092394
2025-10-04 13:07:05,068 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 13:07:05,141 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:07:05,157 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276))]) (ID: 1818184981)
2025-10-04 13:07:06,466 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 13:07:17,846 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:07:17,847 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:07:17,929 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 13:07:17,973 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 13:07:18,031 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 13:07:18,078 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 13:07:18,126 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 13:07:18,152 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 13:07:18,243 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 13:07:18,243 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 13:07:20,018 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 13:07:20,031 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276))]) (ID: 1818184981)
2025-10-04 13:07:21,443 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 13:07:32,747 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:07:32,748 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:07:32,820 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 13:07:32,845 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 13:07:32,873 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 13:07:32,909 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 13:07:32,939 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 13:07:32,959 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 13:07:33,029 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 13:07:33,029 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 13:07:34,789 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 13:07:34,789 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338))
2025-10-04 13:07:34,789 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-04 13:07:34,790 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338))
2025-10-04 13:07:34,797 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276))]) (ID: 1818184981)
2025-10-04 13:07:34,800 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}, 'is_changed': False}
2025-10-04 13:07:34,801 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 13:07:34,814 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:07:34,815 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:07:34,816 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:07:34,816 - src.infrastructure.services.logger - INFO - Получили обновленный товар
2025-10-04 13:07:34,817 - src.infrastructure.services.logger - INFO - Цена не изменилась, уведомление не требуется
2025-10-04 13:07:35,051 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 209, in handle_update_price
    await call.answer('✅ Цена актуальна', show_alert=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-10-04 13:07:35,149 - aiogram.event - INFO - Update id=557185264 is handled. Duration 30084 ms by bot id=5702092394
2025-10-04 13:09:48,823 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 13:09:48,825 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 13:09:48,825 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 13:09:48,963 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 13:09:54,231 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 13:09:54,233 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 13:09:54,233 - aiogram.dispatcher - INFO - Start polling
2025-10-04 13:09:54,492 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 13:10:05,150 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 13:10:05,238 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:10:05,329 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 13:10:05,330 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 13:10:05,331 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 13:10:05,333 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:10:05,335 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:10:05,335 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:10:05,336 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 13:10:05,602 - aiogram.event - INFO - Update id=557185265 is handled. Duration 452 ms by bot id=5702092394
2025-10-04 13:10:06,330 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:10:06,331 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 13:10:06,355 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338))]) (ID: 1818184981)
2025-10-04 13:10:06,374 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 13:10:06,389 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 13:10:06,405 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 13:10:06,412 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 13:10:06,415 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 13:10:06,417 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:10:06,417 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:10:06,563 - aiogram.event - INFO - Update id=557185266 is handled. Duration 234 ms by bot id=5702092394
2025-10-04 13:10:07,598 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:10:07,613 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338))]) (ID: 1818184981)
2025-10-04 13:10:07,618 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 13:10:07,621 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 13:10:07,622 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:10:07,623 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:10:07,782 - aiogram.event - INFO - Update id=557185267 is handled. Duration 313 ms by bot id=5702092394
2025-10-04 13:10:08,651 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 13:10:08,652 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:10:08,670 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338))]) (ID: 1818184981)
2025-10-04 13:10:10,496 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 13:10:21,887 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:10:21,888 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:10:21,973 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 13:10:22,016 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 13:10:22,063 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 13:10:22,119 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 13:10:22,169 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 13:10:22,204 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 13:10:22,327 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 13:10:22,328 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 13:10:24,214 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 13:10:24,221 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338))]) (ID: 1818184981)
2025-10-04 13:10:25,435 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 13:10:36,744 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:10:36,745 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:10:36,794 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 13:10:36,824 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 13:10:36,853 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 13:10:36,881 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 13:10:36,910 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 13:10:36,933 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 13:10:37,061 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 13:10:37,061 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 13:10:38,756 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 13:10:38,757 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274))
2025-10-04 13:10:38,757 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-04 13:10:38,758 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274))
2025-10-04 13:10:38,767 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338))]) (ID: 1818184981)
2025-10-04 13:10:38,771 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}, 'is_changed': False}
2025-10-04 13:10:38,771 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 13:10:38,781 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:10:38,781 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:10:38,782 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:10:39,125 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 207, in handle_update_price
    await call.answer()  # Просто закрываем callback без текста
    ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-10-04 13:10:39,315 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 207, in handle_update_price
    await call.answer()  # Просто закрываем callback без текста
    ^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 221, in handle_update_price
    await call.answer()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: query is too old and response timeout expired or query ID is invalid
2025-10-04 13:10:39,318 - aiogram.event - INFO - Update id=557185268 is handled. Duration 30671 ms by bot id=5702092394
2025-10-04 13:12:31,909 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 13:12:31,910 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 13:12:31,911 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 13:12:32,051 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 13:12:36,674 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 13:12:36,675 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 13:12:36,675 - aiogram.dispatcher - INFO - Start polling
2025-10-04 13:12:36,887 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 13:13:04,936 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 13:13:04,997 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:13:05,074 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 13:13:05,075 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 13:13:05,075 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 13:13:05,077 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:13:05,077 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:13:05,078 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:13:05,078 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 13:13:05,336 - aiogram.event - INFO - Update id=557185269 is handled. Duration 400 ms by bot id=5702092394
2025-10-04 13:13:06,114 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:13:06,115 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 13:13:06,134 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274))]) (ID: 1818184981)
2025-10-04 13:13:06,151 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 13:13:06,165 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 13:13:06,177 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 13:13:06,180 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 13:13:06,182 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 13:13:06,182 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:13:06,183 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:13:06,270 - aiogram.event - INFO - Update id=557185270 is handled. Duration 157 ms by bot id=5702092394
2025-10-04 13:13:07,219 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:13:07,230 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274))]) (ID: 1818184981)
2025-10-04 13:13:07,235 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 13:13:07,238 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 13:13:07,240 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:13:07,240 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:13:07,343 - aiogram.event - INFO - Update id=557185271 is handled. Duration 240 ms by bot id=5702092394
2025-10-04 13:13:07,906 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 13:13:07,907 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 13:13:07,920 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274))]) (ID: 1818184981)
2025-10-04 13:13:09,236 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 13:13:20,580 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:13:20,581 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:13:20,630 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 13:13:20,661 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 13:13:20,711 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 13:13:20,753 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 13:13:20,789 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 13:13:20,811 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 13:13:20,907 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 13:13:20,908 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 13:13:22,594 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 13:13:22,601 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274))]) (ID: 1818184981)
2025-10-04 13:13:23,761 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 13:13:35,089 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:13:35,092 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 13:13:35,144 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 13:13:35,177 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 13:13:35,210 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 13:13:35,242 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 13:13:35,279 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 13:13:35,305 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 13:13:35,376 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 13:13:35,377 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 13:13:37,132 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 13:13:37,133 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072))
2025-10-04 13:13:37,133 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-04 13:13:37,134 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072))
2025-10-04 13:13:37,143 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274))]) (ID: 1818184981)
2025-10-04 13:13:37,147 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}, 'is_changed': False}
2025-10-04 13:13:37,148 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 13:13:37,176 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:13:37,177 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 13:13:37,178 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 13:13:37,463 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-04 13:13:37,464 - aiogram.event - INFO - Update id=557185272 is handled. Duration 29559 ms by bot id=5702092394
2025-10-04 14:36:57,506 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-10-04 14:36:57,535 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 14:37:09,190 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 5702092394)
2025-10-04 15:50:41,017 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-10-04 15:50:41,028 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 15:50:52,564 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 5702092394)
2025-10-04 15:51:06,245 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:51:06,246 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 15:51:06,354 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072))]) (ID: 1818184981)
2025-10-04 15:51:06,370 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 15:51:06,406 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 15:51:06,420 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 15:51:06,426 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 15:51:06,430 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 15:51:06,430 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:51:06,431 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:51:06,731 - aiogram.event - INFO - Update id=557185273 is handled. Duration 487 ms by bot id=5702092394
2025-10-04 15:51:09,331 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:51:09,366 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 15:51:09,371 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 15:51:09,377 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 15:51:09,378 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:51:09,378 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:51:09,484 - aiogram.event - INFO - Update id=557185274 is handled. Duration 258 ms by bot id=5702092394
2025-10-04 15:51:11,159 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1565602444
2025-10-04 15:51:11,159 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:51:11,175 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 15:51:13,309 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 15:51:24,633 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-04 15:51:24,634 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-04 15:51:24,734 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1565602444
2025-10-04 15:51:24,799 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Ray-Ban Очки солнцезащитные
2025-10-04 15:51:24,860 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.7
2025-10-04 15:51:24,929 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 561
2025-10-04 15:51:24,997 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 612
2025-10-04 15:51:25,040 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg
2025-10-04 15:51:25,256 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']
2025-10-04 15:51:25,257 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'rating': 4.7, 'price_with_card': 561, 'price_without_card': 612, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'categories': ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']}
2025-10-04 15:51:27,328 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 15:51:27,348 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 15:51:29,163 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 15:51:40,465 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-04 15:51:40,465 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-04 15:51:40,511 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1565602444
2025-10-04 15:51:40,546 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Ray-Ban Очки солнцезащитные
2025-10-04 15:51:40,578 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.7
2025-10-04 15:51:40,607 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 561
2025-10-04 15:51:40,642 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 612
2025-10-04 15:51:40,667 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg
2025-10-04 15:51:40,803 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']
2025-10-04 15:51:40,804 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'rating': 4.7, 'price_with_card': 561, 'price_without_card': 612, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'categories': ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']}
2025-10-04 15:51:42,891 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 15:51:42,892 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))
2025-10-04 15:51:42,892 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 737
2025-10-04 15:51:42,892 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))
2025-10-04 15:51:42,897 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 15:51:42,900 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'link': 'https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'rating': 4.7, 'categories': '{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', 'latest_price': {'with_card': 737, 'without_card': 805}, 'is_changed': True}
2025-10-04 15:51:42,901 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 15:51:42,914 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:51:42,915 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:51:42,915 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:51:43,240 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 193, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 15:51:43,455 - aiogram.event - INFO - Update id=557185275 is handled. Duration 32300 ms by bot id=5702092394
2025-10-04 15:52:11,142 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:52:11,183 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))]) (ID: 1565602444)
2025-10-04 15:52:11,195 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 15:52:11,201 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 15:52:11,201 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:52:11,202 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:52:11,300 - aiogram.event - INFO - Update id=557185276 is handled. Duration 255 ms by bot id=5702092394
2025-10-04 15:52:12,725 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:52:12,726 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 15:52:12,742 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072))]) (ID: 1818184981)
2025-10-04 15:52:12,761 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 15:52:12,773 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 15:52:12,788 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))]) (ID: 1565602444)
2025-10-04 15:52:12,792 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 15:52:12,796 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 15:52:12,797 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:52:12,798 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:52:12,893 - aiogram.event - INFO - Update id=557185277 is handled. Duration 246 ms by bot id=5702092394
2025-10-04 15:52:14,917 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:52:14,930 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072))]) (ID: 1818184981)
2025-10-04 15:52:14,934 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 15:52:14,939 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 15:52:14,940 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:52:14,941 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:52:15,078 - aiogram.event - INFO - Update id=557185278 is handled. Duration 264 ms by bot id=5702092394
2025-10-04 15:52:15,941 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 15:52:15,942 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:52:15,953 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072))]) (ID: 1818184981)
2025-10-04 15:52:17,283 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 15:52:28,631 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 15:52:28,632 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 15:52:28,711 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 15:52:28,765 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 15:52:28,814 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 15:52:28,876 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 15:52:28,923 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 15:52:28,965 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 15:52:29,073 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 15:52:29,074 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 15:52:30,733 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 15:52:30,746 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072))]) (ID: 1818184981)
2025-10-04 15:52:32,073 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 15:52:43,437 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 15:52:43,443 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 15:52:43,844 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 15:52:43,934 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 15:52:44,013 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 15:52:44,087 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 15:52:44,173 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 15:52:44,227 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 15:52:44,406 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 15:52:44,407 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 15:52:46,313 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 15:52:46,314 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004))
2025-10-04 15:52:46,314 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-04 15:52:46,315 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004))
2025-10-04 15:52:46,323 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072))]) (ID: 1818184981)
2025-10-04 15:52:46,327 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}, 'is_changed': False}
2025-10-04 15:52:46,328 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 15:52:46,336 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:52:46,338 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:52:46,339 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:52:46,612 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-04 15:52:46,612 - aiogram.event - INFO - Update id=557185279 is handled. Duration 30674 ms by bot id=5702092394
2025-10-04 15:52:56,629 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:52:56,630 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 15:52:56,641 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004))]) (ID: 1818184981)
2025-10-04 15:52:56,659 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-04 15:52:56,674 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 15:52:56,687 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))]) (ID: 1565602444)
2025-10-04 15:52:56,691 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 15:52:56,694 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 15:52:56,695 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:52:56,696 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:52:56,854 - aiogram.event - INFO - Update id=557185280 is handled. Duration 370 ms by bot id=5702092394
2025-10-04 15:52:59,085 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:52:59,098 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))]) (ID: 1565602444)
2025-10-04 15:52:59,104 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 15:52:59,108 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 15:52:59,109 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:52:59,110 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:52:59,267 - aiogram.event - INFO - Update id=557185281 is handled. Duration 365 ms by bot id=5702092394
2025-10-04 15:53:00,107 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1565602444
2025-10-04 15:53:00,108 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 15:53:00,126 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))]) (ID: 1565602444)
2025-10-04 15:53:01,425 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 15:53:13,643 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-04 15:53:13,645 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-04 15:53:13,737 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1565602444
2025-10-04 15:53:13,824 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Ray-Ban Очки солнцезащитные
2025-10-04 15:53:13,901 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.7
2025-10-04 15:53:13,955 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 561
2025-10-04 15:53:14,047 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 612
2025-10-04 15:53:14,103 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg
2025-10-04 15:53:14,377 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']
2025-10-04 15:53:14,378 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'rating': 4.7, 'price_with_card': 561, 'price_without_card': 612, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'categories': ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']}
2025-10-04 15:53:16,379 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 15:53:16,397 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))]) (ID: 1565602444)
2025-10-04 15:53:17,958 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 15:53:29,307 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-04 15:53:29,308 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-04 15:53:29,514 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1565602444
2025-10-04 15:53:29,761 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Ray-Ban Очки солнцезащитные
2025-10-04 15:53:29,956 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.7
2025-10-04 15:53:30,077 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 561
2025-10-04 15:53:30,293 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 612
2025-10-04 15:53:30,365 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg
2025-10-04 15:53:30,676 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']
2025-10-04 15:53:30,676 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'rating': 4.7, 'price_with_card': 561, 'price_without_card': 612, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'categories': ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']}
2025-10-04 15:53:32,758 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 15:53:32,759 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))
2025-10-04 15:53:32,760 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 561
2025-10-04 15:53:32,760 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))
2025-10-04 15:53:32,769 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985))]) (ID: 1565602444)
2025-10-04 15:53:32,774 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'link': 'https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'rating': 4.7, 'categories': '{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', 'latest_price': {'with_card': 561, 'without_card': 612}, 'is_changed': False}
2025-10-04 15:53:32,774 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 15:53:32,785 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:53:32,785 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 15:53:32,786 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 15:53:33,174 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-04 15:53:33,175 - aiogram.event - INFO - Update id=557185282 is handled. Duration 33070 ms by bot id=5702092394
2025-10-04 15:55:06,138 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 15:55:06,139 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 15:55:06,139 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 15:55:06,288 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:11:39,258 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 09:11:39,261 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 09:11:39,261 - aiogram.dispatcher - INFO - Start polling
2025-10-05 09:11:39,557 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:15:37,687 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 09:15:37,691 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 09:15:37,691 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 09:15:37,878 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:15:46,573 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 09:15:46,575 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 09:15:46,576 - aiogram.dispatcher - INFO - Start polling
2025-10-05 09:15:46,808 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:15:55,237 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 09:15:55,679 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:15:56,143 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-05 09:15:56,143 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 09:15:56,145 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 09:15:56,150 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:15:56,153 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:15:56,154 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:15:56,155 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 09:15:56,482 - aiogram.event - INFO - Update id=557185283 is handled. Duration 1246 ms by bot id=5702092394
2025-10-05 09:15:57,803 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:15:57,804 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:15:57,879 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004))]) (ID: 1818184981)
2025-10-05 09:15:57,935 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-05 09:15:57,961 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-05 09:15:57,998 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:15:58,005 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:15:58,020 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:15:58,021 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:15:58,022 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:15:58,138 - aiogram.event - INFO - Update id=557185284 is handled. Duration 337 ms by bot id=5702092394
2025-10-05 09:15:59,725 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:15:59,760 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004))]) (ID: 1818184981)
2025-10-05 09:15:59,778 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:15:59,785 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:15:59,786 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:15:59,787 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:15:59,912 - aiogram.event - INFO - Update id=557185285 is handled. Duration 276 ms by bot id=5702092394
2025-10-05 09:16:00,895 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-05 09:16:00,897 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:16:00,924 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004))]) (ID: 1818184981)
2025-10-05 09:16:05,054 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:16:16,593 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 09:16:16,597 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 09:16:21,563 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 09:16:21,656 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 09:16:21,750 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:16:21,864 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 09:16:21,967 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 09:16:22,025 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 09:16:22,219 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 09:16:22,220 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 09:16:24,314 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:16:24,342 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004))]) (ID: 1818184981)
2025-10-05 09:16:25,979 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:16:37,325 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 09:16:37,325 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 09:16:37,435 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 09:16:37,493 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 09:16:37,546 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:16:37,604 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 09:16:37,662 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 09:16:37,707 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 09:16:37,843 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 09:16:37,844 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 09:16:39,793 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:16:39,794 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))
2025-10-05 09:16:39,795 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-05 09:16:39,797 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))
2025-10-05 09:16:39,833 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004))]) (ID: 1818184981)
2025-10-05 09:16:39,844 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}, 'is_changed': False}
2025-10-05 09:16:39,846 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 09:16:40,017 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:16:40,019 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:16:40,019 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:16:40,285 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-05 09:16:40,285 - aiogram.event - INFO - Update id=557185286 is handled. Duration 39405 ms by bot id=5702092394
2025-10-05 09:16:47,589 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:16:47,591 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:16:47,623 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:16:47,657 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-05 09:16:47,689 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-05 09:16:47,727 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:16:47,735 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:16:47,741 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:16:47,742 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:16:47,743 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:16:47,899 - aiogram.event - INFO - Update id=557185287 is handled. Duration 491 ms by bot id=5702092394
2025-10-05 09:16:49,172 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:16:49,196 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-05 09:16:49,204 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:16:49,211 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:16:49,212 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:16:49,214 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:16:49,311 - aiogram.event - INFO - Update id=557185288 is handled. Duration 232 ms by bot id=5702092394
2025-10-05 09:16:50,822 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1728110604
2025-10-05 09:16:50,823 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:16:50,849 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-05 09:16:52,340 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:17:03,716 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/
2025-10-05 09:17:03,717 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/
2025-10-05 09:17:03,851 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1728110604
2025-10-05 09:17:03,933 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый
2025-10-05 09:17:04,030 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.8
2025-10-05 09:17:04,118 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 15830
2025-10-05 09:17:04,202 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 15990
2025-10-05 09:17:04,259 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg
2025-10-05 09:17:04,512 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Бытовая техника', 'Техника для дома', 'Пылесосы', 'Роботы-пылесосы', 'Xiaomi']
2025-10-05 09:17:04,514 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1728110604', 'name': 'Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', 'rating': 4.8, 'price_with_card': 15830, 'price_without_card': 15990, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', 'categories': ['Бытовая техника', 'Техника для дома', 'Пылесосы', 'Роботы-пылесосы', 'Xiaomi']}
2025-10-05 09:17:06,419 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:17:06,445 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-05 09:17:08,093 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:17:19,559 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/
2025-10-05 09:17:19,561 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/
2025-10-05 09:17:19,666 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1728110604
2025-10-05 09:17:19,742 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый
2025-10-05 09:17:19,819 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.8
2025-10-05 09:17:19,894 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 15830
2025-10-05 09:17:19,982 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 15990
2025-10-05 09:17:20,033 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg
2025-10-05 09:17:20,272 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Бытовая техника', 'Техника для дома', 'Пылесосы', 'Роботы-пылесосы', 'Xiaomi']
2025-10-05 09:17:20,273 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1728110604', 'name': 'Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', 'rating': 4.8, 'price_with_card': 15830, 'price_without_card': 15990, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', 'categories': ['Бытовая техника', 'Техника для дома', 'Пылесосы', 'Роботы-пылесосы', 'Xiaomi']}
2025-10-05 09:17:22,263 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:17:22,264 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))
2025-10-05 09:17:22,265 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 15830
2025-10-05 09:17:22,266 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))
2025-10-05 09:17:22,286 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397))]) (ID: 1728110604)
2025-10-05 09:17:22,299 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1728110604', 'name': 'Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', 'link': 'https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', 'rating': 4.8, 'categories': '{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', 'latest_price': {'with_card': 15830, 'without_card': 15990}, 'is_changed': False}
2025-10-05 09:17:22,300 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 09:17:22,319 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:17:22,320 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:17:22,321 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:17:22,615 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-05 09:17:22,616 - aiogram.event - INFO - Update id=557185289 is handled. Duration 31797 ms by bot id=5702092394
2025-10-05 09:17:27,951 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:17:27,952 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:17:27,986 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:17:28,023 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:17:28,050 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-05 09:17:28,076 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:17:28,085 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:17:28,095 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:17:28,096 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:17:28,097 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:17:28,245 - aiogram.event - INFO - Update id=557185290 is handled. Duration 424 ms by bot id=5702092394
2025-10-05 09:17:29,701 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:17:29,729 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-05 09:17:29,740 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:17:29,748 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:17:29,749 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:17:29,750 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:17:29,868 - aiogram.event - INFO - Update id=557185291 is handled. Duration 284 ms by bot id=5702092394
2025-10-05 09:17:32,573 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1668950019
2025-10-05 09:17:32,575 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:17:32,602 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-05 09:17:34,106 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:17:45,530 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:17:45,532 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:17:45,705 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 09:17:45,795 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 09:17:45,881 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:17:45,958 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 09:17:46,047 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 09:17:46,102 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 09:17:46,335 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 09:17:46,335 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 09:17:48,291 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:17:48,310 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-05 09:17:49,853 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:18:01,311 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:18:01,312 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:18:01,464 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 09:18:01,537 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 09:18:01,626 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:18:01,713 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 09:18:01,831 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 09:18:01,896 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 09:18:02,148 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 09:18:02,149 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 09:18:04,006 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:18:04,007 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1575, previous_without_card=1713, created_at=datetime.datetime(2025, 10, 5, 9, 18, 4, 7195))
2025-10-05 09:18:04,008 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 1575
2025-10-05 09:18:04,009 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1575, previous_without_card=1713, created_at=datetime.datetime(2025, 10, 5, 9, 18, 4, 7195))
2025-10-05 09:18:04,029 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-05 09:18:04,036 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'link': 'https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'rating': 4.9, 'categories': '{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', 'latest_price': {'with_card': 1575, 'without_card': 1713}, 'is_changed': True}
2025-10-05 09:18:04,037 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 09:18:04,058 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:18:04,059 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:18:04,060 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:18:04,359 - src.infrastructure.services.logger - INFO - ✅ Цена обновлена!
2025-10-05 09:18:04,360 - aiogram.event - INFO - Update id=557185292 is handled. Duration 31790 ms by bot id=5702092394
2025-10-05 09:43:35,425 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 09:43:35,427 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 09:43:35,428 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 09:43:35,593 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:43:44,024 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 09:43:44,028 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 09:43:44,028 - aiogram.dispatcher - INFO - Start polling
2025-10-05 09:43:44,260 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:43:53,144 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 09:43:53,272 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:43:53,273 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:43:53,488 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:43:53,534 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:43:53,569 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681)), Price(id=51, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1575, previous_without_card=1713, created_at=datetime.datetime(2025, 10, 5, 9, 18, 4, 7195))]) (ID: 1668950019)
2025-10-05 09:43:53,609 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:43:53,621 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:43:53,631 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:43:53,632 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:43:53,633 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:43:53,760 - aiogram.event - INFO - Update id=557185293 is handled. Duration 978 ms by bot id=5702092394
2025-10-05 09:43:54,900 - aiogram.event - INFO - Update id=557185294 is handled. Duration 413 ms by bot id=5702092394
2025-10-05 09:43:59,772 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:43:59,774 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:43:59,809 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:43:59,847 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:43:59,884 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681)), Price(id=51, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1575, previous_without_card=1713, created_at=datetime.datetime(2025, 10, 5, 9, 18, 4, 7195))]) (ID: 1668950019)
2025-10-05 09:43:59,926 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:43:59,940 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:43:59,946 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:43:59,947 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:43:59,958 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:44:00,073 - aiogram.event - INFO - Update id=557185295 is handled. Duration 302 ms by bot id=5702092394
2025-10-05 09:44:01,757 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:44:01,783 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-05 09:44:01,785 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 09:44:01,786 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 09:44:01,793 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:44:01,794 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:44:01,795 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:44:01,796 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 09:44:01,891 - aiogram.event - INFO - Update id=557185296 is handled. Duration 134 ms by bot id=5702092394
2025-10-05 09:44:07,652 - aiogram.event - INFO - Update id=557185297 is handled. Duration 226 ms by bot id=5702092394
2025-10-05 09:44:14,809 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 09:44:14,811 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 09:44:14,812 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 09:44:14,969 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:44:29,130 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 09:44:29,133 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 09:44:29,133 - aiogram.dispatcher - INFO - Start polling
2025-10-05 09:44:29,394 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:44:29,747 - aiogram.event - INFO - Update id=557185298 is handled. Duration 259 ms by bot id=5702092394
2025-10-05 09:44:35,095 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 09:44:35,272 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:44:35,775 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-05 09:44:35,777 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 09:44:35,778 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 09:44:35,783 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:44:35,785 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:44:35,786 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:44:35,786 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 09:44:35,896 - aiogram.event - INFO - Update id=557185299 is handled. Duration 801 ms by bot id=5702092394
2025-10-05 09:44:36,910 - aiogram.event - INFO - Update id=557185300 is handled. Duration 216 ms by bot id=5702092394
2025-10-05 09:44:52,405 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:44:53,918 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:45:05,408 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/
2025-10-05 09:45:05,409 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/
2025-10-05 09:45:05,550 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 816992280
2025-10-05 09:45:05,628 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Рюкзак городской спортивный ТЕВИН
2025-10-05 09:45:05,715 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:45:05,793 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1824
2025-10-05 09:45:05,868 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1990
2025-10-05 09:45:05,945 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg
2025-10-05 09:45:06,199 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Мужчинам', 'Сумки и рюкзаки', 'Рюкзаки', 'TEVIN']
2025-10-05 09:45:06,200 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '816992280', 'name': 'Рюкзак городской спортивный ТЕВИН', 'rating': 4.9, 'price_with_card': 1824, 'price_without_card': 1990, 'image_url': 'https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', 'categories': ['Аксессуары', 'Мужчинам', 'Сумки и рюкзаки', 'Рюкзаки', 'TEVIN']}
2025-10-05 09:45:08,178 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:45:08,179 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/: {'id': '816992280', 'name': 'Рюкзак городской спортивный ТЕВИН', 'rating': 4.9, 'price_with_card': 1824, 'price_without_card': 1990, 'image_url': 'https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', 'categories': ['Аксессуары', 'Мужчинам', 'Сумки и рюкзаки', 'Рюкзаки', 'TEVIN']}
2025-10-05 09:45:08,204 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 816992280 не найден
2025-10-05 09:45:08,218 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-05 09:45:08,226 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='816992280', user_id='515084006', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories=['Аксессуары', 'Мужчинам', 'Сумки и рюкзаки', 'Рюкзаки', 'TEVIN'], prices=[Price(id=None, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))])
2025-10-05 09:45:08,234 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))
2025-10-05 09:45:08,237 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 816992280 пользователю ID 515084006
2025-10-05 09:45:08,238 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-05 09:45:08,308 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:08,309 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:08,310 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:45:08,598 - aiogram.event - INFO - Update id=557185301 is handled. Duration 16195 ms by bot id=5702092394
2025-10-05 09:45:43,808 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:45:43,810 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:45:43,856 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:45:43,889 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:45:43,917 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681)), Price(id=51, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1575, previous_without_card=1713, created_at=datetime.datetime(2025, 10, 5, 9, 18, 4, 7195))]) (ID: 1668950019)
2025-10-05 09:45:43,945 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:45:43,973 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:45:43,980 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:45:43,990 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:45:43,991 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:43,992 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:45:44,207 - aiogram.event - INFO - Update id=557185302 is handled. Duration 674 ms by bot id=5702092394
2025-10-05 09:45:46,110 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:45:46,153 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681)), Price(id=51, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1575, previous_without_card=1713, created_at=datetime.datetime(2025, 10, 5, 9, 18, 4, 7195))]) (ID: 1668950019)
2025-10-05 09:45:46,160 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:45:46,164 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:45:46,166 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:46,166 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:45:46,326 - aiogram.event - INFO - Update id=557185303 is handled. Duration 374 ms by bot id=5702092394
2025-10-05 09:45:47,401 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:45:47,428 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681)), Price(id=51, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1575, previous_without_card=1713, created_at=datetime.datetime(2025, 10, 5, 9, 18, 4, 7195))]) (ID: 1668950019)
2025-10-05 09:45:47,440 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:45:47,444 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:45:47,445 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:47,446 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:45:47,543 - aiogram.event - INFO - Update id=557185304 is handled. Duration 250 ms by bot id=5702092394
2025-10-05 09:45:48,782 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:45:48,807 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681)), Price(id=51, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1575, previous_without_card=1713, created_at=datetime.datetime(2025, 10, 5, 9, 18, 4, 7195))]) (ID: 1668950019)
2025-10-05 09:45:48,814 - src.infrastructure.database.repositories.price_repository - INFO - Найдено 3 цен для продукта 1668950019
2025-10-05 09:45:48,815 - src.infrastructure.database.repositories.price_repository - INFO - Попытка удаления цены с ID: 32
2025-10-05 09:45:48,824 - src.infrastructure.database.repositories.price_repository - INFO - Цена с ID 32 успешно удалена
2025-10-05 09:45:48,825 - src.infrastructure.database.repositories.price_repository - INFO - Попытка удаления цены с ID: 38
2025-10-05 09:45:48,835 - src.infrastructure.database.repositories.price_repository - INFO - Цена с ID 38 успешно удалена
2025-10-05 09:45:48,837 - src.infrastructure.database.repositories.price_repository - INFO - Попытка удаления цены с ID: 51
2025-10-05 09:45:48,843 - src.infrastructure.database.repositories.price_repository - INFO - Цена с ID 51 успешно удалена
2025-10-05 09:45:48,844 - src.infrastructure.database.repositories.product_repository - INFO - Попытка удаления товара с ID: 1668950019
2025-10-05 09:45:48,864 - src.infrastructure.database.repositories.product_repository - INFO - Товар с ID 1668950019 успешно удален
2025-10-05 09:45:48,870 - src.infrastructure.database.repositories.user_repository - WARNING - Пользователь с id  не найден
2025-10-05 09:45:48,871 - src.application.use_cases.delete_product - INFO - Операция удаления выполнена для ID 1668950019
2025-10-05 09:45:48,872 - src.core.decorators - INFO - Функция delete_product: выполняется commit транзакции
2025-10-05 09:45:48,935 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:48,937 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:48,938 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:45:48,939 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:45:48,940 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:45:48,976 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:45:49,006 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:45:49,035 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:45:49,058 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:45:49,066 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:45:49,071 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:45:49,072 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:49,073 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:45:49,258 - aiogram.event - INFO - Update id=557185305 is handled. Duration 638 ms by bot id=5702092394
2025-10-05 09:45:52,754 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:45:52,777 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280']) получен по id: 515084006
2025-10-05 09:45:52,778 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 09:45:52,779 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 09:45:52,784 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:52,785 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:52,786 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:45:52,787 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 09:45:52,893 - aiogram.event - INFO - Update id=557185306 is handled. Duration 141 ms by bot id=5702092394
2025-10-05 09:45:54,257 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:45:54,258 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:45:54,308 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:45:54,355 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:45:54,376 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:45:54,394 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:45:54,404 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:45:54,407 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:45:54,408 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:45:54,408 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:45:54,501 - aiogram.event - INFO - Update id=557185307 is handled. Duration 247 ms by bot id=5702092394
2025-10-05 09:45:55,901 - aiogram.event - INFO - Update id=557185308 is handled. Duration 213 ms by bot id=5702092394
2025-10-05 09:45:57,858 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:45:59,326 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:46:10,772 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:46:10,773 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:46:10,966 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 09:46:11,034 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 09:46:11,113 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:46:11,178 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 09:46:11,260 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 09:46:11,309 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 09:46:11,541 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 09:46:11,542 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 09:46:13,412 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:46:13,415 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 09:46:13,429 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 1668950019 не найден
2025-10-05 09:46:13,439 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280']) получен по id: 515084006
2025-10-05 09:46:13,445 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='1668950019', user_id='515084006', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories=['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX'], prices=[Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))])
2025-10-05 09:46:13,453 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))
2025-10-05 09:46:13,455 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 1668950019 пользователю ID 515084006
2025-10-05 09:46:13,457 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-05 09:46:13,480 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:46:13,481 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:46:13,482 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:46:13,719 - aiogram.event - INFO - Update id=557185309 is handled. Duration 15862 ms by bot id=5702092394
2025-10-05 09:46:16,861 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:46:16,862 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:46:16,901 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:46:16,923 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:46:16,945 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:46:16,970 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:46:16,995 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:46:17,005 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:46:17,010 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:46:17,012 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:46:17,013 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:46:17,119 - aiogram.event - INFO - Update id=557185310 is handled. Duration 342 ms by bot id=5702092394
2025-10-05 09:46:19,754 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:46:19,785 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:46:19,792 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:46:19,799 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:46:19,800 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:46:19,801 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:46:20,057 - aiogram.event - INFO - Update id=557185311 is handled. Duration 404 ms by bot id=5702092394
2025-10-05 09:46:24,406 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:46:24,407 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:46:24,438 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:46:24,475 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:46:24,499 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:46:24,521 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:46:24,549 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:46:24,555 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:46:24,561 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:46:24,562 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:46:24,563 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:46:24,674 - aiogram.event - INFO - Update id=557185312 is handled. Duration 391 ms by bot id=5702092394
2025-10-05 09:47:19,957 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:47:19,983 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019']) получен по id: 515084006
2025-10-05 09:47:19,984 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 09:47:19,985 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 09:47:19,989 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:47:19,990 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:47:19,990 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:47:19,991 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 09:47:20,104 - aiogram.event - INFO - Update id=557185313 is handled. Duration 147 ms by bot id=5702092394
2025-10-05 09:47:21,366 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:47:21,366 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:47:21,408 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:47:21,436 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:47:21,457 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:47:21,483 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:47:21,501 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:47:21,506 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:47:21,511 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:47:21,512 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:47:21,513 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:47:21,600 - aiogram.event - INFO - Update id=557185314 is handled. Duration 236 ms by bot id=5702092394
2025-10-05 09:47:22,648 - aiogram.event - INFO - Update id=557185315 is handled. Duration 193 ms by bot id=5702092394
2025-10-05 09:47:24,656 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:47:26,082 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:47:37,541 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 09:47:37,542 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 09:47:37,652 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 247385222
2025-10-05 09:47:37,724 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие
2025-10-05 09:47:37,782 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:47:37,844 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 859
2025-10-05 09:47:37,906 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 963
2025-10-05 09:47:37,962 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg
2025-10-05 09:47:38,268 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']
2025-10-05 09:47:38,269 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '247385222', 'name': 'Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', 'rating': 4.9, 'price_with_card': 859, 'price_without_card': 963, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', 'categories': ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']}
2025-10-05 09:47:40,059 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:47:40,063 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/: {'id': '247385222', 'name': 'Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', 'rating': 4.9, 'price_with_card': 859, 'price_without_card': 963, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', 'categories': ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']}
2025-10-05 09:47:40,075 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 247385222 не найден
2025-10-05 09:47:40,088 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019']) получен по id: 515084006
2025-10-05 09:47:40,094 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='247385222', user_id='515084006', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories=['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan'], prices=[Price(id=None, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))])
2025-10-05 09:47:40,101 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))
2025-10-05 09:47:40,102 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 247385222 пользователю ID 515084006
2025-10-05 09:47:40,103 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-05 09:47:40,132 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:47:40,133 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:47:40,133 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:47:40,358 - aiogram.event - INFO - Update id=557185316 is handled. Duration 15705 ms by bot id=5702092394
2025-10-05 09:47:46,417 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:47:46,419 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:47:46,499 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:47:46,561 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:47:46,618 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:47:46,667 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:47:46,709 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:47:46,737 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 09:47:46,746 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:47:46,750 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:47:46,751 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:47:46,752 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:47:47,511 - aiogram.event - INFO - Update id=557185317 is handled. Duration 1504 ms by bot id=5702092394
2025-10-05 09:47:48,978 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:47:49,012 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 09:47:49,019 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:47:49,024 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:47:49,025 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:47:49,027 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:47:49,122 - aiogram.event - INFO - Update id=557185318 is handled. Duration 266 ms by bot id=5702092394
2025-10-05 09:49:14,831 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:49:14,832 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:49:14,867 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:49:14,898 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:49:14,933 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:49:14,955 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:49:14,981 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:49:15,001 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 09:49:15,009 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:49:15,013 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:49:15,015 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:49:15,015 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:49:15,135 - aiogram.event - INFO - Update id=557185319 is handled. Duration 388 ms by bot id=5702092394
2025-10-05 09:49:23,081 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:49:23,109 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:49:23,116 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:49:23,122 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:49:23,123 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:49:23,124 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:49:23,240 - aiogram.event - INFO - Update id=557185320 is handled. Duration 241 ms by bot id=5702092394
2025-10-05 09:49:24,429 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1668950019
2025-10-05 09:49:24,430 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:49:24,456 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:49:25,961 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:49:37,414 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:49:37,415 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:49:37,547 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 09:49:37,657 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 09:49:37,745 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:49:37,844 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 09:49:37,963 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 09:49:38,004 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 09:49:38,173 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 09:49:38,174 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 09:49:39,967 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:49:39,978 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:49:41,299 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:49:52,748 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:49:52,749 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:49:52,804 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 09:49:52,842 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 09:49:52,888 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:49:52,932 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 09:49:52,974 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 09:49:53,007 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 09:49:53,138 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 09:49:53,138 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 09:49:54,750 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:49:54,751 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))
2025-10-05 09:49:54,752 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 1641
2025-10-05 09:49:54,752 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))
2025-10-05 09:49:54,763 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085))]) (ID: 1668950019)
2025-10-05 09:49:54,767 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'link': 'https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'rating': 4.9, 'categories': '{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', 'latest_price': {'with_card': 1641, 'without_card': 1784, 'previous_price_with_card': None, 'previous_price_without_card': None}, 'is_changed': False}
2025-10-05 09:49:54,767 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 09:49:54,788 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:49:54,788 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:49:54,789 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:49:54,790 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:49:54,799 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))]) (ID: 1668950019)
2025-10-05 09:49:54,802 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:49:54,805 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:49:54,805 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:49:54,806 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:49:54,807 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 190, in handle_update_price
    price_with_card = actual_prices_for_product['with_card']
                      ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'
2025-10-05 09:49:55,067 - aiogram.event - INFO - Update id=557185321 is handled. Duration 30641 ms by bot id=5702092394
2025-10-05 09:54:48,991 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 09:54:48,993 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 09:54:48,993 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 09:54:49,139 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:54:53,863 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 09:54:53,865 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 09:54:53,865 - aiogram.dispatcher - INFO - Start polling
2025-10-05 09:54:54,115 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:54:59,401 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 09:54:59,485 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:54:59,672 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 09:54:59,672 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 09:54:59,674 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 09:54:59,676 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:54:59,676 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:54:59,677 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:54:59,677 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 09:54:59,935 - aiogram.event - INFO - Update id=557185322 is handled. Duration 534 ms by bot id=5702092394
2025-10-05 09:55:01,282 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:55:01,282 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:55:01,303 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:55:01,321 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:55:01,334 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:55:01,347 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:55:01,360 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))]) (ID: 1668950019)
2025-10-05 09:55:01,370 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 09:55:01,375 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:55:01,377 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:55:01,378 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:55:01,378 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:55:01,469 - aiogram.event - INFO - Update id=557185323 is handled. Duration 189 ms by bot id=5702092394
2025-10-05 09:55:03,304 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:55:03,318 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:55:03,323 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:55:03,327 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:55:03,328 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:55:03,328 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:55:03,430 - aiogram.event - INFO - Update id=557185324 is handled. Duration 213 ms by bot id=5702092394
2025-10-05 09:55:04,948 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-05 09:55:04,949 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:55:04,966 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:55:06,318 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:55:17,751 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 09:55:17,752 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 09:55:17,812 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 09:55:17,856 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 09:55:17,909 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:55:17,962 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 09:55:18,015 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 09:55:18,045 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 09:55:18,141 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 09:55:18,142 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 09:55:19,750 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:55:19,764 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:55:21,073 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:55:32,464 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 09:55:32,464 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 09:55:32,530 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 09:55:32,572 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 09:55:32,620 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:55:32,668 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 09:55:32,724 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 09:55:32,755 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 09:55:32,843 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 09:55:32,843 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 09:55:34,644 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:55:34,645 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))
2025-10-05 09:55:34,646 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-05 09:55:34,646 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))
2025-10-05 09:55:34,654 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675))]) (ID: 1818184981)
2025-10-05 09:55:34,659 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'is_changed': False}
2025-10-05 09:55:34,659 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 09:55:34,673 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:55:34,674 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:55:34,674 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:55:34,675 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:55:34,687 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 09:55:34,692 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:55:34,696 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:55:34,697 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:55:34,697 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:55:34,698 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 196, in handle_update_price
    created_at = full_product_info['latest_price']['created_at']
                 ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
KeyError: 'created_at'
2025-10-05 09:55:34,960 - aiogram.event - INFO - Update id=557185325 is handled. Duration 30013 ms by bot id=5702092394
2025-10-05 09:56:06,804 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 09:56:06,805 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 09:56:06,805 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 09:56:06,959 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:56:13,927 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 09:56:13,929 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 09:56:13,930 - aiogram.dispatcher - INFO - Start polling
2025-10-05 09:56:14,185 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:56:18,564 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 09:56:18,844 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:56:18,939 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 09:56:18,939 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 09:56:18,939 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 09:56:18,941 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:56:18,942 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:56:18,942 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:56:18,943 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 09:56:19,242 - aiogram.event - INFO - Update id=557185326 is handled. Duration 678 ms by bot id=5702092394
2025-10-05 09:56:21,759 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:56:21,760 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:56:21,787 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 09:56:21,802 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:56:21,823 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:56:21,834 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:56:21,847 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))]) (ID: 1668950019)
2025-10-05 09:56:21,856 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 09:56:21,861 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:56:21,863 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:56:21,864 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:56:21,865 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:56:21,966 - aiogram.event - INFO - Update id=557185327 is handled. Duration 208 ms by bot id=5702092394
2025-10-05 09:56:24,270 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:56:24,282 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))]) (ID: 1668950019)
2025-10-05 09:56:24,286 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:56:24,288 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:56:24,289 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:56:24,289 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:56:24,397 - aiogram.event - INFO - Update id=557185328 is handled. Duration 222 ms by bot id=5702092394
2025-10-05 09:56:26,573 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1668950019
2025-10-05 09:56:26,573 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:56:26,582 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))]) (ID: 1668950019)
2025-10-05 09:56:28,356 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:56:39,729 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:56:39,729 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:56:39,879 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 09:56:39,929 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 09:56:39,976 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:56:40,014 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 09:56:40,054 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 09:56:40,109 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 09:56:40,254 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 09:56:40,255 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 09:56:42,083 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:56:42,089 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))]) (ID: 1668950019)
2025-10-05 09:56:43,320 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 09:56:54,695 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:56:54,695 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 09:56:54,747 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 09:56:54,808 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 09:56:54,842 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 09:56:54,878 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 09:56:54,917 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 09:56:54,944 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 09:56:55,039 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 09:56:55,039 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 09:56:56,732 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 09:56:56,732 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))
2025-10-05 09:56:56,733 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 1641
2025-10-05 09:56:56,733 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))
2025-10-05 09:56:56,740 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512))]) (ID: 1668950019)
2025-10-05 09:56:56,743 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'link': 'https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'rating': 4.9, 'categories': '{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', 'latest_price': {'with_card': 1641, 'without_card': 1784, 'previous_price_with_card': 1641, 'previous_price_without_card': 1784}, 'is_changed': False}
2025-10-05 09:56:56,743 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 09:56:56,750 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:56:56,751 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:56:56,752 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:56:56,752 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:56:56,771 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 09:56:56,776 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 09:56:56,779 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:56:56,779 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:56:56,780 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:56:56,781 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 196, in handle_update_price
    created_at = full_product_info['created_at']
                 ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
KeyError: 'created_at'
2025-10-05 09:56:57,077 - aiogram.event - INFO - Update id=557185329 is handled. Duration 30505 ms by bot id=5702092394
2025-10-05 09:59:10,741 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 09:59:10,743 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 09:59:10,744 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 09:59:10,880 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:59:15,649 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 09:59:15,651 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 09:59:15,651 - aiogram.dispatcher - INFO - Start polling
2025-10-05 09:59:15,867 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:59:23,332 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 09:59:23,416 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:59:23,513 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 09:59:23,513 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 09:59:23,513 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 09:59:23,515 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:59:23,516 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:59:23,516 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:59:23,517 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 09:59:23,789 - aiogram.event - INFO - Update id=557185330 is handled. Duration 457 ms by bot id=5702092394
2025-10-05 09:59:24,886 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:59:24,887 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:59:24,911 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 09:59:24,920 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 1818184981: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:24,929 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:59:24,934 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 1728110604: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:24,941 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:59:24,945 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 1565602444: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:24,953 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:59:24,956 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 816992280: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:24,968 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 09:59:24,971 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 1668950019: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:24,979 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 09:59:24,983 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 247385222: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:24,983 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:59:24,986 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:59:24,986 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:59:24,987 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:59:25,098 - aiogram.event - INFO - Update id=557185331 is handled. Duration 212 ms by bot id=5702092394
2025-10-05 09:59:29,932 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:59:29,932 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:59:29,945 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 09:59:29,948 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 1818184981: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:29,956 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:59:29,960 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 1728110604: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:29,970 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:59:29,972 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 1565602444: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:29,982 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:59:29,985 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 816992280: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:29,992 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 09:59:29,996 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 1668950019: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:30,005 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 09:59:30,007 - src.infrastructure.services.product_service - ERROR - Ошибка получения полной карточки для 247385222: 'Product' object has no attribute 'created_at'
2025-10-05 09:59:30,008 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:59:30,012 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:59:30,013 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:59:30,015 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:59:30,373 - aiogram.event - INFO - Update id=557185332 is handled. Duration 442 ms by bot id=5702092394
2025-10-05 09:59:38,011 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 09:59:38,013 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 09:59:38,013 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 09:59:38,162 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:59:43,118 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 09:59:43,120 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 09:59:43,120 - aiogram.dispatcher - INFO - Start polling
2025-10-05 09:59:43,344 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 09:59:49,878 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 09:59:49,942 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 09:59:49,943 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 09:59:50,035 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 09:59:50,047 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 09:59:50,061 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 09:59:50,072 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 09:59:50,085 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 09:59:50,097 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 09:59:50,101 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 09:59:50,103 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 09:59:50,104 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 09:59:50,104 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 09:59:50,337 - aiogram.event - INFO - Update id=557185333 is handled. Duration 458 ms by bot id=5702092394
2025-10-05 10:00:39,314 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 10:00:39,315 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 10:00:39,316 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 10:00:39,474 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:00:43,865 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 10:00:43,867 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 10:00:43,867 - aiogram.dispatcher - INFO - Start polling
2025-10-05 10:00:44,106 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:00:50,737 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 10:00:50,800 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:00:50,897 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 10:00:50,898 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 10:00:50,898 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 10:00:50,900 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:00:50,901 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:00:50,901 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:00:50,902 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 10:00:51,133 - aiogram.event - INFO - Update id=557185334 is handled. Duration 396 ms by bot id=5702092394
2025-10-05 10:00:53,058 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:00:53,059 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:00:53,085 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 10:00:53,101 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:00:53,115 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:00:53,125 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:00:53,138 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 10:00:53,153 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 10:00:53,158 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:00:53,160 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:00:53,161 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:00:53,162 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:00:53,274 - aiogram.event - INFO - Update id=557185335 is handled. Duration 216 ms by bot id=5702092394
2025-10-05 10:00:55,471 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:00:55,483 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 10:00:55,485 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:00:55,488 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:00:55,489 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:00:55,489 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:00:55,627 - aiogram.event - INFO - Update id=557185336 is handled. Duration 329 ms by bot id=5702092394
2025-10-05 10:00:56,862 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1668950019
2025-10-05 10:00:56,862 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:00:56,871 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 10:00:58,070 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:01:09,389 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 10:01:09,390 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 10:01:09,438 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 10:01:09,477 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 10:01:09,515 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:01:09,559 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 10:01:09,613 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 10:01:09,636 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 10:01:09,736 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 10:01:09,736 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 10:01:11,447 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:01:11,454 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 10:01:12,644 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:01:24,013 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 10:01:24,013 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-05 10:01:24,059 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-05 10:01:24,092 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-05 10:01:24,126 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:01:24,180 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1641
2025-10-05 10:01:24,217 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1784
2025-10-05 10:01:24,240 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-05 10:01:24,366 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-05 10:01:24,366 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1641, 'price_without_card': 1784, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-05 10:01:26,008 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:01:26,009 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))
2025-10-05 10:01:26,009 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 1641
2025-10-05 10:01:26,010 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))
2025-10-05 10:01:26,016 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796))]) (ID: 1668950019)
2025-10-05 10:01:26,019 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'link': 'https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'rating': 4.9, 'categories': '{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', 'latest_price': {'with_card': 1641, 'without_card': 1784, 'previous_price_with_card': 1641, 'previous_price_without_card': 1784}, 'created_at': datetime.datetime(2025, 10, 5, 9, 56, 56, 732796), 'is_changed': False}
2025-10-05 10:01:26,020 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 10:01:26,043 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:01:26,044 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:01:26,045 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:01:26,045 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:01:26,053 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:01:26,060 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:01:26,062 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:01:26,063 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:01:26,063 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:01:26,386 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-05 10:01:26,387 - aiogram.event - INFO - Update id=557185337 is handled. Duration 29527 ms by bot id=5702092394
2025-10-05 10:01:42,202 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:01:42,202 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:01:42,219 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 10:01:42,245 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:01:42,256 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:01:42,266 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:01:42,278 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:01:42,292 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 10:01:42,294 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:01:42,296 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:01:42,297 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:01:42,298 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:01:42,409 - aiogram.event - INFO - Update id=557185338 is handled. Duration 335 ms by bot id=5702092394
2025-10-05 10:01:43,986 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:01:43,996 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 10:01:43,999 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:01:44,003 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:01:44,004 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:01:44,005 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:01:44,110 - aiogram.event - INFO - Update id=557185339 is handled. Duration 192 ms by bot id=5702092394
2025-10-05 10:01:45,988 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 247385222
2025-10-05 10:01:45,989 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:01:45,999 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 10:01:47,223 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:01:58,629 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 10:01:58,630 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 10:01:58,697 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 247385222
2025-10-05 10:01:58,766 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие
2025-10-05 10:01:58,808 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:01:58,849 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 859
2025-10-05 10:01:58,890 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 963
2025-10-05 10:01:58,917 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg
2025-10-05 10:01:59,023 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']
2025-10-05 10:01:59,023 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '247385222', 'name': 'Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', 'rating': 4.9, 'price_with_card': 859, 'price_without_card': 963, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', 'categories': ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']}
2025-10-05 10:02:00,637 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:02:00,648 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 10:02:01,870 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:02:13,250 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 10:02:13,251 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 10:02:13,311 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 247385222
2025-10-05 10:02:13,383 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие
2025-10-05 10:02:13,428 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:02:13,492 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 859
2025-10-05 10:02:13,533 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 963
2025-10-05 10:02:13,564 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg
2025-10-05 10:02:13,721 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']
2025-10-05 10:02:13,722 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '247385222', 'name': 'Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', 'rating': 4.9, 'price_with_card': 859, 'price_without_card': 963, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', 'categories': ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']}
2025-10-05 10:02:15,460 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:02:15,461 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))
2025-10-05 10:02:15,461 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 859
2025-10-05 10:02:15,461 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))
2025-10-05 10:02:15,473 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269))]) (ID: 247385222)
2025-10-05 10:02:15,494 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '247385222', 'name': 'Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', 'link': 'https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', 'rating': 4.9, 'categories': '{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', 'latest_price': {'with_card': 859, 'without_card': 963, 'previous_price_with_card': None, 'previous_price_without_card': None}, 'created_at': datetime.datetime(2025, 10, 5, 9, 47, 40, 77269), 'is_changed': False}
2025-10-05 10:02:15,496 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 10:02:15,515 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:02:15,516 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:02:15,516 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:02:15,517 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:02:15,535 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:02:15,542 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:02:15,551 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:02:15,552 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:02:15,553 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:02:15,824 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-05 10:02:15,825 - aiogram.event - INFO - Update id=557185340 is handled. Duration 29839 ms by bot id=5702092394
2025-10-05 10:06:32,907 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 10:06:32,909 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 10:06:32,910 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 10:06:33,069 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:06:37,057 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 10:06:37,059 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 10:06:37,059 - aiogram.dispatcher - INFO - Start polling
2025-10-05 10:06:37,304 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:07:06,317 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 10:07:06,375 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:07:06,464 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 10:07:06,465 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 10:07:06,465 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 10:07:06,467 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:07:06,467 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:07:06,468 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:07:06,468 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 10:07:06,726 - aiogram.event - INFO - Update id=557185341 is handled. Duration 409 ms by bot id=5702092394
2025-10-05 10:07:07,735 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:07:07,736 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:07:07,761 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 10:07:07,781 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:07:07,794 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:07:07,802 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:07:07,818 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:07:07,831 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:07:07,834 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:07:07,837 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:07:07,837 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:07:07,838 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:07:07,941 - aiogram.event - INFO - Update id=557185342 is handled. Duration 206 ms by bot id=5702092394
2025-10-05 10:07:09,698 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:07:09,709 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 10:07:09,712 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:07:09,714 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:07:09,715 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:07:09,715 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:07:09,953 - aiogram.event - INFO - Update id=557185343 is handled. Duration 442 ms by bot id=5702092394
2025-10-05 10:07:13,111 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-05 10:07:13,112 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:07:13,121 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 10:07:14,404 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:07:25,916 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:07:25,916 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:07:25,978 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 10:07:26,036 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 10:07:26,076 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:07:26,125 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 10:07:26,171 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 10:07:26,207 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 10:07:26,306 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 10:07:26,306 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 10:07:27,992 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:07:28,002 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 10:07:29,203 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:07:40,633 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:07:40,634 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:07:40,697 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 10:07:40,733 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 10:07:40,785 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:07:40,830 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 10:07:40,875 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 10:07:40,904 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 10:07:41,004 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 10:07:41,004 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 10:07:42,635 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:07:42,635 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926))
2025-10-05 10:07:42,636 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-05 10:07:42,637 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926))
2025-10-05 10:07:42,644 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700))]) (ID: 1818184981)
2025-10-05 10:07:42,648 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 5, 9, 55, 34, 645700), 'is_changed': False}
2025-10-05 10:07:42,649 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 10:07:42,666 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:07:42,667 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:07:42,667 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:07:42,668 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:07:42,681 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926))]) (ID: 1818184981)
2025-10-05 10:07:42,686 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:07:42,689 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:07:42,691 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:07:42,692 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:07:42,692 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 207, in handle_update_price
    updated_at = datetime.strptime(created_at, '%Y-%m-%d %H:%M:%S.%f').strftime('%Y-%m-%d %H:%M:%S')
                 ~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: strptime() argument 1 must be str, not datetime.datetime
2025-10-05 10:07:43,006 - aiogram.event - INFO - Update id=557185344 is handled. Duration 29896 ms by bot id=5702092394
2025-10-05 10:08:13,070 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 10:08:13,071 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 10:08:13,072 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 10:08:13,194 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:08:17,404 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 10:08:17,406 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 10:08:17,406 - aiogram.dispatcher - INFO - Start polling
2025-10-05 10:08:17,638 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:08:20,987 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 10:08:21,047 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:08:21,135 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 10:08:21,136 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 10:08:21,137 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 10:08:21,139 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:08:21,139 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:08:21,140 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:08:21,140 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 10:08:21,365 - aiogram.event - INFO - Update id=557185345 is handled. Duration 378 ms by bot id=5702092394
2025-10-05 10:08:22,427 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:08:22,428 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:08:22,456 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926))]) (ID: 1818184981)
2025-10-05 10:08:22,477 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:08:22,488 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:08:22,500 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:08:22,513 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:08:22,528 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:08:22,531 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:08:22,533 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:08:22,533 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:08:22,534 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:08:22,640 - aiogram.event - INFO - Update id=557185346 is handled. Duration 214 ms by bot id=5702092394
2025-10-05 10:08:23,927 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:08:23,939 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926))]) (ID: 1818184981)
2025-10-05 10:08:23,941 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:08:23,944 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:08:23,944 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:08:23,945 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:08:24,059 - aiogram.event - INFO - Update id=557185347 is handled. Duration 231 ms by bot id=5702092394
2025-10-05 10:08:25,346 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-05 10:08:25,346 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:08:25,358 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926))]) (ID: 1818184981)
2025-10-05 10:08:26,542 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:08:37,995 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:08:37,996 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:08:38,071 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 10:08:38,115 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 10:08:38,180 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:08:38,229 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 10:08:38,279 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 10:08:38,314 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 10:08:38,409 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 10:08:38,410 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 10:08:40,063 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:08:40,070 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926))]) (ID: 1818184981)
2025-10-05 10:08:41,310 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:08:52,663 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:08:52,664 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:08:52,735 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 10:08:52,780 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 10:08:52,848 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:08:52,908 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 10:08:52,951 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 10:08:52,990 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 10:08:53,087 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 10:08:53,088 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 10:08:54,789 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:08:54,790 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333))
2025-10-05 10:08:54,791 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-05 10:08:54,791 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333))
2025-10-05 10:08:54,801 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926))]) (ID: 1818184981)
2025-10-05 10:08:54,807 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 5, 10, 7, 42, 635926), 'is_changed': False}
2025-10-05 10:08:54,808 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 10:08:54,823 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:08:54,823 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:08:54,824 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:08:54,825 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:08:54,841 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333))]) (ID: 1818184981)
2025-10-05 10:08:54,846 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:08:54,850 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:08:54,852 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:08:54,853 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:08:55,121 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-05 10:08:55,122 - aiogram.event - INFO - Update id=557185348 is handled. Duration 29777 ms by bot id=5702092394
2025-10-05 10:28:01,238 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 10:28:01,240 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 10:28:01,241 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 10:28:01,424 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:28:08,467 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 10:28:08,470 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 10:28:08,470 - aiogram.dispatcher - INFO - Start polling
2025-10-05 10:28:08,725 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:28:35,160 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 10:28:35,288 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:28:35,289 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:28:35,468 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333))]) (ID: 1818184981)
2025-10-05 10:28:35,491 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:28:35,514 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:28:35,540 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:28:35,571 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:28:35,591 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:28:35,598 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:28:35,603 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:28:35,604 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:28:35,604 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:28:35,940 - aiogram.event - INFO - Update id=557185349 is handled. Duration 782 ms by bot id=5702092394
2025-10-05 10:28:37,978 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:28:38,001 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333))]) (ID: 1818184981)
2025-10-05 10:28:38,007 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:28:38,013 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:28:38,015 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:28:38,016 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:28:38,120 - aiogram.event - INFO - Update id=557185350 is handled. Duration 219 ms by bot id=5702092394
2025-10-05 10:28:39,685 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-05 10:28:39,769 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:28:39,793 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333))]) (ID: 1818184981)
2025-10-05 10:28:43,098 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:28:54,570 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:28:54,571 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:28:54,860 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 10:28:54,950 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 10:28:55,012 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:28:55,075 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 10:28:55,139 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 10:28:55,190 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 10:28:55,320 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 10:28:55,321 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 10:28:57,358 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:28:57,393 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333))]) (ID: 1818184981)
2025-10-05 10:28:58,961 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:29:10,443 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:29:10,445 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 10:29:10,547 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 10:29:10,592 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 10:29:10,642 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:29:10,704 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 10:29:10,775 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 10:29:10,821 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 10:29:10,989 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 10:29:10,990 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 10:29:12,972 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:29:12,973 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))
2025-10-05 10:29:12,974 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-05 10:29:12,975 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))
2025-10-05 10:29:13,000 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333))]) (ID: 1818184981)
2025-10-05 10:29:13,010 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 5, 10, 8, 54, 790333), 'is_changed': False}
2025-10-05 10:29:13,011 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 10:29:13,089 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:29:13,091 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:29:13,093 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:29:13,094 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:29:13,139 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 10:29:13,161 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:29:13,168 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:29:13,169 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:29:13,170 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:29:13,492 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-05 10:29:13,493 - aiogram.event - INFO - Update id=557185351 is handled. Duration 33810 ms by bot id=5702092394
2025-10-05 10:29:55,836 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 10:29:55,838 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 10:29:55,839 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 10:29:56,004 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:30:02,841 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 10:30:02,845 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 10:30:02,845 - aiogram.dispatcher - INFO - Start polling
2025-10-05 10:30:03,079 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 10:30:11,458 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 10:30:11,580 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:11,824 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 10:30:11,825 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 10:30:11,825 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 10:30:11,832 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:11,833 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:11,834 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:11,835 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 10:30:12,082 - aiogram.event - INFO - Update id=557185352 is handled. Duration 625 ms by bot id=5702092394
2025-10-05 10:30:13,536 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:13,537 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:30:13,611 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 10:30:13,642 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:30:13,692 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:30:13,730 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:13,761 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:30:13,801 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:30:13,808 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:30:13,825 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:13,828 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:13,829 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:13,939 - aiogram.event - INFO - Update id=557185353 is handled. Duration 404 ms by bot id=5702092394
2025-10-05 10:30:15,894 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:15,924 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 10:30:15,945 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:30:15,955 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:15,957 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:15,958 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:16,120 - aiogram.event - INFO - Update id=557185354 is handled. Duration 395 ms by bot id=5702092394
2025-10-05 10:30:20,502 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:20,503 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:30:20,536 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 10:30:20,571 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:30:20,628 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:30:20,659 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:20,723 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:30:20,764 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:30:20,774 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:30:20,788 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:20,790 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:20,791 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:20,893 - aiogram.event - INFO - Update id=557185355 is handled. Duration 491 ms by bot id=5702092394
2025-10-05 10:30:22,025 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:22,051 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:30:22,066 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:30:22,075 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:22,078 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:22,080 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:22,184 - aiogram.event - INFO - Update id=557185356 is handled. Duration 255 ms by bot id=5702092394
2025-10-05 10:30:24,667 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:24,668 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:30:24,710 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 10:30:24,770 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:30:24,803 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:30:24,857 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:24,885 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:30:24,910 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:30:24,919 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:30:24,925 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:24,926 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:24,928 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:25,041 - aiogram.event - INFO - Update id=557185357 is handled. Duration 521 ms by bot id=5702092394
2025-10-05 10:30:26,216 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:26,242 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:30:26,257 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:30:26,267 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:26,269 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:26,270 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:26,388 - aiogram.event - INFO - Update id=557185358 is handled. Duration 310 ms by bot id=5702092394
2025-10-05 10:30:27,630 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:27,630 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:30:27,671 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 10:30:27,731 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:30:27,772 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:30:27,813 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:27,847 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:30:27,884 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:30:27,896 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:30:27,902 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:27,903 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:27,904 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:27,999 - aiogram.event - INFO - Update id=557185359 is handled. Duration 477 ms by bot id=5702092394
2025-10-05 10:30:28,985 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:29,010 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:30:29,022 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:30:29,031 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:29,032 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:29,033 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:29,138 - aiogram.event - INFO - Update id=557185360 is handled. Duration 223 ms by bot id=5702092394
2025-10-05 10:30:30,827 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:30,828 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:30:30,863 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 10:30:30,904 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:30:30,936 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:30:30,967 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:30,998 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:30:31,033 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:30:31,044 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:30:31,055 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:31,056 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:31,058 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:31,172 - aiogram.event - INFO - Update id=557185361 is handled. Duration 457 ms by bot id=5702092394
2025-10-05 10:30:32,400 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:32,473 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:30:32,499 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:30:32,515 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:32,516 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:32,517 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:32,695 - aiogram.event - INFO - Update id=557185362 is handled. Duration 444 ms by bot id=5702092394
2025-10-05 10:30:33,894 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:33,895 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 10:30:33,924 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 10:30:33,988 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 10:30:34,028 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 10:30:34,052 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:34,093 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 10:30:34,121 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 10:30:34,134 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 10:30:34,139 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:34,139 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:34,140 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:34,257 - aiogram.event - INFO - Update id=557185363 is handled. Duration 445 ms by bot id=5702092394
2025-10-05 10:30:35,755 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:35,779 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:35,791 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:30:35,805 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:30:35,806 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:30:35,808 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:30:35,909 - aiogram.event - INFO - Update id=557185364 is handled. Duration 249 ms by bot id=5702092394
2025-10-05 10:30:37,483 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 816992280
2025-10-05 10:30:37,568 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:30:37,603 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:39,107 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:30:50,520 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/
2025-10-05 10:30:50,521 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/
2025-10-05 10:30:50,705 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 816992280
2025-10-05 10:30:50,804 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Рюкзак городской спортивный ТЕВИН
2025-10-05 10:30:50,902 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:30:51,005 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1824
2025-10-05 10:30:51,105 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1990
2025-10-05 10:30:51,201 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg
2025-10-05 10:30:51,500 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Мужчинам', 'Сумки и рюкзаки', 'Рюкзаки', 'TEVIN']
2025-10-05 10:30:51,501 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '816992280', 'name': 'Рюкзак городской спортивный ТЕВИН', 'rating': 4.9, 'price_with_card': 1824, 'price_without_card': 1990, 'image_url': 'https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', 'categories': ['Аксессуары', 'Мужчинам', 'Сумки и рюкзаки', 'Рюкзаки', 'TEVIN']}
2025-10-05 10:30:53,488 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:30:53,519 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:30:55,011 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 10:31:06,463 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/
2025-10-05 10:31:06,465 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/
2025-10-05 10:31:06,584 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 816992280
2025-10-05 10:31:06,675 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Рюкзак городской спортивный ТЕВИН
2025-10-05 10:31:06,745 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 10:31:06,852 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1824
2025-10-05 10:31:06,962 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1990
2025-10-05 10:31:07,016 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg
2025-10-05 10:31:07,363 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Мужчинам', 'Сумки и рюкзаки', 'Рюкзаки', 'TEVIN']
2025-10-05 10:31:07,365 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '816992280', 'name': 'Рюкзак городской спортивный ТЕВИН', 'rating': 4.9, 'price_with_card': 1824, 'price_without_card': 1990, 'image_url': 'https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', 'categories': ['Аксессуары', 'Мужчинам', 'Сумки и рюкзаки', 'Рюкзаки', 'TEVIN']}
2025-10-05 10:31:09,251 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 10:31:09,253 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))
2025-10-05 10:31:09,255 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 1824
2025-10-05 10:31:09,256 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))
2025-10-05 10:31:09,283 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473))]) (ID: 816992280)
2025-10-05 10:31:09,294 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '816992280', 'name': 'Рюкзак городской спортивный ТЕВИН', 'link': 'https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', 'rating': 4.9, 'categories': '{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', 'latest_price': {'with_card': 1824, 'without_card': 1990, 'previous_price_with_card': None, 'previous_price_without_card': None}, 'created_at': datetime.datetime(2025, 10, 5, 9, 45, 8, 205473), 'is_changed': False}
2025-10-05 10:31:09,295 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 10:31:09,322 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:31:09,324 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:31:09,326 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:31:09,327 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 10:31:09,351 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 10:31:09,361 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 10:31:09,367 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 10:31:09,368 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 10:31:09,369 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 10:31:09,697 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-05 10:31:09,698 - aiogram.event - INFO - Update id=557185365 is handled. Duration 32217 ms by bot id=5702092394
2025-10-05 10:31:32,243 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 10:31:32,246 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 10:31:32,247 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 10:31:32,386 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 12:49:49,938 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 12:49:49,941 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 12:49:49,941 - aiogram.dispatcher - INFO - Start polling
2025-10-05 12:49:50,205 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 12:50:01,159 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 12:50:01,258 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:50:01,387 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 12:50:01,387 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 12:50:01,388 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 12:50:01,390 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:50:01,391 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:50:01,391 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:50:01,392 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 12:50:01,679 - aiogram.event - INFO - Update id=557185366 is handled. Duration 520 ms by bot id=5702092394
2025-10-05 12:50:03,594 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:50:03,595 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 12:50:03,626 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 12:50:03,642 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 12:50:03,656 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 12:50:03,670 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 12:50:03,685 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 12:50:03,700 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 12:50:03,705 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 12:50:03,709 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 12:50:03,710 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:50:03,711 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:50:03,824 - aiogram.event - INFO - Update id=557185367 is handled. Duration 231 ms by bot id=5702092394
2025-10-05 12:50:05,384 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:50:05,396 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 12:50:05,402 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 12:50:05,405 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 12:50:05,406 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:50:05,406 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:50:05,527 - aiogram.event - INFO - Update id=557185368 is handled. Duration 236 ms by bot id=5702092394
2025-10-05 12:50:06,524 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-05 12:50:06,611 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:50:06,627 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 12:50:08,957 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 12:50:20,335 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 12:50:20,336 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 12:50:20,424 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 12:50:20,478 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 12:50:20,538 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 12:50:20,593 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 12:50:20,647 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 12:50:20,691 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 12:50:20,831 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 12:50:20,832 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 12:50:22,645 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 12:50:22,657 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 12:50:24,039 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 12:50:35,466 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 12:50:35,467 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-05 12:50:35,575 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-05 12:50:35,639 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-05 12:50:35,700 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 12:50:35,785 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-05 12:50:35,850 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-05 12:50:35,893 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-05 12:50:36,035 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-05 12:50:36,036 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-05 12:50:37,970 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 12:50:37,971 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))
2025-10-05 12:50:37,972 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-05 12:50:37,973 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))
2025-10-05 12:50:37,987 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194))]) (ID: 1818184981)
2025-10-05 12:50:37,992 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 5, 10, 29, 12, 973194), 'is_changed': False}
2025-10-05 12:50:37,992 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 12:50:38,014 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:50:38,016 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:50:38,017 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:50:38,019 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:50:38,036 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 12:50:38,042 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 12:50:38,046 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 12:50:38,047 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:50:38,048 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:50:38,321 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-05 12:50:38,322 - aiogram.event - INFO - Update id=557185369 is handled. Duration 31799 ms by bot id=5702092394
2025-10-05 12:51:13,243 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:51:13,244 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 12:51:13,257 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 12:51:13,275 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 12:51:13,292 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 12:51:13,308 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 12:51:13,324 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 12:51:13,344 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 12:51:13,353 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 12:51:13,357 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 12:51:13,359 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:51:13,359 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:51:13,452 - aiogram.event - INFO - Update id=557185370 is handled. Duration 313 ms by bot id=5702092394
2025-10-05 12:51:15,440 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:51:15,452 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 12:51:15,455 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 12:51:15,458 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 12:51:15,459 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:51:15,459 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:51:15,569 - aiogram.event - INFO - Update id=557185371 is handled. Duration 212 ms by bot id=5702092394
2025-10-05 12:51:16,568 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 247385222
2025-10-05 12:51:16,742 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:51:16,758 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 12:51:18,101 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 12:51:29,430 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 12:51:29,434 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 12:51:29,615 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 247385222
2025-10-05 12:51:29,689 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие
2025-10-05 12:51:29,755 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 12:51:29,817 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 857
2025-10-05 12:51:29,886 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 961
2025-10-05 12:51:29,935 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg
2025-10-05 12:51:30,568 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']
2025-10-05 12:51:30,569 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '247385222', 'name': 'Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', 'rating': 4.9, 'price_with_card': 857, 'price_without_card': 961, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', 'categories': ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']}
2025-10-05 12:51:32,753 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 12:51:32,780 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 12:51:34,258 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 12:51:45,573 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 12:51:45,574 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/
2025-10-05 12:51:45,652 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 247385222
2025-10-05 12:51:45,694 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие
2025-10-05 12:51:45,744 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 12:51:45,832 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 857
2025-10-05 12:51:45,876 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 961
2025-10-05 12:51:45,914 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg
2025-10-05 12:51:46,121 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']
2025-10-05 12:51:46,122 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '247385222', 'name': 'Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', 'rating': 4.9, 'price_with_card': 857, 'price_without_card': 961, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', 'categories': ['Аптека', 'Товары для гигиены', 'Презервативы и лубриканты', 'Презервативы', 'Masculan']}
2025-10-05 12:51:47,913 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 12:51:47,914 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))
2025-10-05 12:51:47,915 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 859
2025-10-05 12:51:47,915 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))
2025-10-05 12:51:47,923 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112))]) (ID: 247385222)
2025-10-05 12:51:47,926 - src.infrastructure.services.product_service - INFO - IF DEBUG IS_CHANGED {'id': '247385222', 'name': 'Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', 'link': 'https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', 'rating': 4.9, 'categories': '{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', 'latest_price': {'with_card': 859, 'without_card': 963, 'previous_price_with_card': 859, 'previous_price_without_card': 963}, 'created_at': datetime.datetime(2025, 10, 5, 10, 2, 15, 461112), 'is_changed': True}
2025-10-05 12:51:47,927 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 12:51:47,936 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:51:47,937 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:51:47,937 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:51:47,938 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 12:51:47,952 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-05 12:51:47,956 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 12:51:47,959 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 12:51:47,961 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 12:51:47,962 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 12:51:48,295 - src.infrastructure.services.logger - INFO - ✅ Цена обновлена!
2025-10-05 12:51:48,296 - aiogram.event - INFO - Update id=557185372 is handled. Duration 31730 ms by bot id=5702092394
2025-10-05 14:28:32,659 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 14:28:32,664 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 14:28:32,665 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 14:28:32,814 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 14:28:39,277 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 14:28:39,278 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 14:28:39,279 - aiogram.dispatcher - INFO - Start polling
2025-10-05 14:28:39,567 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 14:28:46,174 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 14:28:46,540 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:28:46,742 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 14:28:46,743 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 14:28:46,743 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 14:28:46,746 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:28:46,746 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:28:46,747 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:28:46,747 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 14:28:47,029 - aiogram.event - INFO - Update id=557185373 is handled. Duration 859 ms by bot id=5702092394
2025-10-05 14:28:51,347 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:28:51,347 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 14:28:51,376 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:28:51,402 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 14:28:51,417 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 14:28:51,432 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 14:28:51,445 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 14:28:51,456 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-05 14:28:51,459 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 14:28:51,462 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:28:51,463 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:28:51,464 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:28:51,632 - aiogram.event - INFO - Update id=557185374 is handled. Duration 287 ms by bot id=5702092394
2025-10-05 14:28:53,250 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:28:53,265 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:28:53,268 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 14:28:53,271 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:28:53,272 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:28:53,272 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:28:53,444 - aiogram.event - INFO - Update id=557185375 is handled. Duration 377 ms by bot id=5702092394
2025-10-05 14:28:54,758 - aiogram.event - INFO - Update id=557185376 is not handled. Duration 1 ms by bot id=5702092394
2025-10-05 14:28:54,759 - aiogram.event - ERROR - Cause exception while process update id=557185376 by bot id=5702092394
AttributeError: module 'src.infrastructure.services.logger' has no attribute 'info'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 104, in handle_update_price
    logger.info(f'Начинаем обновление цены для товара {product_id}')
    ^^^^^^^^^^^
AttributeError: module 'src.infrastructure.services.logger' has no attribute 'info'
2025-10-05 14:50:40,516 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 14:50:40,519 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 14:50:40,519 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 14:50:40,689 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 14:50:45,543 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 14:50:45,544 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 14:50:45,545 - aiogram.dispatcher - INFO - Start polling
2025-10-05 14:50:45,797 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 14:50:52,035 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 14:50:52,156 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:50:52,258 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 14:50:52,259 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 14:50:52,259 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 14:50:52,262 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:50:52,262 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:50:52,263 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:50:52,264 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 14:50:52,549 - aiogram.event - INFO - Update id=557185377 is handled. Duration 515 ms by bot id=5702092394
2025-10-05 14:50:53,671 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:50:53,671 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 14:50:53,696 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:50:53,712 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 14:50:53,731 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 14:50:53,745 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 14:50:53,758 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 14:50:53,780 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-05 14:50:53,785 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 14:50:53,790 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:50:53,791 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:50:53,792 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:50:54,006 - aiogram.event - INFO - Update id=557185378 is handled. Duration 336 ms by bot id=5702092394
2025-10-05 14:50:55,264 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:50:55,279 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:50:55,282 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 14:50:55,286 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:50:55,287 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:50:55,288 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:50:55,438 - aiogram.event - INFO - Update id=557185379 is handled. Duration 311 ms by bot id=5702092394
2025-10-05 14:50:56,336 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-05 14:50:56,528 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:50:56,529 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 14:50:56,529 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:50:56,529 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:50:56,530 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:50:56,530 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:50:56,550 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:50:56,557 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 14:50:56,562 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:50:56,563 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:50:56,563 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:50:56,565 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 112, in handle_update_price
    new_text = _build_price_update_message(updated_product, full_product_info)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 156, in _build_price_update_message
    f"📦 {updated_product['name']}\n"
          ~~~~~~~~~~~~~~~^^^^^^^^
TypeError: 'coroutine' object is not subscriptable
2025-10-05 14:50:56,832 - aiogram.event - INFO - Update id=557185380 is handled. Duration 499 ms by bot id=5702092394
2025-10-05 14:53:09,595 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 14:53:09,598 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 14:53:09,598 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 14:53:09,729 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 14:53:15,769 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 14:53:15,771 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 14:53:15,771 - aiogram.dispatcher - INFO - Start polling
2025-10-05 14:53:16,033 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 14:53:22,053 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 14:53:22,144 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:53:22,257 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 14:53:22,258 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 14:53:22,259 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 14:53:22,262 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:53:22,263 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:53:22,264 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:53:22,265 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 14:53:22,567 - aiogram.event - INFO - Update id=557185381 is handled. Duration 513 ms by bot id=5702092394
2025-10-05 14:53:23,338 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:53:23,339 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 14:53:23,369 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:53:23,393 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 14:53:23,407 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 14:53:23,419 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 14:53:23,432 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 14:53:23,443 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-05 14:53:23,448 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 14:53:23,450 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:53:23,451 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:53:23,451 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:53:23,572 - aiogram.event - INFO - Update id=557185382 is handled. Duration 235 ms by bot id=5702092394
2025-10-05 14:53:24,798 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:53:24,812 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:53:24,817 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 14:53:24,823 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:53:24,824 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:53:24,824 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:53:24,917 - aiogram.event - INFO - Update id=557185383 is handled. Duration 212 ms by bot id=5702092394
2025-10-05 14:53:25,555 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-05 14:53:25,678 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:53:25,679 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 14:53:25,680 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:53:25,680 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:53:25,681 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:53:25,682 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 109, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 118, in update_product_price
    product = self.uow.product_repository.get(product_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'product_repository'
2025-10-05 14:53:25,814 - aiogram.event - INFO - Update id=557185384 is handled. Duration 261 ms by bot id=5702092394
2025-10-05 14:55:08,134 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 14:55:08,136 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 14:55:08,136 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 14:55:08,275 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 14:55:25,268 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-05 14:55:25,270 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-05 14:55:25,270 - aiogram.dispatcher - INFO - Start polling
2025-10-05 14:55:25,513 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-05 14:55:32,614 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-05 14:55:32,705 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:55:32,776 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 14:55:32,776 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 14:55:32,777 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 14:55:32,778 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:55:32,779 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:55:32,780 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:55:32,780 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 14:55:33,070 - aiogram.event - INFO - Update id=557185385 is handled. Duration 457 ms by bot id=5702092394
2025-10-05 14:55:33,660 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:55:33,661 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 14:55:33,682 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:55:33,699 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 14:55:33,712 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 14:55:33,719 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 14:55:33,732 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 14:55:33,740 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-05 14:55:33,745 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 14:55:33,747 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:55:33,747 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:55:33,748 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:55:33,914 - aiogram.event - INFO - Update id=557185386 is handled. Duration 255 ms by bot id=5702092394
2025-10-05 14:55:35,987 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:55:35,995 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 14:55:35,997 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 14:55:35,999 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:55:36,000 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:55:36,000 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:55:36,186 - aiogram.event - INFO - Update id=557185387 is handled. Duration 325 ms by bot id=5702092394
2025-10-05 14:55:37,928 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:55:37,929 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 14:55:37,944 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 14:55:37,959 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 14:55:37,972 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 14:55:37,984 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 14:55:37,996 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 14:55:38,011 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-05 14:55:38,014 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 14:55:38,016 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:55:38,017 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:55:38,018 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:55:38,115 - aiogram.event - INFO - Update id=557185388 is handled. Duration 268 ms by bot id=5702092394
2025-10-05 14:55:39,614 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:55:39,624 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 14:55:39,626 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-05 14:55:39,628 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 14:55:39,629 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:55:39,630 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:55:39,724 - aiogram.event - INFO - Update id=557185389 is handled. Duration 189 ms by bot id=5702092394
2025-10-05 14:55:40,398 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1565602444
2025-10-05 14:55:40,474 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 14:55:40,475 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 14:55:40,476 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:55:40,476 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 14:55:40,476 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 14:55:40,477 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 109, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 118, in update_product_price
    product = self.uow.product_repository.get(product_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'product_repository'
2025-10-05 14:55:40,610 - aiogram.event - INFO - Update id=557185390 is handled. Duration 214 ms by bot id=5702092394
2025-10-05 15:42:37,397 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-10-05 15:42:37,468 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 15:42:38,548 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-05 15:42:38,569 - aiogram.dispatcher - WARNING - Sleep for 1.171103 seconds and try again... (tryings = 1, bot id = 5702092394)
2025-10-05 15:42:39,756 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-05 15:42:39,757 - aiogram.dispatcher - WARNING - Sleep for 1.551108 seconds and try again... (tryings = 2, bot id = 5702092394)
2025-10-05 15:42:41,314 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-05 15:42:41,315 - aiogram.dispatcher - WARNING - Sleep for 1.991767 seconds and try again... (tryings = 3, bot id = 5702092394)
2025-10-05 18:51:02,644 - aiogram.dispatcher - INFO - Connection established (tryings = 4, bot id = 5702092394)
2025-10-05 18:59:28,837 - aiogram.event - INFO - Update id=557185391 is handled. Duration 465 ms by bot id=5702092394
2025-10-05 18:59:31,884 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 18:59:34,652 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 18:59:45,968 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru
2025-10-05 18:59:45,971 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru
2025-10-05 18:59:46,208 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 612659680
2025-10-05 18:59:46,274 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г
2025-10-05 18:59:46,323 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 18:59:46,385 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 519
2025-10-05 18:59:46,443 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 577
2025-10-05 18:59:46,485 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg
2025-10-05 18:59:46,641 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Продукты питания', 'Выпечка и сладости', 'Шоколадная и ореховая пасты', 'DopDrops']
2025-10-05 18:59:46,642 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '612659680', 'name': 'Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', 'rating': 4.9, 'price_with_card': 519, 'price_without_card': 577, 'image_url': 'https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', 'categories': ['Продукты питания', 'Выпечка и сладости', 'Шоколадная и ореховая пасты', 'DopDrops']}
2025-10-05 18:59:48,526 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 18:59:48,526 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru: {'id': '612659680', 'name': 'Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', 'rating': 4.9, 'price_with_card': 519, 'price_without_card': 577, 'image_url': 'https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', 'categories': ['Продукты питания', 'Выпечка и сладости', 'Шоколадная и ореховая пасты', 'DopDrops']}
2025-10-05 18:59:48,573 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 612659680 не найден
2025-10-05 18:59:48,578 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222']) получен по id: 515084006
2025-10-05 18:59:48,581 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='612659680', user_id='515084006', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories=['Продукты питания', 'Выпечка и сладости', 'Шоколадная и ореховая пасты', 'DopDrops'], prices=[Price(id=None, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))])
2025-10-05 18:59:48,586 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))
2025-10-05 18:59:48,586 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 612659680 пользователю ID 515084006
2025-10-05 18:59:48,587 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-05 18:59:48,639 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 18:59:48,639 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 18:59:48,640 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 18:59:48,912 - aiogram.event - INFO - Update id=557185392 is handled. Duration 17030 ms by bot id=5702092394
2025-10-05 18:59:52,338 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 18:59:52,339 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-05 18:59:52,353 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-05 18:59:52,375 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-05 18:59:52,389 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-05 18:59:52,402 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-05 18:59:52,416 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-05 18:59:52,428 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-05 18:59:52,440 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-05 18:59:52,444 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-05 18:59:52,447 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 18:59:52,448 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 18:59:52,449 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 18:59:52,549 - aiogram.event - INFO - Update id=557185393 is handled. Duration 292 ms by bot id=5702092394
2025-10-05 18:59:55,494 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 18:59:55,502 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680']) получен по id: 515084006
2025-10-05 18:59:55,503 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 18:59:55,504 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 18:59:55,505 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 18:59:55,506 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 18:59:55,506 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 18:59:55,507 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 18:59:55,600 - aiogram.event - INFO - Update id=557185394 is handled. Duration 106 ms by bot id=5702092394
2025-10-05 18:59:56,748 - aiogram.event - INFO - Update id=557185395 is handled. Duration 191 ms by bot id=5702092394
2025-10-05 18:59:58,820 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 19:00:00,082 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 19:00:11,404 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru
2025-10-05 19:00:11,410 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru
2025-10-05 19:00:11,809 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 612659680
2025-10-05 19:00:11,893 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г
2025-10-05 19:00:11,992 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 19:00:12,091 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 519
2025-10-05 19:00:12,174 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 577
2025-10-05 19:00:12,242 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg
2025-10-05 19:00:12,544 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Продукты питания', 'Выпечка и сладости', 'Шоколадная и ореховая пасты', 'DopDrops']
2025-10-05 19:00:12,545 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '612659680', 'name': 'Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', 'rating': 4.9, 'price_with_card': 519, 'price_without_card': 577, 'image_url': 'https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', 'categories': ['Продукты питания', 'Выпечка и сладости', 'Шоколадная и ореховая пасты', 'DopDrops']}
2025-10-05 19:00:14,527 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 19:00:14,528 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru: {'id': '612659680', 'name': 'Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', 'rating': 4.9, 'price_with_card': 519, 'price_without_card': 577, 'image_url': 'https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', 'categories': ['Продукты питания', 'Выпечка и сладости', 'Шоколадная и ореховая пасты', 'DopDrops']}
2025-10-05 19:00:14,539 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-05 19:00:14,540 - src.application.use_cases.create_product - ERROR - Товар с ID 612659680 уже существует
2025-10-05 19:00:14,541 - src.core.uow - WARNING - Исключение в Unit of Work: ProductCreationError: Товар с ID 612659680 уже существует
2025-10-05 19:00:14,545 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-05 19:00:14,546 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 19:00:14,547 - src.core.decorators - ERROR - Ошибка в функции create_product: Товар с ID 612659680 уже существует
2025-10-05 19:00:14,547 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 30, in add_product_process
    result = product_service.create_product(str(message.from_user.id), url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 46, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 41, in execute
    raise ProductCreationError(f'Товар с ID {product_data['id']} уже существует')
src.domain.exceptions.ProductCreationError: Товар с ID 612659680 уже существует
2025-10-05 19:00:14,963 - aiogram.event - INFO - Update id=557185396 is handled. Duration 16148 ms by bot id=5702092394
2025-10-05 19:00:18,245 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 19:00:18,253 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680']) получен по id: 515084006
2025-10-05 19:00:18,254 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-05 19:00:18,254 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-05 19:00:18,256 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 19:00:18,256 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 19:00:18,257 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 19:00:18,257 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-05 19:00:18,395 - aiogram.event - INFO - Update id=557185397 is handled. Duration 150 ms by bot id=5702092394
2025-10-05 19:00:19,628 - aiogram.event - INFO - Update id=557185398 is handled. Duration 430 ms by bot id=5702092394
2025-10-05 19:00:21,363 - aiogram.event - INFO - Update id=557185399 is handled. Duration 244 ms by bot id=5702092394
2025-10-05 19:00:27,352 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 19:00:28,590 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-05 19:00:39,990 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/
2025-10-05 19:00:39,990 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/
2025-10-05 19:00:40,069 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 177655422
2025-10-05 19:00:40,108 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.
2025-10-05 19:00:40,156 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-05 19:00:40,216 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 384
2025-10-05 19:00:40,263 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 429
2025-10-05 19:00:40,295 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg
2025-10-05 19:00:40,457 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Продукты питания', 'Масла, соусы и специи', 'Сиропы и топпинги', 'Pinch&Drop']
2025-10-05 19:00:40,457 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '177655422', 'name': 'Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', 'rating': 4.9, 'price_with_card': 384, 'price_without_card': 429, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', 'categories': ['Продукты питания', 'Масла, соусы и специи', 'Сиропы и топпинги', 'Pinch&Drop']}
2025-10-05 19:00:42,134 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-05 19:00:42,134 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/: {'id': '177655422', 'name': 'Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', 'rating': 4.9, 'price_with_card': 384, 'price_without_card': 429, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', 'categories': ['Продукты питания', 'Масла, соусы и специи', 'Сиропы и топпинги', 'Pinch&Drop']}
2025-10-05 19:00:42,139 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 177655422 не найден
2025-10-05 19:00:42,142 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680']) получен по id: 515084006
2025-10-05 19:00:42,145 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='177655422', user_id='515084006', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories=['Продукты питания', 'Масла, соусы и специи', 'Сиропы и топпинги', 'Pinch&Drop'], prices=[Price(id=None, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))])
2025-10-05 19:00:42,148 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))
2025-10-05 19:00:42,149 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 177655422 пользователю ID 515084006
2025-10-05 19:00:42,150 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-05 19:00:42,161 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 19:00:42,162 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 19:00:42,163 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 19:00:42,314 - aiogram.event - INFO - Update id=557185400 is handled. Duration 14963 ms by bot id=5702092394
2025-10-05 20:13:47,701 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 177655422
2025-10-05 20:13:47,945 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-05 20:13:47,947 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-05 20:13:47,950 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 20:13:47,950 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-05 20:13:47,951 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-05 20:13:47,962 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 109, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 118, in update_product_price
    product = self.uow.product_repository.get(product_id)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'product_repository'
2025-10-05 20:13:48,062 - aiogram.event - INFO - Update id=557185401 is handled. Duration 368 ms by bot id=5702092394
2025-10-05 20:27:57,514 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-10-05 20:27:57,529 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 20:28:08,985 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 5702092394)
2025-10-05 20:47:46,041 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-10-05 20:47:46,057 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 20:47:57,569 - aiogram.dispatcher - INFO - Connection established (tryings = 1, bot id = 5702092394)
2025-10-05 20:48:00,711 - aiogram.dispatcher - INFO - Polling stopped
2025-10-05 20:48:00,724 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-05 20:48:00,725 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-05 20:48:00,874 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 07:53:52,939 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 07:53:52,942 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 07:53:52,942 - aiogram.dispatcher - INFO - Start polling
2025-10-06 07:53:53,292 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 07:54:00,198 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-06 07:54:00,638 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 07:54:21,696 - src.infrastructure.services.product_service - ERROR - Ошибка при получении полной информации о продукте 177655422: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 07:54:21,696 - src.core.uow - WARNING - Исключение в Unit of Work: OperationalError: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 07:54:21,697 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 07:54:21,698 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 07:54:21,699 - src.core.decorators - ERROR - Ошибка в функции get_full_product: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 07:54:21,699 - src.infrastructure.services.logger - ERROR - Ошибка в handle_product_button
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3295, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 626, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\psycopg2\__init__.py", line 135, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 79, in handle_product_button
    product = product_service.get_full_product(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 68, in get_full_product
    return use_case.execute(product_id)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\get_full_product.py", line 21, in execute
    product = self.product_repo.get(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\database\repositories\product_repository.py", line 43, in get
    orm_model = self.session.get(ORMProduct, product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3694, in get
    return self._get_impl(
           ~~~~~~~~~~~~~~^
        entity,
        ^^^^^^^
    ...<7 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3873, in _get_impl
    return db_load_fn(
        self,
    ...<5 lines>...
        bind_arguments=bind_arguments,
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3271, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    Connection._handle_dbapi_exception_noconnection(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        err, dialect, engine
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2434, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3295, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 626, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\psycopg2\__init__.py", line 135, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 07:54:22,033 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 07:54:22,042 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 07:54:43,089 - src.infrastructure.services.product_service - ERROR - Ошибка при создании пользователя 515084006: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 07:54:43,090 - src.core.uow - WARNING - Исключение в Unit of Work: UserCreationError: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 07:54:43,091 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 07:54:43,091 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 07:54:43,091 - src.core.decorators - ERROR - Ошибка в функции create_user: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 07:54:43,092 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 07:54:43,193 - aiogram.event - INFO - Update id=557185402 is not handled. Duration 43253 ms by bot id=5702092394
2025-10-06 07:54:43,194 - aiogram.event - ERROR - Cause exception while process update id=557185402 by bot id=5702092394
TelegramNetworkError: HTTP Client says - ClientConnectionError: Connector is closed.
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3295, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 626, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\psycopg2\__init__.py", line 135, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 79, in handle_product_button
    product = product_service.get_full_product(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 68, in get_full_product
    return use_case.execute(product_id)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\get_full_product.py", line 21, in execute
    product = self.product_repo.get(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\database\repositories\product_repository.py", line 43, in get
    orm_model = self.session.get(ORMProduct, product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3694, in get
    return self._get_impl(
           ~~~~~~~~~~~~~~^
        entity,
        ^^^^^^^
    ...<7 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3873, in _get_impl
    return db_load_fn(
        self,
    ...<5 lines>...
        bind_arguments=bind_arguments,
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3271, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    Connection._handle_dbapi_exception_noconnection(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        err, dialect, engine
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2434, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3295, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 626, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\psycopg2\__init__.py", line 135, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 177, in make_request
    async with session.post(
               ~~~~~~~~~~~~^
        url, data=form, timeout=self.timeout if timeout is None else timeout
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ) as resp:
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiohttp\client.py", line 1488, in __aenter__
    self._resp: _RetType = await self._coro
                           ^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiohttp\client.py", line 770, in _request
    resp = await handler(req)
           ^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiohttp\client.py", line 725, in _connect_and_send_request
    conn = await self._connector.connect(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        req, traces=traces, timeout=real_timeout
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiohttp\connector.py", line 652, in connect
    raise ClientConnectionError("Connector is closed.")
aiohttp.client_exceptions.ClientConnectionError: Connector is closed.

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 96, in handle_product_button
    await call.answer(f'Ошибка: {e}', show_alert=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 184, in make_request
    raise TelegramNetworkError(method=method, message=f"{type(e).__name__}: {e}")
aiogram.exceptions.TelegramNetworkError: HTTP Client says - ClientConnectionError: Connector is closed.
2025-10-06 07:54:43,484 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 07:54:43,485 - aiogram.event - INFO - Update id=557185403 is not handled. Duration 21443 ms by bot id=5702092394
2025-10-06 08:10:43,429 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 08:10:43,431 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 08:10:43,431 - aiogram.dispatcher - INFO - Start polling
2025-10-06 08:10:43,780 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 08:10:43,864 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-06 08:10:43,935 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 08:11:04,969 - src.infrastructure.services.product_service - ERROR - Ошибка при создании пользователя 515084006: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 08:11:04,970 - src.core.uow - WARNING - Исключение в Unit of Work: UserCreationError: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 08:11:04,971 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 08:11:04,972 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 08:11:04,972 - src.core.decorators - ERROR - Ошибка в функции create_user: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 08:11:04,973 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 08:11:04,985 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 08:11:26,036 - src.infrastructure.services.product_service - ERROR - Ошибка при создании пользователя 515084006: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 08:11:26,037 - src.core.uow - WARNING - Исключение в Unit of Work: UserCreationError: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 08:11:26,037 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 08:11:26,038 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 08:11:26,039 - src.core.decorators - ERROR - Ошибка в функции create_user: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 08:11:26,039 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 08:11:26,288 - aiogram.event - INFO - Update id=557185403 is handled. Duration 42422 ms by bot id=5702092394
2025-10-06 08:11:26,317 - aiogram.event - INFO - Update id=557185404 is handled. Duration 21331 ms by bot id=5702092394
2025-10-06 08:11:44,338 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 08:11:44,340 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 08:11:44,341 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 08:11:44,485 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:09:07,563 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 15:09:07,567 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 15:09:07,567 - aiogram.dispatcher - INFO - Start polling
2025-10-06 15:09:07,868 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:11:03,512 - aiogram.event - INFO - Update id=557185405 is handled. Duration 471 ms by bot id=5702092394
2025-10-06 15:11:05,232 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-06 15:11:05,559 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:11:08,382 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-06 15:11:19,719 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/
2025-10-06 15:11:19,720 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/
2025-10-06 15:11:19,852 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1522830591
2025-10-06 15:11:19,879 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Кроссовки adidas Ozweego
2025-10-06 15:11:19,905 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.8
2025-10-06 15:11:19,956 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 6179
2025-10-06 15:11:19,983 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 6735
2025-10-06 15:11:20,005 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg
2025-10-06 15:11:20,094 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Обувь', 'Мужчинам', 'Кеды, кроссовки и слипоны', 'adidas']
2025-10-06 15:11:20,095 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1522830591', 'name': 'Кроссовки adidas Ozweego', 'rating': 4.8, 'price_with_card': 6179, 'price_without_card': 6735, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', 'categories': ['Обувь', 'Мужчинам', 'Кеды, кроссовки и слипоны', 'adidas']}
2025-10-06 15:11:21,852 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-06 15:11:21,852 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/: {'id': '1522830591', 'name': 'Кроссовки adidas Ozweego', 'rating': 4.8, 'price_with_card': 6179, 'price_without_card': 6735, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', 'categories': ['Обувь', 'Мужчинам', 'Кеды, кроссовки и слипоны', 'adidas']}
2025-10-06 15:11:23,890 - src.core.uow - WARNING - Исключение в Unit of Work: OperationalError: (psycopg2.OperationalError) connection to server at "10.157.1.75", port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 15:11:23,891 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:11:23,892 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:11:23,892 - src.core.decorators - ERROR - Ошибка в функции create_product: (psycopg2.OperationalError) connection to server at "10.157.1.75", port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 15:11:23,892 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3295, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 626, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\psycopg2\__init__.py", line 135, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
psycopg2.OperationalError: connection to server at "10.157.1.75", port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 30, in add_product_process
    result = product_service.create_product(str(message.from_user.id), url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 46, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 39, in execute
    if self.product_repo.get(product_data['id']):
       ~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\database\repositories\product_repository.py", line 43, in get
    orm_model = self.session.get(ORMProduct, product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3694, in get
    return self._get_impl(
           ~~~~~~~~~~~~~~^
        entity,
        ^^^^^^^
    ...<7 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 3873, in _get_impl
    return db_load_fn(
        self,
    ...<5 lines>...
        bind_arguments=bind_arguments,
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\loading.py", line 694, in load_on_pk_identity
    session.execute(
    ~~~~~~~~~~~~~~~^
        q,
        ^^
    ...<2 lines>...
        bind_arguments=bind_arguments,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2365, in execute
    return self._execute_internal(
           ~~~~~~~~~~~~~~~~~~~~~~^
        statement,
        ^^^^^^^^^^
    ...<4 lines>...
        _add_event=_add_event,
        ^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2241, in _execute_internal
    conn = self._connection_for_bind(bind)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 2110, in _connection_for_bind
    return trans._connection_for_bind(engine, execution_options)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "<string>", line 2, in _connection_for_bind
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\state_changes.py", line 137, in _go
    ret_value = fn(self, *arg, **kw)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\orm\session.py", line 1189, in _connection_for_bind
    conn = bind.connect()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3271, in connect
    return self._connection_cls(self)
           ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 145, in __init__
    Connection._handle_dbapi_exception_noconnection(
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^
        err, dialect, engine
        ^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 2434, in _handle_dbapi_exception_noconnection
    raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 143, in __init__
    self._dbapi_connection = engine.raw_connection()
                             ~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\base.py", line 3295, in raw_connection
    return self.pool.connect()
           ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 447, in connect
    return _ConnectionFairy._checkout(self)
           ~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 1264, in _checkout
    fairy = _ConnectionRecord.checkout(pool)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 711, in checkout
    rec = pool._do_get()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 177, in _do_get
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\impl.py", line 175, in _do_get
    return self._create_connection()
           ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 388, in _create_connection
    return _ConnectionRecord(self)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 673, in __init__
    self.__connect()
    ~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 899, in __connect
    with util.safe_reraise():
         ~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\util\langhelpers.py", line 224, in __exit__
    raise exc_value.with_traceback(exc_tb)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\pool\base.py", line 895, in __connect
    self.dbapi_connection = connection = pool._invoke_creator(self)
                                         ~~~~~~~~~~~~~~~~~~~~^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\create.py", line 646, in connect
    return dialect.connect(*cargs, **cparams)
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\sqlalchemy\engine\default.py", line 626, in connect
    return self.loaded_dbapi.connect(*cargs, **cparams)  # type: ignore[no-any-return]  # NOQA: E501
           ~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\psycopg2\__init__.py", line 135, in connect
    conn = _connect(dsn, connection_factory=connection_factory, **kwasync)
sqlalchemy.exc.OperationalError: (psycopg2.OperationalError) connection to server at "10.157.1.75", port 5432 failed: Connection refused (0x0000274D/10061)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-06 15:11:24,498 - aiogram.event - INFO - Update id=557185406 is handled. Duration 19265 ms by bot id=5702092394
2025-10-06 15:11:42,000 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 15:11:42,002 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 15:11:42,002 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:11:42,200 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:14:05,905 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 15:14:05,908 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 15:14:05,909 - aiogram.dispatcher - INFO - Start polling
2025-10-06 15:14:06,195 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:14:14,910 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-06 15:14:15,012 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:14:15,134 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422']) получен по id: 515084006
2025-10-06 15:14:15,135 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-06 15:14:15,136 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-06 15:14:15,139 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:14:15,140 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:14:15,141 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:14:15,141 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-06 15:14:15,401 - aiogram.event - INFO - Update id=557185407 is handled. Duration 492 ms by bot id=5702092394
2025-10-06 15:14:17,155 - aiogram.event - INFO - Update id=557185408 is handled. Duration 328 ms by bot id=5702092394
2025-10-06 15:14:19,289 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:14:20,582 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-06 15:14:31,915 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/
2025-10-06 15:14:31,916 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/
2025-10-06 15:14:31,983 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1522830591
2025-10-06 15:14:32,019 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Кроссовки adidas Ozweego
2025-10-06 15:14:32,057 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.8
2025-10-06 15:14:32,097 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 6179
2025-10-06 15:14:32,140 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 6735
2025-10-06 15:14:32,161 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg
2025-10-06 15:14:32,229 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Обувь', 'Мужчинам', 'Кеды, кроссовки и слипоны', 'adidas']
2025-10-06 15:14:32,229 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1522830591', 'name': 'Кроссовки adidas Ozweego', 'rating': 4.8, 'price_with_card': 6179, 'price_without_card': 6735, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', 'categories': ['Обувь', 'Мужчинам', 'Кеды, кроссовки и слипоны', 'adidas']}
2025-10-06 15:14:33,978 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-06 15:14:33,979 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/: {'id': '1522830591', 'name': 'Кроссовки adidas Ozweego', 'rating': 4.8, 'price_with_card': 6179, 'price_without_card': 6735, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', 'categories': ['Обувь', 'Мужчинам', 'Кеды, кроссовки и слипоны', 'adidas']}
2025-10-06 15:14:33,986 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 1522830591 не найден
2025-10-06 15:14:33,992 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422']) получен по id: 515084006
2025-10-06 15:14:33,998 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='1522830591', user_id='515084006', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories=['Обувь', 'Мужчинам', 'Кеды, кроссовки и слипоны', 'adidas'], prices=[Price(id=None, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))])
2025-10-06 15:14:34,002 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))
2025-10-06 15:14:34,003 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 1522830591 пользователю ID 515084006
2025-10-06 15:14:34,004 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-06 15:14:34,067 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:14:34,068 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:14:34,068 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:14:34,223 - aiogram.event - INFO - Update id=557185409 is handled. Duration 14936 ms by bot id=5702092394
2025-10-06 15:15:15,798 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:15,800 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-06 15:15:15,830 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-06 15:15:15,849 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-06 15:15:15,870 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-06 15:15:15,886 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-06 15:15:15,904 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-06 15:15:15,918 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-06 15:15:15,936 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-06 15:15:15,954 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-06 15:15:15,971 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:15:15,976 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-06 15:15:15,981 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:15:15,982 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:15,982 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:16,087 - aiogram.event - INFO - Update id=557185410 is handled. Duration 373 ms by bot id=5702092394
2025-10-06 15:15:24,441 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:24,448 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-06 15:15:24,448 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-06 15:15:24,449 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-06 15:15:24,451 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:24,452 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:24,452 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:24,453 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-06 15:15:24,591 - aiogram.event - INFO - Update id=557185411 is handled. Duration 150 ms by bot id=5702092394
2025-10-06 15:15:25,880 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:25,881 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-06 15:15:25,897 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-06 15:15:25,913 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-06 15:15:25,923 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-06 15:15:25,935 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-06 15:15:25,946 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-06 15:15:25,955 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-06 15:15:25,965 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-06 15:15:25,974 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-06 15:15:25,984 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:15:25,989 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-06 15:15:25,992 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:15:25,993 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:25,993 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:26,147 - aiogram.event - INFO - Update id=557185412 is handled. Duration 278 ms by bot id=5702092394
2025-10-06 15:15:30,788 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:30,797 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:15:30,800 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-06 15:15:30,802 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:15:30,802 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:30,803 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:30,919 - aiogram.event - INFO - Update id=557185413 is handled. Duration 226 ms by bot id=5702092394
2025-10-06 15:15:32,402 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1522830591
2025-10-06 15:15:32,493 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:32,494 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-06 15:15:32,495 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:32,495 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:32,496 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:32,497 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:32,509 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:15:32,514 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-06 15:15:32,519 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:15:32,519 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:32,520 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:32,520 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 112, in handle_update_price
    new_text = _build_price_update_message(updated_product, full_product_info)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 151, in _build_price_update_message
    emoji = _get_price_change_emoji(price_with_card, prev_with_card)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 136, in _get_price_change_emoji
    if current > previous:
       ^^^^^^^^^^^^^^^^^^
TypeError: '>' not supported between instances of 'int' and 'NoneType'
2025-10-06 15:15:32,642 - aiogram.event - INFO - Update id=557185414 is handled. Duration 241 ms by bot id=5702092394
2025-10-06 15:15:34,155 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:34,169 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:15:34,176 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-06 15:15:34,179 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:15:34,180 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:34,181 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:34,294 - aiogram.event - INFO - Update id=557185415 is handled. Duration 224 ms by bot id=5702092394
2025-10-06 15:15:35,577 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1522830591
2025-10-06 15:15:35,791 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:35,791 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-06 15:15:35,792 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:35,792 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:35,793 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:35,793 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:15:35,810 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:15:35,814 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-06 15:15:35,817 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:15:35,818 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:15:35,818 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:15:35,819 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 112, in handle_update_price
    new_text = _build_price_update_message(updated_product, full_product_info)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 151, in _build_price_update_message
    emoji = _get_price_change_emoji(price_with_card, prev_with_card)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 136, in _get_price_change_emoji
    if current > previous:
       ^^^^^^^^^^^^^^^^^^
TypeError: '>' not supported between instances of 'int' and 'NoneType'
2025-10-06 15:15:36,051 - aiogram.event - INFO - Update id=557185416 is handled. Duration 476 ms by bot id=5702092394
2025-10-06 15:16:21,917 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 15:16:21,920 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 15:16:21,920 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:16:22,098 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:16:28,993 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 15:16:28,994 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 15:16:28,995 - aiogram.dispatcher - INFO - Start polling
2025-10-06 15:16:29,208 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:16:39,288 - aiogram.event - INFO - Update id=557185417 is handled. Duration 344 ms by bot id=5702092394
2025-10-06 15:17:27,077 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 15:17:27,078 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 15:17:27,078 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:17:27,238 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:17:32,165 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 15:17:32,167 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 15:17:32,167 - aiogram.dispatcher - INFO - Start polling
2025-10-06 15:17:32,439 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:17:35,972 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-06 15:17:36,050 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:17:36,140 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-06 15:17:36,140 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-06 15:17:36,141 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-06 15:17:36,142 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:17:36,143 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:17:36,143 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:17:36,143 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-06 15:17:36,403 - aiogram.event - INFO - Update id=557185418 is handled. Duration 432 ms by bot id=5702092394
2025-10-06 15:17:37,932 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:17:37,933 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-06 15:17:37,962 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-06 15:17:37,977 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-06 15:17:37,993 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-06 15:17:38,002 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-06 15:17:38,016 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-06 15:17:38,027 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-06 15:17:38,038 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-06 15:17:38,050 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-06 15:17:38,063 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:17:38,066 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-06 15:17:38,068 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:17:38,068 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:17:38,068 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:17:38,189 - aiogram.event - INFO - Update id=557185419 is handled. Duration 258 ms by bot id=5702092394
2025-10-06 15:17:39,263 - aiogram.event - INFO - Update id=557185420 is handled. Duration 196 ms by bot id=5702092394
2025-10-06 15:17:58,007 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 15:17:58,009 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 15:17:58,009 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:17:58,172 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:18:03,268 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 15:18:03,270 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 15:18:03,270 - aiogram.dispatcher - INFO - Start polling
2025-10-06 15:18:03,477 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:18:15,364 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-06 15:18:15,448 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:18:15,533 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-06 15:18:15,533 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-06 15:18:15,534 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-06 15:18:15,536 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:18:15,536 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:18:15,537 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:18:15,538 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-06 15:18:15,879 - aiogram.event - INFO - Update id=557185421 is handled. Duration 515 ms by bot id=5702092394
2025-10-06 15:18:16,942 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:18:16,942 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-06 15:18:16,968 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-06 15:18:16,986 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-06 15:18:17,000 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-06 15:18:17,013 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-06 15:18:17,028 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-06 15:18:17,043 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-06 15:18:17,057 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-06 15:18:17,069 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-06 15:18:17,083 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:18:17,086 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-06 15:18:17,089 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:18:17,090 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:18:17,091 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:18:17,189 - aiogram.event - INFO - Update id=557185422 is handled. Duration 248 ms by bot id=5702092394
2025-10-06 15:18:18,355 - aiogram.event - INFO - Update id=557185423 is handled. Duration 214 ms by bot id=5702092394
2025-10-06 15:18:58,827 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 15:18:58,828 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 15:18:58,829 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:18:58,975 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:19:03,939 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 15:19:03,940 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 15:19:03,941 - aiogram.dispatcher - INFO - Start polling
2025-10-06 15:19:04,190 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:19:07,358 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-06 15:19:07,428 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:19:07,518 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-06 15:19:07,519 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-06 15:19:07,519 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-06 15:19:07,521 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:19:07,522 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:19:07,523 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:19:07,523 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-06 15:19:14,625 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:19:14,633 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-06 15:19:14,634 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-06 15:19:14,635 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-06 15:19:14,637 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:19:14,638 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:19:14,639 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:19:14,639 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-06 15:19:14,966 - aiogram.event - INFO - Update id=557185425 is handled. Duration 341 ms by bot id=5702092394
2025-10-06 15:19:16,471 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:19:16,471 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-06 15:19:16,489 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-06 15:19:16,500 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-06 15:19:16,511 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-06 15:19:16,520 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-06 15:19:16,530 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-06 15:19:16,541 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-06 15:19:16,548 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-06 15:19:16,557 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-06 15:19:16,566 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:19:16,569 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-06 15:19:16,571 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:19:16,572 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:19:16,573 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:19:17,182 - aiogram.event - INFO - Update id=557185426 is handled. Duration 712 ms by bot id=5702092394
2025-10-06 15:19:18,667 - aiogram.event - INFO - Update id=557185427 is handled. Duration 208 ms by bot id=5702092394
2025-10-06 15:19:28,228 - aiogram.event - INFO - Update id=557185424 is handled. Duration 20869 ms by bot id=5702092394
2025-10-06 15:19:31,690 - aiogram.event - INFO - Update id=557185428 is handled. Duration 226 ms by bot id=5702092394
2025-10-06 15:20:23,582 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 15:20:23,584 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 15:20:23,585 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:20:23,754 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:20:28,253 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 15:20:28,254 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 15:20:28,255 - aiogram.dispatcher - INFO - Start polling
2025-10-06 15:20:28,554 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:20:33,672 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-06 15:20:33,758 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:20:33,845 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-06 15:20:33,846 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-06 15:20:33,847 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-06 15:20:33,848 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:20:33,849 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:20:33,850 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:20:33,850 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-06 15:20:34,215 - aiogram.event - INFO - Update id=557185429 is handled. Duration 544 ms by bot id=5702092394
2025-10-06 15:20:34,986 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:20:34,987 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-06 15:20:35,015 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-06 15:20:35,034 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-06 15:20:35,049 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-06 15:20:35,063 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-06 15:20:35,073 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-06 15:20:35,098 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-06 15:20:35,111 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-06 15:20:35,122 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-06 15:20:35,139 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:20:35,144 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-06 15:20:35,146 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:20:35,147 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:20:35,147 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:20:35,257 - aiogram.event - INFO - Update id=557185430 is handled. Duration 272 ms by bot id=5702092394
2025-10-06 15:20:36,897 - aiogram.event - INFO - Update id=557185431 is handled. Duration 185 ms by bot id=5702092394
2025-10-06 15:32:47,563 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 15:32:47,565 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 15:32:47,566 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:32:47,688 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:33:07,393 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-06 15:33:07,394 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-06 15:33:07,394 - aiogram.dispatcher - INFO - Start polling
2025-10-06 15:33:07,655 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-06 15:33:14,680 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-06 15:33:14,813 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:33:14,873 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-06 15:33:14,874 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-06 15:33:14,874 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-06 15:33:14,876 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:33:14,876 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:33:14,877 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:33:14,878 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-06 15:33:15,163 - aiogram.event - INFO - Update id=557185432 is handled. Duration 483 ms by bot id=5702092394
2025-10-06 15:33:16,402 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-06 15:33:16,403 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-06 15:33:16,422 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-06 15:33:16,433 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-06 15:33:16,445 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-06 15:33:16,459 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-06 15:33:16,467 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-06 15:33:16,485 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-06 15:33:16,499 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-06 15:33:16,512 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-06 15:33:16,519 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-06 15:33:16,525 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-06 15:33:16,527 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-06 15:33:16,528 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-06 15:33:16,528 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-06 15:33:16,674 - aiogram.event - INFO - Update id=557185433 is handled. Duration 273 ms by bot id=5702092394
2025-10-06 15:33:18,436 - aiogram.event - INFO - Update id=557185434 is handled. Duration 238 ms by bot id=5702092394
2025-10-06 15:48:05,802 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-10-06 15:48:05,824 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:48:39,189 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-10-06 15:48:39,195 - aiogram.dispatcher - WARNING - Sleep for 1.183982 seconds and try again... (tryings = 1, bot id = 5702092394)
2025-10-06 15:48:51,699 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 5702092394)
2025-10-06 15:54:35,325 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-10-06 15:54:35,325 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 15:54:57,373 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-10-06 15:54:57,374 - aiogram.dispatcher - WARNING - Sleep for 1.210317 seconds and try again... (tryings = 1, bot id = 5702092394)
2025-10-06 15:55:19,638 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-10-06 15:55:19,638 - aiogram.dispatcher - WARNING - Sleep for 1.575606 seconds and try again... (tryings = 2, bot id = 5702092394)
2025-10-06 15:55:42,283 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-10-06 15:55:42,284 - aiogram.dispatcher - WARNING - Sleep for 1.900705 seconds and try again... (tryings = 3, bot id = 5702092394)
2025-10-06 15:55:44,190 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:55:44,191 - aiogram.dispatcher - WARNING - Sleep for 2.494095 seconds and try again... (tryings = 4, bot id = 5702092394)
2025-10-06 15:55:46,702 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:55:46,703 - aiogram.dispatcher - WARNING - Sleep for 3.371816 seconds and try again... (tryings = 5, bot id = 5702092394)
2025-10-06 15:55:50,079 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:55:50,079 - aiogram.dispatcher - WARNING - Sleep for 4.265265 seconds and try again... (tryings = 6, bot id = 5702092394)
2025-10-06 15:55:54,355 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:55:54,356 - aiogram.dispatcher - WARNING - Sleep for 4.924291 seconds and try again... (tryings = 7, bot id = 5702092394)
2025-10-06 15:55:59,299 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:55:59,300 - aiogram.dispatcher - WARNING - Sleep for 5.031656 seconds and try again... (tryings = 8, bot id = 5702092394)
2025-10-06 15:56:04,338 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:04,349 - aiogram.dispatcher - WARNING - Sleep for 5.118969 seconds and try again... (tryings = 9, bot id = 5702092394)
2025-10-06 15:56:09,484 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:09,485 - aiogram.dispatcher - WARNING - Sleep for 5.007028 seconds and try again... (tryings = 10, bot id = 5702092394)
2025-10-06 15:56:14,509 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:14,510 - aiogram.dispatcher - WARNING - Sleep for 4.992319 seconds and try again... (tryings = 11, bot id = 5702092394)
2025-10-06 15:56:19,516 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:19,517 - aiogram.dispatcher - WARNING - Sleep for 4.894989 seconds and try again... (tryings = 12, bot id = 5702092394)
2025-10-06 15:56:24,423 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:24,424 - aiogram.dispatcher - WARNING - Sleep for 5.116500 seconds and try again... (tryings = 13, bot id = 5702092394)
2025-10-06 15:56:29,547 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:29,547 - aiogram.dispatcher - WARNING - Sleep for 5.006114 seconds and try again... (tryings = 14, bot id = 5702092394)
2025-10-06 15:56:34,558 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:34,558 - aiogram.dispatcher - WARNING - Sleep for 4.891290 seconds and try again... (tryings = 15, bot id = 5702092394)
2025-10-06 15:56:39,459 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:39,459 - aiogram.dispatcher - WARNING - Sleep for 4.998798 seconds and try again... (tryings = 16, bot id = 5702092394)
2025-10-06 15:56:44,463 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:44,464 - aiogram.dispatcher - WARNING - Sleep for 4.889246 seconds and try again... (tryings = 17, bot id = 5702092394)
2025-10-06 15:56:49,359 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:49,359 - aiogram.dispatcher - WARNING - Sleep for 4.996002 seconds and try again... (tryings = 18, bot id = 5702092394)
2025-10-06 15:56:54,391 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:54,392 - aiogram.dispatcher - WARNING - Sleep for 4.975440 seconds and try again... (tryings = 19, bot id = 5702092394)
2025-10-06 15:56:59,379 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:56:59,380 - aiogram.dispatcher - WARNING - Sleep for 4.860472 seconds and try again... (tryings = 20, bot id = 5702092394)
2025-10-06 15:57:04,248 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:04,249 - aiogram.dispatcher - WARNING - Sleep for 4.831897 seconds and try again... (tryings = 21, bot id = 5702092394)
2025-10-06 15:57:09,087 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:09,087 - aiogram.dispatcher - WARNING - Sleep for 5.090050 seconds and try again... (tryings = 22, bot id = 5702092394)
2025-10-06 15:57:14,188 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:14,189 - aiogram.dispatcher - WARNING - Sleep for 5.063306 seconds and try again... (tryings = 23, bot id = 5702092394)
2025-10-06 15:57:19,258 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:19,258 - aiogram.dispatcher - WARNING - Sleep for 4.969786 seconds and try again... (tryings = 24, bot id = 5702092394)
2025-10-06 15:57:24,235 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:24,235 - aiogram.dispatcher - WARNING - Sleep for 5.081214 seconds and try again... (tryings = 25, bot id = 5702092394)
2025-10-06 15:57:29,334 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:29,334 - aiogram.dispatcher - WARNING - Sleep for 5.125217 seconds and try again... (tryings = 26, bot id = 5702092394)
2025-10-06 15:57:34,466 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:34,468 - aiogram.dispatcher - WARNING - Sleep for 5.130046 seconds and try again... (tryings = 27, bot id = 5702092394)
2025-10-06 15:57:39,602 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:39,603 - aiogram.dispatcher - WARNING - Sleep for 5.191752 seconds and try again... (tryings = 28, bot id = 5702092394)
2025-10-06 15:57:44,812 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:44,813 - aiogram.dispatcher - WARNING - Sleep for 5.001159 seconds and try again... (tryings = 29, bot id = 5702092394)
2025-10-06 15:57:49,823 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:49,823 - aiogram.dispatcher - WARNING - Sleep for 4.986653 seconds and try again... (tryings = 30, bot id = 5702092394)
2025-10-06 15:57:54,818 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:54,819 - aiogram.dispatcher - WARNING - Sleep for 5.076165 seconds and try again... (tryings = 31, bot id = 5702092394)
2025-10-06 15:57:59,907 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:57:59,908 - aiogram.dispatcher - WARNING - Sleep for 5.103223 seconds and try again... (tryings = 32, bot id = 5702092394)
2025-10-06 15:58:05,029 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:05,029 - aiogram.dispatcher - WARNING - Sleep for 4.869701 seconds and try again... (tryings = 33, bot id = 5702092394)
2025-10-06 15:58:09,907 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:09,907 - aiogram.dispatcher - WARNING - Sleep for 5.136538 seconds and try again... (tryings = 34, bot id = 5702092394)
2025-10-06 15:58:15,050 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:15,051 - aiogram.dispatcher - WARNING - Sleep for 5.058358 seconds and try again... (tryings = 35, bot id = 5702092394)
2025-10-06 15:58:20,126 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:20,126 - aiogram.dispatcher - WARNING - Sleep for 5.063926 seconds and try again... (tryings = 36, bot id = 5702092394)
2025-10-06 15:58:25,196 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:25,197 - aiogram.dispatcher - WARNING - Sleep for 4.836678 seconds and try again... (tryings = 37, bot id = 5702092394)
2025-10-06 15:58:30,048 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:30,049 - aiogram.dispatcher - WARNING - Sleep for 4.937617 seconds and try again... (tryings = 38, bot id = 5702092394)
2025-10-06 15:58:34,999 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:35,000 - aiogram.dispatcher - WARNING - Sleep for 5.000995 seconds and try again... (tryings = 39, bot id = 5702092394)
2025-10-06 15:58:40,018 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:40,018 - aiogram.dispatcher - WARNING - Sleep for 5.101052 seconds and try again... (tryings = 40, bot id = 5702092394)
2025-10-06 15:58:45,135 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:45,135 - aiogram.dispatcher - WARNING - Sleep for 5.256731 seconds and try again... (tryings = 41, bot id = 5702092394)
2025-10-06 15:58:50,400 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:50,401 - aiogram.dispatcher - WARNING - Sleep for 4.918387 seconds and try again... (tryings = 42, bot id = 5702092394)
2025-10-06 15:58:55,324 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:58:55,324 - aiogram.dispatcher - WARNING - Sleep for 4.962123 seconds and try again... (tryings = 43, bot id = 5702092394)
2025-10-06 15:59:00,301 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:00,301 - aiogram.dispatcher - WARNING - Sleep for 5.054060 seconds and try again... (tryings = 44, bot id = 5702092394)
2025-10-06 15:59:05,369 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:05,370 - aiogram.dispatcher - WARNING - Sleep for 5.042235 seconds and try again... (tryings = 45, bot id = 5702092394)
2025-10-06 15:59:10,427 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:10,428 - aiogram.dispatcher - WARNING - Sleep for 5.150238 seconds and try again... (tryings = 46, bot id = 5702092394)
2025-10-06 15:59:15,590 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:15,590 - aiogram.dispatcher - WARNING - Sleep for 4.961442 seconds and try again... (tryings = 47, bot id = 5702092394)
2025-10-06 15:59:20,566 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:20,567 - aiogram.dispatcher - WARNING - Sleep for 5.039231 seconds and try again... (tryings = 48, bot id = 5702092394)
2025-10-06 15:59:25,621 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:25,622 - aiogram.dispatcher - WARNING - Sleep for 4.926739 seconds and try again... (tryings = 49, bot id = 5702092394)
2025-10-06 15:59:30,557 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:30,557 - aiogram.dispatcher - WARNING - Sleep for 4.944736 seconds and try again... (tryings = 50, bot id = 5702092394)
2025-10-06 15:59:35,520 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:35,520 - aiogram.dispatcher - WARNING - Sleep for 4.886369 seconds and try again... (tryings = 51, bot id = 5702092394)
2025-10-06 15:59:40,410 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:40,411 - aiogram.dispatcher - WARNING - Sleep for 5.110535 seconds and try again... (tryings = 52, bot id = 5702092394)
2025-10-06 15:59:45,525 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:45,526 - aiogram.dispatcher - WARNING - Sleep for 4.798379 seconds and try again... (tryings = 53, bot id = 5702092394)
2025-10-06 15:59:50,330 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:50,331 - aiogram.dispatcher - WARNING - Sleep for 4.786578 seconds and try again... (tryings = 54, bot id = 5702092394)
2025-10-06 15:59:55,123 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 15:59:55,123 - aiogram.dispatcher - WARNING - Sleep for 5.076645 seconds and try again... (tryings = 55, bot id = 5702092394)
2025-10-06 16:00:00,212 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 16:00:00,213 - aiogram.dispatcher - WARNING - Sleep for 4.989261 seconds and try again... (tryings = 56, bot id = 5702092394)
2025-10-06 16:00:05,209 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Сетевая папка недоступна. За информацией о разрешении проблем в сети обратитесь к справочной системе Windows]
2025-10-06 16:00:05,209 - aiogram.dispatcher - WARNING - Sleep for 4.886019 seconds and try again... (tryings = 57, bot id = 5702092394)
2025-10-06 16:49:36,973 - aiogram.dispatcher - INFO - Connection established (tryings = 58, bot id = 5702092394)
2025-10-06 20:57:20,971 - aiogram.dispatcher - INFO - Polling stopped
2025-10-06 20:57:20,975 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-06 20:57:20,976 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-06 20:57:21,064 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 12:43:25,191 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-07 12:43:25,193 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-07 12:43:25,193 - aiogram.dispatcher - INFO - Start polling
2025-10-07 12:43:25,478 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 12:44:07,522 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-07 12:44:07,620 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:44:07,743 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-07 12:44:07,744 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-07 12:44:07,745 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-07 12:44:07,747 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:07,747 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:07,748 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:44:07,748 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-07 12:44:08,095 - aiogram.event - INFO - Update id=557185435 is handled. Duration 574 ms by bot id=5702092394
2025-10-07 12:44:09,349 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:44:09,349 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-07 12:44:09,375 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-07 12:44:09,395 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-07 12:44:09,410 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-07 12:44:09,421 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-07 12:44:09,434 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-07 12:44:09,447 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-07 12:44:09,460 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-07 12:44:09,473 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-07 12:44:09,485 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-07 12:44:09,488 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-07 12:44:09,491 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 12:44:09,492 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:09,493 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:44:09,671 - aiogram.event - INFO - Update id=557185436 is handled. Duration 323 ms by bot id=5702092394
2025-10-07 12:44:12,112 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:44:12,132 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-07 12:44:12,140 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 12:44:12,143 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 12:44:12,144 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:12,144 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:44:12,260 - aiogram.event - INFO - Update id=557185437 is handled. Duration 235 ms by bot id=5702092394
2025-10-07 12:44:16,558 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:44:16,559 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-07 12:44:16,575 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-07 12:44:16,596 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-07 12:44:16,610 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-07 12:44:16,625 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-07 12:44:16,641 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-07 12:44:16,658 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-07 12:44:16,676 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-07 12:44:16,696 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-07 12:44:16,714 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-07 12:44:16,720 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-07 12:44:16,724 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 12:44:16,724 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:16,725 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:44:16,845 - aiogram.event - INFO - Update id=557185438 is handled. Duration 372 ms by bot id=5702092394
2025-10-07 12:44:17,998 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:44:18,011 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-07 12:44:18,016 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 12:44:18,019 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 12:44:18,020 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:18,021 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:44:18,131 - aiogram.event - INFO - Update id=557185439 is handled. Duration 216 ms by bot id=5702092394
2025-10-07 12:44:19,240 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-07 12:44:19,323 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:44:19,335 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-07 12:44:22,510 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 12:44:33,235 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 12:44:33,236 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 12:44:33,440 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 12:44:33,494 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 12:44:33,561 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 12:44:33,619 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 12:44:33,713 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 12:44:33,756 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 12:44:33,905 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 12:44:33,906 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 12:44:35,558 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 12:44:35,569 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-07 12:44:36,913 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 12:44:47,576 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 12:44:47,577 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 12:44:47,677 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 12:44:47,739 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 12:44:47,822 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 12:44:48,029 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 12:44:48,513 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 12:44:48,572 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 12:44:48,766 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 12:44:48,767 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 12:44:50,583 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 12:44:50,584 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010))
2025-10-07 12:44:50,584 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-07 12:44:50,584 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010))
2025-10-07 12:44:50,591 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527))]) (ID: 1818184981)
2025-10-07 12:44:50,598 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-07 12:44:50,621 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:50,622 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:50,622 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:44:50,624 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:44:50,642 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010))]) (ID: 1818184981)
2025-10-07 12:44:50,648 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 12:44:50,651 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 12:44:50,652 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:44:50,653 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:44:50,654 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 118, in handle_update_price
    new_text = _build_price_update_message(updated_product, full_product_info)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 162, in _build_price_update_message
    f"📦 {updated_product['name']}\n"
          ~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'name'
2025-10-07 12:44:50,904 - aiogram.event - INFO - Update id=557185440 is handled. Duration 31658 ms by bot id=5702092394
2025-10-07 12:48:23,928 - aiogram.dispatcher - INFO - Polling stopped
2025-10-07 12:48:23,929 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-07 12:48:23,930 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-07 12:48:24,052 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 12:48:34,694 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-07 12:48:34,696 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-07 12:48:34,697 - aiogram.dispatcher - INFO - Start polling
2025-10-07 12:48:35,002 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 12:48:38,336 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-07 12:48:38,400 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:48:38,400 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-07 12:48:38,508 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010))]) (ID: 1818184981)
2025-10-07 12:48:38,519 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-07 12:48:38,532 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-07 12:48:38,541 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-07 12:48:38,552 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-07 12:48:38,566 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-07 12:48:38,577 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-07 12:48:38,592 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-07 12:48:38,605 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-07 12:48:38,608 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-07 12:48:38,613 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 12:48:38,613 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:48:38,614 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:48:38,906 - aiogram.event - INFO - Update id=557185441 is handled. Duration 582 ms by bot id=5702092394
2025-10-07 12:48:40,393 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:48:40,404 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010))]) (ID: 1818184981)
2025-10-07 12:48:40,409 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 12:48:40,412 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 12:48:40,414 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:48:40,414 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:48:40,558 - aiogram.event - INFO - Update id=557185442 is handled. Duration 278 ms by bot id=5702092394
2025-10-07 12:48:41,705 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-07 12:48:41,873 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:48:41,886 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010))]) (ID: 1818184981)
2025-10-07 12:48:43,300 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 12:48:54,110 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 12:48:54,111 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 12:48:54,169 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 12:48:54,217 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 12:48:54,255 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 12:48:54,285 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 12:48:54,310 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 12:48:54,330 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 12:48:54,396 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 12:48:54,396 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 12:48:55,813 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 12:48:55,823 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010))]) (ID: 1818184981)
2025-10-07 12:48:57,120 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 12:49:07,805 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 12:49:07,806 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 12:49:08,134 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 12:49:08,185 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 12:49:08,251 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 12:49:08,298 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 12:49:08,348 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 12:49:08,377 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 12:49:08,487 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 12:49:08,488 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 12:49:10,087 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 12:49:10,088 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111))
2025-10-07 12:49:10,088 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-07 12:49:10,088 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111))
2025-10-07 12:49:10,102 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010))]) (ID: 1818184981)
2025-10-07 12:49:10,106 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-07 12:49:10,117 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:49:10,118 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:49:10,119 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:49:10,119 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 12:49:10,134 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111))]) (ID: 1818184981)
2025-10-07 12:49:10,139 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 12:49:10,142 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 12:49:10,143 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 12:49:10,143 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 12:49:10,144 - src.infrastructure.services.logger - INFO - FULL INFO DEBUG!!!! {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)}
2025-10-07 12:49:10,144 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 118, in handle_update_price
    new_text = _build_price_update_message(updated_product, full_product_info)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 163, in _build_price_update_message
    f"📦 {updated_product['name']}\n"
          ~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'name'
2025-10-07 12:49:10,383 - aiogram.event - INFO - Update id=557185443 is handled. Duration 28674 ms by bot id=5702092394
2025-10-07 13:51:41,981 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-10-07 13:51:42,013 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-07 13:51:43,066 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:51:43,068 - aiogram.dispatcher - WARNING - Sleep for 1.174980 seconds and try again... (tryings = 1, bot id = 5702092394)
2025-10-07 13:51:44,260 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:51:44,260 - aiogram.dispatcher - WARNING - Sleep for 1.552415 seconds and try again... (tryings = 2, bot id = 5702092394)
2025-10-07 13:51:45,819 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:51:45,820 - aiogram.dispatcher - WARNING - Sleep for 1.867297 seconds and try again... (tryings = 3, bot id = 5702092394)
2025-10-07 13:51:47,703 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:51:47,703 - aiogram.dispatcher - WARNING - Sleep for 2.571122 seconds and try again... (tryings = 4, bot id = 5702092394)
2025-10-07 13:51:50,290 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:51:50,290 - aiogram.dispatcher - WARNING - Sleep for 3.237294 seconds and try again... (tryings = 5, bot id = 5702092394)
2025-10-07 13:51:53,537 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:51:53,538 - aiogram.dispatcher - WARNING - Sleep for 4.332774 seconds and try again... (tryings = 6, bot id = 5702092394)
2025-10-07 13:51:57,891 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:51:57,892 - aiogram.dispatcher - WARNING - Sleep for 4.785674 seconds and try again... (tryings = 7, bot id = 5702092394)
2025-10-07 13:52:02,697 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:02,698 - aiogram.dispatcher - WARNING - Sleep for 5.082195 seconds and try again... (tryings = 8, bot id = 5702092394)
2025-10-07 13:52:07,787 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:07,787 - aiogram.dispatcher - WARNING - Sleep for 4.926471 seconds and try again... (tryings = 9, bot id = 5702092394)
2025-10-07 13:52:12,733 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:12,734 - aiogram.dispatcher - WARNING - Sleep for 5.208177 seconds and try again... (tryings = 10, bot id = 5702092394)
2025-10-07 13:52:17,958 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:17,959 - aiogram.dispatcher - WARNING - Sleep for 4.864258 seconds and try again... (tryings = 11, bot id = 5702092394)
2025-10-07 13:52:22,830 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:22,830 - aiogram.dispatcher - WARNING - Sleep for 5.007847 seconds and try again... (tryings = 12, bot id = 5702092394)
2025-10-07 13:52:27,858 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:27,859 - aiogram.dispatcher - WARNING - Sleep for 5.043662 seconds and try again... (tryings = 13, bot id = 5702092394)
2025-10-07 13:52:32,913 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:32,914 - aiogram.dispatcher - WARNING - Sleep for 5.060075 seconds and try again... (tryings = 14, bot id = 5702092394)
2025-10-07 13:52:38,004 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:38,005 - aiogram.dispatcher - WARNING - Sleep for 5.054561 seconds and try again... (tryings = 15, bot id = 5702092394)
2025-10-07 13:52:43,078 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:43,080 - aiogram.dispatcher - WARNING - Sleep for 4.886867 seconds and try again... (tryings = 16, bot id = 5702092394)
2025-10-07 13:52:47,981 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:47,982 - aiogram.dispatcher - WARNING - Sleep for 4.981748 seconds and try again... (tryings = 17, bot id = 5702092394)
2025-10-07 13:52:52,969 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:52,969 - aiogram.dispatcher - WARNING - Sleep for 4.930160 seconds and try again... (tryings = 18, bot id = 5702092394)
2025-10-07 13:52:57,917 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:52:57,918 - aiogram.dispatcher - WARNING - Sleep for 5.090747 seconds and try again... (tryings = 19, bot id = 5702092394)
2025-10-07 13:53:03,021 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:03,021 - aiogram.dispatcher - WARNING - Sleep for 5.149416 seconds and try again... (tryings = 20, bot id = 5702092394)
2025-10-07 13:53:08,238 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:08,238 - aiogram.dispatcher - WARNING - Sleep for 5.052994 seconds and try again... (tryings = 21, bot id = 5702092394)
2025-10-07 13:53:13,308 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:13,309 - aiogram.dispatcher - WARNING - Sleep for 4.949890 seconds and try again... (tryings = 22, bot id = 5702092394)
2025-10-07 13:53:18,268 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:18,268 - aiogram.dispatcher - WARNING - Sleep for 5.112919 seconds and try again... (tryings = 23, bot id = 5702092394)
2025-10-07 13:53:23,397 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:23,398 - aiogram.dispatcher - WARNING - Sleep for 4.911159 seconds and try again... (tryings = 24, bot id = 5702092394)
2025-10-07 13:53:28,325 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:28,326 - aiogram.dispatcher - WARNING - Sleep for 5.184615 seconds and try again... (tryings = 25, bot id = 5702092394)
2025-10-07 13:53:33,514 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:33,515 - aiogram.dispatcher - WARNING - Sleep for 4.944435 seconds and try again... (tryings = 26, bot id = 5702092394)
2025-10-07 13:53:38,465 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:38,466 - aiogram.dispatcher - WARNING - Sleep for 5.114215 seconds and try again... (tryings = 27, bot id = 5702092394)
2025-10-07 13:53:43,583 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:43,584 - aiogram.dispatcher - WARNING - Sleep for 5.041931 seconds and try again... (tryings = 28, bot id = 5702092394)
2025-10-07 13:53:48,643 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:48,644 - aiogram.dispatcher - WARNING - Sleep for 5.094674 seconds and try again... (tryings = 29, bot id = 5702092394)
2025-10-07 13:53:53,744 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:53,744 - aiogram.dispatcher - WARNING - Sleep for 4.879220 seconds and try again... (tryings = 30, bot id = 5702092394)
2025-10-07 13:53:58,641 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:53:58,641 - aiogram.dispatcher - WARNING - Sleep for 5.037316 seconds and try again... (tryings = 31, bot id = 5702092394)
2025-10-07 13:54:03,687 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:03,687 - aiogram.dispatcher - WARNING - Sleep for 4.938862 seconds and try again... (tryings = 32, bot id = 5702092394)
2025-10-07 13:54:08,642 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:08,643 - aiogram.dispatcher - WARNING - Sleep for 4.799064 seconds and try again... (tryings = 33, bot id = 5702092394)
2025-10-07 13:54:13,455 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:13,456 - aiogram.dispatcher - WARNING - Sleep for 5.001977 seconds and try again... (tryings = 34, bot id = 5702092394)
2025-10-07 13:54:18,469 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:18,470 - aiogram.dispatcher - WARNING - Sleep for 5.034498 seconds and try again... (tryings = 35, bot id = 5702092394)
2025-10-07 13:54:23,532 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:23,533 - aiogram.dispatcher - WARNING - Sleep for 5.020163 seconds and try again... (tryings = 36, bot id = 5702092394)
2025-10-07 13:54:28,583 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:28,584 - aiogram.dispatcher - WARNING - Sleep for 4.884189 seconds and try again... (tryings = 37, bot id = 5702092394)
2025-10-07 13:54:33,479 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:33,479 - aiogram.dispatcher - WARNING - Sleep for 5.143901 seconds and try again... (tryings = 38, bot id = 5702092394)
2025-10-07 13:54:38,648 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:38,648 - aiogram.dispatcher - WARNING - Sleep for 4.903382 seconds and try again... (tryings = 39, bot id = 5702092394)
2025-10-07 13:54:43,573 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:43,574 - aiogram.dispatcher - WARNING - Sleep for 4.964287 seconds and try again... (tryings = 40, bot id = 5702092394)
2025-10-07 13:54:48,552 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:48,552 - aiogram.dispatcher - WARNING - Sleep for 4.990807 seconds and try again... (tryings = 41, bot id = 5702092394)
2025-10-07 13:54:53,550 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-07 13:54:53,551 - aiogram.dispatcher - WARNING - Sleep for 4.926870 seconds and try again... (tryings = 42, bot id = 5702092394)
2025-10-07 13:55:08,978 - aiogram.dispatcher - INFO - Connection established (tryings = 43, bot id = 5702092394)
2025-10-07 15:36:15,952 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientOSError: [WinError 1236] Подключение к сети было разорвано локальной системой
2025-10-07 15:36:16,121 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-07 15:36:38,319 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorError: Cannot connect to host api.telegram.org:443 ssl:default [Превышен таймаут семафора]
2025-10-07 15:36:38,329 - aiogram.dispatcher - WARNING - Sleep for 1.306113 seconds and try again... (tryings = 1, bot id = 5702092394)
2025-10-07 15:36:49,874 - aiogram.dispatcher - INFO - Connection established (tryings = 2, bot id = 5702092394)
2025-10-07 15:40:16,209 - aiogram.dispatcher - INFO - Polling stopped
2025-10-07 15:40:16,228 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-07 15:40:16,229 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-07 15:40:16,506 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 15:43:22,759 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-07 15:43:22,762 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-07 15:43:22,763 - aiogram.dispatcher - INFO - Start polling
2025-10-07 15:43:23,069 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 15:43:24,348 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-07 15:43:24,424 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 15:43:24,499 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1565602444', '816992280', '1668950019', '247385222', '612659680', '177655422', '1522830591']) получен по id: 515084006
2025-10-07 15:43:24,499 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-07 15:43:24,499 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-07 15:43:24,501 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 15:43:24,502 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 15:43:24,503 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 15:43:24,503 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-07 15:43:24,773 - aiogram.event - INFO - Update id=557185444 is handled. Duration 426 ms by bot id=5702092394
2025-10-07 15:43:25,717 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 15:43:25,718 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-07 15:43:25,735 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111))]) (ID: 1818184981)
2025-10-07 15:43:25,752 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-07 15:43:25,761 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-07 15:43:25,774 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-07 15:43:25,786 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-07 15:43:25,793 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-07 15:43:25,804 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-07 15:43:25,812 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-07 15:43:25,822 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-07 15:43:25,825 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-07 15:43:25,827 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 15:43:25,828 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 15:43:25,829 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 15:43:25,933 - aiogram.event - INFO - Update id=557185445 is handled. Duration 218 ms by bot id=5702092394
2025-10-07 15:43:27,450 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 15:43:27,466 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111))]) (ID: 1818184981)
2025-10-07 15:43:27,471 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 15:43:27,473 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 15:43:27,474 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 15:43:27,474 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 15:43:27,652 - aiogram.event - INFO - Update id=557185446 is handled. Duration 312 ms by bot id=5702092394
2025-10-07 15:43:28,538 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-07 15:43:28,678 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 15:43:28,696 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111))]) (ID: 1818184981)
2025-10-07 15:43:32,608 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 15:43:43,379 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 15:43:43,380 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 15:43:43,743 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 15:43:43,846 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 15:43:43,949 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 15:43:44,060 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 15:43:44,141 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 15:43:44,195 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 15:43:44,359 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 15:43:44,360 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 15:43:46,432 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 15:43:46,442 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111))]) (ID: 1818184981)
2025-10-07 15:43:47,821 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 15:43:58,565 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 15:43:58,566 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 15:43:58,986 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 15:43:59,058 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 15:43:59,122 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 15:43:59,198 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 15:43:59,261 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 15:43:59,309 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 15:43:59,484 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 15:43:59,485 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 15:44:01,310 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 15:44:01,311 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735))
2025-10-07 15:44:01,312 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-07 15:44:01,312 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735))
2025-10-07 15:44:01,318 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111))]) (ID: 1818184981)
2025-10-07 15:44:01,321 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-07 15:44:01,327 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 15:44:01,328 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 15:44:01,328 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 15:44:01,328 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 15:44:01,334 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735))]) (ID: 1818184981)
2025-10-07 15:44:01,337 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 15:44:01,339 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 15:44:01,339 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 15:44:01,339 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 15:44:01,340 - src.infrastructure.services.logger - INFO - FULL INFO DEBUG!!!! {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)}
2025-10-07 15:44:01,340 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 118, in handle_update_price
    new_text = _build_price_update_message(updated_product, full_product_info)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 163, in _build_price_update_message
    f"📦 {updated_product['name']}\n"
          ~~~~~~~~~~~~~~~^^^^^^^^
KeyError: 'name'
2025-10-07 15:44:01,646 - aiogram.event - INFO - Update id=557185447 is handled. Duration 33112 ms by bot id=5702092394
2025-10-07 16:05:05,719 - aiogram.dispatcher - INFO - Polling stopped
2025-10-07 16:05:05,732 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-07 16:05:05,732 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-07 16:05:05,890 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 16:05:12,270 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-07 16:05:12,272 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-07 16:05:12,272 - aiogram.dispatcher - INFO - Start polling
2025-10-07 16:05:12,554 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 16:05:19,763 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-07 16:05:19,887 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:05:19,888 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-07 16:05:20,023 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735))]) (ID: 1818184981)
2025-10-07 16:05:20,040 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-07 16:05:20,063 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-07 16:05:20,079 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-07 16:05:20,103 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-07 16:05:20,119 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-07 16:05:20,131 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-07 16:05:20,146 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-07 16:05:20,171 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-07 16:05:20,180 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-07 16:05:20,182 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 16:05:20,183 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:05:20,184 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:05:20,500 - aiogram.event - INFO - Update id=557185448 is handled. Duration 739 ms by bot id=5702092394
2025-10-07 16:05:21,823 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:05:21,850 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735))]) (ID: 1818184981)
2025-10-07 16:05:21,856 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 16:05:21,859 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 16:05:21,860 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:05:21,861 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:05:21,986 - aiogram.event - INFO - Update id=557185449 is handled. Duration 252 ms by bot id=5702092394
2025-10-07 16:05:22,927 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-07 16:05:23,031 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:05:23,055 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735))]) (ID: 1818184981)
2025-10-07 16:05:25,094 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 16:05:35,948 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:05:35,949 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:05:36,026 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 16:05:36,074 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 16:05:36,120 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 16:05:36,174 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 16:05:36,226 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 16:05:36,254 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 16:05:36,353 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 16:05:36,353 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 16:05:38,066 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 16:05:38,078 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735))]) (ID: 1818184981)
2025-10-07 16:05:39,390 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 16:05:50,135 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:05:50,135 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:05:50,170 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 16:05:50,221 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 16:05:50,252 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 16:05:50,283 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 16:05:50,311 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 16:05:50,331 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 16:05:50,408 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 16:05:50,408 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 16:05:51,993 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 16:05:51,994 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418))
2025-10-07 16:05:51,994 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-07 16:05:51,995 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418))
2025-10-07 16:05:52,002 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735))]) (ID: 1818184981)
2025-10-07 16:05:52,004 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-07 16:05:52,012 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:05:52,012 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:05:52,013 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:05:52,013 - src.infrastructure.services.logger - INFO - Получены данные товара: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)}
2025-10-07 16:05:52,013 - src.infrastructure.services.logger - INFO - FULL INFO DEBUG!!!! {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)}
2025-10-07 16:05:52,014 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 124, in handle_update_price
    new_text = _build_price_update_message(full_product_info, full_product_info)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 159, in _build_price_update_message
    name = updated_product['full_product']['name']
           ~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^
KeyError: 'full_product'
2025-10-07 16:05:52,315 - aiogram.event - INFO - Update id=557185450 is handled. Duration 29393 ms by bot id=5702092394
2025-10-07 16:07:09,698 - aiogram.dispatcher - INFO - Polling stopped
2025-10-07 16:07:09,700 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-07 16:07:09,700 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-07 16:07:09,952 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 16:07:14,421 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-07 16:07:14,423 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-07 16:07:14,423 - aiogram.dispatcher - INFO - Start polling
2025-10-07 16:07:14,631 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 16:07:30,069 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-07 16:07:30,165 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:07:30,166 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-07 16:07:30,275 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418))]) (ID: 1818184981)
2025-10-07 16:07:30,290 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-07 16:07:30,310 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-07 16:07:30,324 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-07 16:07:30,338 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-07 16:07:30,347 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-07 16:07:30,361 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-07 16:07:30,376 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-07 16:07:30,390 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-07 16:07:30,394 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-07 16:07:30,396 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 16:07:30,396 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:07:30,397 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:07:30,748 - aiogram.event - INFO - Update id=557185451 is handled. Duration 680 ms by bot id=5702092394
2025-10-07 16:07:32,227 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:07:32,242 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418))]) (ID: 1818184981)
2025-10-07 16:07:32,246 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 16:07:32,250 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 16:07:32,252 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:07:32,252 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:07:32,488 - aiogram.event - INFO - Update id=557185452 is handled. Duration 442 ms by bot id=5702092394
2025-10-07 16:07:33,603 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-07 16:07:33,748 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:07:33,762 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418))]) (ID: 1818184981)
2025-10-07 16:07:35,126 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 16:07:45,864 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:07:45,865 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:07:45,919 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 16:07:45,960 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 16:07:46,001 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 16:07:46,044 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 16:07:46,087 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 16:07:46,113 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 16:07:46,201 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 16:07:46,201 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 16:07:47,786 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 16:07:47,795 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418))]) (ID: 1818184981)
2025-10-07 16:07:49,023 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 16:07:59,685 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:07:59,686 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:07:59,761 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 16:07:59,805 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 16:08:00,055 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 16:08:00,281 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 16:08:00,360 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 16:08:00,392 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 16:08:00,569 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 16:08:00,570 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 16:08:02,204 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 16:08:02,204 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 8, 2, 204934))
2025-10-07 16:08:02,205 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-07 16:08:02,205 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 8, 2, 204934))
2025-10-07 16:08:02,213 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418))]) (ID: 1818184981)
2025-10-07 16:08:02,216 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-07 16:08:02,227 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:08:02,229 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:08:02,230 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:08:02,231 - src.infrastructure.services.logger - INFO - Получены данные товара: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 7, 16, 5, 51, 994418)}
2025-10-07 16:08:02,231 - src.infrastructure.services.logger - INFO - FULL INFO DEBUG!!!! {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 7, 16, 5, 51, 994418)}
2025-10-07 16:08:02,473 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-07 16:08:02,473 - aiogram.event - INFO - Update id=557185453 is handled. Duration 28872 ms by bot id=5702092394
2025-10-07 16:10:10,704 - aiogram.dispatcher - INFO - Polling stopped
2025-10-07 16:10:10,706 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-07 16:10:10,706 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-07 16:10:10,967 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 16:10:15,964 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-07 16:10:15,965 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-07 16:10:15,966 - aiogram.dispatcher - INFO - Start polling
2025-10-07 16:10:16,288 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-07 16:14:52,186 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.157.1.75:5432/pricely_db
2025-10-07 16:14:52,295 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:14:52,295 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-07 16:14:52,400 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418)), Price(id=73, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 8, 2, 204934))]) (ID: 1818184981)
2025-10-07 16:14:52,414 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458)), Price(id=39, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 10, 4, 11, 59, 7, 526397)), Price(id=50, product_id='1728110604', with_card=15830, without_card=15990, previous_with_card=15830, previous_without_card=15990, created_at=datetime.datetime(2025, 10, 5, 9, 17, 22, 264687))]) (ID: 1728110604)
2025-10-07 16:14:52,427 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143)), Price(id=46, product_id='1565602444', with_card=561, without_card=612, previous_with_card=737, previous_without_card=805, created_at=datetime.datetime(2025, 10, 4, 15, 51, 42, 891985)), Price(id=48, product_id='1565602444', with_card=561, without_card=612, previous_with_card=561, previous_without_card=612, created_at=datetime.datetime(2025, 10, 4, 15, 53, 32, 759396))]) (ID: 1565602444)
2025-10-07 16:14:52,446 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='816992280', user_id='', name='Рюкзак городской спортивный ТЕВИН', link='https://www.ozon.ru/product/ryukzak-gorodskoy-sportivnyy-tevin-816992280/', image_url='https://ir.ozone.ru/s3/multimedia-f/wc1000/6723691791.jpg', rating=4.9, categories='{Аксессуары,Мужчинам,"Сумки и рюкзаки",Рюкзаки,TEVIN}', prices=[Price(id=52, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 45, 8, 205473)), Price(id=63, product_id='816992280', with_card=1824, without_card=1990, previous_with_card=1824, previous_without_card=1990, created_at=datetime.datetime(2025, 10, 5, 10, 31, 9, 253684))]) (ID: 816992280)
2025-10-07 16:14:52,462 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=53, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 46, 13, 430085)), Price(id=55, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 49, 54, 751512)), Price(id=57, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 9, 56, 56, 732796)), Price(id=58, product_id='1668950019', with_card=1641, without_card=1784, previous_with_card=1641, previous_without_card=1784, created_at=datetime.datetime(2025, 10, 5, 10, 1, 26, 9334))]) (ID: 1668950019)
2025-10-07 16:14:52,475 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='247385222', user_id='', name='Презервативы Masculan Маскулан Ultra Fine 20 шт, ультратонкие', link='https://www.ozon.ru/product/prezervativy-masculan-maskulan-ultra-fine-20-sht-ultratonkie-247385222/', image_url='https://ir.ozone.ru/s3/multimedia-1-h/wc1000/7768091429.jpg', rating=4.9, categories='{Аптека,"Товары для гигиены","Презервативы и лубриканты",Презервативы,Masculan}', prices=[Price(id=54, product_id='247385222', with_card=859, without_card=963, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 9, 47, 40, 77269)), Price(id=59, product_id='247385222', with_card=859, without_card=963, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 10, 2, 15, 461112)), Price(id=65, product_id='247385222', with_card=857, without_card=961, previous_with_card=859, previous_without_card=963, created_at=datetime.datetime(2025, 10, 5, 12, 51, 47, 914591))]) (ID: 247385222)
2025-10-07 16:14:52,489 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='612659680', user_id='', name='Паста Арахисовая DopDrops Хрустящая Кранч без добавок, 1000 г', link='https://www.ozon.ru/product/pasta-arahisovaya-dopdrops-hrustyashchaya-kranch-bez-dobavok-1000-g-612659680/?abt_att=1&origin_referer=www.ozon.ru', image_url='https://ir.ozone.ru/s3/multimedia-s/wc1000/6381771856.jpg', rating=4.9, categories='{"Продукты питания","Выпечка и сладости","Шоколадная и ореховая пасты",DopDrops}', prices=[Price(id=66, product_id='612659680', with_card=519, without_card=577, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 18, 59, 48, 574116))]) (ID: 612659680)
2025-10-07 16:14:52,502 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='177655422', user_id='', name='Сироп Pinch& Drop Груша конференция для кофе, коктейлей, лимонада, мороженого и десертов, стекло, 1л.', link='https://www.ozon.ru/product/sirop-pinch-drop-grusha-konferentsiya-dlya-kofe-kokteyley-limonada-morozhenogo-i-desertov-steklo-1l-177655422/', image_url='https://ir.ozone.ru/s3/multimedia-1-b/wc1000/7506436547.jpg', rating=4.9, categories='{"Продукты питания","Масла, соусы и специи","Сиропы и топпинги",Pinch&Drop}', prices=[Price(id=67, product_id='177655422', with_card=384, without_card=429, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 5, 19, 0, 42, 139808))]) (ID: 177655422)
2025-10-07 16:14:52,516 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1522830591', user_id='', name='Кроссовки adidas Ozweego', link='https://www.ozon.ru/product/krossovki-adidas-ozweego-1522830591/', image_url='https://ir.ozone.ru/s3/multimedia-1-f/wc1000/6983994939.jpg', rating=4.8, categories='{Обувь,Мужчинам,"Кеды, кроссовки и слипоны",adidas}', prices=[Price(id=68, product_id='1522830591', with_card=6179, without_card=6735, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 6, 15, 14, 33, 987205))]) (ID: 1522830591)
2025-10-07 16:14:52,524 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-07 16:14:52,526 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 16:14:52,527 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:14:52,527 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:14:52,776 - aiogram.event - INFO - Update id=557185454 is handled. Duration 592 ms by bot id=5702092394
2025-10-07 16:14:54,376 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:14:54,396 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418)), Price(id=73, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 8, 2, 204934))]) (ID: 1818184981)
2025-10-07 16:14:54,412 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-07 16:14:54,415 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-07 16:14:54,416 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:14:54,417 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:14:54,516 - aiogram.event - INFO - Update id=557185455 is handled. Duration 221 ms by bot id=5702092394
2025-10-07 16:14:55,455 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-07 16:14:55,555 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-07 16:14:55,570 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418)), Price(id=73, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 8, 2, 204934))]) (ID: 1818184981)
2025-10-07 16:14:57,036 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 16:15:07,774 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:15:07,774 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:15:07,877 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 16:15:07,934 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 16:15:07,987 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 16:15:08,036 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 16:15:08,095 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 16:15:08,134 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 16:15:08,246 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 16:15:08,246 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 16:15:10,002 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 16:15:10,012 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418)), Price(id=73, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 8, 2, 204934))]) (ID: 1818184981)
2025-10-07 16:15:11,472 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-07 16:15:22,271 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:15:22,272 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-07 16:15:22,347 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-07 16:15:22,405 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-07 16:15:22,459 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-07 16:15:22,505 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-07 16:15:22,557 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-07 16:15:22,605 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-07 16:15:22,709 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-07 16:15:22,709 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-07 16:15:24,344 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-07 16:15:24,345 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE -> Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 15, 24, 345130))
2025-10-07 16:15:24,346 - src.application.use_cases.upd_product - INFO - DEBUG!!! PRICE.WITH_CARD -> 145
2025-10-07 16:15:24,346 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 15, 24, 345130))
2025-10-07 16:15:24,360 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365)), Price(id=40, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 46, 58, 214687)), Price(id=41, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 12, 50, 33, 507891)), Price(id=42, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 5, 58, 519276)), Price(id=43, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 7, 34, 789338)), Price(id=44, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 10, 38, 757274)), Price(id=45, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 13, 13, 37, 133072)), Price(id=47, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 4, 15, 52, 46, 314004)), Price(id=49, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 16, 39, 794675)), Price(id=56, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 9, 55, 34, 645700)), Price(id=60, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 7, 42, 635926)), Price(id=61, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 8, 54, 790333)), Price(id=62, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 10, 29, 12, 973194)), Price(id=64, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 5, 12, 50, 37, 971527)), Price(id=69, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 44, 50, 584010)), Price(id=70, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 12, 49, 10, 88111)), Price(id=71, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 15, 44, 1, 311735)), Price(id=72, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 5, 51, 994418)), Price(id=73, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 7, 16, 8, 2, 204934))]) (ID: 1818184981)
2025-10-07 16:15:24,365 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-07 16:15:24,388 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:15:24,388 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-07 16:15:24,389 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-07 16:15:24,390 - src.infrastructure.services.logger - INFO - Получены данные товара: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 7, 16, 8, 2, 204934)}
2025-10-07 16:15:24,391 - src.infrastructure.services.logger - INFO - FULL INFO DEBUG!!!! {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161, 'previous_price_with_card': 145, 'previous_price_without_card': 161}, 'created_at': datetime.datetime(2025, 10, 7, 16, 8, 2, 204934)}
2025-10-07 16:15:24,786 - src.infrastructure.services.logger - INFO - ✅ Цена актуальна
2025-10-07 16:15:24,787 - aiogram.event - INFO - Update id=557185456 is handled. Duration 29335 ms by bot id=5702092394
2025-10-07 16:15:42,510 - aiogram.dispatcher - INFO - Polling stopped
2025-10-07 16:15:42,512 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-07 16:15:42,513 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-07 16:15:42,652 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
