2025-09-30 14:03:52,213 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:03:52,476 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:03:52,697 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:04:01,296 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:04:01,642 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:04:02,446 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:04:02,446 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:04:02,447 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:04:02,453 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:04:02,454 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:04:02,455 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:04:02,456 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:04:02,482 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:04:02,502 - aiogram.event - INFO - Update id=557184935 is not handled. Duration 1207 ms by bot id=5702092394
2025-09-30 14:04:02,503 - aiogram.event - ERROR - Cause exception while process update id=557184935 by bot id=5702092394
UnboundLocalError: cannot access local variable 'keyboard' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 23, in command_start_handler
    reply_markup=keyboard
                 ^^^^^^^^
UnboundLocalError: cannot access local variable 'keyboard' where it is not associated with a value
2025-09-30 14:05:05,198 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:05:05,202 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:05:05,202 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:05:05,368 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:05:11,335 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:05:11,742 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:05:11,978 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:05:15,001 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:05:15,104 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:05:15,230 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:05:15,230 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:05:15,230 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:05:15,233 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:05:15,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:05:15,234 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:05:15,235 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:05:15,235 - aiogram.event - INFO - Update id=557184936 is not handled. Duration 234 ms by bot id=5702092394
2025-09-30 14:05:15,236 - aiogram.event - ERROR - Cause exception while process update id=557184936 by bot id=5702092394
ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 21, in command_start_handler
    keyboard = main_manu()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\keyboard\main_menu.py", line 8, in main_manu
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:06:12,561 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:06:12,563 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:06:12,563 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:06:12,736 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:06:17,719 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:06:18,068 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:06:18,248 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:06:20,512 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:06:20,598 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:06:20,788 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:06:20,789 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:06:20,789 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:06:20,791 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:06:20,793 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:06:20,794 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:06:20,794 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:06:20,795 - aiogram.event - INFO - Update id=557184937 is not handled. Duration 283 ms by bot id=5702092394
2025-09-30 14:06:20,796 - aiogram.event - ERROR - Cause exception while process update id=557184937 by bot id=5702092394
ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 21, in command_start_handler
    keyboard = main_menu()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\keyboard\main_menu.py", line 8, in main_menu
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:09:01,569 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:09:01,572 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:09:01,572 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:09:01,732 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:19:16,514 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:19:16,923 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:19:17,208 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:19:26,038 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:19:26,198 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:19:26,716 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:19:26,717 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:19:26,717 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:19:26,721 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:19:26,722 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:19:26,722 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:19:26,723 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:19:26,919 - aiogram.event - INFO - Update id=557184940 is handled. Duration 883 ms by bot id=5702092394
2025-09-30 14:19:29,054 - aiogram.event - INFO - Update id=557184941 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:19:31,198 - aiogram.event - INFO - Update id=557184942 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:19:33,288 - aiogram.event - INFO - Update id=557184943 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:20:03,611 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:20:03,613 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:20:03,614 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:20:03,774 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:20:09,056 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:20:09,433 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:20:09,614 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:20:13,957 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:20:14,106 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:20:14,312 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:20:14,312 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:20:14,313 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:20:14,316 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:20:14,317 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:20:14,318 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:20:14,320 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:20:14,557 - aiogram.event - INFO - Update id=557184944 is handled. Duration 600 ms by bot id=5702092394
2025-09-30 14:20:15,963 - aiogram.event - INFO - Update id=557184945 is handled. Duration 84 ms by bot id=5702092394
2025-09-30 14:20:18,480 - aiogram.event - INFO - Update id=557184946 is handled. Duration 82 ms by bot id=5702092394
2025-09-30 14:20:20,185 - aiogram.event - INFO - Update id=557184947 is handled. Duration 78 ms by bot id=5702092394
2025-09-30 15:49:34,089 - aiogram.event - INFO - Update id=557184948 is not handled. Duration 25 ms by bot id=5702092394
2025-09-30 15:49:37,721 - aiogram.event - INFO - Update id=557184949 is not handled. Duration 1 ms by bot id=5702092394
2025-09-30 16:19:41,348 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 16:19:41,388 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 16:19:41,390 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 16:19:41,492 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:49:32,994 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:49:33,703 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:49:33,964 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:49:56,048 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:49:56,282 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:49:56,791 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:49:56,792 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:49:56,792 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:49:56,799 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:49:56,800 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:49:56,801 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:49:56,802 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:49:57,040 - aiogram.event - INFO - Update id=557184950 is handled. Duration 992 ms by bot id=5702092394
2025-10-01 09:49:59,615 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:50:03,897 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:50:03,907 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:03,908 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:03,909 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:06,037 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:50:06,037 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:06,038 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:06,039 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:50:06,039 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:50:06,040 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:50:06,040 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:06,373 - aiogram.event - INFO - Update id=557184951 is handled. Duration 6759 ms by bot id=5702092394
2025-10-01 09:50:09,137 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:50:10,745 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:50:10,753 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы ➕ Добавить товар: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:10,755 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы ➕ Добавить товар: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:10,757 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:12,523 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:50:12,523 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL ➕ Добавить товар для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:12,524 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:12,525 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:50:12,525 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:50:12,526 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:50:12,526 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:12,717 - aiogram.event - INFO - Update id=557184952 is handled. Duration 3580 ms by bot id=5702092394
2025-10-01 09:51:32,221 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:51:32,224 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:51:32,225 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:51:32,384 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:51:49,927 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:51:50,553 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:51:50,815 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:53:52,318 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:53:52,320 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:53:52,320 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:53:52,493 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:54:01,419 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:54:01,854 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:54:02,050 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:54:04,608 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:54:04,745 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:54:05,594 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:54:05,594 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:54:05,595 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:54:05,602 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:54:05,603 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:54:05,603 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:54:05,604 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:54:05,822 - aiogram.event - INFO - Update id=557184953 is handled. Duration 1213 ms by bot id=5702092394
2025-10-01 09:54:09,284 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:54:10,958 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:54:10,966 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:10,967 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:10,968 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:12,879 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:54:12,880 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:12,882 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:54:12,883 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:54:12,883 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:54:12,884 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:54:12,884 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:54:12,989 - aiogram.event - INFO - Update id=557184954 is handled. Duration 3706 ms by bot id=5702092394
2025-10-01 09:56:02,082 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:56:02,087 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:56:02,089 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:56:02,244 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:56:11,020 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:56:11,402 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:56:11,626 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:56:14,929 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:56:15,026 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:56:15,306 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:56:15,307 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:56:15,307 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:56:15,310 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:56:15,311 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:56:15,311 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:56:15,312 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:56:15,557 - aiogram.event - INFO - Update id=557184955 is handled. Duration 627 ms by bot id=5702092394
2025-10-01 09:56:18,995 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:56:20,700 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:56:20,705 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:20,705 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:20,706 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:22,305 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:56:22,316 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:22,317 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:56:22,317 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:56:22,318 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:56:22,318 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:56:22,319 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:56:22,411 - aiogram.event - INFO - Update id=557184956 is handled. Duration 3415 ms by bot id=5702092394
2025-10-01 10:47:32,422 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 10:47:32,466 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 10:47:32,470 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 10:47:32,564 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 10:52:41,488 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 10:52:41,915 - aiogram.dispatcher - INFO - Start polling
2025-10-01 10:52:42,232 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 10:52:47,762 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 10:52:48,062 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 10:52:48,762 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 10:52:48,764 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 10:52:48,765 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 10:52:48,772 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 10:52:48,775 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 10:52:48,777 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 10:52:48,778 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 10:52:49,052 - aiogram.event - INFO - Update id=557184957 is handled. Duration 1291 ms by bot id=5702092394
2025-10-01 10:52:51,483 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 10:52:57,891 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 10:52:57,917 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:52:57,922 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:52:57,924 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:53:00,799 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 10:53:00,801 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:53:00,803 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 10:53:00,804 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 10:53:00,805 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 10:53:00,806 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 10:53:00,807 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = product_service.create_product(str(message.from_user.id), url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 10:53:01,347 - aiogram.event - INFO - Update id=557184958 is handled. Duration 9864 ms by bot id=5702092394
2025-10-01 13:45:06,169 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 13:45:06,197 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 13:45:06,198 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 13:45:06,305 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:56:20,420 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 13:56:20,421 - aiogram.dispatcher - INFO - Start polling
2025-10-01 13:56:20,694 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:56:30,349 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 13:56:30,526 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 13:56:30,929 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 13:56:30,930 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 13:56:30,930 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 13:56:30,933 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 13:56:30,934 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 13:56:30,935 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 13:56:30,935 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 13:56:31,138 - aiogram.event - INFO - Update id=557184959 is handled. Duration 789 ms by bot id=5702092394
2025-10-01 13:56:32,825 - aiogram.event - INFO - Update id=557184960 is handled. Duration 86 ms by bot id=5702092394
2025-10-01 13:56:38,169 - aiogram.event - INFO - Update id=557184961 is handled. Duration 88 ms by bot id=5702092394
2025-10-01 13:56:39,793 - aiogram.event - INFO - Update id=557184962 is handled. Duration 96 ms by bot id=5702092394
2025-10-01 13:59:51,434 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 13:59:51,436 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 13:59:51,436 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 13:59:51,603 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:59:57,202 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 13:59:57,204 - aiogram.dispatcher - INFO - Start polling
2025-10-01 13:59:57,515 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:00:01,254 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:00:01,389 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:00:01,649 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:00:01,651 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:00:01,651 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:00:01,654 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:01,655 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:01,656 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:00:01,657 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:00:02,053 - aiogram.event - INFO - Update id=557184963 is handled. Duration 799 ms by bot id=5702092394
2025-10-01 14:00:03,802 - aiogram.event - INFO - Update id=557184964 is handled. Duration 186 ms by bot id=5702092394
2025-10-01 14:00:05,703 - aiogram.event - INFO - Update id=557184965 is handled. Duration 208 ms by bot id=5702092394
2025-10-01 14:00:06,248 - aiogram.event - INFO - Update id=557184966 is handled. Duration 143 ms by bot id=5702092394
2025-10-01 14:00:11,309 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:00:11,324 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:00:11,326 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:00:11,326 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:00:11,333 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:11,333 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:11,334 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:00:11,335 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:00:11,511 - aiogram.event - INFO - Update id=557184967 is handled. Duration 202 ms by bot id=5702092394
2025-10-01 14:00:12,900 - aiogram.event - INFO - Update id=557184968 is handled. Duration 192 ms by bot id=5702092394
2025-10-01 14:06:41,635 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:06:41,637 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:06:41,637 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:06:41,804 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:06:46,823 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:06:46,825 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:06:47,042 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:06:57,346 - aiogram.event - INFO - Update id=557184969 is handled. Duration 633 ms by bot id=5702092394
2025-10-01 14:06:59,347 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:06:59,486 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:06:59,598 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:06:59,599 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:06:59,599 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:06:59,601 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:06:59,602 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:06:59,603 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:06:59,603 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:06:59,720 - aiogram.event - INFO - Update id=557184970 is handled. Duration 373 ms by bot id=5702092394
2025-10-01 14:07:01,064 - aiogram.event - INFO - Update id=557184971 is handled. Duration 219 ms by bot id=5702092394
2025-10-01 14:07:09,060 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:07:09,062 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:07:09,063 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:07:09,230 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:18,718 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:07:18,719 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:07:19,001 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:19,077 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:07:19,148 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:07:19,244 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:07:19,245 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:07:19,245 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:07:19,247 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:19,248 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:19,248 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:07:19,248 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:07:19,452 - aiogram.event - INFO - Update id=557184972 is handled. Duration 374 ms by bot id=5702092394
2025-10-01 14:07:21,991 - aiogram.event - INFO - Update id=557184973 is handled. Duration 100 ms by bot id=5702092394
2025-10-01 14:07:24,507 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:07:24,508 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:07:24,509 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:07:24,678 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:36,022 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:07:36,023 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:07:37,680 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:42,368 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:07:42,464 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:07:42,568 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:07:42,568 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:07:42,569 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:07:42,571 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:42,572 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:42,572 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:07:42,573 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:07:42,839 - aiogram.event - INFO - Update id=557184974 is handled. Duration 470 ms by bot id=5702092394
2025-10-01 14:07:44,646 - aiogram.event - INFO - Update id=557184975 is handled. Duration 114 ms by bot id=5702092394
2025-10-01 14:08:00,490 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:08:00,491 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:08:00,492 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:08:00,648 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:08:06,226 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:08:06,227 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:08:06,527 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:08:08,283 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:08:08,370 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:08:08,497 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:08:08,497 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:08:08,498 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:08:08,499 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:08:08,500 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:08:08,501 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:08:08,501 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:08:08,841 - aiogram.event - INFO - Update id=557184976 is handled. Duration 558 ms by bot id=5702092394
2025-10-01 14:08:10,487 - aiogram.event - INFO - Update id=557184977 is handled. Duration 115 ms by bot id=5702092394
2025-10-01 14:08:12,047 - aiogram.event - INFO - Update id=557184978 is handled. Duration 90 ms by bot id=5702092394
2025-10-01 14:08:37,875 - aiogram.event - INFO - Update id=557184979 is handled. Duration 484 ms by bot id=5702092394
2025-10-01 14:10:04,501 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:10:04,504 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:10:04,504 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:10:04,659 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:10:09,753 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:10:09,754 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:10:09,996 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:10:13,064 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:10:13,183 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:10:13,342 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:10:13,343 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:10:13,343 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:10:13,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:10:13,345 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:10:13,345 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:10:13,346 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:10:13,591 - aiogram.event - INFO - Update id=557184980 is handled. Duration 528 ms by bot id=5702092394
2025-10-01 14:10:15,448 - aiogram.event - INFO - Update id=557184981 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:23,196 - aiogram.event - INFO - Update id=557184982 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:24,174 - aiogram.event - INFO - Update id=557184983 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:24,643 - aiogram.event - INFO - Update id=557184984 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:26,039 - aiogram.event - INFO - Update id=557184985 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:26,569 - aiogram.event - INFO - Update id=557184986 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,021 - aiogram.event - INFO - Update id=557184987 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,173 - aiogram.event - INFO - Update id=557184988 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,326 - aiogram.event - INFO - Update id=557184989 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:27,475 - aiogram.event - INFO - Update id=557184990 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:27,621 - aiogram.event - INFO - Update id=557184991 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,754 - aiogram.event - INFO - Update id=557184992 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:04,449 - aiogram.event - INFO - Update id=557184993 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:06,166 - aiogram.event - INFO - Update id=557184994 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:07,247 - aiogram.event - INFO - Update id=557184995 is not handled. Duration 11 ms by bot id=5702092394
2025-10-01 14:11:08,460 - aiogram.event - INFO - Update id=557184996 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:11:09,588 - aiogram.event - INFO - Update id=557184997 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:59,623 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:11:59,624 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:11:59,624 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:11:59,799 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:12:04,722 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:12:04,724 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:12:04,724 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:12:05,028 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:12:12,782 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:12:12,873 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:12:12,979 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:12:12,979 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:12:12,979 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:12:12,981 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:12:12,982 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:12:12,983 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:12:12,984 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:12:13,921 - aiogram.event - INFO - Update id=557184998 is handled. Duration 1139 ms by bot id=5702092394
2025-10-01 14:12:17,531 - aiogram.event - INFO - Update id=557184999 is not handled. Duration 2 ms by bot id=5702092394
2025-10-01 14:15:51,305 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:15:51,308 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:15:51,308 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:15:51,452 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:15:56,526 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:15:56,528 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:15:56,529 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:15:56,745 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:00,019 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:16:00,127 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:16:00,244 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:16:00,245 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:16:00,245 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:16:00,247 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:00,248 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:00,248 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:16:00,249 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:16:01,845 - aiogram.event - INFO - Update id=557185001 is not handled. Duration 12 ms by bot id=5702092394
2025-10-01 14:16:01,895 - aiogram.event - INFO - Update id=557185000 is handled. Duration 1876 ms by bot id=5702092394
2025-10-01 14:16:04,336 - aiogram.event - INFO - Update id=557185002 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:16:05,382 - aiogram.event - INFO - Update id=557185003 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:16:07,990 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:16:07,992 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:16:07,993 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:16:08,150 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:16,420 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:16:16,422 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:16:16,423 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:16:16,605 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:23,009 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:16:23,092 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:16:23,193 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:16:23,194 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:16:23,194 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:16:23,196 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:23,197 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:23,198 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:16:23,198 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:16:23,466 - aiogram.event - INFO - Update id=557185004 is handled. Duration 456 ms by bot id=5702092394
2025-10-01 14:16:25,675 - aiogram.event - INFO - Update id=557185005 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:31:36,200 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:31:36,212 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:31:36,213 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:31:36,381 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:31:42,036 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:31:42,038 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:31:42,327 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:31:48,754 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:31:48,875 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:31:49,002 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:31:49,002 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:31:49,003 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:31:49,005 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:31:49,005 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:31:49,006 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:31:49,007 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:31:49,394 - aiogram.event - INFO - Update id=557185006 is handled. Duration 640 ms by bot id=5702092394
2025-10-01 14:31:51,107 - aiogram.event - INFO - Update id=557185007 is handled. Duration 113 ms by bot id=5702092394
2025-10-01 14:31:53,743 - aiogram.event - INFO - Update id=557185008 is handled. Duration 248 ms by bot id=5702092394
2025-10-01 14:31:54,371 - aiogram.event - INFO - Update id=557185009 is handled. Duration 257 ms by bot id=5702092394
2025-10-01 14:31:55,767 - aiogram.event - INFO - Update id=557185010 is handled. Duration 90 ms by bot id=5702092394
2025-10-01 14:31:56,518 - aiogram.event - INFO - Update id=557185011 is handled. Duration 121 ms by bot id=5702092394
2025-10-01 14:31:57,634 - aiogram.event - INFO - Update id=557185012 is handled. Duration 92 ms by bot id=5702092394
2025-10-01 14:31:58,465 - aiogram.event - INFO - Update id=557185013 is handled. Duration 162 ms by bot id=5702092394
2025-10-01 14:31:59,538 - aiogram.event - INFO - Update id=557185014 is handled. Duration 95 ms by bot id=5702092394
2025-10-01 14:40:41,605 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:40:41,607 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:40:41,608 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:40:41,751 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:40:47,477 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:40:47,479 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:40:47,709 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:40:55,327 - aiogram.event - INFO - Update id=557185015 is handled. Duration 268 ms by bot id=5702092394
2025-10-01 14:40:58,013 - aiogram.event - INFO - Update id=557185016 is handled. Duration 102 ms by bot id=5702092394
2025-10-01 14:40:58,357 - aiogram.event - INFO - Update id=557185017 is handled. Duration 85 ms by bot id=5702092394
2025-10-01 14:40:58,768 - aiogram.event - INFO - Update id=557185018 is handled. Duration 106 ms by bot id=5702092394
2025-10-01 14:40:59,700 - aiogram.event - INFO - Update id=557185019 is handled. Duration 111 ms by bot id=5702092394
2025-10-01 14:41:00,238 - aiogram.event - INFO - Update id=557185020 is handled. Duration 145 ms by bot id=5702092394
2025-10-01 14:41:00,565 - aiogram.event - INFO - Update id=557185021 is handled. Duration 169 ms by bot id=5702092394
2025-10-01 14:42:58,885 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:42:58,887 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:42:58,887 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:42:59,068 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:46:54,532 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:46:54,545 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:46:54,839 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:46:59,589 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:46:59,711 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:46:59,877 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:46:59,877 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:46:59,878 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:46:59,880 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:46:59,881 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:46:59,882 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:46:59,882 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:47:00,188 - aiogram.event - INFO - Update id=557185022 is handled. Duration 599 ms by bot id=5702092394
2025-10-01 14:47:01,810 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:47:01,810 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 14:47:01,862 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 14:47:01,895 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 14:47:01,923 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 14:47:01,928 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 14:47:01,931 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 14:47:01,932 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:47:01,932 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:47:01,933 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 55, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 14:47:02,138 - aiogram.event - INFO - Update id=557185023 is handled. Duration 329 ms by bot id=5702092394
2025-10-01 14:47:07,772 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:47:07,982 - aiogram.event - INFO - Update id=557185024 is handled. Duration 212 ms by bot id=5702092394
2025-10-01 14:48:31,440 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:31,442 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:48:41,627 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:48:56,941 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:56,942 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:57,902 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-01 14:48:58,004 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-01 14:48:58,066 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-01 14:48:58,134 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1568
2025-10-01 14:48:58,202 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1705
2025-10-01 14:48:58,243 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-01 14:48:58,435 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-01 14:49:00,996 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:49:00,997 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1568, 'price_without_card': 1705, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-01 14:49:01,004 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 1668950019 не найден
2025-10-01 14:49:01,011 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:49:01,014 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='1668950019', user_id='515084006', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories=['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX'], prices=[Price(id=None, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))])
2025-10-01 14:49:01,018 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))
2025-10-01 14:49:01,019 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 1668950019 пользователю ID 515084006
2025-10-01 14:49:01,021 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-01 14:49:01,133 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:49:01,134 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:49:01,134 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:49:01,135 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 35, in add_product_process
    reply_markup=build_product_actions_keyboard(result['id'], result['link'])
                                                ~~~~~~^^^^^^
KeyError: 'id'
2025-10-01 14:49:01,389 - aiogram.event - INFO - Update id=557185025 is handled. Duration 29954 ms by bot id=5702092394
2025-10-01 14:50:20,486 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:50:20,487 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:50:20,488 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:50:20,647 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:50:29,353 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:50:29,355 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:50:29,952 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:50:33,251 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:50:33,411 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:50:33,636 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:50:33,636 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:50:33,637 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:50:33,642 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:50:33,643 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:50:33,644 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:50:33,645 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:50:34,138 - aiogram.event - INFO - Update id=557185026 is handled. Duration 887 ms by bot id=5702092394
2025-10-01 14:50:35,301 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:50:35,469 - aiogram.event - INFO - Update id=557185027 is handled. Duration 169 ms by bot id=5702092394
2025-10-01 14:50:37,717 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:50:37,718 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:50:39,403 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:50:54,172 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:50:54,172 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:51:05,752 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-01 14:51:05,797 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-01 14:51:05,845 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-01 14:51:05,917 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1568
2025-10-01 14:51:05,973 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1705
2025-10-01 14:51:06,011 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-01 14:51:06,151 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-01 14:51:08,955 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:51:08,956 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1568, 'price_without_card': 1705, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-01 14:51:08,983 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 14:51:08,984 - src.application.use_cases.create_product - ERROR - Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,984 - src.core.uow - WARNING - Исключение в Unit of Work: ProductCreationError: Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,988 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 14:51:08,989 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:51:08,989 - src.core.decorators - ERROR - Ошибка в функции create_product: Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,990 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 29, in add_product_process
    result = product_service.create_product(str(message.from_user.id), url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 41, in execute
    raise ProductCreationError(f'Товар с ID {product_data['id']} уже существует')
src.domain.exceptions.ProductCreationError: Товар с ID 1668950019 уже существует
2025-10-01 14:51:09,364 - aiogram.event - INFO - Update id=557185028 is handled. Duration 31649 ms by bot id=5702092394
2025-10-01 14:51:26,939 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:51:26,975 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:51:26,976 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:51:26,977 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:51:26,984 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:51:26,985 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:51:26,986 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:51:26,987 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:51:27,084 - aiogram.event - INFO - Update id=557185029 is handled. Duration 145 ms by bot id=5702092394
2025-10-01 14:51:27,942 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:51:28,175 - aiogram.event - INFO - Update id=557185030 is handled. Duration 235 ms by bot id=5702092394
2025-10-01 14:51:30,687 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:51:30,687 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:51:32,224 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:51:47,650 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:51:47,650 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:52:22,082 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1565602444
2025-10-01 14:52:22,120 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Ray-Ban Очки солнцезащитные
2025-10-01 14:52:22,164 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.7
2025-10-01 14:52:22,210 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 737
2025-10-01 14:52:22,254 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 805
2025-10-01 14:52:22,289 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg
2025-10-01 14:52:22,440 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']
2025-10-01 14:52:24,109 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:52:24,110 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/: {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'rating': 4.7, 'price_with_card': 737, 'price_without_card': 805, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'categories': ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']}
2025-10-01 14:52:24,118 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 1565602444 не найден
2025-10-01 14:52:24,125 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:52:24,129 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='1565602444', user_id='515084006', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories=['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban'], prices=[Price(id=None, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))])
2025-10-01 14:52:24,135 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))
2025-10-01 14:52:24,136 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 1565602444 пользователю ID 515084006
2025-10-01 14:52:24,136 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-01 14:52:24,175 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:52:24,176 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:52:24,177 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:52:24,179 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 35, in add_product_process
    reply_markup=build_product_actions_keyboard(result['product_id'], result['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 14:52:24,694 - aiogram.event - INFO - Update id=557185031 is handled. Duration 54008 ms by bot id=5702092394
2025-10-01 16:10:20,384 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:10:20,411 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:10:20,414 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:10:20,522 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:10:29,073 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:10:29,075 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:10:29,331 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:10:34,883 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:10:35,032 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:10:35,341 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:10:35,342 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:10:35,342 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:10:35,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:35,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:35,345 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:10:35,345 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:10:36,785 - aiogram.event - INFO - Update id=557185032 is handled. Duration 1903 ms by bot id=5702092394
2025-10-01 16:10:37,915 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:10:37,916 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:10:37,957 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:10:37,978 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:10:37,996 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:10:38,007 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:10:38,021 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:10:38,026 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:10:38,029 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:10:38,030 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:38,031 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:10:38,032 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:10:38,158 - aiogram.event - INFO - Update id=557185033 is handled. Duration 244 ms by bot id=5702092394
2025-10-01 16:12:59,272 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:12:59,274 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:12:59,274 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:12:59,423 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:13:04,785 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:13:04,787 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:13:07,716 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:13:08,072 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:13:08,155 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:13:08,231 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:13:08,232 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:13:08,232 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:13:08,235 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:13:08,534 - aiogram.event - INFO - Update id=557185034 is handled. Duration 462 ms by bot id=5702092394
2025-10-01 16:13:11,686 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:13:11,687 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:13:11,729 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:13:11,756 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:13:11,782 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:13:11,802 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:13:11,824 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:13:11,829 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:13:11,839 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:13:11,840 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:11,841 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:13:11,842 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:13:12,296 - aiogram.event - INFO - Update id=557185035 is handled. Duration 612 ms by bot id=5702092394
2025-10-01 16:13:53,153 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:13:53,154 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:13:53,155 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:13:53,322 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:14:00,260 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:14:00,261 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:14:01,595 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:14:05,043 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:14:05,144 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:14:05,237 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:14:05,238 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:14:05,238 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:14:05,240 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:05,241 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:05,241 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:14:05,242 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:14:06,784 - aiogram.event - INFO - Update id=557185036 is handled. Duration 1741 ms by bot id=5702092394
2025-10-01 16:14:08,398 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:14:08,399 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:14:08,426 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:14:08,438 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:14:08,461 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:14:08,475 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:14:08,486 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:14:08,490 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:14:08,493 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:14:08,493 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:08,494 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:14:08,495 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:14:08,626 - aiogram.event - INFO - Update id=557185037 is handled. Duration 230 ms by bot id=5702092394
2025-10-01 16:17:10,998 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:17:11,001 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:17:11,001 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:17:11,157 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:16,053 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:17:16,055 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:17:16,344 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:19,789 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:17:19,892 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:19,970 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:17:19,971 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:17:19,971 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:17:19,973 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:19,973 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:19,974 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:19,974 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:17:20,226 - aiogram.event - INFO - Update id=557185038 is handled. Duration 436 ms by bot id=5702092394
2025-10-01 16:17:21,161 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:21,162 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:17:21,191 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:17:21,209 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:17:21,227 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:17:21,241 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:17:21,249 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:17:21,254 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:17:21,257 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:17:21,258 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:21,258 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:21,259 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:17:21,389 - aiogram.event - INFO - Update id=557185039 is handled. Duration 229 ms by bot id=5702092394
2025-10-01 16:17:29,244 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:17:29,246 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:17:29,246 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:17:29,409 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:35,297 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:17:35,299 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:17:36,886 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:40,537 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:17:40,605 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:40,691 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:17:40,691 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:17:40,692 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:17:40,693 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:40,694 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:40,694 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:40,694 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:17:40,959 - aiogram.event - INFO - Update id=557185040 is handled. Duration 422 ms by bot id=5702092394
2025-10-01 16:17:43,124 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:43,125 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:17:43,149 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:17:43,163 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:17:43,199 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:17:43,212 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:17:43,224 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:17:43,227 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:17:43,230 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:17:43,231 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:43,231 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:43,232 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:17:43,359 - aiogram.event - INFO - Update id=557185041 is handled. Duration 235 ms by bot id=5702092394
2025-10-01 16:19:18,115 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:19:18,118 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:19:18,119 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:19:18,271 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:24,675 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:19:24,678 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:19:24,919 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:27,896 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:19:27,984 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:19:28,038 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:19:28,039 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:19:28,039 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:19:28,040 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:28,041 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:28,041 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:19:28,041 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:19:28,250 - aiogram.event - INFO - Update id=557185042 is handled. Duration 353 ms by bot id=5702092394
2025-10-01 16:19:29,365 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:19:29,365 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:19:29,391 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:19:29,414 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:19:29,431 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:19:29,451 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:19:29,463 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:19:29,467 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:19:29,469 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:19:29,470 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:29,470 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:19:29,470 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 104, in get_my_product_list
    inline_buttons.add(InlineKeyboardButton(text=display, callback_data=f"product:{p['id']}"))
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'add'
2025-10-01 16:19:29,579 - aiogram.event - INFO - Update id=557185043 is handled. Duration 216 ms by bot id=5702092394
2025-10-01 16:19:49,729 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:19:49,732 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:19:49,732 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:19:49,860 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:54,479 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:19:54,481 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:19:54,724 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:20:00,600 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:20:00,719 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:20:00,719 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:20:00,796 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:20:00,806 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:20:00,817 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:20:00,828 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:20:00,839 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:20:00,843 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:20:00,846 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:20:00,846 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:20:00,847 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:20:01,049 - aiogram.event - INFO - Update id=557185044 is handled. Duration 451 ms by bot id=5702092394
2025-10-01 16:20:04,623 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:20:04,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:20:04,636 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:20:04,638 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:20:04,638 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:20:04,639 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:20:04,639 - src.infrastructure.services.logger - ERROR - Ошибка в handle_product_button
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:20:04,719 - aiogram.event - INFO - Update id=557185045 is not handled. Duration 170 ms by bot id=5702092394
2025-10-01 16:20:04,720 - aiogram.event - ERROR - Cause exception while process update id=557185045 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 159, in handle_product_button
    await call.answer(f'Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:21:57,755 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:21:57,757 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:21:57,757 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:21:57,921 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:03,557 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:22:03,560 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:22:04,436 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:07,117 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:22:07,198 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:07,276 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:22:07,277 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:22:07,277 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:22:07,279 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:07,280 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:07,281 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:07,281 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:22:07,542 - aiogram.event - INFO - Update id=557185046 is handled. Duration 424 ms by bot id=5702092394
2025-10-01 16:22:08,717 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:08,718 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:22:08,742 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:22:08,756 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:22:08,769 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:22:08,783 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:22:08,799 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:22:08,804 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:22:08,806 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:22:08,806 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:08,807 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:08,809 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:22:08,970 - aiogram.event - INFO - Update id=557185047 is not handled. Duration 254 ms by bot id=5702092394
2025-10-01 16:22:08,971 - aiogram.event - ERROR - Cause exception while process update id=557185047 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: message is too long
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 114, in get_my_product_list
    await message.answer(f'❌ Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is too long
2025-10-01 16:22:18,863 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:22:18,865 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:22:18,866 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:22:19,034 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:25,320 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:22:25,323 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:22:25,565 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:28,671 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:22:28,749 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:28,810 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:22:28,810 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:22:28,811 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:22:28,812 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:28,813 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:28,813 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:28,814 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:22:29,069 - aiogram.event - INFO - Update id=557185048 is handled. Duration 398 ms by bot id=5702092394
2025-10-01 16:22:30,420 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:30,421 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:22:30,453 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:22:30,474 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:22:30,490 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:22:30,506 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:22:30,521 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:22:30,525 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:22:30,528 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:22:30,529 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:30,530 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:30,531 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:22:30,660 - aiogram.event - INFO - Update id=557185049 is not handled. Duration 241 ms by bot id=5702092394
2025-10-01 16:22:30,660 - aiogram.event - ERROR - Cause exception while process update id=557185049 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: message is too long
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 114, in get_my_product_list
    await message.answer(f'❌ Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is too long
2025-10-01 16:22:54,971 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:22:54,972 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:22:54,972 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:22:55,147 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:23:01,808 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:23:01,810 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:23:02,033 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:23:04,798 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:23:04,934 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:23:04,935 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:23:05,025 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:23:05,038 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:23:05,051 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:23:05,068 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:23:05,083 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:23:05,089 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:23:05,091 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:23:05,092 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:23:05,092 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:23:05,618 - aiogram.event - INFO - Update id=557185050 is handled. Duration 826 ms by bot id=5702092394
2025-10-01 16:24:04,757 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:24:04,770 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:24:04,774 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:24:04,776 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:24:04,777 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:24:04,777 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:24:04,778 - src.infrastructure.services.logger - ERROR - Ошибка в handle_product_button
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:24:04,866 - aiogram.event - INFO - Update id=557185051 is not handled. Duration 193 ms by bot id=5702092394
2025-10-01 16:24:04,866 - aiogram.event - ERROR - Cause exception while process update id=557185051 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 159, in handle_product_button
    await call.answer(f'Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:25:51,011 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:25:51,015 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:25:51,015 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:25:51,276 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:25:57,951 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:25:57,953 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:26:00,461 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:26:02,250 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:26:02,336 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:26:02,394 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:26:02,394 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:26:02,394 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:26:02,396 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:02,396 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:02,397 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:26:02,397 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:26:02,648 - aiogram.event - INFO - Update id=557185052 is handled. Duration 398 ms by bot id=5702092394
2025-10-01 16:26:04,286 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:26:04,286 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:26:04,305 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:26:04,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:26:04,351 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:26:04,364 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:26:04,372 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:26:04,376 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:26:04,378 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:26:04,379 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:04,379 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:26:04,380 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 105, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=[[inline_buttons]])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:26:04,544 - aiogram.event - INFO - Update id=557185053 is handled. Duration 258 ms by bot id=5702092394
2025-10-01 16:27:47,151 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:27:47,153 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:27:47,154 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:27:47,322 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:53:41,975 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:53:41,978 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:53:42,246 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:53:46,455 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:53:46,640 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:46,944 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:53:46,945 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:53:46,946 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:53:46,947 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:46,948 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:46,949 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:46,949 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:53:47,752 - aiogram.event - INFO - Update id=557185060 is handled. Duration 1298 ms by bot id=5702092394
2025-10-01 16:53:48,172 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:48,174 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:53:48,206 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:48,226 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:53:48,249 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:53:48,270 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:53:48,284 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:53:48,288 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:53:48,290 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:48,291 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:48,291 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:48,388 - aiogram.event - INFO - Update id=557185061 is handled. Duration 216 ms by bot id=5702092394
2025-10-01 16:53:49,806 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:49,816 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:49,819 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:53:49,821 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:49,822 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:49,822 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:50,011 - aiogram.event - INFO - Update id=557185062 is handled. Duration 322 ms by bot id=5702092394
2025-10-01 16:53:57,128 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:57,129 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:53:57,156 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:57,173 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:53:57,188 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:53:57,205 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:53:57,223 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:53:57,234 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:53:57,237 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:57,238 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:57,239 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:57,239 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-01 16:53:57,388 - aiogram.event - INFO - Update id=557185063 is not handled. Duration 380 ms by bot id=5702092394
2025-10-01 16:53:57,389 - aiogram.event - ERROR - Cause exception while process update id=557185063 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:54:32,844 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:54:32,848 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:54:32,849 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:54:33,013 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:54:41,014 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:54:41,018 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:54:41,225 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:54:50,703 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:54:50,817 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:50,927 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:54:50,927 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:54:50,928 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:54:50,929 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:50,930 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:50,930 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:50,931 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:54:51,186 - aiogram.event - INFO - Update id=557185064 is handled. Duration 482 ms by bot id=5702092394
2025-10-01 16:54:52,946 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:52,946 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:54:52,970 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:54:52,995 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:54:53,012 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:54:53,029 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:54:53,047 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:54:53,053 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:54:53,055 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:54:53,056 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:53,056 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:53,155 - aiogram.event - INFO - Update id=557185065 is handled. Duration 210 ms by bot id=5702092394
2025-10-01 16:54:56,162 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:56,175 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:54:56,180 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:54:56,183 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:54:56,184 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:56,184 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:56,385 - aiogram.event - INFO - Update id=557185066 is handled. Duration 429 ms by bot id=5702092394
2025-10-01 16:55:58,004 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:55:58,008 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:55:58,008 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:55:58,141 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
