2025-09-30 14:03:52,213 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:03:52,476 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:03:52,697 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:04:01,296 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:04:01,642 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:04:02,446 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:04:02,446 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:04:02,447 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:04:02,453 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:04:02,454 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:04:02,455 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:04:02,456 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:04:02,482 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:04:02,502 - aiogram.event - INFO - Update id=557184935 is not handled. Duration 1207 ms by bot id=5702092394
2025-09-30 14:04:02,503 - aiogram.event - ERROR - Cause exception while process update id=557184935 by bot id=5702092394
UnboundLocalError: cannot access local variable 'keyboard' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 23, in command_start_handler
    reply_markup=keyboard
                 ^^^^^^^^
UnboundLocalError: cannot access local variable 'keyboard' where it is not associated with a value
2025-09-30 14:05:05,198 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:05:05,202 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:05:05,202 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:05:05,368 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:05:11,335 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:05:11,742 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:05:11,978 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:05:15,001 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:05:15,104 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:05:15,230 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:05:15,230 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:05:15,230 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:05:15,233 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:05:15,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:05:15,234 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:05:15,235 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:05:15,235 - aiogram.event - INFO - Update id=557184936 is not handled. Duration 234 ms by bot id=5702092394
2025-09-30 14:05:15,236 - aiogram.event - ERROR - Cause exception while process update id=557184936 by bot id=5702092394
ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 21, in command_start_handler
    keyboard = main_manu()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\keyboard\main_menu.py", line 8, in main_manu
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:06:12,561 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:06:12,563 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:06:12,563 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:06:12,736 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:06:17,719 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:06:18,068 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:06:18,248 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:06:20,512 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:06:20,598 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:06:20,788 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:06:20,789 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:06:20,789 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:06:20,791 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:06:20,793 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:06:20,794 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:06:20,794 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:06:20,795 - aiogram.event - INFO - Update id=557184937 is not handled. Duration 283 ms by bot id=5702092394
2025-09-30 14:06:20,796 - aiogram.event - ERROR - Cause exception while process update id=557184937 by bot id=5702092394
ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\start.py", line 21, in command_start_handler
    keyboard = main_menu()
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\keyboard\main_menu.py", line 8, in main_menu
    kb = ReplyKeyboardMarkup(resize_keyboard=True)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for ReplyKeyboardMarkup
keyboard
  Field required [type=missing, input_value={'resize_keyboard': True}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-09-30 14:09:01,569 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:09:01,572 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:09:01,572 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:09:01,732 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:19:16,514 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:19:16,923 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:19:17,208 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:19:26,038 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:19:26,198 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:19:26,716 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:19:26,717 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:19:26,717 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:19:26,721 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:19:26,722 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:19:26,722 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:19:26,723 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:19:26,919 - aiogram.event - INFO - Update id=557184940 is handled. Duration 883 ms by bot id=5702092394
2025-09-30 14:19:29,054 - aiogram.event - INFO - Update id=557184941 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:19:31,198 - aiogram.event - INFO - Update id=557184942 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:19:33,288 - aiogram.event - INFO - Update id=557184943 is not handled. Duration 0 ms by bot id=5702092394
2025-09-30 14:20:03,611 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 14:20:03,613 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 14:20:03,614 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 14:20:03,774 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:20:09,056 - src.infrastructure.services.logger - INFO - Бот запущен
2025-09-30 14:20:09,433 - aiogram.dispatcher - INFO - Start polling
2025-09-30 14:20:09,614 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-09-30 14:20:13,957 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-09-30 14:20:14,106 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-09-30 14:20:14,312 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-09-30 14:20:14,312 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-09-30 14:20:14,313 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-09-30 14:20:14,316 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:20:14,317 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-09-30 14:20:14,318 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-09-30 14:20:14,320 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-09-30 14:20:14,557 - aiogram.event - INFO - Update id=557184944 is handled. Duration 600 ms by bot id=5702092394
2025-09-30 14:20:15,963 - aiogram.event - INFO - Update id=557184945 is handled. Duration 84 ms by bot id=5702092394
2025-09-30 14:20:18,480 - aiogram.event - INFO - Update id=557184946 is handled. Duration 82 ms by bot id=5702092394
2025-09-30 14:20:20,185 - aiogram.event - INFO - Update id=557184947 is handled. Duration 78 ms by bot id=5702092394
2025-09-30 15:49:34,089 - aiogram.event - INFO - Update id=557184948 is not handled. Duration 25 ms by bot id=5702092394
2025-09-30 15:49:37,721 - aiogram.event - INFO - Update id=557184949 is not handled. Duration 1 ms by bot id=5702092394
2025-09-30 16:19:41,348 - aiogram.dispatcher - INFO - Polling stopped
2025-09-30 16:19:41,388 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-09-30 16:19:41,390 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-09-30 16:19:41,492 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:49:32,994 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:49:33,703 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:49:33,964 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:49:56,048 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:49:56,282 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:49:56,791 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:49:56,792 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:49:56,792 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:49:56,799 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:49:56,800 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:49:56,801 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:49:56,802 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:49:57,040 - aiogram.event - INFO - Update id=557184950 is handled. Duration 992 ms by bot id=5702092394
2025-10-01 09:49:59,615 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:50:03,897 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:50:03,907 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:03,908 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:03,909 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:06,037 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:50:06,037 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:06,038 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:06,039 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:50:06,039 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:50:06,040 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:50:06,040 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:06,373 - aiogram.event - INFO - Update id=557184951 is handled. Duration 6759 ms by bot id=5702092394
2025-10-01 09:50:09,137 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:50:10,745 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:50:10,753 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы ➕ Добавить товар: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:10,755 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы ➕ Добавить товар: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:10,757 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:12,523 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:50:12,523 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL ➕ Добавить товар для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:50:12,524 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:12,525 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:50:12,525 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:50:12,526 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:50:12,526 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff7ae3a1eb5+80197]
	GetHandleVerifier [0x0x7ff7ae3a1f10+80288]
	(No symbol) [0x0x7ff7ae12011c]
	(No symbol) [0x0x7ff7ae10ce39]
	(No symbol) [0x0x7ff7ae10b19d]
	(No symbol) [0x0x7ff7ae10b87c]
	(No symbol) [0x0x7ff7ae1243ca]
	(No symbol) [0x0x7ff7ae1c95de]
	(No symbol) [0x0x7ff7ae1a037a]
	(No symbol) [0x0x7ff7ae1c87fb]
	(No symbol) [0x0x7ff7ae1a0153]
	(No symbol) [0x0x7ff7ae168b02]
	(No symbol) [0x0x7ff7ae1698d3]
	GetHandleVerifier [0x0x7ff7ae65e83d+2949837]
	GetHandleVerifier [0x0x7ff7ae658c6a+2926330]
	GetHandleVerifier [0x0x7ff7ae6786c7+3055959]
	GetHandleVerifier [0x0x7ff7ae3bcfee+191102]
	GetHandleVerifier [0x0x7ff7ae3c50af+224063]
	GetHandleVerifier [0x0x7ff7ae3aaf64+117236]
	GetHandleVerifier [0x0x7ff7ae3ab119+117673]
	GetHandleVerifier [0x0x7ff7ae3910a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:50:12,717 - aiogram.event - INFO - Update id=557184952 is handled. Duration 3580 ms by bot id=5702092394
2025-10-01 09:51:32,221 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:51:32,224 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:51:32,225 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:51:32,384 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:51:49,927 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:51:50,553 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:51:50,815 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:53:52,318 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:53:52,320 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:53:52,320 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:53:52,493 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:54:01,419 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:54:01,854 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:54:02,050 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:54:04,608 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:54:04,745 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:54:05,594 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:54:05,594 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:54:05,595 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:54:05,602 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:54:05,603 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:54:05,603 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:54:05,604 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:54:05,822 - aiogram.event - INFO - Update id=557184953 is handled. Duration 1213 ms by bot id=5702092394
2025-10-01 09:54:09,284 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:54:10,958 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:54:10,966 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:10,967 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:10,968 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:12,879 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:54:12,880 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:54:12,882 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:54:12,883 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:54:12,883 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:54:12,884 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:54:12,884 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:54:12,989 - aiogram.event - INFO - Update id=557184954 is handled. Duration 3706 ms by bot id=5702092394
2025-10-01 09:56:02,082 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 09:56:02,087 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 09:56:02,089 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 09:56:02,244 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:56:11,020 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 09:56:11,402 - aiogram.dispatcher - INFO - Start polling
2025-10-01 09:56:11,626 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 09:56:14,929 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 09:56:15,026 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:56:15,306 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 09:56:15,307 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 09:56:15,307 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 09:56:15,310 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:56:15,311 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 09:56:15,311 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:56:15,312 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 09:56:15,557 - aiogram.event - INFO - Update id=557184955 is handled. Duration 627 ms by bot id=5702092394
2025-10-01 09:56:18,995 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 09:56:20,700 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 09:56:20,705 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:20,705 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:20,706 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:22,305 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 09:56:22,316 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 09:56:22,317 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 09:56:22,317 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 09:56:22,318 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 09:56:22,318 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 09:56:22,319 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff76e9d1eb5+80197]
	GetHandleVerifier [0x0x7ff76e9d1f10+80288]
	(No symbol) [0x0x7ff76e75011c]
	(No symbol) [0x0x7ff76e73ce39]
	(No symbol) [0x0x7ff76e73b19d]
	(No symbol) [0x0x7ff76e73b87c]
	(No symbol) [0x0x7ff76e7543ca]
	(No symbol) [0x0x7ff76e7f95de]
	(No symbol) [0x0x7ff76e7d037a]
	(No symbol) [0x0x7ff76e7f87fb]
	(No symbol) [0x0x7ff76e7d0153]
	(No symbol) [0x0x7ff76e798b02]
	(No symbol) [0x0x7ff76e7998d3]
	GetHandleVerifier [0x0x7ff76ec8e83d+2949837]
	GetHandleVerifier [0x0x7ff76ec88c6a+2926330]
	GetHandleVerifier [0x0x7ff76eca86c7+3055959]
	GetHandleVerifier [0x0x7ff76e9ecfee+191102]
	GetHandleVerifier [0x0x7ff76e9f50af+224063]
	GetHandleVerifier [0x0x7ff76e9daf64+117236]
	GetHandleVerifier [0x0x7ff76e9db119+117673]
	GetHandleVerifier [0x0x7ff76e9c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = await product_service.create_product(str(message.from_user.id), url)
                   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 09:56:22,411 - aiogram.event - INFO - Update id=557184956 is handled. Duration 3415 ms by bot id=5702092394
2025-10-01 10:47:32,422 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 10:47:32,466 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 10:47:32,470 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 10:47:32,564 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 10:52:41,488 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 10:52:41,915 - aiogram.dispatcher - INFO - Start polling
2025-10-01 10:52:42,232 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 10:52:47,762 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 10:52:48,062 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 10:52:48,762 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 10:52:48,764 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 10:52:48,765 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 10:52:48,772 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 10:52:48,775 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 10:52:48,777 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 10:52:48,778 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 10:52:49,052 - aiogram.event - INFO - Update id=557184957 is handled. Duration 1291 ms by bot id=5702092394
2025-10-01 10:52:51,483 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 10:52:57,891 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 10:52:57,917 - src.infrastructure.parsers.session_engine - ERROR - Ошибка при загрузке страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:52:57,922 - src.infrastructure.parsers.ozon_parser - ERROR - Ошибка при парсинге страницы 📋 Мои товары: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:52:57,924 - src.infrastructure.parsers.session_decorator - ERROR - Ошибка в декорируемой функции: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:53:00,799 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 10:53:00,801 - src.application.use_cases.create_product - ERROR - Ошибка парсинга URL 📋 Мои товары для пользователя 515084006: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]

2025-10-01 10:53:00,803 - src.core.uow - WARNING - Исключение в Unit of Work: ParserProductError: Ошибка парсинга товара
2025-10-01 10:53:00,804 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 10:53:00,805 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 10:53:00,806 - src.core.decorators - ERROR - Ошибка в функции create_product: Ошибка парсинга товара
2025-10-01 10:53:00,807 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 32, in execute
    product_data = self.parser.parse_product(url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_decorator.py", line 35, in wrapper
    result = func(self, session, *args, **kwargs)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\ozon_parser.py", line 28, in parse_product
    session.navigate(url)
    ~~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\parsers\session_engine.py", line 84, in navigate
    self.driver.get(url)
    ~~~~~~~~~~~~~~~^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 483, in get
    self.execute(Command.GET, {"url": url})
    ~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\webdriver.py", line 458, in execute
    self.error_handler.check_response(response)
    ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\selenium\webdriver\remote\errorhandler.py", line 232, in check_response
    raise exception_class(message, screen, stacktrace)
selenium.common.exceptions.InvalidArgumentException: Message: invalid argument
  (Session info: chrome=140.0.7339.208)
Stacktrace:
	GetHandleVerifier [0x0x7ff71a1d1eb5+80197]
	GetHandleVerifier [0x0x7ff71a1d1f10+80288]
	(No symbol) [0x0x7ff719f5011c]
	(No symbol) [0x0x7ff719f3ce39]
	(No symbol) [0x0x7ff719f3b19d]
	(No symbol) [0x0x7ff719f3b87c]
	(No symbol) [0x0x7ff719f543ca]
	(No symbol) [0x0x7ff719ff95de]
	(No symbol) [0x0x7ff719fd037a]
	(No symbol) [0x0x7ff719ff87fb]
	(No symbol) [0x0x7ff719fd0153]
	(No symbol) [0x0x7ff719f98b02]
	(No symbol) [0x0x7ff719f998d3]
	GetHandleVerifier [0x0x7ff71a48e83d+2949837]
	GetHandleVerifier [0x0x7ff71a488c6a+2926330]
	GetHandleVerifier [0x0x7ff71a4a86c7+3055959]
	GetHandleVerifier [0x0x7ff71a1ecfee+191102]
	GetHandleVerifier [0x0x7ff71a1f50af+224063]
	GetHandleVerifier [0x0x7ff71a1daf64+117236]
	GetHandleVerifier [0x0x7ff71a1db119+117673]
	GetHandleVerifier [0x0x7ff71a1c10a8+11064]
	BaseThreadInitThunk [0x0x7ff918dce8d7+23]
	RtlUserThreadStart [0x0x7ff91a548d9c+44]


During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 23, in add_product_process
    result = product_service.create_product(str(message.from_user.id), url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 36, in execute
    raise ParserProductError('Ошибка парсинга товара')
src.domain.exceptions.ParserProductError: Ошибка парсинга товара
2025-10-01 10:53:01,347 - aiogram.event - INFO - Update id=557184958 is handled. Duration 9864 ms by bot id=5702092394
2025-10-01 13:45:06,169 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 13:45:06,197 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 13:45:06,198 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 13:45:06,305 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:56:20,420 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 13:56:20,421 - aiogram.dispatcher - INFO - Start polling
2025-10-01 13:56:20,694 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:56:30,349 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 13:56:30,526 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 13:56:30,929 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 13:56:30,930 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 13:56:30,930 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 13:56:30,933 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 13:56:30,934 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 13:56:30,935 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 13:56:30,935 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 13:56:31,138 - aiogram.event - INFO - Update id=557184959 is handled. Duration 789 ms by bot id=5702092394
2025-10-01 13:56:32,825 - aiogram.event - INFO - Update id=557184960 is handled. Duration 86 ms by bot id=5702092394
2025-10-01 13:56:38,169 - aiogram.event - INFO - Update id=557184961 is handled. Duration 88 ms by bot id=5702092394
2025-10-01 13:56:39,793 - aiogram.event - INFO - Update id=557184962 is handled. Duration 96 ms by bot id=5702092394
2025-10-01 13:59:51,434 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 13:59:51,436 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 13:59:51,436 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 13:59:51,603 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 13:59:57,202 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 13:59:57,204 - aiogram.dispatcher - INFO - Start polling
2025-10-01 13:59:57,515 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:00:01,254 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:00:01,389 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:00:01,649 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:00:01,651 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:00:01,651 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:00:01,654 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:01,655 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:01,656 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:00:01,657 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:00:02,053 - aiogram.event - INFO - Update id=557184963 is handled. Duration 799 ms by bot id=5702092394
2025-10-01 14:00:03,802 - aiogram.event - INFO - Update id=557184964 is handled. Duration 186 ms by bot id=5702092394
2025-10-01 14:00:05,703 - aiogram.event - INFO - Update id=557184965 is handled. Duration 208 ms by bot id=5702092394
2025-10-01 14:00:06,248 - aiogram.event - INFO - Update id=557184966 is handled. Duration 143 ms by bot id=5702092394
2025-10-01 14:00:11,309 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:00:11,324 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:00:11,326 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:00:11,326 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:00:11,333 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:11,333 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:00:11,334 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:00:11,335 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:00:11,511 - aiogram.event - INFO - Update id=557184967 is handled. Duration 202 ms by bot id=5702092394
2025-10-01 14:00:12,900 - aiogram.event - INFO - Update id=557184968 is handled. Duration 192 ms by bot id=5702092394
2025-10-01 14:06:41,635 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:06:41,637 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:06:41,637 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:06:41,804 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:06:46,823 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:06:46,825 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:06:47,042 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:06:57,346 - aiogram.event - INFO - Update id=557184969 is handled. Duration 633 ms by bot id=5702092394
2025-10-01 14:06:59,347 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:06:59,486 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:06:59,598 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:06:59,599 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:06:59,599 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:06:59,601 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:06:59,602 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:06:59,603 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:06:59,603 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:06:59,720 - aiogram.event - INFO - Update id=557184970 is handled. Duration 373 ms by bot id=5702092394
2025-10-01 14:07:01,064 - aiogram.event - INFO - Update id=557184971 is handled. Duration 219 ms by bot id=5702092394
2025-10-01 14:07:09,060 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:07:09,062 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:07:09,063 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:07:09,230 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:18,718 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:07:18,719 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:07:19,001 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:19,077 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:07:19,148 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:07:19,244 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:07:19,245 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:07:19,245 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:07:19,247 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:19,248 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:19,248 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:07:19,248 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:07:19,452 - aiogram.event - INFO - Update id=557184972 is handled. Duration 374 ms by bot id=5702092394
2025-10-01 14:07:21,991 - aiogram.event - INFO - Update id=557184973 is handled. Duration 100 ms by bot id=5702092394
2025-10-01 14:07:24,507 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:07:24,508 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:07:24,509 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:07:24,678 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:36,022 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:07:36,023 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:07:37,680 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:07:42,368 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:07:42,464 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:07:42,568 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:07:42,568 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:07:42,569 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:07:42,571 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:42,572 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:07:42,572 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:07:42,573 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:07:42,839 - aiogram.event - INFO - Update id=557184974 is handled. Duration 470 ms by bot id=5702092394
2025-10-01 14:07:44,646 - aiogram.event - INFO - Update id=557184975 is handled. Duration 114 ms by bot id=5702092394
2025-10-01 14:08:00,490 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:08:00,491 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:08:00,492 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:08:00,648 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:08:06,226 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:08:06,227 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:08:06,527 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:08:08,283 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:08:08,370 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:08:08,497 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:08:08,497 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:08:08,498 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:08:08,499 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:08:08,500 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:08:08,501 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:08:08,501 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:08:08,841 - aiogram.event - INFO - Update id=557184976 is handled. Duration 558 ms by bot id=5702092394
2025-10-01 14:08:10,487 - aiogram.event - INFO - Update id=557184977 is handled. Duration 115 ms by bot id=5702092394
2025-10-01 14:08:12,047 - aiogram.event - INFO - Update id=557184978 is handled. Duration 90 ms by bot id=5702092394
2025-10-01 14:08:37,875 - aiogram.event - INFO - Update id=557184979 is handled. Duration 484 ms by bot id=5702092394
2025-10-01 14:10:04,501 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:10:04,504 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:10:04,504 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:10:04,659 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:10:09,753 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:10:09,754 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:10:09,996 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:10:13,064 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:10:13,183 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:10:13,342 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:10:13,343 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:10:13,343 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:10:13,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:10:13,345 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:10:13,345 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:10:13,346 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:10:13,591 - aiogram.event - INFO - Update id=557184980 is handled. Duration 528 ms by bot id=5702092394
2025-10-01 14:10:15,448 - aiogram.event - INFO - Update id=557184981 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:23,196 - aiogram.event - INFO - Update id=557184982 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:24,174 - aiogram.event - INFO - Update id=557184983 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:24,643 - aiogram.event - INFO - Update id=557184984 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:26,039 - aiogram.event - INFO - Update id=557184985 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:26,569 - aiogram.event - INFO - Update id=557184986 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,021 - aiogram.event - INFO - Update id=557184987 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,173 - aiogram.event - INFO - Update id=557184988 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,326 - aiogram.event - INFO - Update id=557184989 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:27,475 - aiogram.event - INFO - Update id=557184990 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:10:27,621 - aiogram.event - INFO - Update id=557184991 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:10:27,754 - aiogram.event - INFO - Update id=557184992 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:04,449 - aiogram.event - INFO - Update id=557184993 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:06,166 - aiogram.event - INFO - Update id=557184994 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:07,247 - aiogram.event - INFO - Update id=557184995 is not handled. Duration 11 ms by bot id=5702092394
2025-10-01 14:11:08,460 - aiogram.event - INFO - Update id=557184996 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:11:09,588 - aiogram.event - INFO - Update id=557184997 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:11:59,623 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:11:59,624 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:11:59,624 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:11:59,799 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:12:04,722 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:12:04,724 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:12:04,724 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:12:05,028 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:12:12,782 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:12:12,873 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:12:12,979 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:12:12,979 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:12:12,979 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:12:12,981 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:12:12,982 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:12:12,983 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:12:12,984 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:12:13,921 - aiogram.event - INFO - Update id=557184998 is handled. Duration 1139 ms by bot id=5702092394
2025-10-01 14:12:17,531 - aiogram.event - INFO - Update id=557184999 is not handled. Duration 2 ms by bot id=5702092394
2025-10-01 14:15:51,305 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:15:51,308 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:15:51,308 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:15:51,452 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:15:56,526 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:15:56,528 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:15:56,529 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:15:56,745 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:00,019 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:16:00,127 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:16:00,244 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:16:00,245 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:16:00,245 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:16:00,247 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:00,248 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:00,248 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:16:00,249 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:16:01,845 - aiogram.event - INFO - Update id=557185001 is not handled. Duration 12 ms by bot id=5702092394
2025-10-01 14:16:01,895 - aiogram.event - INFO - Update id=557185000 is handled. Duration 1876 ms by bot id=5702092394
2025-10-01 14:16:04,336 - aiogram.event - INFO - Update id=557185002 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:16:05,382 - aiogram.event - INFO - Update id=557185003 is not handled. Duration 0 ms by bot id=5702092394
2025-10-01 14:16:07,990 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:16:07,992 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:16:07,993 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:16:08,150 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:16,420 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:16:16,422 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-01 14:16:16,423 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:16:16,605 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:16:23,009 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:16:23,092 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:16:23,193 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:16:23,194 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:16:23,194 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:16:23,196 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:23,197 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:16:23,198 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:16:23,198 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:16:23,466 - aiogram.event - INFO - Update id=557185004 is handled. Duration 456 ms by bot id=5702092394
2025-10-01 14:16:25,675 - aiogram.event - INFO - Update id=557185005 is not handled. Duration 1 ms by bot id=5702092394
2025-10-01 14:31:36,200 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:31:36,212 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:31:36,213 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:31:36,381 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:31:42,036 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:31:42,038 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:31:42,327 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:31:48,754 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:31:48,875 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:31:49,002 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:31:49,002 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:31:49,003 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:31:49,005 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:31:49,005 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:31:49,006 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:31:49,007 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:31:49,394 - aiogram.event - INFO - Update id=557185006 is handled. Duration 640 ms by bot id=5702092394
2025-10-01 14:31:51,107 - aiogram.event - INFO - Update id=557185007 is handled. Duration 113 ms by bot id=5702092394
2025-10-01 14:31:53,743 - aiogram.event - INFO - Update id=557185008 is handled. Duration 248 ms by bot id=5702092394
2025-10-01 14:31:54,371 - aiogram.event - INFO - Update id=557185009 is handled. Duration 257 ms by bot id=5702092394
2025-10-01 14:31:55,767 - aiogram.event - INFO - Update id=557185010 is handled. Duration 90 ms by bot id=5702092394
2025-10-01 14:31:56,518 - aiogram.event - INFO - Update id=557185011 is handled. Duration 121 ms by bot id=5702092394
2025-10-01 14:31:57,634 - aiogram.event - INFO - Update id=557185012 is handled. Duration 92 ms by bot id=5702092394
2025-10-01 14:31:58,465 - aiogram.event - INFO - Update id=557185013 is handled. Duration 162 ms by bot id=5702092394
2025-10-01 14:31:59,538 - aiogram.event - INFO - Update id=557185014 is handled. Duration 95 ms by bot id=5702092394
2025-10-01 14:40:41,605 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:40:41,607 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:40:41,608 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:40:41,751 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:40:47,477 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:40:47,479 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:40:47,709 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:40:55,327 - aiogram.event - INFO - Update id=557185015 is handled. Duration 268 ms by bot id=5702092394
2025-10-01 14:40:58,013 - aiogram.event - INFO - Update id=557185016 is handled. Duration 102 ms by bot id=5702092394
2025-10-01 14:40:58,357 - aiogram.event - INFO - Update id=557185017 is handled. Duration 85 ms by bot id=5702092394
2025-10-01 14:40:58,768 - aiogram.event - INFO - Update id=557185018 is handled. Duration 106 ms by bot id=5702092394
2025-10-01 14:40:59,700 - aiogram.event - INFO - Update id=557185019 is handled. Duration 111 ms by bot id=5702092394
2025-10-01 14:41:00,238 - aiogram.event - INFO - Update id=557185020 is handled. Duration 145 ms by bot id=5702092394
2025-10-01 14:41:00,565 - aiogram.event - INFO - Update id=557185021 is handled. Duration 169 ms by bot id=5702092394
2025-10-01 14:42:58,885 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:42:58,887 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:42:58,887 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:42:59,068 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:46:54,532 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:46:54,545 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:46:54,839 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:46:59,589 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:46:59,711 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:46:59,877 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:46:59,877 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:46:59,878 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:46:59,880 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:46:59,881 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:46:59,882 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:46:59,882 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:47:00,188 - aiogram.event - INFO - Update id=557185022 is handled. Duration 599 ms by bot id=5702092394
2025-10-01 14:47:01,810 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:47:01,810 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 14:47:01,862 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 14:47:01,895 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 14:47:01,923 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 14:47:01,928 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 14:47:01,931 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 14:47:01,932 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:47:01,932 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:47:01,933 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 55, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 14:47:02,138 - aiogram.event - INFO - Update id=557185023 is handled. Duration 329 ms by bot id=5702092394
2025-10-01 14:47:07,772 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:47:07,982 - aiogram.event - INFO - Update id=557185024 is handled. Duration 212 ms by bot id=5702092394
2025-10-01 14:48:31,440 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:31,442 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:48:41,627 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:48:56,941 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:56,942 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:48:57,902 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-01 14:48:58,004 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-01 14:48:58,066 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-01 14:48:58,134 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1568
2025-10-01 14:48:58,202 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1705
2025-10-01 14:48:58,243 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-01 14:48:58,435 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-01 14:49:00,996 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:49:00,997 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1568, 'price_without_card': 1705, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-01 14:49:01,004 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 1668950019 не найден
2025-10-01 14:49:01,011 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604']) получен по id: 515084006
2025-10-01 14:49:01,014 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='1668950019', user_id='515084006', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories=['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX'], prices=[Price(id=None, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))])
2025-10-01 14:49:01,018 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))
2025-10-01 14:49:01,019 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 1668950019 пользователю ID 515084006
2025-10-01 14:49:01,021 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-01 14:49:01,133 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:49:01,134 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:49:01,134 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:49:01,135 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 35, in add_product_process
    reply_markup=build_product_actions_keyboard(result['id'], result['link'])
                                                ~~~~~~^^^^^^
KeyError: 'id'
2025-10-01 14:49:01,389 - aiogram.event - INFO - Update id=557185025 is handled. Duration 29954 ms by bot id=5702092394
2025-10-01 14:50:20,486 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 14:50:20,487 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 14:50:20,488 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 14:50:20,647 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:50:29,353 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 14:50:29,355 - aiogram.dispatcher - INFO - Start polling
2025-10-01 14:50:29,952 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 14:50:33,251 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 14:50:33,411 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:50:33,636 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:50:33,636 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:50:33,637 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:50:33,642 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:50:33,643 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:50:33,644 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:50:33,645 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:50:34,138 - aiogram.event - INFO - Update id=557185026 is handled. Duration 887 ms by bot id=5702092394
2025-10-01 14:50:35,301 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:50:35,469 - aiogram.event - INFO - Update id=557185027 is handled. Duration 169 ms by bot id=5702092394
2025-10-01 14:50:37,717 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:50:37,718 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:50:39,403 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:50:54,172 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:50:54,172 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-01 14:51:05,752 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-01 14:51:05,797 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-01 14:51:05,845 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-01 14:51:05,917 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1568
2025-10-01 14:51:05,973 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1705
2025-10-01 14:51:06,011 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-01 14:51:06,151 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-01 14:51:08,955 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:51:08,956 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1568, 'price_without_card': 1705, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-01 14:51:08,983 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 14:51:08,984 - src.application.use_cases.create_product - ERROR - Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,984 - src.core.uow - WARNING - Исключение в Unit of Work: ProductCreationError: Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,988 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 14:51:08,989 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:51:08,989 - src.core.decorators - ERROR - Ошибка в функции create_product: Товар с ID 1668950019 уже существует
2025-10-01 14:51:08,990 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 29, in add_product_process
    result = product_service.create_product(str(message.from_user.id), url)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 47, in create_product
    return use_case.execute(user_id, url)
           ~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\create_product.py", line 41, in execute
    raise ProductCreationError(f'Товар с ID {product_data['id']} уже существует')
src.domain.exceptions.ProductCreationError: Товар с ID 1668950019 уже существует
2025-10-01 14:51:09,364 - aiogram.event - INFO - Update id=557185028 is handled. Duration 31649 ms by bot id=5702092394
2025-10-01 14:51:26,939 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:51:26,975 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:51:26,976 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 14:51:26,977 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 14:51:26,984 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:51:26,985 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:51:26,986 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:51:26,987 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 14:51:27,084 - aiogram.event - INFO - Update id=557185029 is handled. Duration 145 ms by bot id=5702092394
2025-10-01 14:51:27,942 - src.infrastructure.services.logger - INFO - Обработчик /add_product сработал
2025-10-01 14:51:28,175 - aiogram.event - INFO - Update id=557185030 is handled. Duration 235 ms by bot id=5702092394
2025-10-01 14:51:30,687 - src.infrastructure.services.logger - INFO - Обработчик add_product_process с URL: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:51:30,687 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 14:51:32,224 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-01 14:51:47,650 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:51:47,650 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/
2025-10-01 14:52:22,082 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1565602444
2025-10-01 14:52:22,120 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Ray-Ban Очки солнцезащитные
2025-10-01 14:52:22,164 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.7
2025-10-01 14:52:22,210 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 737
2025-10-01 14:52:22,254 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 805
2025-10-01 14:52:22,289 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg
2025-10-01 14:52:22,440 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']
2025-10-01 14:52:24,109 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-01 14:52:24,110 - src.application.use_cases.create_product - INFO - Успешный парсинг данных для https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/: {'id': '1565602444', 'name': 'Ray-Ban Очки солнцезащитные', 'rating': 4.7, 'price_with_card': 737, 'price_without_card': 805, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', 'categories': ['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban']}
2025-10-01 14:52:24,118 - src.infrastructure.database.repositories.product_repository - WARNING - Товар с ID 1565602444 не найден
2025-10-01 14:52:24,125 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019']) получен по id: 515084006
2025-10-01 14:52:24,129 - src.infrastructure.database.repositories.product_repository - INFO - Сохранение товара: Product(id='1565602444', user_id='515084006', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories=['Аксессуары', 'Женщинам', 'Очки', 'Солнцезащитные очки', 'Ray-Ban'], prices=[Price(id=None, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))])
2025-10-01 14:52:24,135 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))
2025-10-01 14:52:24,136 - src.infrastructure.database.repositories.user_products_repository - INFO - Привязка товара ID 1565602444 пользователю ID 515084006
2025-10-01 14:52:24,136 - src.core.decorators - INFO - Функция create_product: выполняется commit транзакции
2025-10-01 14:52:24,175 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:52:24,176 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 14:52:24,177 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 14:52:24,179 - src.infrastructure.services.logger - ERROR - Ошибка при добавлении товара
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 35, in add_product_process
    reply_markup=build_product_actions_keyboard(result['product_id'], result['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 14:52:24,694 - aiogram.event - INFO - Update id=557185031 is handled. Duration 54008 ms by bot id=5702092394
2025-10-01 16:10:20,384 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:10:20,411 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:10:20,414 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:10:20,522 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:10:29,073 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:10:29,075 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:10:29,331 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:10:34,883 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:10:35,032 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:10:35,341 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:10:35,342 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:10:35,342 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:10:35,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:35,344 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:35,345 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:10:35,345 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:10:36,785 - aiogram.event - INFO - Update id=557185032 is handled. Duration 1903 ms by bot id=5702092394
2025-10-01 16:10:37,915 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:10:37,916 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:10:37,957 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:10:37,978 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:10:37,996 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:10:38,007 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:10:38,021 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:10:38,026 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:10:38,029 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:10:38,030 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:10:38,031 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:10:38,032 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:10:38,158 - aiogram.event - INFO - Update id=557185033 is handled. Duration 244 ms by bot id=5702092394
2025-10-01 16:12:59,272 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:12:59,274 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:12:59,274 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:12:59,423 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:13:04,785 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:13:04,787 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:13:07,716 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:13:08,072 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:13:08,155 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:13:08,231 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:13:08,232 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:13:08,232 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:08,234 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:13:08,235 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:13:08,534 - aiogram.event - INFO - Update id=557185034 is handled. Duration 462 ms by bot id=5702092394
2025-10-01 16:13:11,686 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:13:11,687 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:13:11,729 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:13:11,756 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:13:11,782 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:13:11,802 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:13:11,824 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:13:11,829 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:13:11,839 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:13:11,840 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:13:11,841 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:13:11,842 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:13:12,296 - aiogram.event - INFO - Update id=557185035 is handled. Duration 612 ms by bot id=5702092394
2025-10-01 16:13:53,153 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:13:53,154 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:13:53,155 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:13:53,322 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:14:00,260 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:14:00,261 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:14:01,595 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:14:05,043 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:14:05,144 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:14:05,237 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:14:05,238 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:14:05,238 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:14:05,240 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:05,241 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:05,241 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:14:05,242 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:14:06,784 - aiogram.event - INFO - Update id=557185036 is handled. Duration 1741 ms by bot id=5702092394
2025-10-01 16:14:08,398 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:14:08,399 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:14:08,426 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:14:08,438 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:14:08,461 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:14:08,475 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:14:08,486 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:14:08,490 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:14:08,493 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:14:08,493 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:14:08,494 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:14:08,495 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:14:08,626 - aiogram.event - INFO - Update id=557185037 is handled. Duration 230 ms by bot id=5702092394
2025-10-01 16:17:10,998 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:17:11,001 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:17:11,001 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:17:11,157 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:16,053 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:17:16,055 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:17:16,344 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:19,789 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:17:19,892 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:19,970 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:17:19,971 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:17:19,971 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:17:19,973 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:19,973 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:19,974 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:19,974 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:17:20,226 - aiogram.event - INFO - Update id=557185038 is handled. Duration 436 ms by bot id=5702092394
2025-10-01 16:17:21,161 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:21,162 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:17:21,191 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:17:21,209 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:17:21,227 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:17:21,241 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:17:21,249 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:17:21,254 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:17:21,257 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:17:21,258 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:21,258 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:21,259 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:17:21,389 - aiogram.event - INFO - Update id=557185039 is handled. Duration 229 ms by bot id=5702092394
2025-10-01 16:17:29,244 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:17:29,246 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:17:29,246 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:17:29,409 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:35,297 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:17:35,299 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:17:36,886 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:17:40,537 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:17:40,605 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:40,691 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:17:40,691 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:17:40,692 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:17:40,693 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:40,694 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:40,694 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:40,694 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:17:40,959 - aiogram.event - INFO - Update id=557185040 is handled. Duration 422 ms by bot id=5702092394
2025-10-01 16:17:43,124 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:17:43,125 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:17:43,149 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:17:43,163 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:17:43,199 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:17:43,212 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:17:43,224 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:17:43,227 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:17:43,230 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:17:43,231 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:17:43,231 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:17:43,232 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 97, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1)  # Инициализация клавиатуры с правильным параметром row_width
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 1}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:17:43,359 - aiogram.event - INFO - Update id=557185041 is handled. Duration 235 ms by bot id=5702092394
2025-10-01 16:19:18,115 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:19:18,118 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:19:18,119 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:19:18,271 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:24,675 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:19:24,678 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:19:24,919 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:27,896 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:19:27,984 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:19:28,038 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:19:28,039 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:19:28,039 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:19:28,040 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:28,041 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:28,041 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:19:28,041 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:19:28,250 - aiogram.event - INFO - Update id=557185042 is handled. Duration 353 ms by bot id=5702092394
2025-10-01 16:19:29,365 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:19:29,365 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:19:29,391 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:19:29,414 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:19:29,431 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:19:29,451 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:19:29,463 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:19:29,467 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:19:29,469 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:19:29,470 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:19:29,470 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:19:29,470 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 104, in get_my_product_list
    inline_buttons.add(InlineKeyboardButton(text=display, callback_data=f"product:{p['id']}"))
    ^^^^^^^^^^^^^^^^^^
AttributeError: 'list' object has no attribute 'add'
2025-10-01 16:19:29,579 - aiogram.event - INFO - Update id=557185043 is handled. Duration 216 ms by bot id=5702092394
2025-10-01 16:19:49,729 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:19:49,732 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:19:49,732 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:19:49,860 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:19:54,479 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:19:54,481 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:19:54,724 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:20:00,600 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:20:00,719 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:20:00,719 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:20:00,796 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:20:00,806 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:20:00,817 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:20:00,828 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:20:00,839 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:20:00,843 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:20:00,846 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:20:00,846 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:20:00,847 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:20:01,049 - aiogram.event - INFO - Update id=557185044 is handled. Duration 451 ms by bot id=5702092394
2025-10-01 16:20:04,623 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:20:04,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:20:04,636 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:20:04,638 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:20:04,638 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:20:04,639 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:20:04,639 - src.infrastructure.services.logger - ERROR - Ошибка в handle_product_button
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:20:04,719 - aiogram.event - INFO - Update id=557185045 is not handled. Duration 170 ms by bot id=5702092394
2025-10-01 16:20:04,720 - aiogram.event - ERROR - Cause exception while process update id=557185045 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 159, in handle_product_button
    await call.answer(f'Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:21:57,755 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:21:57,757 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:21:57,757 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:21:57,921 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:03,557 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:22:03,560 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:22:04,436 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:07,117 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:22:07,198 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:07,276 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:22:07,277 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:22:07,277 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:22:07,279 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:07,280 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:07,281 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:07,281 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:22:07,542 - aiogram.event - INFO - Update id=557185046 is handled. Duration 424 ms by bot id=5702092394
2025-10-01 16:22:08,717 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:08,718 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:22:08,742 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:22:08,756 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:22:08,769 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:22:08,783 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:22:08,799 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:22:08,804 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:22:08,806 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:22:08,806 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:08,807 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:08,809 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:22:08,970 - aiogram.event - INFO - Update id=557185047 is not handled. Duration 254 ms by bot id=5702092394
2025-10-01 16:22:08,971 - aiogram.event - ERROR - Cause exception while process update id=557185047 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: message is too long
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 114, in get_my_product_list
    await message.answer(f'❌ Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is too long
2025-10-01 16:22:18,863 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:22:18,865 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:22:18,866 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:22:19,034 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:25,320 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:22:25,323 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:22:25,565 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:22:28,671 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:22:28,749 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:28,810 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:22:28,810 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:22:28,811 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:22:28,812 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:28,813 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:28,813 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:28,814 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:22:29,069 - aiogram.event - INFO - Update id=557185048 is handled. Duration 398 ms by bot id=5702092394
2025-10-01 16:22:30,420 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:22:30,421 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:22:30,453 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:22:30,474 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:22:30,490 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:22:30,506 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:22:30,521 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:22:30,525 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:22:30,528 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:22:30,529 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:22:30,530 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:22:30,531 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:22:30,660 - aiogram.event - INFO - Update id=557185049 is not handled. Duration 241 ms by bot id=5702092394
2025-10-01 16:22:30,660 - aiogram.event - ERROR - Cause exception while process update id=557185049 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: message is too long
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 107, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=inline_buttons)  # Убираем лишний список вокруг кнопок
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 114, in get_my_product_list
    await message.answer(f'❌ Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is too long
2025-10-01 16:22:54,971 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:22:54,972 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:22:54,972 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:22:55,147 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:23:01,808 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:23:01,810 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:23:02,033 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:23:04,798 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:23:04,934 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:23:04,935 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:23:05,025 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:23:05,038 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:23:05,051 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:23:05,068 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:23:05,083 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:23:05,089 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:23:05,091 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:23:05,092 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:23:05,092 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:23:05,618 - aiogram.event - INFO - Update id=557185050 is handled. Duration 826 ms by bot id=5702092394
2025-10-01 16:24:04,757 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:24:04,770 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:24:04,774 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:24:04,776 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:24:04,777 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:24:04,777 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:24:04,778 - src.infrastructure.services.logger - ERROR - Ошибка в handle_product_button
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-01 16:24:04,866 - aiogram.event - INFO - Update id=557185051 is not handled. Duration 193 ms by bot id=5702092394
2025-10-01 16:24:04,866 - aiogram.event - ERROR - Cause exception while process update id=557185051 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 147, in handle_product_button
    kb = build_product_actions_keyboard(product_id=product['id'], product_link=product['link'])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\utils\keyboard.py", line 5, in build_product_actions_keyboard
    kb = InlineKeyboardMarkup(row_width=2)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={'row_width': 2}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 159, in handle_product_button
    await call.answer(f'Ошибка: {e}')
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:25:51,011 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:25:51,015 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:25:51,015 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:25:51,276 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:25:57,951 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:25:57,953 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:26:00,461 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:26:02,250 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:26:02,336 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:26:02,394 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:26:02,394 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:26:02,394 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:26:02,396 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:02,396 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:02,397 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:26:02,397 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:26:02,648 - aiogram.event - INFO - Update id=557185052 is handled. Duration 398 ms by bot id=5702092394
2025-10-01 16:26:04,286 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:26:04,286 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:26:04,305 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:26:04,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:26:04,351 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:26:04,364 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:26:04,372 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:26:04,376 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:26:04,378 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:26:04,379 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:26:04,379 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:26:04,380 - src.infrastructure.services.logger - ERROR - Ошибка при получении списка товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 105, in get_my_product_list
    kb = InlineKeyboardMarkup(row_width=1, inline_keyboard=[[inline_buttons]])
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=[InlineKeyboardButton(tex...ck_game=None, pay=None)], input_type=list]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-01 16:26:04,544 - aiogram.event - INFO - Update id=557185053 is handled. Duration 258 ms by bot id=5702092394
2025-10-01 16:27:47,151 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:27:47,153 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:27:47,154 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:27:47,322 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:53:41,975 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:53:41,978 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:53:42,246 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:53:46,455 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:53:46,640 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:46,944 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:53:46,945 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:53:46,946 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:53:46,947 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:46,948 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:46,949 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:46,949 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:53:47,752 - aiogram.event - INFO - Update id=557185060 is handled. Duration 1298 ms by bot id=5702092394
2025-10-01 16:53:48,172 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:48,174 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:53:48,206 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:48,226 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:53:48,249 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:53:48,270 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:53:48,284 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:53:48,288 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:53:48,290 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:48,291 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:48,291 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:48,388 - aiogram.event - INFO - Update id=557185061 is handled. Duration 216 ms by bot id=5702092394
2025-10-01 16:53:49,806 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:49,816 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:49,819 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:53:49,821 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:49,822 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:49,822 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:50,011 - aiogram.event - INFO - Update id=557185062 is handled. Duration 322 ms by bot id=5702092394
2025-10-01 16:53:57,128 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:53:57,129 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:53:57,156 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:53:57,173 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:53:57,188 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:53:57,205 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:53:57,223 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:53:57,234 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:53:57,237 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:53:57,238 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:53:57,239 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:53:57,239 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-01 16:53:57,388 - aiogram.event - INFO - Update id=557185063 is not handled. Duration 380 ms by bot id=5702092394
2025-10-01 16:53:57,389 - aiogram.event - ERROR - Cause exception while process update id=557185063 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-01 16:54:32,844 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:54:32,848 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:54:32,849 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:54:33,013 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:54:41,014 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-01 16:54:41,018 - aiogram.dispatcher - INFO - Start polling
2025-10-01 16:54:41,225 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-01 16:54:50,703 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@10.165.1.93:5432/pricely_db
2025-10-01 16:54:50,817 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:50,927 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-01 16:54:50,927 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-01 16:54:50,928 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-01 16:54:50,929 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:50,930 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:50,930 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:50,931 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-01 16:54:51,186 - aiogram.event - INFO - Update id=557185064 is handled. Duration 482 ms by bot id=5702092394
2025-10-01 16:54:52,946 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:52,946 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-01 16:54:52,970 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-01 16:54:52,995 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:54:53,012 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-01 16:54:53,029 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-01 16:54:53,047 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-01 16:54:53,053 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-01 16:54:53,055 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:54:53,056 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:53,056 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:53,155 - aiogram.event - INFO - Update id=557185065 is handled. Duration 210 ms by bot id=5702092394
2025-10-01 16:54:56,162 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-01 16:54:56,175 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-01 16:54:56,180 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-01 16:54:56,183 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-01 16:54:56,184 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-01 16:54:56,184 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-01 16:54:56,385 - aiogram.event - INFO - Update id=557185066 is handled. Duration 429 ms by bot id=5702092394
2025-10-01 16:55:58,004 - aiogram.dispatcher - INFO - Polling stopped
2025-10-01 16:55:58,008 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-01 16:55:58,008 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-01 16:55:58,141 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:36:19,468 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:36:19,482 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:36:20,280 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:36:20,442 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:36:20,537 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:20,726 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:36:20,726 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:36:20,727 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:36:20,730 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:20,730 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:20,731 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:20,732 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:36:21,010 - aiogram.event - INFO - Update id=557185070 is handled. Duration 569 ms by bot id=5702092394
2025-10-02 18:36:24,308 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:24,345 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:36:24,346 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:36:24,347 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:36:24,354 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:24,356 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:24,357 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:24,358 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:36:24,453 - aiogram.event - INFO - Update id=557185071 is handled. Duration 145 ms by bot id=5702092394
2025-10-02 18:36:25,817 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:25,818 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:36:25,892 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:36:25,942 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:36:25,987 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:36:26,016 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:36:26,045 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:36:26,056 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:36:26,065 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:36:26,067 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:26,068 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:26,177 - aiogram.event - INFO - Update id=557185072 is handled. Duration 362 ms by bot id=5702092394
2025-10-02 18:36:28,119 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:28,170 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:36:28,177 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:36:28,181 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:36:28,183 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:28,184 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:28,297 - aiogram.event - INFO - Update id=557185073 is handled. Duration 298 ms by bot id=5702092394
2025-10-02 18:36:32,524 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:32,525 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:36:32,593 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:36:32,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:36:32,676 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:36:32,712 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:36:32,744 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:36:32,763 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:36:32,767 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:36:32,769 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:32,770 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:32,771 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:36:32,992 - aiogram.event - INFO - Update id=557185074 is not handled. Duration 554 ms by bot id=5702092394
2025-10-02 18:36:32,993 - aiogram.event - ERROR - Cause exception while process update id=557185074 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:36:34,250 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:36:34,252 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:36:34,323 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:36:34,362 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:36:34,402 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:36:34,441 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:36:34,467 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:36:34,476 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:36:34,480 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:36:34,481 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:36:34,482 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:36:34,484 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:36:34,669 - aiogram.event - INFO - Update id=557185075 is not handled. Duration 606 ms by bot id=5702092394
2025-10-02 18:36:34,670 - aiogram.event - ERROR - Cause exception while process update id=557185075 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:36:47,227 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:36:47,239 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:36:47,240 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:36:47,405 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:36:54,572 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:36:54,575 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:36:54,836 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:39:20,874 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:39:20,877 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:39:20,877 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:39:21,068 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:39:28,889 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:39:28,893 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:39:29,136 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:39:33,950 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:39:34,143 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:39:34,677 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:39:34,678 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:39:34,678 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:39:34,688 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:34,689 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:34,690 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:39:34,691 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:39:35,001 - aiogram.event - INFO - Update id=557185076 is handled. Duration 1055 ms by bot id=5702092394
2025-10-02 18:39:36,141 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:39:36,142 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:39:36,238 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:39:36,291 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:39:36,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:39:36,373 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:39:36,409 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:39:36,428 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:39:36,436 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:39:36,437 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:36,438 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:39:36,592 - aiogram.event - INFO - Update id=557185077 is handled. Duration 453 ms by bot id=5702092394
2025-10-02 18:39:39,152 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:39:39,201 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:39:39,212 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:39:39,218 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:39:39,219 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:39,220 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:39:39,352 - aiogram.event - INFO - Update id=557185078 is handled. Duration 317 ms by bot id=5702092394
2025-10-02 18:39:41,122 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:39:41,123 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:39:41,334 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:39:41,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:39:41,911 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:39:42,144 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:39:42,180 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:39:42,195 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:39:42,201 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:39:42,202 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:39:42,202 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:39:42,203 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:39:42,347 - aiogram.event - INFO - Update id=557185079 is not handled. Duration 1356 ms by bot id=5702092394
2025-10-02 18:39:42,348 - aiogram.event - ERROR - Cause exception while process update id=557185079 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:26,574 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:44:26,578 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:44:26,579 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:44:26,687 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:44:33,164 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:44:33,167 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:44:33,399 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:44:40,385 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:44:40,597 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:40,876 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:44:40,877 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:44:40,877 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:44:40,882 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:40,883 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:40,885 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:40,886 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:44:41,236 - aiogram.event - INFO - Update id=557185080 is handled. Duration 852 ms by bot id=5702092394
2025-10-02 18:44:42,381 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:42,381 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:42,453 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:42,500 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:42,541 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:42,580 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:42,612 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:42,620 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:42,624 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:42,625 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:42,626 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:42,792 - aiogram.event - INFO - Update id=557185081 is handled. Duration 416 ms by bot id=5702092394
2025-10-02 18:44:44,805 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:44,876 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:44,888 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:44:44,897 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:44,898 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:44,899 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:45,109 - aiogram.event - INFO - Update id=557185082 is handled. Duration 517 ms by bot id=5702092394
2025-10-02 18:44:46,550 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:46,551 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:46,583 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:46,610 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:46,642 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:46,679 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:46,707 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:46,720 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:46,725 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:46,726 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:46,728 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:46,731 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:46,872 - aiogram.event - INFO - Update id=557185083 is not handled. Duration 434 ms by bot id=5702092394
2025-10-02 18:44:46,873 - aiogram.event - ERROR - Cause exception while process update id=557185083 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:47,935 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:47,937 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:47,968 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:48,018 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:48,063 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:48,091 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:48,118 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:48,126 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:48,133 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:48,135 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:48,135 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:48,136 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:48,245 - aiogram.event - INFO - Update id=557185084 is not handled. Duration 442 ms by bot id=5702092394
2025-10-02 18:44:48,247 - aiogram.event - ERROR - Cause exception while process update id=557185084 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:48,556 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:48,558 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:48,590 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:48,622 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:48,661 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:48,707 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:48,742 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:48,755 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:48,763 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:48,765 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:48,766 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:48,768 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:48,850 - aiogram.event - INFO - Update id=557185085 is not handled. Duration 377 ms by bot id=5702092394
2025-10-02 18:44:48,851 - aiogram.event - ERROR - Cause exception while process update id=557185085 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:50,739 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:50,740 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:50,772 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:50,802 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:50,834 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:50,886 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:50,912 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:50,921 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:50,935 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:50,936 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:50,937 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:50,938 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:51,079 - aiogram.event - INFO - Update id=557185086 is not handled. Duration 576 ms by bot id=5702092394
2025-10-02 18:44:51,080 - aiogram.event - ERROR - Cause exception while process update id=557185086 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:44:51,242 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:44:51,244 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:44:51,274 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:44:51,298 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:44:51,333 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:44:51,388 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:44:51,441 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:44:51,454 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:44:51,461 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:44:51,462 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:44:51,464 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:44:51,465 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:44:51,584 - aiogram.event - INFO - Update id=557185087 is not handled. Duration 630 ms by bot id=5702092394
2025-10-02 18:44:51,585 - aiogram.event - ERROR - Cause exception while process update id=557185087 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:45:56,311 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:45:56,313 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:45:56,313 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:45:56,465 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:46:03,626 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:46:03,629 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:46:03,878 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:46:11,589 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:46:11,701 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:11,932 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:46:11,933 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:46:11,934 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:46:11,938 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:11,939 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:11,941 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:11,942 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:46:12,225 - aiogram.event - INFO - Update id=557185088 is handled. Duration 636 ms by bot id=5702092394
2025-10-02 18:46:12,771 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:12,773 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:46:12,864 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:46:12,899 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:46:12,935 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:46:12,978 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:13,007 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:46:13,034 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:46:13,047 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:13,048 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:13,049 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:13,595 - aiogram.event - INFO - Update id=557185089 is handled. Duration 825 ms by bot id=5702092394
2025-10-02 18:46:15,660 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:15,678 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:15,683 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:46:15,687 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:15,689 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:15,690 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:15,797 - aiogram.event - INFO - Update id=557185090 is handled. Duration 246 ms by bot id=5702092394
2025-10-02 18:46:17,333 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:17,334 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:46:17,377 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:46:17,406 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:46:17,435 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:46:17,473 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:17,519 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:46:17,533 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:46:17,536 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:17,536 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:17,537 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:17,538 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:46:17,633 - aiogram.event - INFO - Update id=557185091 is not handled. Duration 383 ms by bot id=5702092394
2025-10-02 18:46:17,634 - aiogram.event - ERROR - Cause exception while process update id=557185091 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:46:18,879 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:18,880 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:46:18,914 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:46:18,934 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:46:18,981 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:46:19,011 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:19,045 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:46:19,054 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:46:19,060 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:19,061 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:19,062 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:19,063 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:46:19,197 - aiogram.event - INFO - Update id=557185092 is not handled. Duration 396 ms by bot id=5702092394
2025-10-02 18:46:19,198 - aiogram.event - ERROR - Cause exception while process update id=557185092 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:46:19,759 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:46:19,760 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:46:19,812 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:46:19,852 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:46:19,893 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:46:19,924 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:46:19,952 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:46:19,959 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:46:19,964 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:46:19,965 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:46:19,966 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:46:19,967 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:46:20,108 - aiogram.event - INFO - Update id=557185093 is not handled. Duration 529 ms by bot id=5702092394
2025-10-02 18:46:20,109 - aiogram.event - ERROR - Cause exception while process update id=557185093 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:50:27,386 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:50:27,399 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:50:27,469 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:50:27,528 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:50:27,625 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:50:27,675 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:50:27,735 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:50:27,758 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:50:27,769 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:50:27,770 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:50:27,771 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:50:27,772 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:50:27,874 - aiogram.event - INFO - Update id=557185094 is not handled. Duration 600 ms by bot id=5702092394
2025-10-02 18:50:27,875 - aiogram.event - ERROR - Cause exception while process update id=557185094 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:51:12,077 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:51:12,079 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:51:12,138 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:51:12,190 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:51:12,219 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:51:12,247 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:51:12,285 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:51:12,300 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:51:12,306 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:51:12,307 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:51:12,309 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:51:12,311 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type
2025-10-02 18:51:12,410 - aiogram.event - INFO - Update id=557185095 is not handled. Duration 422 ms by bot id=5702092394
2025-10-02 18:51:12,412 - aiogram.event - ERROR - Cause exception while process update id=557185095 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Input should be a valid list [type=list_type, input_value=None, input_type=NoneType]
    For further information visit https://errors.pydantic.dev/2.11/v/list_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-02 18:55:00,485 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:55:00,490 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:55:00,491 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:55:00,657 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:55:08,162 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:55:08,165 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:55:08,407 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:55:15,178 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:55:15,384 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:15,385 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:55:15,614 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:55:15,644 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:55:15,690 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:55:15,725 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:55:15,767 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:55:15,777 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:55:15,785 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:55:15,787 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:15,789 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:16,059 - aiogram.event - INFO - Update id=557185096 is handled. Duration 882 ms by bot id=5702092394
2025-10-02 18:55:17,822 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:17,855 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:55:17,863 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:55:17,873 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:55:17,874 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:17,875 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:17,984 - aiogram.event - INFO - Update id=557185097 is handled. Duration 247 ms by bot id=5702092394
2025-10-02 18:55:19,324 - aiogram.event - INFO - Update id=557185098 is not handled. Duration 3 ms by bot id=5702092394
2025-10-02 18:55:33,377 - aiogram.dispatcher - INFO - Polling stopped
2025-10-02 18:55:33,380 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-02 18:55:33,381 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 18:55:33,536 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:55:40,549 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-02 18:55:40,552 - aiogram.dispatcher - INFO - Start polling
2025-10-02 18:55:40,827 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-02 18:55:43,536 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-02 18:55:43,623 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:43,786 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-02 18:55:43,786 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-02 18:55:43,787 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-02 18:55:43,790 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:43,791 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:43,791 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:43,792 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-02 18:55:44,105 - aiogram.event - INFO - Update id=557185099 is handled. Duration 569 ms by bot id=5702092394
2025-10-02 18:55:45,574 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:45,575 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-02 18:55:45,637 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-02 18:55:45,673 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-02 18:55:45,723 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-02 18:55:45,754 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-02 18:55:45,778 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:55:45,788 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-02 18:55:45,794 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:55:45,795 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:45,796 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:45,916 - aiogram.event - INFO - Update id=557185100 is handled. Duration 342 ms by bot id=5702092394
2025-10-02 18:55:46,968 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-02 18:55:46,998 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-02 18:55:47,006 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-02 18:55:47,014 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-02 18:55:47,016 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-02 18:55:47,027 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-02 18:55:47,633 - aiogram.event - INFO - Update id=557185101 is handled. Duration 755 ms by bot id=5702092394
2025-10-02 18:55:48,209 - aiogram.event - INFO - Update id=557185102 is not handled. Duration 2 ms by bot id=5702092394
2025-10-02 20:01:23,505 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - Request timeout error
2025-10-02 20:01:23,582 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-02 20:01:24,663 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-02 20:01:24,663 - aiogram.dispatcher - WARNING - Sleep for 1.247018 seconds and try again... (tryings = 1, bot id = 5702092394)
2025-10-02 20:01:25,930 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-02 20:01:25,931 - aiogram.dispatcher - WARNING - Sleep for 1.525038 seconds and try again... (tryings = 2, bot id = 5702092394)
2025-10-02 20:01:27,467 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-02 20:01:27,469 - aiogram.dispatcher - WARNING - Sleep for 2.064538 seconds and try again... (tryings = 3, bot id = 5702092394)
2025-10-02 20:07:59,276 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ClientConnectorDNSError: Cannot connect to host api.telegram.org:443 ssl:default [getaddrinfo failed]
2025-10-02 20:07:59,316 - aiogram.dispatcher - WARNING - Sleep for 2.621835 seconds and try again... (tryings = 4, bot id = 5702092394)
2025-10-02 20:08:12,267 - aiogram.dispatcher - INFO - Connection established (tryings = 5, bot id = 5702092394)
2025-10-03 17:15:41,963 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:15:41,967 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:15:42,201 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:16:01,391 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:16:01,482 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:16:01,576 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:16:01,576 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:16:01,577 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:16:01,578 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:16:01,579 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:16:01,579 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:16:01,580 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:16:01,838 - aiogram.event - INFO - Update id=557185103 is handled. Duration 447 ms by bot id=5702092394
2025-10-03 17:16:03,294 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:16:03,295 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:16:03,337 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:16:03,356 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:16:03,369 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:16:03,384 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:16:03,398 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:16:03,403 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:16:03,406 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:16:03,408 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:16:03,409 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:16:03,516 - aiogram.event - INFO - Update id=557185104 is handled. Duration 223 ms by bot id=5702092394
2025-10-03 17:16:05,346 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:16:05,362 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:16:05,367 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:16:05,369 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:16:05,370 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:16:05,371 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:16:05,543 - aiogram.event - INFO - Update id=557185105 is handled. Duration 297 ms by bot id=5702092394
2025-10-03 17:16:06,945 - aiogram.event - INFO - Update id=557185106 is not handled. Duration 2 ms by bot id=5702092394
2025-10-03 17:20:14,382 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:20:14,393 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:20:14,394 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:20:14,549 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:20:20,792 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:20:20,795 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:20:21,004 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:20:24,828 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:20:24,927 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:20:25,034 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:20:25,035 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:20:25,035 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:20:25,038 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:20:25,039 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:20:25,039 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:20:25,040 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:20:25,324 - aiogram.event - INFO - Update id=557185107 is handled. Duration 496 ms by bot id=5702092394
2025-10-03 17:20:26,525 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:20:26,526 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:20:26,556 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:20:26,574 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:20:26,591 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:20:26,605 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:20:26,619 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:20:26,623 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:20:26,625 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:20:26,626 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:20:26,627 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:20:26,739 - aiogram.event - INFO - Update id=557185108 is handled. Duration 215 ms by bot id=5702092394
2025-10-03 17:20:28,564 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:20:28,577 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:20:28,581 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:20:28,585 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:20:28,586 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:20:28,586 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:20:28,725 - aiogram.event - INFO - Update id=557185109 is handled. Duration 265 ms by bot id=5702092394
2025-10-03 17:20:30,079 - aiogram.event - INFO - Update id=557185110 is not handled. Duration 3 ms by bot id=5702092394
2025-10-03 17:20:53,291 - aiogram.event - INFO - Update id=557185111 is not handled. Duration 3 ms by bot id=5702092394
2025-10-03 17:26:38,725 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:26:38,727 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:26:38,727 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:26:38,883 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:26:43,449 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:26:43,452 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:26:43,660 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:26:49,293 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:26:49,380 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:26:49,459 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:26:49,460 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:26:49,460 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:26:49,463 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:26:49,464 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:26:49,465 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:26:49,465 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:26:49,720 - aiogram.event - INFO - Update id=557185112 is handled. Duration 427 ms by bot id=5702092394
2025-10-03 17:26:50,676 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:26:50,676 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:26:50,704 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:26:50,721 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:26:50,735 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:26:50,747 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:26:50,758 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:26:50,761 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:26:50,764 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:26:50,765 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:26:50,766 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:26:50,883 - aiogram.event - INFO - Update id=557185113 is handled. Duration 208 ms by bot id=5702092394
2025-10-03 17:26:52,058 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:26:52,069 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:26:52,072 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:26:52,074 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:26:52,075 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:26:52,076 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:26:52,200 - aiogram.event - INFO - Update id=557185114 is handled. Duration 225 ms by bot id=5702092394
2025-10-03 17:26:52,982 - aiogram.event - INFO - Update id=557185115 is not handled. Duration 2 ms by bot id=5702092394
2025-10-03 17:27:14,090 - aiogram.event - INFO - Update id=557185116 is not handled. Duration 2 ms by bot id=5702092394
2025-10-03 17:27:33,302 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:27:33,304 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:27:33,304 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:27:33,494 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:27:38,125 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:27:38,126 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:27:38,330 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:27:41,391 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:27:41,454 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:41,540 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:27:41,541 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:27:41,542 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:27:41,545 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:41,545 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:41,546 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:41,547 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:27:41,798 - aiogram.event - INFO - Update id=557185117 is handled. Duration 407 ms by bot id=5702092394
2025-10-03 17:27:42,511 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:42,511 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:42,531 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:42,547 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:42,562 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:42,574 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:42,585 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:42,588 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:42,590 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:42,591 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:42,591 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:42,715 - aiogram.event - INFO - Update id=557185118 is handled. Duration 205 ms by bot id=5702092394
2025-10-03 17:27:44,377 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:44,384 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:44,388 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:27:44,390 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:44,391 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:44,392 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:44,673 - aiogram.event - INFO - Update id=557185119 is handled. Duration 535 ms by bot id=5702092394
2025-10-03 17:27:46,327 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:46,328 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:46,341 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:46,359 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:46,374 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:46,389 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:46,406 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:46,414 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:46,416 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:46,417 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:46,418 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:46,419 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:46,501 - aiogram.event - INFO - Update id=557185120 is not handled. Duration 248 ms by bot id=5702092394
2025-10-03 17:27:46,503 - aiogram.event - ERROR - Cause exception while process update id=557185120 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:47,893 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:47,894 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:47,911 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:47,932 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:47,950 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:47,970 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:47,991 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:47,997 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:48,000 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:48,002 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:48,003 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:48,004 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:48,085 - aiogram.event - INFO - Update id=557185121 is not handled. Duration 268 ms by bot id=5702092394
2025-10-03 17:27:48,086 - aiogram.event - ERROR - Cause exception while process update id=557185121 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:49,301 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:49,302 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:49,316 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:49,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:49,349 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:49,364 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:49,381 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:49,385 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:49,388 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:49,390 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:49,391 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:49,392 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:49,474 - aiogram.event - INFO - Update id=557185122 is not handled. Duration 245 ms by bot id=5702092394
2025-10-03 17:27:49,475 - aiogram.event - ERROR - Cause exception while process update id=557185122 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:50,019 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:50,019 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:50,039 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:50,055 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:50,072 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:50,089 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:50,104 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:50,110 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:50,114 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:50,115 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:50,116 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:50,116 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:50,199 - aiogram.event - INFO - Update id=557185123 is not handled. Duration 254 ms by bot id=5702092394
2025-10-03 17:27:50,200 - aiogram.event - ERROR - Cause exception while process update id=557185123 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:50,289 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:50,290 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:50,303 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:50,319 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:50,336 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:50,352 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:50,367 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:50,371 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:50,374 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:50,375 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:50,376 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:50,378 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:50,456 - aiogram.event - INFO - Update id=557185124 is not handled. Duration 241 ms by bot id=5702092394
2025-10-03 17:27:50,457 - aiogram.event - ERROR - Cause exception while process update id=557185124 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:27:51,729 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:27:51,729 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:27:51,748 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:27:51,766 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:27:51,782 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:27:51,807 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:27:51,821 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:27:51,832 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:27:51,835 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:27:51,835 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:27:51,836 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:27:51,838 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:27:51,921 - aiogram.event - INFO - Update id=557185125 is not handled. Duration 291 ms by bot id=5702092394
2025-10-03 17:27:51,923 - aiogram.event - ERROR - Cause exception while process update id=557185125 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:28:36,057 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:28:36,059 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:28:36,059 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:28:36,217 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:28:40,859 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:28:40,861 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:28:41,057 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:28:49,509 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:28:49,573 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:28:49,659 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:28:49,660 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:28:49,661 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:28:49,663 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:28:49,663 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:28:49,664 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:28:49,664 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:28:49,972 - aiogram.event - INFO - Update id=557185126 is handled. Duration 463 ms by bot id=5702092394
2025-10-03 17:28:50,537 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:28:50,537 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:28:50,564 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:28:50,578 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:28:50,591 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:28:50,602 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:28:50,614 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:28:50,618 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:28:50,620 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:28:50,621 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:28:50,621 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:28:50,732 - aiogram.event - INFO - Update id=557185127 is handled. Duration 196 ms by bot id=5702092394
2025-10-03 17:28:51,710 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:28:51,720 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:28:51,725 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:28:51,727 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:28:51,729 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:28:51,730 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:28:51,871 - aiogram.event - INFO - Update id=557185128 is handled. Duration 267 ms by bot id=5702092394
2025-10-03 17:28:53,052 - aiogram.event - INFO - Update id=557185129 is not handled. Duration 1 ms by bot id=5702092394
2025-10-03 17:35:01,861 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:35:01,862 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:35:01,863 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:35:02,041 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:35:07,210 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:35:07,211 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:35:07,468 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:35:13,943 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:35:14,049 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:35:14,171 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:35:14,172 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:35:14,173 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:35:14,177 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:14,178 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:14,179 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:35:14,179 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:35:14,592 - aiogram.event - INFO - Update id=557185130 is handled. Duration 649 ms by bot id=5702092394
2025-10-03 17:35:15,798 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:35:15,799 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:35:15,824 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:35:15,841 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:35:15,854 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:35:15,868 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:35:15,880 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:35:15,883 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:35:15,884 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:35:15,885 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:15,885 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:35:16,129 - aiogram.event - INFO - Update id=557185131 is handled. Duration 331 ms by bot id=5702092394
2025-10-03 17:35:17,791 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:35:17,808 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:35:17,814 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:35:17,818 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:35:17,819 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:17,821 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:35:17,944 - aiogram.event - INFO - Update id=557185132 is handled. Duration 246 ms by bot id=5702092394
2025-10-03 17:35:19,380 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:35:19,380 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:35:19,399 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:35:19,417 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:35:19,438 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:35:19,453 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:35:19,469 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:35:19,477 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:35:19,479 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:35:19,479 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:35:19,480 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:35:19,481 - src.infrastructure.services.logger - ERROR - Ошибка при возврате к списку товаров
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
2025-10-03 17:35:19,576 - aiogram.event - INFO - Update id=557185133 is not handled. Duration 285 ms by bot id=5702092394
2025-10-03 17:35:19,576 - aiogram.event - ERROR - Cause exception while process update id=557185133 by bot id=5702092394
TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 27, in handle_back_to_products
    kb = InlineKeyboardMarkup(inline_keyboard=buttons)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 55 validation errors for InlineKeyboardMarkup
inline_keyboard.0.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Кардиган SALPAGARINI'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:2000108942'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.0.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Наклейк...арту крекер'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1818184981'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.1.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Xiaomi S20 EU (... и влажная ...'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1728110604'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.2.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Легинсы ...порт Фитнес'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1668950019'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.3.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.0
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('text', 'Ray-Ban Очк...нцезащитные'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.1
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.2
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_data', 'product:1565602444'), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.3
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('web_app', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.4
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('login_url', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.5
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.6
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_current_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.7
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('switch_inline_query_chosen_chat', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.8
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('copy_text', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.9
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('callback_game', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type
inline_keyboard.4.10
  Input should be a valid dictionary or instance of InlineKeyboardButton [type=model_type, input_value=('pay', None), input_type=tuple]
    For further information visit https://errors.pydantic.dev/2.11/v/model_type

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 309, in _process_update
    response = await self.feed_update(bot, update, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 158, in feed_update
    response = await self.update.wrap_outer_middleware(
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<7 lines>...
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\error.py", line 25, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\middlewares\user_context.py", line 56, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\fsm\middleware.py", line 42, in __call__
    return await handler(event, data)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\dispatcher.py", line 276, in _listen_update
    return await self.propagate_event(update_type=update_type, event=event, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 146, in propagate_event
    return await observer.wrap_outer_middleware(_wrapped, event=event, data=kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 141, in _wrapped
    return await self._propagate_event(
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        observer=observer, update_type=update_type, event=telegram_event, **data
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\router.py", line 166, in _propagate_event
    response = await observer.trigger(event, **kwargs)
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\telegram.py", line 121, in trigger
    return await wrapped_inner(event, kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\dispatcher\event\handler.py", line 43, in call
    return await wrapped()
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\navigation.py", line 36, in handle_back_to_products
    await call.answer(f"❌ Ошибка: {e}")  # Отправляем сообщение об ошибке
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: MESSAGE_TOO_LONG
2025-10-03 17:40:19,657 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 17:40:19,669 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 17:40:19,669 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 17:40:19,812 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:42:06,455 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 17:42:06,457 - aiogram.dispatcher - INFO - Start polling
2025-10-03 17:42:06,726 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 17:42:11,154 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 17:42:11,260 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:42:11,323 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 17:42:11,324 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 17:42:11,324 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 17:42:11,326 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:11,327 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:11,328 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:42:11,328 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 17:42:11,604 - aiogram.event - INFO - Update id=557185134 is handled. Duration 449 ms by bot id=5702092394
2025-10-03 17:42:12,810 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:42:12,810 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:42:12,826 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:42:12,841 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:42:12,850 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:42:12,865 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:42:12,875 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:42:12,880 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:42:12,882 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:42:12,882 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:12,883 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:42:12,996 - aiogram.event - INFO - Update id=557185135 is handled. Duration 187 ms by bot id=5702092394
2025-10-03 17:42:13,957 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:42:13,967 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:42:13,972 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 17:42:13,975 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:42:13,976 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:13,977 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:42:14,119 - aiogram.event - INFO - Update id=557185136 is handled. Duration 259 ms by bot id=5702092394
2025-10-03 17:42:15,308 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 17:42:15,309 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 17:42:15,320 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 17:42:15,330 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 17:42:15,348 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 17:42:15,361 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 17:42:15,377 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 17:42:15,380 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 17:42:15,383 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 17:42:15,384 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 17:42:15,384 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 17:42:15,537 - aiogram.event - INFO - Update id=557185137 is handled. Duration 396 ms by bot id=5702092394
2025-10-03 18:05:56,276 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:05:56,284 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:05:56,286 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:05:56,289 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:05:56,290 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:05:56,291 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:05:56,407 - aiogram.event - INFO - Update id=557185138 is handled. Duration 239 ms by bot id=5702092394
2025-10-03 18:05:58,003 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:05:58,005 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:05:58,019 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:05:58,033 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:05:58,048 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:05:58,062 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:05:58,077 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:05:58,082 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:05:58,086 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:05:58,087 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:05:58,088 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:05:58,199 - aiogram.event - INFO - Update id=557185139 is handled. Duration 298 ms by bot id=5702092394
2025-10-03 18:05:59,560 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:05:59,568 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:05:59,572 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:05:59,575 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:05:59,575 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:05:59,576 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:05:59,722 - aiogram.event - INFO - Update id=557185140 is handled. Duration 262 ms by bot id=5702092394
2025-10-03 18:06:00,676 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 18:06:00,760 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 18:06:00,761 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:06:00,768 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:06:04,352 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 18:06:15,759 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 18:06:15,760 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 18:06:15,897 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 18:06:15,931 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 18:06:15,970 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 18:06:16,022 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 18:06:16,065 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 18:06:16,089 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 18:06:16,167 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 18:06:17,879 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 18:06:17,883 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:06:17,889 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id='b8690b1c-089b-4646-84e0-1fcc1c28dd6f', product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))
2025-10-03 18:06:17,890 - src.application.use_cases.upd_product - INFO - Цена для товара 1818184981 обновлена: Price(id='b8690b1c-089b-4646-84e0-1fcc1c28dd6f', product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))
2025-10-03 18:06:17,896 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339))]) (ID: 1818184981)
2025-10-03 18:06:17,899 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 18:06:17,916 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:06:17,916 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:06:17,917 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:06:17,917 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-10-03 18:06:17,919 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 230, in handle_update_price
    reply_markup=InlineKeyboardMarkup().add(
                 ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-03 18:06:17,950 - aiogram.event - INFO - Update id=557185141 is handled. Duration 17276 ms by bot id=5702092394
2025-10-03 18:06:26,791 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:06:26,798 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:06:26,800 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:06:26,803 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:06:26,804 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:06:26,804 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:06:26,805 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:06:26,959 - aiogram.event - INFO - Update id=557185142 is handled. Duration 477 ms by bot id=5702092394
2025-10-03 18:09:05,579 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:09:05,581 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:09:05,582 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:09:05,736 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:09:11,544 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:09:11,547 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:09:11,547 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:09:11,773 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:09:17,320 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:09:17,426 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:09:17,492 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:09:17,493 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:09:17,493 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:09:17,496 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:17,498 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:17,498 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:09:17,499 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:09:17,757 - aiogram.event - INFO - Update id=557185143 is handled. Duration 438 ms by bot id=5702092394
2025-10-03 18:09:18,836 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:09:18,837 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:09:18,861 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:09:18,883 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:09:18,895 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:09:18,907 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:09:18,917 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:09:18,920 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:09:18,922 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:09:18,923 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:18,923 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:09:19,025 - aiogram.event - INFO - Update id=557185144 is handled. Duration 190 ms by bot id=5702092394
2025-10-03 18:09:20,355 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:09:20,365 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:09:20,368 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:09:20,370 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:09:20,371 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:20,371 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:09:20,506 - aiogram.event - INFO - Update id=557185145 is handled. Duration 283 ms by bot id=5702092394
2025-10-03 18:09:22,023 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:09:22,024 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:09:22,035 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:09:22,054 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:09:22,078 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:09:22,102 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:09:22,122 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:09:22,130 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:09:22,133 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:09:22,134 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:09:22,135 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:09:22,280 - aiogram.event - INFO - Update id=557185146 is handled. Duration 396 ms by bot id=5702092394
2025-10-03 18:10:01,298 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:10:01,299 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:10:01,312 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:10:01,318 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:10:01,324 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:10:01,334 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:10:01,340 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:10:01,343 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:10:01,347 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:10:01,348 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:10:01,348 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:10:01,436 - aiogram.event - INFO - Update id=557185147 is handled. Duration 139 ms by bot id=5702092394
2025-10-03 18:10:02,972 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:10:02,979 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:10:02,983 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:10:02,985 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:10:02,986 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:10:02,986 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:10:03,156 - aiogram.event - INFO - Update id=557185148 is handled. Duration 321 ms by bot id=5702092394
2025-10-03 18:10:04,906 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:10:04,915 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:10:04,917 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:10:04,919 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:10:04,920 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:10:04,920 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:10:04,920 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:10:05,006 - aiogram.event - INFO - Update id=557185149 is handled. Duration 192 ms by bot id=5702092394
2025-10-03 18:14:45,265 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:14:45,268 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:14:45,268 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:14:45,415 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:15:35,935 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:15:35,936 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:15:35,936 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:15:36,171 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:15:40,586 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:15:40,703 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:40,782 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:15:40,782 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:15:40,783 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:15:40,784 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:40,785 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:40,786 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:40,786 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:15:41,043 - aiogram.event - INFO - Update id=557185150 is handled. Duration 457 ms by bot id=5702092394
2025-10-03 18:15:43,304 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:43,305 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:15:43,331 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:15:43,342 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:15:43,355 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:15:43,367 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:15:43,385 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:15:43,388 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:15:43,389 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:15:43,390 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:43,391 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:43,645 - aiogram.event - INFO - Update id=557185151 is handled. Duration 342 ms by bot id=5702092394
2025-10-03 18:15:45,057 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:45,065 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:15:45,068 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:15:45,070 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:15:45,070 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:45,071 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:45,197 - aiogram.event - INFO - Update id=557185152 is handled. Duration 269 ms by bot id=5702092394
2025-10-03 18:15:46,370 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:46,382 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:15:46,385 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:15:46,387 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:15:46,388 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:46,389 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:46,390 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:15:46,489 - aiogram.event - INFO - Update id=557185153 is handled. Duration 203 ms by bot id=5702092394
2025-10-03 18:15:53,884 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:15:53,891 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:15:53,895 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:15:53,898 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:15:53,899 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:15:53,899 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:15:53,900 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:15:53,990 - aiogram.event - INFO - Update id=557185154 is handled. Duration 198 ms by bot id=5702092394
2025-10-03 18:24:34,156 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:24:34,159 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:24:34,160 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:24:34,326 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:24:41,784 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:24:41,788 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:24:41,788 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:24:42,017 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:24:46,496 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:24:46,579 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:46,625 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:24:46,626 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:24:46,626 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:24:46,627 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:46,627 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:46,627 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:46,628 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:24:46,863 - aiogram.event - INFO - Update id=557185155 is handled. Duration 367 ms by bot id=5702092394
2025-10-03 18:24:47,701 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:47,702 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:24:47,724 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:24:47,733 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:24:47,745 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:24:47,752 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:24:47,763 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:24:47,767 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:24:47,772 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:24:47,773 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:47,774 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:47,869 - aiogram.event - INFO - Update id=557185156 is handled. Duration 168 ms by bot id=5702092394
2025-10-03 18:24:49,201 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:49,209 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:24:49,213 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:24:49,214 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:24:49,215 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:49,216 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:49,322 - aiogram.event - INFO - Update id=557185157 is handled. Duration 216 ms by bot id=5702092394
2025-10-03 18:24:50,299 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:50,310 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:24:50,313 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:24:50,315 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:24:50,316 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:50,316 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:50,317 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:24:50,430 - aiogram.event - INFO - Update id=557185158 is handled. Duration 234 ms by bot id=5702092394
2025-10-03 18:24:53,350 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:24:53,363 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:24:53,367 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:24:53,372 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:24:53,373 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:24:53,374 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:24:53,374 - src.infrastructure.services.logger - ERROR - Ошибка при запросе подтверждения удаления
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\delete.py", line 40, in handle_delete_product_request
    InlineKeyboardButton("✅ Да, удалить", callback_data=f"confirm_delete:{product_id}"),
    ~~~~~~~~~~~~~~~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: BaseModel.__init__() takes 1 positional argument but 2 were given
2025-10-03 18:24:53,511 - aiogram.event - INFO - Update id=557185159 is handled. Duration 297 ms by bot id=5702092394
2025-10-03 18:26:20,218 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:26:20,221 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:26:20,222 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:26:20,380 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:27:04,762 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:27:04,765 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:27:04,765 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:27:05,020 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:27:08,627 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:27:08,684 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:08,768 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['2000108942', '1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:27:08,769 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:27:08,769 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:27:08,770 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:08,771 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:08,771 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:08,771 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:27:09,036 - aiogram.event - INFO - Update id=557185160 is handled. Duration 408 ms by bot id=5702092394
2025-10-03 18:27:09,665 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:09,666 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:27:09,689 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:27:09,702 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:27:09,720 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:27:09,739 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:27:09,753 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:27:09,759 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:27:09,762 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:27:09,763 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:09,764 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:09,878 - aiogram.event - INFO - Update id=557185161 is handled. Duration 214 ms by bot id=5702092394
2025-10-03 18:27:10,806 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:10,821 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:27:10,825 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:27:10,827 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:27:10,828 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:10,829 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:10,933 - aiogram.event - INFO - Update id=557185162 is handled. Duration 219 ms by bot id=5702092394
2025-10-03 18:27:11,739 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:11,752 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:27:11,755 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:27:11,757 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:27:11,758 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:11,758 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:11,872 - aiogram.event - INFO - Update id=557185163 is handled. Duration 210 ms by bot id=5702092394
2025-10-03 18:27:13,472 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:13,484 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='2000108942', user_id='', name='Кардиган SALPAGARINI', link='https://www.ozon.ru/product/kardigan-salpagarini-2000108942/?from=share_android&perehod=smm_share_button_productpage_link', image_url='https://ir.ozone.ru/s3/multimedia-1-4/wc1000/7441839580.jpg', rating=4.9, categories='{Одежда,Женщинам,"Джемперы, свитеры и кардиганы",SALPAGARINI}', prices=[Price(id=12, product_id='2000108942', with_card=1553, without_card=1689, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 28, 17, 25, 0, 518096))]) (ID: 2000108942)
2025-10-03 18:27:13,489 - src.infrastructure.database.repositories.price_repository - INFO - Найдено 1 цен для продукта 2000108942
2025-10-03 18:27:13,489 - src.infrastructure.database.repositories.price_repository - INFO - Попытка удаления цены с ID: 12
2025-10-03 18:27:13,495 - src.infrastructure.database.repositories.price_repository - INFO - Цена с ID 12 успешно удалена
2025-10-03 18:27:13,497 - src.infrastructure.database.repositories.product_repository - INFO - Попытка удаления товара с ID: 2000108942
2025-10-03 18:27:13,508 - src.infrastructure.database.repositories.product_repository - INFO - Товар с ID 2000108942 успешно удален
2025-10-03 18:27:13,511 - src.infrastructure.database.repositories.user_repository - WARNING - Пользователь с id  не найден
2025-10-03 18:27:13,512 - src.application.use_cases.delete_product - INFO - Операция удаления выполнена для ID 2000108942
2025-10-03 18:27:13,513 - src.core.decorators - INFO - Функция delete_product: выполняется commit транзакции
2025-10-03 18:27:13,539 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:13,540 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:13,541 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:13,542 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:27:13,543 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:27:13,558 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:27:13,571 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:27:13,584 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:27:13,598 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:27:13,601 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:27:13,603 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:27:13,604 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:27:13,604 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:27:13,715 - aiogram.event - INFO - Update id=557185164 is handled. Duration 389 ms by bot id=5702092394
2025-10-03 18:27:23,534 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 18:27:23,535 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 18:27:23,535 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 18:27:23,687 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:32:22,794 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 18:32:22,796 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 18:32:22,796 - aiogram.dispatcher - INFO - Start polling
2025-10-03 18:32:23,056 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 18:32:30,042 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 18:32:30,176 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:32:30,301 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 18:32:30,301 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 18:32:30,302 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 18:32:30,304 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:30,304 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:30,305 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:32:30,305 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 18:32:30,558 - aiogram.event - INFO - Update id=557185165 is handled. Duration 517 ms by bot id=5702092394
2025-10-03 18:32:31,583 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:32:31,583 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 18:32:31,625 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:31,657 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 18:32:31,676 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 18:32:31,690 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 18:32:31,695 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 18:32:31,700 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:32:31,700 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:31,701 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:32:31,825 - aiogram.event - INFO - Update id=557185166 is handled. Duration 243 ms by bot id=5702092394
2025-10-03 18:32:33,189 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:32:33,208 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:33,214 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 18:32:33,221 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 18:32:33,221 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:33,222 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:32:33,361 - aiogram.event - INFO - Update id=557185167 is handled. Duration 264 ms by bot id=5702092394
2025-10-03 18:32:34,590 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 18:32:34,670 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 18:32:34,671 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 18:32:34,697 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:36,581 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 18:32:48,105 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 18:32:48,105 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 18:32:48,193 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 18:32:48,271 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 18:32:48,343 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 18:32:48,396 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 18:32:48,457 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 18:32:48,496 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 18:32:48,652 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 18:32:50,649 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 18:32:50,656 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:50,660 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id='38fdfc6b-4984-4a7d-9f33-67d8146b0516', product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))
2025-10-03 18:32:50,661 - src.application.use_cases.upd_product - INFO - Цена для товара 1818184981 обновлена: Price(id='38fdfc6b-4984-4a7d-9f33-67d8146b0516', product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))
2025-10-03 18:32:50,671 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458))]) (ID: 1818184981)
2025-10-03 18:32:50,676 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 18:32:50,689 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:50,690 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 18:32:50,691 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 18:32:50,691 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-10-03 18:32:50,693 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 230, in handle_update_price
    reply_markup=InlineKeyboardMarkup().add(
                 ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-03 18:32:50,700 - aiogram.event - INFO - Update id=557185168 is handled. Duration 16115 ms by bot id=5702092394
2025-10-03 19:18:29,538 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 19:18:29,543 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 19:18:29,544 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 19:18:29,710 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 19:21:00,596 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 19:21:00,598 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 19:21:00,599 - aiogram.dispatcher - INFO - Start polling
2025-10-03 19:21:00,869 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 19:21:15,442 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 19:21:15,606 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:15,723 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 19:21:15,723 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 19:21:15,724 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 19:21:15,728 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:15,729 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:15,730 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:15,730 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 19:21:16,004 - aiogram.event - INFO - Update id=557185169 is handled. Duration 562 ms by bot id=5702092394
2025-10-03 19:21:16,393 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:16,394 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 19:21:16,421 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:16,440 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 19:21:16,450 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 19:21:16,471 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 19:21:16,476 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 19:21:16,478 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:21:16,479 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:16,480 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:16,607 - aiogram.event - INFO - Update id=557185170 is handled. Duration 214 ms by bot id=5702092394
2025-10-03 19:21:17,771 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:17,785 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:17,790 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 19:21:17,793 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:21:17,794 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:17,794 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:17,960 - aiogram.event - INFO - Update id=557185171 is handled. Duration 268 ms by bot id=5702092394
2025-10-03 19:21:19,507 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:19,508 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 19:21:19,524 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:19,549 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 19:21:19,567 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 19:21:19,588 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 19:21:19,594 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 19:21:19,604 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:21:19,605 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:19,606 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:19,771 - aiogram.event - INFO - Update id=557185172 is handled. Duration 353 ms by bot id=5702092394
2025-10-03 19:21:21,034 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:21,050 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:21,056 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 19:21:21,058 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:21:21,060 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:21,065 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:21,167 - aiogram.event - INFO - Update id=557185173 is handled. Duration 220 ms by bot id=5702092394
2025-10-03 19:21:21,989 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 19:21:22,076 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 19:21:22,077 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:21:22,090 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:25,271 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 19:21:36,660 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 19:21:36,660 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 19:21:36,713 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 19:21:36,752 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 19:21:36,788 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 19:21:36,820 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 19:21:36,852 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 19:21:36,876 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 19:21:36,945 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 19:21:38,660 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 19:21:38,668 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:38,680 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))
2025-10-03 19:21:38,681 - src.application.use_cases.upd_product - INFO - Цена для товара 1818184981 обновлена: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))
2025-10-03 19:21:38,688 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873))]) (ID: 1818184981)
2025-10-03 19:21:38,690 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 19:21:38,698 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:38,699 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:21:38,700 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:21:38,700 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-10-03 19:21:38,704 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 230, in handle_update_price
    reply_markup=InlineKeyboardMarkup().add(
                 ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-03 19:21:38,706 - aiogram.event - INFO - Update id=557185174 is handled. Duration 16720 ms by bot id=5702092394
2025-10-03 19:22:18,619 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 19:22:18,620 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 19:22:18,620 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 19:22:18,781 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 19:22:23,752 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 19:22:23,754 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 19:22:23,755 - aiogram.dispatcher - INFO - Start polling
2025-10-03 19:22:24,017 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 19:22:26,476 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 19:22:26,583 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:22:26,583 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 19:22:26,698 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:26,716 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 19:22:26,736 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 19:22:26,758 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 19:22:26,768 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 19:22:26,771 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:22:26,772 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:22:26,772 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:22:27,088 - aiogram.event - INFO - Update id=557185175 is handled. Duration 614 ms by bot id=5702092394
2025-10-03 19:22:29,282 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:22:29,292 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:29,304 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 19:22:29,307 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 19:22:29,308 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:22:29,308 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:22:29,552 - aiogram.event - INFO - Update id=557185176 is handled. Duration 455 ms by bot id=5702092394
2025-10-03 19:22:30,633 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 19:22:30,634 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 19:22:30,634 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 19:22:30,650 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:32,387 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 19:22:43,785 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 19:22:43,786 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 19:22:43,848 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 19:22:43,883 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 19:22:43,913 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 19:22:43,946 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 19:22:43,984 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 19:22:44,005 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 19:22:44,074 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 19:22:45,884 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 19:22:45,888 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:45,891 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))
2025-10-03 19:22:45,892 - src.application.use_cases.upd_product - INFO - Цена для товара 1818184981 обновлена: Price(id=None, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))
2025-10-03 19:22:45,903 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092))]) (ID: 1818184981)
2025-10-03 19:22:45,906 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 19:22:45,919 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:22:45,920 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 19:22:45,921 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 19:22:45,921 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = await product_service.update_product_price(product_id)
                      ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
TypeError: object dict can't be used in 'await' expression
2025-10-03 19:22:45,922 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 230, in handle_update_price
    reply_markup=InlineKeyboardMarkup().add(
                 ~~~~~~~~~~~~~~~~~~~~^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\pydantic\main.py", line 253, in __init__
    validated_self = self.__pydantic_validator__.validate_python(data, self_instance=self)
pydantic_core._pydantic_core.ValidationError: 1 validation error for InlineKeyboardMarkup
inline_keyboard
  Field required [type=missing, input_value={}, input_type=dict]
    For further information visit https://errors.pydantic.dev/2.11/v/missing
2025-10-03 19:22:45,924 - aiogram.event - INFO - Update id=557185177 is handled. Duration 15297 ms by bot id=5702092394
2025-10-03 22:09:48,752 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:09:48,757 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:09:48,758 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:09:49,017 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:09:56,833 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 22:09:56,834 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 22:09:56,835 - aiogram.dispatcher - INFO - Start polling
2025-10-03 22:09:57,083 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:10:05,072 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 22:10:05,724 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:10:05,903 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 22:10:05,903 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 22:10:05,904 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 22:10:05,909 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:05,910 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:05,911 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:10:05,911 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 22:10:06,156 - aiogram.event - INFO - Update id=557185178 is handled. Duration 1084 ms by bot id=5702092394
2025-10-03 22:10:06,954 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:10:06,955 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 22:10:06,997 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:10:07,040 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 22:10:07,071 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:07,100 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 22:10:07,107 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 22:10:07,111 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:10:07,113 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:07,113 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:10:07,235 - aiogram.event - INFO - Update id=557185179 is handled. Duration 282 ms by bot id=5702092394
2025-10-03 22:10:08,463 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:10:08,499 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:08,505 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 22:10:08,508 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:10:08,509 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:08,510 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:10:08,607 - aiogram.event - INFO - Update id=557185180 is handled. Duration 230 ms by bot id=5702092394
2025-10-03 22:10:09,413 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1668950019
2025-10-03 22:10:09,414 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 22:10:09,414 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:10:09,443 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:13,235 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 22:10:24,601 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-03 22:10:24,602 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-03 22:10:25,116 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-03 22:10:25,232 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-03 22:10:25,296 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 22:10:25,350 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1575
2025-10-03 22:10:25,509 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1713
2025-10-03 22:10:25,566 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-03 22:10:25,771 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-03 22:10:27,656 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 22:10:27,662 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:27,666 - src.infrastructure.database.repositories.price_repository - INFO - Сохранение цены: Price(id=None, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))
2025-10-03 22:10:27,667 - src.application.use_cases.upd_product - INFO - Цена для товара 1668950019 обновлена: Price(id=None, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))
2025-10-03 22:10:27,673 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209))]) (ID: 1668950019)
2025-10-03 22:10:27,677 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-03 22:10:27,697 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:27,698 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:10:27,699 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:10:27,699 - src.infrastructure.services.logger - INFO - Получили обновленный товар: <class 'dict'> - {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'link': 'https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'rating': 4.9, 'categories': '{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', 'latest_price': {'with_card': 1568, 'without_card': 1705}}
2025-10-03 22:10:27,700 - src.infrastructure.services.logger - INFO - Формируем новое сообщение
2025-10-03 22:10:27,701 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Легинсы FITFOX Спорт Фитнес
💳 Цена с картой: 1568 ₽
💵 Цена без карты: 1705 ₽
🔗 <a href='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/'>Ссылка на товар</a>
2025-10-03 22:10:27,702 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-03 22:10:27,702 - src.infrastructure.services.logger - INFO - Обновляем сообщение с новыми данными
2025-10-03 22:10:27,982 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 213, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-03 22:10:28,053 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-03 22:10:28,056 - aiogram.event - INFO - Update id=557185181 is handled. Duration 18645 ms by bot id=5702092394
2025-10-03 22:43:21,646 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:43:21,648 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:43:21,649 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:43:21,903 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:43:27,093 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 22:43:27,094 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 22:43:27,095 - aiogram.dispatcher - INFO - Start polling
2025-10-03 22:43:27,349 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:43:38,183 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 22:43:38,334 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:43:38,476 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 22:43:38,477 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 22:43:38,478 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 22:43:38,480 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:43:38,481 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:43:38,482 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:43:38,483 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 22:43:38,837 - aiogram.event - INFO - Update id=557185182 is handled. Duration 654 ms by bot id=5702092394
2025-10-03 22:43:40,200 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:43:40,201 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 22:43:40,250 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:43:40,283 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 22:43:40,319 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-03 22:43:40,348 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 22:43:40,354 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 22:43:40,359 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:43:40,362 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:43:40,363 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:43:40,604 - aiogram.event - INFO - Update id=557185183 is handled. Duration 405 ms by bot id=5702092394
2025-10-03 22:43:42,121 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:43:42,144 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:43:42,152 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 22:43:42,156 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:43:42,157 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:43:42,158 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:43:42,268 - aiogram.event - INFO - Update id=557185184 is handled. Duration 255 ms by bot id=5702092394
2025-10-03 22:43:43,350 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 22:43:43,350 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 22:43:43,351 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:43:43,371 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:43:45,549 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-03 22:43:56,998 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 22:43:56,999 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-03 22:43:57,059 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-03 22:43:57,107 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-03 22:43:57,146 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-03 22:43:57,178 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-03 22:43:57,213 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-03 22:43:57,239 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-03 22:43:57,310 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-03 22:43:59,020 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-03 22:43:59,021 - src.core.uow - WARNING - Исключение в Unit of Work: TypeError: UpdateProductPriceUseCase.__init__() missing 1 required positional argument: 'parser'
2025-10-03 22:43:59,024 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:43:59,024 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:43:59,025 - src.core.decorators - ERROR - Ошибка в функции update_product_price: UpdateProductPriceUseCase.__init__() missing 1 required positional argument: 'parser'
2025-10-03 22:43:59,026 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 124, in update_product_price
    use_case = UpdateProductPriceUseCase(
        product_repo=self.uow.product_repository,
        price_repo=self.uow.price_repository,
    )
TypeError: UpdateProductPriceUseCase.__init__() missing 1 required positional argument: 'parser'
2025-10-03 22:43:59,040 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-03 22:43:59,042 - aiogram.event - INFO - Update id=557185185 is handled. Duration 15697 ms by bot id=5702092394
2025-10-03 22:45:43,149 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:45:43,150 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:45:43,151 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:45:43,365 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:45:48,093 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 22:45:48,094 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 22:45:48,095 - aiogram.dispatcher - INFO - Start polling
2025-10-03 22:45:48,330 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:45:52,472 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 22:45:52,609 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:45:52,752 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 22:45:52,753 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 22:45:52,754 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 22:45:52,756 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:45:52,757 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:45:52,758 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:45:52,758 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 22:45:53,029 - aiogram.event - INFO - Update id=557185186 is handled. Duration 557 ms by bot id=5702092394
2025-10-03 22:45:53,733 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:45:53,734 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 22:45:53,765 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:45:53,793 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 22:45:53,815 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-03 22:45:53,841 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 22:45:53,847 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 22:45:53,852 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:45:53,854 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:45:53,854 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:45:53,991 - aiogram.event - INFO - Update id=557185187 is handled. Duration 260 ms by bot id=5702092394
2025-10-03 22:45:55,339 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:45:55,353 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:45:55,358 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 22:45:55,361 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:45:55,362 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:45:55,363 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:45:55,486 - aiogram.event - INFO - Update id=557185188 is handled. Duration 232 ms by bot id=5702092394
2025-10-03 22:45:57,019 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 22:45:57,020 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 22:45:57,021 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:45:57,021 - src.core.uow - WARNING - Исключение в Unit of Work: TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:45:57,022 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:45:57,022 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:45:57,023 - src.core.decorators - ERROR - Ошибка в функции update_product_price: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:45:57,023 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:45:57,028 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-03 22:45:57,032 - aiogram.event - INFO - Update id=557185189 is handled. Duration 16 ms by bot id=5702092394
2025-10-03 22:50:13,812 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:50:13,813 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:50:13,814 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:50:14,074 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:50:20,114 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-03 22:50:20,116 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-03 22:50:20,117 - aiogram.dispatcher - INFO - Start polling
2025-10-03 22:50:20,340 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-03 22:50:26,766 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-03 22:50:26,923 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:50:27,082 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-03 22:50:27,083 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-03 22:50:27,084 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-03 22:50:27,088 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:50:27,089 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:50:27,091 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:50:27,093 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-03 22:50:27,385 - aiogram.event - INFO - Update id=557185190 is handled. Duration 620 ms by bot id=5702092394
2025-10-03 22:50:28,741 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:50:28,742 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-03 22:50:28,806 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:50:28,839 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-03 22:50:28,869 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-03 22:50:28,897 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-03 22:50:28,904 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-03 22:50:28,915 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:50:28,916 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:50:28,916 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:50:29,028 - aiogram.event - INFO - Update id=557185191 is handled. Duration 292 ms by bot id=5702092394
2025-10-03 22:50:30,078 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:50:30,102 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-03 22:50:30,117 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-03 22:50:30,121 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:50:30,124 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-03 22:50:30,128 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:50:30,255 - aiogram.event - INFO - Update id=557185192 is handled. Duration 284 ms by bot id=5702092394
2025-10-03 22:50:30,930 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-03 22:50:30,930 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-03 22:50:30,931 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-03 22:50:30,932 - src.core.uow - WARNING - Исключение в Unit of Work: TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:50:30,932 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-03 22:50:30,933 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-03 22:50:30,933 - src.core.decorators - ERROR - Ошибка в функции update_product_price: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:50:30,934 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-03 22:50:30,940 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-03 22:50:30,942 - aiogram.event - INFO - Update id=557185193 is handled. Duration 17 ms by bot id=5702092394
2025-10-03 22:52:43,376 - aiogram.dispatcher - INFO - Polling stopped
2025-10-03 22:52:43,377 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-03 22:52:43,378 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-03 22:52:43,507 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:05:53,717 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:05:53,720 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:05:53,720 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:05:53,965 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:06:04,381 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:06:04,879 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:06:05,003 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 09:06:05,003 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 09:06:05,004 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 09:06:05,006 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:06:05,007 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:06:05,008 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:06:05,008 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 09:06:05,274 - aiogram.event - INFO - Update id=557185194 is handled. Duration 895 ms by bot id=5702092394
2025-10-04 09:06:06,371 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:06:06,372 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:06:06,409 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:06:06,439 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:06:06,461 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:06:06,477 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:06:06,486 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:06:06,493 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:06:06,494 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:06:06,494 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:06:06,589 - aiogram.event - INFO - Update id=557185195 is handled. Duration 219 ms by bot id=5702092394
2025-10-04 09:06:07,823 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:06:07,838 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:06:07,845 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:06:07,848 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:06:07,851 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:06:07,853 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:06:07,975 - aiogram.event - INFO - Update id=557185196 is handled. Duration 252 ms by bot id=5702092394
2025-10-04 09:06:10,181 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:06:10,182 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:06:10,183 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:06:10,184 - src.core.uow - WARNING - Исключение в Unit of Work: TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-04 09:06:10,185 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:06:10,185 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:06:10,186 - src.core.decorators - ERROR - Ошибка в функции update_product_price: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-04 09:06:10,186 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
TypeError: ProductService.update_product_price() missing 1 required positional argument: 'parser'
2025-10-04 09:06:10,254 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-04 09:06:10,256 - aiogram.event - INFO - Update id=557185197 is handled. Duration 77 ms by bot id=5702092394
2025-10-04 09:07:43,549 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:07:43,550 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:07:43,551 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:07:43,689 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:07:48,164 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:07:48,165 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:07:48,166 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:07:48,406 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:07:52,534 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:07:52,632 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:07:52,633 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:07:52,719 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:07:52,731 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:07:52,741 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:07:52,756 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:07:52,760 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:07:52,765 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:07:52,766 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:07:52,767 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:07:53,014 - aiogram.event - INFO - Update id=557185198 is handled. Duration 481 ms by bot id=5702092394
2025-10-04 09:07:54,433 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:07:54,444 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:07:54,448 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:07:54,451 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:07:54,452 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:07:54,452 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:07:54,545 - aiogram.event - INFO - Update id=557185199 is handled. Duration 207 ms by bot id=5702092394
2025-10-04 09:07:55,725 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:07:55,726 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:07:55,727 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:07:55,739 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:07:58,662 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:08:10,015 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:08:10,016 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:08:10,161 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:08:10,182 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:08:10,207 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:08:10,236 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:08:10,257 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:08:10,274 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:08:10,328 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:08:12,121 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:08:12,126 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:08:13,352 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:08:24,699 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:08:24,699 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:08:24,746 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:08:24,780 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:08:24,808 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:08:24,837 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:08:24,864 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:08:24,882 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:08:24,936 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:08:26,572 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:08:26,573 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: 'with_card'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'
2025-10-04 09:08:26,587 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:08:26,589 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:08:26,590 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:08:26,591 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:08:26,591 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 80, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:08:26,595 - src.infrastructure.services.logger - ERROR - Не удалось обновить сообщение с ошибкой
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 235, in handle_update_price
    f'❌ Ошибка при обновлении цены: {e}',
                                      ^
UnboundLocalError: cannot access local variable 'e' where it is not associated with a value
2025-10-04 09:08:26,597 - aiogram.event - INFO - Update id=557185200 is handled. Duration 30874 ms by bot id=5702092394
2025-10-04 09:12:16,940 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:12:16,942 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:12:16,943 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:12:17,105 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:12:21,198 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:12:21,201 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:12:21,201 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:12:21,445 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:12:28,201 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:12:28,273 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:12:28,273 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:12:28,351 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:12:28,359 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:12:28,370 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:12:28,379 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:12:28,381 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:12:28,385 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:12:28,386 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:12:28,386 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:12:28,660 - aiogram.event - INFO - Update id=557185201 is handled. Duration 459 ms by bot id=5702092394
2025-10-04 09:12:30,153 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:12:30,160 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:12:30,163 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:12:30,166 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:12:30,167 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:12:30,167 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:12:30,270 - aiogram.event - INFO - Update id=557185202 is handled. Duration 214 ms by bot id=5702092394
2025-10-04 09:12:31,263 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:12:31,264 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:12:31,265 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:12:31,273 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:12:32,635 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:12:44,410 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:12:44,410 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:12:44,481 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:12:44,526 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:12:44,558 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:12:44,588 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:12:44,624 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:12:44,656 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:12:44,749 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:12:46,547 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:12:46,552 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:12:47,856 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:12:59,211 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:12:59,212 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:12:59,282 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:12:59,336 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:12:59,375 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:12:59,410 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:12:59,443 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:12:59,472 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:12:59,537 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:13:01,189 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:13:01,189 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: 'with_card'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'
2025-10-04 09:13:01,192 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:13:01,193 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:13:01,193 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:13:01,193 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:13:01,193 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 80, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:13:01,427 - aiogram.event - INFO - Update id=557185203 is handled. Duration 30167 ms by bot id=5702092394
2025-10-04 09:15:12,043 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:15:12,044 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:15:12,045 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:15:12,210 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:33:15,680 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:33:15,681 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:33:15,682 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:33:16,001 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:33:23,597 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:33:23,712 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:33:44,766 - src.infrastructure.services.product_service - ERROR - Ошибка при создании пользователя 515084006: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:33:44,767 - src.core.uow - WARNING - Исключение в Unit of Work: UserCreationError: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:33:44,768 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:33:44,768 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:33:44,769 - src.core.decorators - ERROR - Ошибка в функции create_user: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:33:44,769 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:33:44,776 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:34:15,178 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:34:15,180 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:34:15,180 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:34:15,390 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:34:15,464 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:34:15,530 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:34:36,586 - src.infrastructure.services.product_service - ERROR - Ошибка при создании пользователя 515084006: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:34:36,587 - src.core.uow - WARNING - Исключение в Unit of Work: UserCreationError: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:34:36,588 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:34:36,588 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:34:36,589 - src.core.decorators - ERROR - Ошибка в функции create_user: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:34:36,589 - src.infrastructure.services.logger - WARNING - Ошибка создания пользователя 515084006: Ошибка создания пользователя: (psycopg2.OperationalError) connection to server at "192.168.1.50", port 5432 failed: Connection timed out (0x0000274C/10060)
	Is the server running on that host and accepting TCP/IP connections?

(Background on this error at: https://sqlalche.me/e/20/e3q8)
2025-10-04 09:34:36,665 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:31,839 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:51:31,842 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:51:31,842 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:51:32,113 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:51:40,691 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:51:40,789 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:40,919 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 09:51:40,920 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 09:51:40,920 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 09:51:40,922 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:51:40,923 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:51:40,923 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:51:40,924 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 09:51:41,233 - aiogram.event - INFO - Update id=557185209 is handled. Duration 542 ms by bot id=5702092394
2025-10-04 09:51:42,524 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:42,524 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:51:42,562 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:51:42,590 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:51:42,608 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:51:42,624 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:51:42,629 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:51:42,633 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:51:42,634 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:51:42,635 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:51:42,745 - aiogram.event - INFO - Update id=557185210 is handled. Duration 222 ms by bot id=5702092394
2025-10-04 09:51:43,663 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:43,679 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:51:43,685 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:51:43,689 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:51:43,690 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:51:43,691 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:51:43,795 - aiogram.event - INFO - Update id=557185211 is handled. Duration 235 ms by bot id=5702092394
2025-10-04 09:51:44,670 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:51:44,671 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:51:44,672 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:51:44,689 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:51:46,642 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:51:58,045 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:51:58,046 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:51:58,113 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:51:58,144 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:51:58,170 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:51:58,197 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:51:58,226 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:51:58,243 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:51:58,329 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:51:58,329 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:52:00,088 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:52:00,099 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:52:01,322 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:52:12,821 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:52:12,822 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:52:12,888 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:52:12,925 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:52:12,961 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:52:13,001 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:52:13,028 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:52:13,049 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:52:13,109 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:52:13,110 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:52:14,701 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:52:14,701 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: 'with_card'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'
2025-10-04 09:52:14,714 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:52:14,717 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:52:14,718 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:52:14,718 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:52:14,719 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 37, in execute
    new_with_card = parsed["with_card"]
                    ~~~~~~^^^^^^^^^^^^^
KeyError: 'with_card'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 84, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:52:14,990 - aiogram.event - INFO - Update id=557185212 is handled. Duration 30322 ms by bot id=5702092394
2025-10-04 09:53:04,875 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:53:04,879 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:53:04,879 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:53:05,016 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:53:11,756 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:53:11,757 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:53:11,758 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:53:11,999 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:53:17,835 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:53:17,938 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:53:18,040 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 09:53:18,041 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 09:53:18,041 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 09:53:18,043 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:53:18,043 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:53:18,044 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:53:18,045 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 09:53:18,323 - aiogram.event - INFO - Update id=557185213 is handled. Duration 487 ms by bot id=5702092394
2025-10-04 09:53:18,859 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:53:18,860 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:53:18,884 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:53:18,903 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:53:18,917 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:53:18,930 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:53:18,935 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:53:18,938 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:53:18,939 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:53:18,939 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:53:19,063 - aiogram.event - INFO - Update id=557185214 is handled. Duration 204 ms by bot id=5702092394
2025-10-04 09:53:20,348 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:53:20,359 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:53:20,364 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:53:20,370 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:53:20,370 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:53:20,371 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:53:20,492 - aiogram.event - INFO - Update id=557185215 is handled. Duration 558 ms by bot id=5702092394
2025-10-04 09:53:21,563 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:53:21,563 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:53:21,564 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:53:21,581 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:53:23,276 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:53:34,671 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:53:34,672 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:53:34,774 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:53:34,833 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:53:34,908 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:53:34,987 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:53:35,049 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:53:35,098 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:53:35,278 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:53:35,279 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:53:37,129 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:53:37,138 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:53:38,358 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:53:49,722 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:53:49,723 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:53:49,782 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:53:49,857 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:53:49,922 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:53:49,975 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:53:50,034 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:53:50,067 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:53:50,189 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:53:50,190 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:53:51,915 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:53:51,916 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 09:53:51,918 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: cannot access local variable 'new_price' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 67, in execute
    logger.info(f"Цена для товара {product_id} успешно обновлена: {new_price}")
                                                                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value
2025-10-04 09:53:51,919 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:53:51,921 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:53:51,922 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:53:51,922 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:53:51,922 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 67, in execute
    logger.info(f"Цена для товара {product_id} успешно обновлена: {new_price}")
                                                                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 84, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:53:52,146 - aiogram.event - INFO - Update id=557185216 is handled. Duration 30587 ms by bot id=5702092394
2025-10-04 09:55:34,617 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:55:34,618 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:55:34,619 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:55:34,752 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:55:39,475 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:55:39,477 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:55:39,477 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:55:39,719 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:56:37,354 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:56:37,416 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:56:37,417 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:56:37,512 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:56:37,530 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:56:37,545 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:56:37,560 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:56:37,565 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:56:37,568 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:56:37,568 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:56:37,569 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:56:37,955 - aiogram.event - INFO - Update id=557185217 is handled. Duration 601 ms by bot id=5702092394
2025-10-04 09:56:39,661 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:56:39,718 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:56:39,724 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:56:39,730 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:56:39,731 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:56:39,731 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:56:39,864 - aiogram.event - INFO - Update id=557185218 is handled. Duration 305 ms by bot id=5702092394
2025-10-04 09:56:45,916 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 09:56:45,917 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:56:45,918 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:56:45,930 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:56:47,360 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:56:58,726 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:56:58,728 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:56:58,982 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:56:59,026 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:56:59,057 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:56:59,092 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:56:59,140 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:56:59,162 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:56:59,229 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:56:59,229 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:57:01,049 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:57:01,057 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:57:02,245 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:57:13,715 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:57:13,715 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 09:57:13,796 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 09:57:13,826 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 09:57:13,853 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:57:13,880 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 09:57:13,923 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 09:57:13,944 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 09:57:14,004 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 09:57:14,005 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 09:57:15,688 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:57:15,689 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 09:57:15,689 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: cannot access local variable 'new_price' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 67, in execute
    logger.info(f"Цена для товара {product_id} успешно обновлена: {new_price.with_card}")
                                                                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value
2025-10-04 09:57:15,690 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:57:15,692 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:57:15,692 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:57:15,692 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:57:15,692 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 67, in execute
    logger.info(f"Цена для товара {product_id} успешно обновлена: {new_price.with_card}")
                                                                   ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 84, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 09:57:16,000 - aiogram.event - INFO - Update id=557185219 is handled. Duration 30085 ms by bot id=5702092394
2025-10-04 09:58:39,660 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 09:58:39,662 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 09:58:39,663 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 09:58:39,800 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:59:01,930 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 09:59:01,932 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 09:59:01,932 - aiogram.dispatcher - INFO - Start polling
2025-10-04 09:59:02,231 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 09:59:09,300 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 09:59:09,389 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:59:09,474 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:59:09,479 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:59:09,482 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:59:09,483 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:59:09,483 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:59:09,636 - aiogram.event - INFO - Update id=557185220 is handled. Duration 611 ms by bot id=5702092394
2025-10-04 09:59:11,320 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:59:11,320 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 09:59:11,342 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 09:59:11,358 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 09:59:11,372 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:59:11,388 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 09:59:11,393 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 09:59:11,397 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:59:11,398 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:59:11,399 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:59:11,555 - aiogram.event - INFO - Update id=557185221 is handled. Duration 432 ms by bot id=5702092394
2025-10-04 09:59:15,759 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:59:15,773 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:59:15,779 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 09:59:15,782 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 09:59:15,783 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 09:59:15,783 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 09:59:15,882 - aiogram.event - INFO - Update id=557185222 is handled. Duration 197 ms by bot id=5702092394
2025-10-04 09:59:19,939 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1668950019
2025-10-04 09:59:19,940 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 09:59:19,941 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 09:59:19,954 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:59:21,393 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:59:34,745 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-04 09:59:34,747 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-04 09:59:34,995 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-04 09:59:35,359 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-04 09:59:35,474 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 09:59:35,590 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1575
2025-10-04 09:59:35,989 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1713
2025-10-04 09:59:36,857 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-04 09:59:37,183 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-04 09:59:37,184 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1575, 'price_without_card': 1713, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-04 09:59:39,024 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 09:59:39,036 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 09:59:40,352 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 09:59:52,358 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-04 09:59:52,359 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/
2025-10-04 10:00:02,047 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1668950019
2025-10-04 10:00:02,075 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Легинсы FITFOX Спорт Фитнес
2025-10-04 10:00:02,131 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 10:00:02,158 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 1575
2025-10-04 10:00:02,193 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 1713
2025-10-04 10:00:02,215 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg
2025-10-04 10:00:02,300 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']
2025-10-04 10:00:02,301 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1668950019', 'name': 'Легинсы FITFOX Спорт Фитнес', 'rating': 4.9, 'price_with_card': 1575, 'price_without_card': 1713, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', 'categories': ['Одежда', 'Женщинам', 'Брюки, бриджи и капри', 'FITFOX']}
2025-10-04 10:00:04,015 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 10:00:04,016 - src.application.use_cases.upd_product - INFO - Цена товара 1668950019 не изменилась
2025-10-04 10:00:04,016 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: cannot access local variable 'new_price' where it is not associated with a value
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 75, in execute
    "with_card": new_price.with_card,
                 ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value
2025-10-04 10:00:04,019 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1668950019
2025-10-04 10:00:04,021 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 10:00:04,021 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 10:00:04,021 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1668950019
2025-10-04 10:00:04,022 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 75, in execute
    "with_card": new_price.with_card,
                 ^^^^^^^^^
UnboundLocalError: cannot access local variable 'new_price' where it is not associated with a value

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 85, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1668950019
2025-10-04 10:00:04,348 - aiogram.event - INFO - Update id=557185223 is handled. Duration 44411 ms by bot id=5702092394
2025-10-04 11:38:40,685 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:38:40,688 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:38:40,688 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:38:40,932 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:40:00,846 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:40:01,010 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:40:01,227 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:40:01,228 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:40:01,229 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:40:01,230 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:40:01,231 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:40:01,231 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:40:01,232 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:40:01,578 - aiogram.event - INFO - Update id=557185224 is handled. Duration 734 ms by bot id=5702092394
2025-10-04 11:40:02,280 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:40:02,281 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:40:02,362 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:40:02,385 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:40:02,403 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:40:02,419 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:40:02,426 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:40:02,428 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:40:02,429 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:40:02,429 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:40:02,674 - aiogram.event - INFO - Update id=557185225 is handled. Duration 395 ms by bot id=5702092394
2025-10-04 11:40:03,833 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:40:03,853 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:40:03,860 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:40:03,862 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:40:03,863 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:40:03,864 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:40:04,012 - aiogram.event - INFO - Update id=557185226 is handled. Duration 295 ms by bot id=5702092394
2025-10-04 11:40:05,285 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:40:05,285 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 11:40:05,286 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:40:05,312 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:40:08,384 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:40:19,742 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:40:19,743 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:40:19,806 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:40:19,850 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:40:19,893 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:40:19,938 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:40:19,981 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:40:20,012 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:40:20,107 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:40:20,108 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:40:21,968 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:40:21,977 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:40:23,194 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:40:34,533 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:40:34,534 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:40:34,598 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:40:34,647 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:40:34,693 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:40:34,733 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:40:34,772 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:40:34,802 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:40:34,875 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:40:34,876 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:40:36,570 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:40:36,570 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:40:36,571 - src.application.use_cases.upd_product - ERROR - Неизвестная ошибка при обновлении цены: 'NoneType' object has no attribute 'with_card'
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 75, in execute
    "with_card": new_price.with_card,
                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'with_card'
2025-10-04 11:40:36,586 - src.core.uow - WARNING - Исключение в Unit of Work: PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 11:40:36,589 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:40:36,589 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:40:36,590 - src.core.decorators - ERROR - Ошибка в функции update_product_price: Ошибка при обновлении цены товара 1818184981
2025-10-04 11:40:36,590 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 75, in execute
    "with_card": new_price.with_card,
                 ^^^^^^^^^^^^^^^^^^^
AttributeError: 'NoneType' object has no attribute 'with_card'

During handling of the above exception, another exception occurred:

Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 194, in handle_update_price
    updated_product = product_service.update_product_price(product_id)
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\core\decorators.py", line 64, in wrapper
    result = func(self, *args, **kwargs) # Убрал передачу аргумента uow
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\infrastructure\services\product_service.py", line 130, in update_product_price
    use_case.execute(
    ~~~~~~~~~~~~~~~~^
        product_id=product_id,
        ^^^^^^^^^^^^^^^^^^^^^^
        with_card=parsed["price_with_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        without_card=parsed["price_without_card"],
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    )
    ^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\application\use_cases\upd_product.py", line 85, in execute
    raise PriceUpdateError(f"Ошибка при обновлении цены товара {product_id}")
src.domain.exceptions.PriceUpdateError: Ошибка при обновлении цены товара 1818184981
2025-10-04 11:40:36,843 - aiogram.event - INFO - Update id=557185227 is handled. Duration 31560 ms by bot id=5702092394
2025-10-04 11:42:30,044 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:42:30,045 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:42:30,046 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:42:30,307 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:42:35,218 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:42:35,220 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:42:35,220 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:42:35,468 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:42:41,508 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:42:41,598 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:42:41,697 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:42:41,699 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:42:41,700 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:42:41,702 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:42:41,702 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:42:41,703 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:42:41,703 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:42:41,943 - aiogram.event - INFO - Update id=557185228 is handled. Duration 435 ms by bot id=5702092394
2025-10-04 11:42:42,567 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:42:42,567 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:42:42,593 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:42:42,610 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:42:42,625 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:42:42,637 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:42:42,641 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:42:42,643 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:42:42,644 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:42:42,645 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:42:42,755 - aiogram.event - INFO - Update id=557185229 is handled. Duration 190 ms by bot id=5702092394
2025-10-04 11:42:43,802 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:42:43,812 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:42:43,819 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:42:43,821 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:42:43,822 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:42:43,822 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:42:43,930 - aiogram.event - INFO - Update id=557185230 is handled. Duration 240 ms by bot id=5702092394
2025-10-04 11:42:44,920 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:42:44,921 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 11:42:44,921 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:42:44,935 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:42:46,327 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:42:57,639 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:42:57,640 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:42:57,693 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:42:57,722 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:42:57,756 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:42:57,807 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:42:57,848 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:42:57,875 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:42:57,972 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:42:57,973 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:42:59,701 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:42:59,709 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:43:00,909 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:43:12,289 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:43:12,290 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:43:12,356 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:43:12,402 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:43:12,459 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:43:12,501 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:43:12,534 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:43:12,555 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:43:12,625 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:43:12,625 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:43:14,262 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:43:14,263 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:43:14,269 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:43:14,271 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:43:14,273 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:43:14,273 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:43:14,273 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:43:14,274 - src.infrastructure.services.logger - INFO - Получили обновленный товар: <class 'dict'> - {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}}
2025-10-04 11:43:14,274 - src.infrastructure.services.logger - INFO - Формируем новое сообщение
2025-10-04 11:43:14,274 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:43:14,275 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-04 11:43:14,275 - src.infrastructure.services.logger - INFO - Обновляем сообщение с новыми данными
2025-10-04 11:43:14,504 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 213, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:43:14,619 - aiogram.event - INFO - Update id=557185231 is handled. Duration 29700 ms by bot id=5702092394
2025-10-04 11:46:23,666 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:46:23,668 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:46:23,668 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:46:23,805 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:46:29,221 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:46:29,223 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:46:29,224 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:46:29,439 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:46:36,233 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:46:36,329 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:46:36,428 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:46:36,429 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:46:36,429 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:46:36,431 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:46:36,432 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:46:36,432 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:46:36,432 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:46:36,662 - aiogram.event - INFO - Update id=557185232 is handled. Duration 429 ms by bot id=5702092394
2025-10-04 11:46:38,159 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:46:38,160 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:46:38,190 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:46:38,212 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:46:38,233 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:46:38,247 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:46:38,250 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:46:38,253 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:46:38,254 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:46:38,255 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:46:38,363 - aiogram.event - INFO - Update id=557185233 is handled. Duration 205 ms by bot id=5702092394
2025-10-04 11:46:39,618 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:46:39,633 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:46:39,641 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:46:39,644 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:46:39,645 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:46:39,645 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:46:39,744 - aiogram.event - INFO - Update id=557185234 is handled. Duration 219 ms by bot id=5702092394
2025-10-04 11:46:40,692 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:46:40,693 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:46:40,704 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:46:42,129 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:46:53,617 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:46:53,618 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:46:53,664 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:46:53,694 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:46:53,741 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:46:53,770 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:46:53,799 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:46:53,823 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:46:53,931 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:46:53,931 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:46:55,640 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:46:55,647 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:46:56,841 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:47:08,176 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:47:08,176 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:47:08,242 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:47:08,280 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:47:08,316 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:47:08,361 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:47:08,395 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:47:08,419 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:47:08,536 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:47:08,536 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:47:10,169 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:47:10,170 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:47:10,174 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:47:10,177 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:47:10,178 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:47:10,179 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:47:10,179 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:47:10,179 - src.infrastructure.services.logger - INFO - Получили обновленный товар: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}}
2025-10-04 11:47:10,179 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:47:10,180 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-04 11:47:10,180 - src.infrastructure.services.logger - INFO - Обновляем сообщение с новыми данными
2025-10-04 11:47:10,432 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 200, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:47:10,522 - aiogram.event - INFO - Update id=557185235 is handled. Duration 29832 ms by bot id=5702092394
2025-10-04 11:50:23,146 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:50:23,148 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:50:23,149 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:50:23,313 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:50:28,550 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:50:28,552 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:50:28,552 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:50:28,807 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:50:33,905 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:50:34,024 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:50:34,170 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:50:34,171 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:50:34,172 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:50:34,177 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:50:34,178 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:50:34,178 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:50:34,179 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:50:34,438 - aiogram.event - INFO - Update id=557185236 is handled. Duration 533 ms by bot id=5702092394
2025-10-04 11:50:36,418 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:50:36,419 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:50:36,452 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:50:36,473 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:50:36,488 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:50:36,503 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:50:36,506 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:50:36,510 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:50:36,511 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:50:36,512 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:50:36,616 - aiogram.event - INFO - Update id=557185237 is handled. Duration 198 ms by bot id=5702092394
2025-10-04 11:50:37,613 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:50:37,628 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:50:37,632 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:50:37,635 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:50:37,636 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:50:37,637 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:50:37,736 - aiogram.event - INFO - Update id=557185238 is handled. Duration 208 ms by bot id=5702092394
2025-10-04 11:50:38,890 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:50:38,973 - src.infrastructure.services.logger - INFO - Вызываем product_service.update_product_price
2025-10-04 11:50:38,974 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:50:38,987 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:50:40,446 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:50:51,885 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:50:51,885 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:50:51,950 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:50:52,020 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:50:52,063 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:50:52,103 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:50:52,139 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:50:52,168 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:50:52,250 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:50:52,250 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:50:53,975 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:50:53,984 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:50:55,231 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:51:06,629 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:51:06,630 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:51:06,671 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:51:06,700 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:51:06,733 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:51:06,766 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:51:06,802 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:51:06,837 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:51:06,914 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:51:06,914 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:51:08,546 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:51:08,547 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:51:08,556 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:51:08,560 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:51:08,562 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:08,562 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:08,563 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:51:08,563 - src.infrastructure.services.logger - INFO - Получили обновленный товар: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'link': 'https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'rating': 4.9, 'categories': '{"Канцелярские товары","Бумажная продукция",Наклейки}', 'latest_price': {'with_card': 145, 'without_card': 161}}
2025-10-04 11:51:08,563 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:51:08,564 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-04 11:51:08,565 - src.infrastructure.services.logger - INFO - Цена изменилась, обновляем сообщение
2025-10-04 11:51:08,814 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 207, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:51:08,909 - aiogram.event - INFO - Update id=557185239 is handled. Duration 30021 ms by bot id=5702092394
2025-10-04 11:51:45,612 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:51:45,614 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:51:45,614 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:51:45,748 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:51:50,131 - src.infrastructure.services.logger - INFO - Бот запущен
2025-10-04 11:51:50,132 - src.infrastructure.services.logger - INFO - Все хендлеры зарегистрированы.
2025-10-04 11:51:50,133 - aiogram.dispatcher - INFO - Start polling
2025-10-04 11:51:50,349 - aiogram.dispatcher - INFO - Run polling for bot @heavenyoung_testbot id=5702092394 - 'testtest'
2025-10-04 11:51:54,324 - src.core.db_connection - INFO - Инициализация подключения к БД: postgresql+psycopg2://postgres:1234@192.168.1.50:5432/pricely_db
2025-10-04 11:51:54,421 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:51:54,529 - src.infrastructure.database.repositories.user_repository - INFO - Пользователь User(id='515084006', username='heavenyoung', chat_id='515084006', products=['1818184981', '1728110604', '1668950019', '1565602444']) получен по id: 515084006
2025-10-04 11:51:54,530 - src.application.use_cases.create_user - INFO - Пользователь 515084006 уже существует, пропускаем создание
2025-10-04 11:51:54,530 - src.core.decorators - INFO - Функция create_user: выполняется commit транзакции
2025-10-04 11:51:54,532 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:54,533 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:54,534 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:51:54,534 - src.infrastructure.services.logger - INFO - Пользователь 515084006 создан или уже существует
2025-10-04 11:51:54,787 - aiogram.event - INFO - Update id=557185240 is handled. Duration 463 ms by bot id=5702092394
2025-10-04 11:51:56,016 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:51:56,017 - src.application.use_cases.get_user_products - INFO - Запрос списка товаров для пользователя ID: 515084006
2025-10-04 11:51:56,046 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:51:56,066 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1728110604', user_id='', name='Xiaomi S20 EU (BHR8629EU) Робот-пылесос, сухая и влажная уборка, белый', link='https://www.ozon.ru/product/xiaomi-s20-eu-bhr8629eu-robot-pylesos-suhaya-i-vlazhnaya-uborka-belyy-1728110604/', image_url='https://ir.ozone.ru/s3/multimedia-1-8/wc1000/7922729852.jpg', rating=4.8, categories='{"Бытовая техника","Техника для дома",Пылесосы,Роботы-пылесосы,Xiaomi}', prices=[Price(id=17, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 16, 39, 30, 705555)), Price(id=18, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 40, 5, 451004)), Price(id=19, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 42, 17, 196145)), Price(id=20, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 44, 4, 901044)), Price(id=21, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 46, 57, 87346)), Price(id=22, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 16, 50, 48, 653461)), Price(id=23, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 17, 1, 20, 444851)), Price(id=24, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 34, 42, 580920)), Price(id=25, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 36, 0, 48055)), Price(id=26, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 38, 8, 854926)), Price(id=27, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 39, 5, 241925)), Price(id=28, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 18, 40, 12, 932794)), Price(id=29, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 32, 537599)), Price(id=30, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 13, 55, 559731)), Price(id=31, product_id='1728110604', with_card=14452, without_card=14598, previous_with_card=14452, previous_without_card=14598, created_at=datetime.datetime(2025, 9, 29, 21, 14, 13, 910458))]) (ID: 1728110604)
2025-10-04 11:51:56,081 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1668950019', user_id='', name='Легинсы FITFOX Спорт Фитнес', link='https://www.ozon.ru/product/leginsy-fitfox-sport-fitnes-1668950019/', image_url='https://ir.ozone.ru/s3/multimedia-1-p/wc1000/7185334021.jpg', rating=4.9, categories='{Одежда,Женщинам,"Брюки, бриджи и капри",FITFOX}', prices=[Price(id=32, product_id='1668950019', with_card=1568, without_card=1705, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 49, 1, 5209)), Price(id=38, product_id='1668950019', with_card=1575, without_card=1713, previous_with_card=1568, previous_without_card=1705, created_at=datetime.datetime(2025, 10, 3, 22, 10, 27, 666681))]) (ID: 1668950019)
2025-10-04 11:51:56,093 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1565602444', user_id='', name='Ray-Ban Очки солнцезащитные', link='https://www.ozon.ru/product/ray-ban-ochki-solntsezashchitnye-1565602444/', image_url='https://ir.ozone.ru/s3/multimedia-1-a/wc1000/7364741986.jpg', rating=4.7, categories='{Аксессуары,Женщинам,Очки,"Солнцезащитные очки",Ray-Ban}', prices=[Price(id=33, product_id='1565602444', with_card=737, without_card=805, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 10, 1, 14, 52, 24, 119143))]) (ID: 1565602444)
2025-10-04 11:51:56,098 - src.core.decorators - INFO - Функция get_all_products: commit пропущен, выполняется rollback
2025-10-04 11:51:56,101 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:51:56,101 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:56,103 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:51:56,203 - aiogram.event - INFO - Update id=557185241 is handled. Duration 187 ms by bot id=5702092394
2025-10-04 11:51:57,299 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:51:57,315 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:51:57,320 - src.core.decorators - INFO - Функция get_full_product: commit пропущен, выполняется rollback
2025-10-04 11:51:57,324 - src.core.uow - INFO - Unit of Work: транзакция откачена, rollback выполнен
2025-10-04 11:51:57,326 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:51:57,327 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:51:57,443 - aiogram.event - INFO - Update id=557185242 is handled. Duration 227 ms by bot id=5702092394
2025-10-04 11:51:58,279 - src.infrastructure.services.logger - INFO - Начинаем обновление цены для товара 1818184981
2025-10-04 11:51:58,355 - src.infrastructure.services.logger - INFO - Вызываем service.update_product_price
2025-10-04 11:51:58,356 - src.core.uow - INFO - Unit of Work инициализирован с сессией и репозиториями
2025-10-04 11:51:58,372 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:51:59,713 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:52:11,080 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:52:11,081 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:52:11,147 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:52:11,193 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:52:11,243 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:52:11,293 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:52:11,343 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:52:11,373 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:52:11,450 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:52:11,451 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:52:13,113 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:52:13,119 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:52:14,347 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно инициализирован.
2025-10-04 11:52:25,703 - src.infrastructure.parsers.session_engine - INFO - Успешно загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:52:25,704 - src.infrastructure.parsers.ozon_parser - INFO - Загружена страница: https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/
2025-10-04 11:52:25,750 - src.infrastructure.parsers.ozon_parser - INFO - Найден артикул: 1818184981
2025-10-04 11:52:25,780 - src.infrastructure.parsers.ozon_parser - INFO - Найдено название товара: Наклейка на банковскую карту крекер
2025-10-04 11:52:25,811 - src.infrastructure.parsers.ozon_parser - INFO - Найден рейтинг: 4.9
2025-10-04 11:52:25,839 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена с картой: 145
2025-10-04 11:52:25,868 - src.infrastructure.parsers.ozon_parser - INFO - Найдена цена без карты: 161
2025-10-04 11:52:25,890 - src.infrastructure.parsers.ozon_parser - INFO - Найдено изображение: https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg
2025-10-04 11:52:25,951 - src.infrastructure.parsers.ozon_parser - INFO - Найдены категории: ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']
2025-10-04 11:52:25,952 - src.infrastructure.parsers.ozon_parser - INFO - РЕЗУЛЬТАТ ПАРСИНГА!!!: {'id': '1818184981', 'name': 'Наклейка на банковскую карту крекер', 'rating': 4.9, 'price_with_card': 145, 'price_without_card': 161, 'image_url': 'https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', 'categories': ['Канцелярские товары', 'Бумажная продукция', 'Наклейки']}
2025-10-04 11:52:27,560 - src.infrastructure.parsers.session_engine - INFO - WebDriver успешно закрыт.
2025-10-04 11:52:27,561 - src.application.use_cases.upd_product - INFO - Цена товара 1818184981 не изменилась
2025-10-04 11:52:27,568 - src.infrastructure.database.repositories.product_repository - INFO - Найден Товар: Product(id='1818184981', user_id='', name='Наклейка на банковскую карту крекер', link='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/', image_url='https://ir.ozone.ru/s3/multimedia-1-5/wc1000/7257215525.jpg', rating=4.9, categories='{"Канцелярские товары","Бумажная продукция",Наклейки}', prices=[Price(id=13, product_id='1818184981', with_card=156, without_card=173, previous_with_card=None, previous_without_card=None, created_at=datetime.datetime(2025, 9, 29, 15, 21, 37, 8287)), Price(id=14, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 12, 30, 49, 202120)), Price(id=15, product_id='1818184981', with_card=156, without_card=173, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 9, 29, 15, 37, 32, 25339)), Price(id=34, product_id='1818184981', with_card=145, without_card=161, previous_with_card=156, previous_without_card=173, created_at=datetime.datetime(2025, 10, 3, 18, 6, 17, 889458)), Price(id=35, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 18, 32, 50, 660873)), Price(id=36, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 21, 38, 680092)), Price(id=37, product_id='1818184981', with_card=145, without_card=161, previous_with_card=145, previous_without_card=161, created_at=datetime.datetime(2025, 10, 3, 19, 22, 45, 891365))]) (ID: 1818184981)
2025-10-04 11:52:27,573 - src.core.decorators - INFO - Функция update_product_price: выполняется commit транзакции
2025-10-04 11:52:27,576 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:52:27,576 - src.core.uow - INFO - Unit of Work: транзакция зафиксирована, commit выполнен
2025-10-04 11:52:27,577 - src.core.uow - INFO - Unit of Work завершил работу, сессия закрыта
2025-10-04 11:52:27,577 - src.infrastructure.services.logger - INFO - Получили обновленный товар
2025-10-04 11:52:27,577 - src.infrastructure.services.logger - INFO - Сформированный текст: 📦 Наклейка на банковскую карту крекер
💳 Цена с картой: 145 ₽
💵 Цена без карты: 161 ₽
🔗 <a href='https://www.ozon.ru/product/nakleyka-na-bankovskuyu-kartu-kreker-1818184981/'>Ссылка на товар</a>
2025-10-04 11:52:27,578 - src.infrastructure.services.logger - INFO - Клавиатура сформирована
2025-10-04 11:52:27,578 - src.infrastructure.services.logger - INFO - Цена изменилась, обновляем сообщение
2025-10-04 11:52:27,827 - src.infrastructure.services.logger - ERROR - ❌ Ошибка при обновлении цены
Traceback (most recent call last):
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\src\presentation\bot\handlers\products.py", line 206, in handle_update_price
    await call.message.edit_text(
    ...<4 lines>...
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\methods\base.py", line 84, in emit
    return await bot(self)
           ^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\bot.py", line 482, in __call__
    return await self.session(self, method, timeout=request_timeout)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 254, in __call__
    return cast(TelegramType, await middleware(bot, method))
                              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\aiohttp.py", line 185, in make_request
    response = self.check_response(
        bot=bot, method=method, status_code=resp.status, content=raw_result
    )
  File "C:\Users\Mefyod-EA\Documents\my_projects\pricely\.venv\Lib\site-packages\aiogram\client\session\base.py", line 120, in check_response
    raise TelegramBadRequest(method=method, message=description)
aiogram.exceptions.TelegramBadRequest: Telegram server says - Bad Request: message is not modified: specified new message content and reply markup are exactly the same as a current content and reply markup of the message
2025-10-04 11:52:27,924 - aiogram.event - INFO - Update id=557185243 is handled. Duration 29647 ms by bot id=5702092394
2025-10-04 11:53:59,912 - aiogram.dispatcher - INFO - Polling stopped
2025-10-04 11:53:59,914 - aiogram.dispatcher - ERROR - Failed to fetch updates - TelegramNetworkError: HTTP Client says - ServerDisconnectedError: Server disconnected
2025-10-04 11:53:59,914 - aiogram.dispatcher - WARNING - Sleep for 1.000000 seconds and try again... (tryings = 0, bot id = 5702092394)
2025-10-04 11:54:00,053 - aiogram.dispatcher - INFO - Polling stopped for bot @heavenyoung_testbot id=5702092394 - 'testtest'
