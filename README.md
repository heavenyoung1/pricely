# 📉 Pricely

┌──────────────────────────┐
│  Внешний мир (Telegram)  │
└─────────────┬────────────┘
              │ JSON / FormData
              ▼
┌──────────────────────────┐
│     DTO (Pydantic)       │ ← Валидация входных данных
└─────────────┬────────────┘
              │ dto_to_entity()
              ▼
┌──────────────────────────┐
│   Domain Entities         │ ← Чистые классы бизнес-логики
└─────────────┬────────────┘
              │ передаём в UseCase
              ▼
┌──────────────────────────┐
│   UseCases                │ ← Бизнес-правила
└─────────────┬────────────┘
              │ вызывает
              ▼
┌──────────────────────────┐
│ Repository Interfaces    │ ← Контракты (сигнатуры методов)
└─────────────┬────────────┘
              │ реализуются в
              ▼
┌──────────────────────────┐
│ Repository Implementations│ ← SQLAlchemy, файлы, API
└─────────────┬────────────┘
              │ entity_to_orm()
              ▼
┌──────────────────────────┐
│ ORM модели (SQLAlchemy)  │ ← Таблицы и поля БД
└─────────────┬────────────┘
              │ session.commit()
              ▼
┌──────────────────────────┐
│        База данных       │
└──────────────────────────┘
-----------------------
Controller / Handler (например, FastAPI endpoint)
        │
        ▼
   ProductService
        │
   ┌────┴────────────────────────────┐
   │ Открывает UnitOfWork             │
   │ Создаёт репозитории              │
   │ Запускает UseCase                │
   └──────────────────────────────────┘
        │
        ▼
  CreateProductUseCase
        │
  ┌─────┴─────────────────────────────┐
  │ Сохраняет в репозитории            │
  │ Проверяет бизнес-правила           │
  │ Обновляет сущности                 │
  └────────────────────────────────────┘
        │
        ▼
 Реализация репозиториев (SQLAlchemy, API, файл и т.д.)



 ------------------------------

 Чеклист готовности к деплою
(DDD + UoW + сервисы + API)

1. Доменный слой (Domain Layer)
 Сущности (Product, Price, User) определены

 Интерфейсы репозиториев (ProductRepository, PriceRepository, UserRepository) есть

 Бизнес-правила инкапсулированы в сущностях или UseCase

2. DTO и маппинг
 DTO для создания (ProductCreateDTO, PriceCreateDTO, UserCreateDTO)

 Мапперы DTO → Entity (dto_to_entity)

 При необходимости — мапперы Entity → DTO для ответов API

3. Репозитории и UoW
 InMemory-репозитории для тестов

 FakeUnitOfWork для тестов

 Настоящие репозитории для БД (SQLAlchemy/AsyncSQLAlchemy)

 Реальный UnitOfWork, работающий с транзакциями БД

4. Сервисы и UseCases
 ProductService реализован

 Сквозной сценарий сохранения продукта с ценой и пользователем

 Остальные сценарии (удаление, обновление, выборки)

 Обработка ошибок (например, если продукт уже существует)

5. API слой
 FastAPI-приложение с эндпоинтами:

POST /products — создание продукта с ценой

GET /products/{id} — получение продукта

DELETE /products/{id} — удаление

и др.

 Подключение реального UoW к API

 Сериализация/десериализация через Pydantic

6. Конфигурация
 Файл .env с настройками (БД, порты, логирование и т.п.)

 Pydantic Settings или аналог для загрузки конфигурации

 Конфиг для логирования

7. База данных
 SQLAlchemy-модели

 Миграции Alembic

 Скрипт инициализации БД (опционально — автосоздание таблиц)

8. Тесты
 Unit-тесты сервиса

 Unit-тесты репозиториев (InMemory и реальные)

 Интеграционные тесты API

 Тесты на обработку ошибок

9. Документация
 README с инструкцией по запуску (dev/prod)

 Пример .env файла

 Описание архитектуры (UoW, репозитории, сервисы)

10. Деплой
 Dockerfile для приложения

 docker-compose для dev и prod (с БД)

 Скрипт миграций в деплое

 Настройка запуска (gunicorn/uvicorn)