# 📉 Pricely

Запрос в API — FastAPI принимает ProductCreateDTO, PriceCreateDTO, UserCreateDTO.

DTO → Entity — маппер конвертирует Pydantic DTO в чистые доменные объекты.

UseCase — CreateProductUseCase получает доменные объекты и управляет бизнес-логикой.

Repository — инфраструктурная реализация сохраняет объекты через ORM.

ORM ↔ Entity — мапперы конвертируют между слоями.

------------

DTO — временный объект для обмена данными

Пользователь отправляет данные в Telegram-бот.

Бот формирует DTO (валидирует вход).

Маппер переводит DTO → Entity.

Use case получает Entity и вызывает методы репозиториев.

Репозиторий через ORM-модель сохраняет данные в базе.

Если нужно вернуть ответ — ORM → Entity → DTO → бот отправляет пользователю.

[Telegram Bot] 
    ↓ (DTO)
[Маппер DTO→Entity] 
    ↓ (Entity)
[Use Case] 
    ↓ (Entity)
[Repository Interface]
    ↓ (Entity ↔ ORM-модель)
[PostgreSQL]

--------------------

[Внешний мир: Телеграм-бот / API]
            │
            ▼
   Interfaces (DTO + мапперы DTO → Entity)
            │
            ▼
   UseCases (Бизнес-логика)
            │
            ▼
   Domain Entities (Чистые модели)
            │
            ▼
   Repository Interfaces (Контракты)
            │
            ▼
   Repository Implementations (SQLAlchemy и др.)
            │
            ▼
        ORM модели
            │
            ▼
        База данных


-------------------

Entities — ядро, чистые объекты для бизнес-логики.

DTO — безопасный слой общения с внешним миром (валидация, сериализация).

ORM — техническое представление данных для БД.

Мапперы — клеят всё это между собой, но при этом слои остаются независимыми.

Такой подход позволяет:

Заменить БД (Postgres → SQLite) без переписывания UseCase'ов.

Заменить интерфейс (Telegram → API) без изменения бизнес-логики.

------------------
JSON (от бота/API)
    ↓ (Pydantic валидирует)
DTO
    ↓ (маппер DTO → Entity)
Entity
    ↓ (маппер Entity → ORM)
ORM-модель
    ↓ (SQLAlchemy session.commit())
БД


┌──────────────────────────┐
│  Внешний мир (Telegram)  │
└─────────────┬────────────┘
              │ JSON / FormData
              ▼
┌──────────────────────────┐
│     DTO (Pydantic)       │ ← Валидация входных данных
└─────────────┬────────────┘
              │ dto_to_entity()
              ▼
┌──────────────────────────┐
│   Domain Entities         │ ← Чистые классы бизнес-логики
└─────────────┬────────────┘
              │ передаём в UseCase
              ▼
┌──────────────────────────┐
│   UseCases                │ ← Бизнес-правила
└─────────────┬────────────┘
              │ вызывает
              ▼
┌──────────────────────────┐
│ Repository Interfaces    │ ← Контракты (сигнатуры методов)
└─────────────┬────────────┘
              │ реализуются в
              ▼
┌──────────────────────────┐
│ Repository Implementations│ ← SQLAlchemy, файлы, API
└─────────────┬────────────┘
              │ entity_to_orm()
              ▼
┌──────────────────────────┐
│ ORM модели (SQLAlchemy)  │ ← Таблицы и поля БД
└─────────────┬────────────┘
              │ session.commit()
              ▼
┌──────────────────────────┐
│        База данных       │
└──────────────────────────┘